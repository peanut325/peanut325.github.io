

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/bg/example.png">
  <link rel="icon" href="/img/bg/example.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="peanut">
  <meta name="keywords" content="">
  
    <meta name="description" content="项目介绍尚筹网项目介绍本项目视频为B站尚硅谷的尚筹网课程，为单一架构过渡到分布式架构的项目，使用Maven管理项目，后台使用SSM框架单一架构，前台使用Springboot和SpringCloud分布式架构（其中会使用SpringSecurity做权限控制，SpringSeesion等Spring家族的产品），数据存储使用mysql，redis数据库，页面显示部分后台页面使用jsp，前台页面使用h">
<meta property="og:type" content="article">
<meta property="og:title" content="尚筹网">
<meta property="og:url" content="http://example.com/2022/02/01/%E5%B0%9A%E7%AD%B9%E7%BD%91/index.html">
<meta property="og:site_name" content="peanut&#39; blog">
<meta property="og:description" content="项目介绍尚筹网项目介绍本项目视频为B站尚硅谷的尚筹网课程，为单一架构过渡到分布式架构的项目，使用Maven管理项目，后台使用SSM框架单一架构，前台使用Springboot和SpringCloud分布式架构（其中会使用SpringSecurity做权限控制，SpringSeesion等Spring家族的产品），数据存储使用mysql，redis数据库，页面显示部分后台页面使用jsp，前台页面使用h">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/bg/258726044.jpg">
<meta property="article:published_time" content="2022-02-01T02:00:00.000Z">
<meta property="article:modified_time" content="2022-02-03T06:46:59.656Z">
<meta property="article:author" content="peanut">
<meta property="article:tag" content="SSM">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="SpringCloud">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/bg/258726044.jpg">
  
  
  <title>尚筹网 - peanut&#39; blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":"flase"},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  <header style="height: 100vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>peanut325</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/bg/crowdback.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="尚筹网">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-02-01 10:00" pubdate>
        2022年2月1日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      241k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      2009 分钟
    </span>
  

  
  
</div>

            
          </div>

          
            <div class="scroll-down-bar">
              <i class="iconfont icon-arrowdown"></i>
            </div>
          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">尚筹网</h1>
            
            <div class="markdown-body">
              <h1 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h1><h2 id="尚筹网项目介绍"><a href="#尚筹网项目介绍" class="headerlink" title="尚筹网项目介绍"></a>尚筹网项目介绍</h2><p>本项目视频为B站尚硅谷的尚筹网课程，为单一架构过渡到分布式架构的项目，使用Maven管理项目，<strong>后台使用SSM框架单一架构，前台使用Springboot和SpringCloud分布式架构</strong>（其中会使用SpringSecurity做权限控制，SpringSeesion等Spring家族的产品），数据存储使用mysql，redis数据库，页面显示部分后台页面使用<strong>jsp</strong>，前台页面使用<strong>html+Thymeleaf</strong>视图解析器。</p>
<h2 id="尚筹网项目构架"><a href="#尚筹网项目构架" class="headerlink" title="尚筹网项目构架"></a>尚筹网项目构架</h2><p><img src="/img/atcrowdfunding.assets/image-20220203131505582.png" alt="image-20220203131505582"></p>
<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><h2 id="总体目标"><a href="#总体目标" class="headerlink" title="总体目标"></a>总体目标</h2><p><img src="/img/atcrowdfunding.assets/project.png" alt="image-20220101150454662"></p>
<h2 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h2><ul>
<li>项目关系如下</li>
</ul>
<p><img src="/img/atcrowdfunding.assets/image-20220203131301256.png" alt="image-20220203131301256"></p>
<ul>
<li><p>工程创建计划</p>
<figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div></td><td class="code"><pre><code class="hljs java">atcrowdfunding01-admin-parent <br><br>groupId：com.atguigu.crowd <br><br>artifactId：atcrowdfunding01-admin-parent <br><br>packaging：pom<br><br><br><br>atcrowdfunding02-admin-webui <br><br>groupId：com.atguigu.crowd <br><br>artifactId：atcrowdfunding02-admin-webui <br><br>packaging：war<br><br><br><br>atcrowdfunding03-admin-component <br><br>groupId：com.atguigu.crowd <br><br>artifactId：atcrowdfunding03-admin-component <br><br>packaging：jar<br><br><br><br>atcrowdfunding04-admin-entity <br><br>groupId：com.atguigu.crowd<br><br>artifactId：atcrowdfunding04-admin-entity<br><br>packaging：jar <br><br><br><br>atcrowdfunding05-common-util<br><br>groupId：com.atguigu.crowd <br><br>artifactId：atcrowdfunding05-common-util <br><br>packaging：jar<br><br><br><br>atcrowdfunding06-common-reverse <br><br>groupId：com.atguigu.crowd <br><br>artifactId：atcrowdfunding06-common-reverse <br><br>packaging：jar<br></code></pre></td></tr></table></figure></li>
<li><p>建立工程之间的依赖关系</p>
<p>webui 依赖 component </p>
<p>component 依赖 entity </p>
<p>component 依赖 util</p>
<p>在IDEA模板pom中导入dependence依赖即可</p>
</li>
<li><p><img src="/img/atcrowdfunding.assets/image-20220107110616599.png" alt="image-20220107110616599"></p>
</li>
</ul>
<h2 id="创建数据库和数据库表"><a href="#创建数据库和数据库表" class="headerlink" title="创建数据库和数据库表"></a>创建数据库和数据库表</h2><ul>
<li><p>物理建模</p>
<ul>
<li>第一范式：数据库表中的每一列都不可再分，也就是原子性</li>
</ul>
<p><img src="/img/atcrowdfunding.assets/image-20220101160030116.png" alt="image-20220101160030116"></p>
<p>​                            这个表中“部门”和“岗位”应该拆分成两个字段：“部门名称”、“岗位”。</p>
<p><img src="/img/atcrowdfunding.assets/image-20220101160107255.png" alt="image-20220101160107255"></p>
<p>​                            这样才能够专门针对“部门”或“岗位”进行查询。</p>
<ul>
<li> 第二范式：在满足第一范式基础上要求每个字段都和主键完整相关，而不是仅和主键部分相关（主要针对联合主键而言）</li>
</ul>
<p>  <img src="/img/atcrowdfunding.assets/image-20220101160328142.png" alt="image-20220101160328142"></p>
<p>  “订单详情表”使用“订单编号”和“产品编号”作为联合主键。此时“产品价格”、“产品数量”都和联合主键整体相关，但“订单金额”和“下单时间” 只和联合主键中的“订单编号”相关，和“产品编号”无关。所以只关联了主键中的部分字段，不满足第二范式。</p>
<p>  把“订单金额”和“下单时间”移到订单表就符合第二范式了</p>
<p>  <img src="/img/atcrowdfunding.assets/image-20220101160420380.png" alt="image-20220101160420380"></p>
<ul>
<li><p>第三范式：表中的非主键字段和主键字段直接相关，不允许间接相关</p>
<p><img src="/img/atcrowdfunding.assets/image-20220101160448251.png" alt="image-20220101160448251"></p>
<p>上面表中的“部门名称”和“员工编号”的关系是“员工编号”→“部门编号”</p>
<p>→“部门名称”，不是直接相关。此时会带来下列问题：</p>
<ul>
<li><p>数据冗余：“部门名称”多次重复出现。</p>
</li>
<li><p>插入异常：组建一个新部门时没有员工信息，也就无法单独插入部门 信息。就算强行插入部门信息，员工表中没有员工信息的记录同样是 非法记录。</p>
</li>
<li><p> 删除异常：删除员工信息会连带删除部门信息导致部门信息意外丢失。</p>
</li>
<li><p>更新异常：哪怕只修改一个部门的名称也要更新多条员工记录。 正确的做法是：把上表拆分成两张表，以外键形式关联</p>
</li>
<li><p><img src="/img/atcrowdfunding.assets/image-20220101160539404.png" alt="image-20220101160539404"></p>
<p>“部门编号”和“员工编号”是直接相关的。</p>
<p>第二范式的另一种表述方式是：两张表要通过外键关联，不保存冗余字段。例 如：不能在“员工表”中存储“部门名称”</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="建表："><a href="#建表：" class="headerlink" title="建表："></a>建表：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DATABASE project_rowd <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8;<br><br>USE project_rowd;<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> t_admin;				# 如果存在t_admin则删除存在的表<br>    <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t_admin (<br>    id <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> auto_increment,			# 主键<br>    login_acct <span class="hljs-type">VARCHAR</span> ( <span class="hljs-number">255</span> ) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,	# 登录账号<br>    user_pswd <span class="hljs-type">CHAR</span> ( <span class="hljs-number">32</span> ) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,			# 登录密码<br>    user_name <span class="hljs-type">VARCHAR</span> ( <span class="hljs-number">255</span> ) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,		# 昵称<br>    email <span class="hljs-type">VARCHAR</span> ( <span class="hljs-number">255</span> ) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,			# 邮件地址<br>    create_time <span class="hljs-type">CHAR</span> ( <span class="hljs-number">19</span> ),				# 创建时间<br>    <span class="hljs-keyword">PRIMARY</span> KEY ( id ) 						# 设置主键<br>);<br></code></pre></td></tr></table></figure>

<p> 进行基于Maven的逆向工程（根据已存在的表，在项目中逆向生成对应的实体类、Mapper文件、Mapper接口）</p>
<h3 id="在reverse模块中进行逆向："><a href="#在reverse模块中进行逆向：" class="headerlink" title="在reverse模块中进行逆向："></a>在reverse模块中进行逆向：</h3><h4 id="pom-xml中导入依赖"><a href="#pom-xml中导入依赖" class="headerlink" title="pom.xml中导入依赖"></a>pom.xml中导入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 控制Maven在构建过程中的相关配置 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.generator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- 逆向工程核心依赖 --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.generator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-generator-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mchange<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>c3p0<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--MySQL驱动--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.15<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="编写generatorConfig-xml文"><a href="#编写generatorConfig-xml文" class="headerlink" title="编写generatorConfig.xml文"></a>编写generatorConfig.xml文</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">generatorConfiguration</span></span><br><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">generatorConfiguration</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;atguiguTables&quot;</span> <span class="hljs-attr">targetRuntime</span>=<span class="hljs-string">&quot;MyBatis3&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">commentGenerator</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 是否去除自动生成的注释 true：是 ： false:否 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;suppressAllComments&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">commentGenerator</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- 数据库链接URL、用户名、密码 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">jdbcConnection</span></span><br><span class="hljs-tag">                <span class="hljs-attr">driverClass</span>=<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">connectionURL</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/project_crowd?serverTimezone=UTC&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">userId</span>=<span class="hljs-string">&quot;root&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">jdbcConnection</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        默认false，把JDBC DECIMAL 和 NUMERIC 类型解析为 Integer</span><br><span class="hljs-comment">            true，把JDBC DECIMAL 和 NUMERIC 类型解析为java.math.BigDecimal</span><br><span class="hljs-comment">        --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">javaTypeResolver</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;forceBigDecimals&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">javaTypeResolver</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        生成model模型，对应的包路径，以及文件存放路径(targetProject)，targetProject可以指定具体的路径,如./src/main/java，</span><br><span class="hljs-comment">        也可以使用“MAVEN”来自动生成，这样生成的代码会在target/generatord-source目录下</span><br><span class="hljs-comment">        --&gt;</span><br>        <span class="hljs-comment">&lt;!--&lt;javaModelGenerator targetPackage=&quot;com.joey.mybaties.test.pojo&quot; targetProject=&quot;MAVEN&quot;&gt;--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">javaModelGenerator</span> <span class="hljs-attr">targetPackage</span>=<span class="hljs-string">&quot;crowd.entity&quot;</span> <span class="hljs-attr">targetProject</span>=<span class="hljs-string">&quot;.\src\main\java&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--是否让schema作为包的后缀--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;enableSubPackages&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br>            <span class="hljs-comment">&lt;!-- 从数据库返回的值被清理前后的空格  --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;trimStrings&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">javaModelGenerator</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!--对应的mapper.xml文件  --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">sqlMapGenerator</span> <span class="hljs-attr">targetPackage</span>=<span class="hljs-string">&quot;mapper&quot;</span> <span class="hljs-attr">targetProject</span>=<span class="hljs-string">&quot;.\src\main\java&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--是否让schema作为包的后缀--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;enableSubPackages&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">sqlMapGenerator</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- 对应的Mapper接口类文件 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">javaClientGenerator</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;XMLMAPPER&quot;</span> <span class="hljs-attr">targetPackage</span>=<span class="hljs-string">&quot;org.fall.mapper&quot;</span> <span class="hljs-attr">targetProject</span>=<span class="hljs-string">&quot;.\src\main\java&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--是否让schema作为包的后缀--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;enableSubPackages&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">javaClientGenerator</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- 数据库表名与需要的实体类对应映射的指定 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_admin&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;Admin&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">context</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">generatorConfiguration</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p> 在IDEA中进行逆向工程的方法：</p>
<p><img src="/img/atcrowdfunding.assets/image-20220101163657740.png" alt="image-20220101163657740"></p>
<p>运行完后，应当对产生的所有文件各归各位（Mapper接口放入component的mapper包下；实体类放入entity模块的entity包；xxxMapper.xml放入webui的resources文件夹下<strong>（xml放在web模块下方便寻找）</strong>）</p>
<h2 id="通过父工程管理依赖版本"><a href="#通过父工程管理依赖版本" class="headerlink" title="通过父工程管理依赖版本"></a>通过父工程管理依赖版本</h2><p>在父工程通过<strong>dependencyManagement</strong>标签管理依赖版本，但是在子工程正式通过<strong>dependencies</strong>标签导入依赖前，这些依赖并不会生效</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--通过properties标签指定一些需要重用的版本号，方便在后面调用--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">fall.spring.version</span>&gt;</span>4.3.20.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">fall.spring.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">fall.spring.security.version</span>&gt;</span>4.2.10.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">fall.spring.security.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--依赖管理--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- Spring 依赖 --&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-orm --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-orm<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;fall.spring.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;fall.spring.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;fall.spring.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- Spring AOP --&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.aspectj/aspectjweaver --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/cglib/cglib --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- 数据库依赖 --&gt;</span><br>        <span class="hljs-comment">&lt;!-- MySQL 驱动 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.15<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 数据源 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- MyBatis --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- MyBatis 与 Spring 整合 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- MyBatis 分页插件 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- 日志 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 其他日志框架的中间转换包 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.25<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jul-to-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.25<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- Spring 进行 JSON 数据转换依赖 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.11.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.11.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- JSTL 标签库 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jstl<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jstl<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- junit 测试 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- 引入 Servlet 容器中相关依赖 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- JSP 页面使用的依赖 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jsp-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.3-b06<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.google.code.gson/gson --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.code.gson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.8.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- SpringSecurity 对 Web 应用进行权限管理 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;fall.spring.security.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- SpringSecurity 配置 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;fall.spring.security.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- SpringSecurity 标签库 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-taglibs<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;fall.spring.security.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="Spring整合MyBatis"><a href="#Spring整合MyBatis" class="headerlink" title="Spring整合MyBatis"></a>Spring整合MyBatis</h2><p>思路:</p>
<p><img src="/img/atcrowdfunding.assets/image-20220101175446685.png" alt="image-20220101175446685"></p>
<h3 id="1、配置Maven依赖"><a href="#1、配置Maven依赖" class="headerlink" title="1、配置Maven依赖"></a>1、配置Maven依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--依赖entity--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>crowdfunding04-admin-entity<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--依赖util--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>crowdfunding05-common-util<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- Spring 依赖 --&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-orm --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-orm<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- Spring AOP --&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.aspectj/aspectjweaver --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/cglib/cglib --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 数据库依赖 --&gt;</span><br>    <span class="hljs-comment">&lt;!-- MySQL 驱动 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 数据源 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- MyBatis --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- MyBatis 与 Spring 整合 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- MyBatis 分页插件 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- Spring 进行 JSON 数据转换依赖 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- JSTL 标签库 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jstl<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jstl<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.google.code.gson/gson --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.code.gson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="2-创建配置文件"><a href="#2-创建配置文件" class="headerlink" title="2.创建配置文件"></a>2.创建配置文件</h3><ul>
<li><p>mybatis-config.xml 全局配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">configuration</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Config 3.0/EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--Spring与MyBatis整合后，MyBatis的配置文件可有可不有--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>jdbc.properties</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml">jdbc.user=root<br>jdbc.password=...<br>jdbc.Driver=com.mysql.cj.jdbc.Driver<br>jdbc.url=jdbc:mysql://localhost:3306/project_crowd?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8<br></code></pre></td></tr></table></figure></li>
<li><p>spring-persist-mybatis.xml 整合mybatis文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">                            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--扫描properties配置文件--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;jdbc.properties&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context:property-placeholder</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--  数据源配置  --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.user&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClassName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.Driver&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-测试"><a href="#3-测试" class="headerlink" title="3.测试"></a>3.测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> test;<br><br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> org.junit.runner.RunWith;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.test.context.ContextConfiguration;<br><span class="hljs-keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;<br><br><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><br><span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="hljs-meta">@ContextConfiguration(locations = &#123;&quot;classpath:spring-persist-mybatis.xml&quot;&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdTest</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DataSource dataSource;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testConnect</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        Connection connection = dataSource.getConnection();<br>        System.out.println(connection);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以打印出connection的数据，而不是报空指针异常，得出结论：整合成功。</p>
<h4 id="遇到的bug"><a href="#遇到的bug" class="headerlink" title="遇到的bug"></a>遇到的bug</h4><p>无法创建sqlsessionfactory，原因是在逆向工程生成后，mybatis文件进行了移动，导致mybatis文件中namespace，resultmap中全类名错误。</p>
<h2 id="日志系统整合"><a href="#日志系统整合" class="headerlink" title="日志系统整合"></a>日志系统整合</h2><h3 id="日志的意义"><a href="#日志的意义" class="headerlink" title="日志的意义"></a>日志的意义</h3><p>大量使用sysout不仅耗时，而且消耗人力，通过日志运行级别可以<strong>批量控制打印信息</strong>。</p>
<p><img src="/img/atcrowdfunding.assets/image-20220107111010489.png" alt="image-20220107111010489"></p>
<h3 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h3><p><img src="/img/atcrowdfunding.assets/image-20220107111040685.png" alt="image-20220107111040685"></p>
<h3 id="不同日志系统的整合"><a href="#不同日志系统的整合" class="headerlink" title="不同日志系统的整合"></a>不同日志系统的整合</h3><p><img src="/img/atcrowdfunding.assets/image-20220107110907715.png" alt="image-20220107110907715"></p>
<h3 id="替换Spring自带的日志"><a href="#替换Spring自带的日志" class="headerlink" title="替换Spring自带的日志"></a>替换Spring自带的日志</h3><p>由于spring自带common-logging的日志包，使用 jcl-over-slf4j.jar来代替common-logging，做接口转换功能，在jcl-over-slf4j下可以实现slf4j-api.jar接口,进而使用logback</p>
<h4 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h4><p>在component中添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 日志 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 其他日志框架的中间转换包 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jul-to-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h4><ul>
<li>DEBUG</li>
<li>INFO</li>
<li>WARN</li>
<li>ERROR</li>
</ul>
<p>等级 <strong>DEBUG &lt; INFO &lt; WARN &lt; ERROR</strong>  会打印和自己一样和比自己高的运行级别</p>
<p>使用方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">logTest</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//获取Logger对象，这里传入的Class就是当前打印日志的类</span><br>    Logger logger = LoggerFactory.getLogger(CrowdTest.class);<br>    logger.debug(<span class="hljs-string">&quot;DEBUG!!!&quot;</span>);<br>    logger.info(<span class="hljs-string">&quot;INFO!!!&quot;</span>);<br>    logger.warn(<span class="hljs-string">&quot;WARN!!!&quot;</span>);<br>    logger.error(<span class="hljs-string">&quot;ERROR!!!&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="logback-xml实现自定义配置日志"><a href="#logback-xml实现自定义配置日志" class="headerlink" title="logback.xml实现自定义配置日志"></a>logback.xml实现自定义配置日志</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> <span class="hljs-attr">debug</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 指定日志输出的位置 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 日志输出的格式 --&gt;</span><br>            <span class="hljs-comment">&lt;!-- 按照顺序分别是： 时间、 日志级别、 线程名称、 打印日志的类、 日志主体</span><br><span class="hljs-comment">            内容、 换行 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>[%d&#123;HH:mm:ss.SSS&#125;] [%-5level] [%-8thread] [%logger] [%msg]%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 设置全局日志级别。 日志级别按顺序分别是： DEBUG、 INFO、 WARN、 ERROR --&gt;</span><br>    <span class="hljs-comment">&lt;!-- 指定任何一个日志级别都只打印当前级别和后面级别的日志。 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 指定打印日志的 appender， 这里通过&quot;STDOUT&quot;引用了前面配置的 appender --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 根据特殊需求指定局部日志级别 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.fall.mapper&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;DEBUG&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="声明式事务"><a href="#声明式事务" class="headerlink" title="声明式事务"></a>声明式事务</h2><h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><ul>
<li><p>要么<strong>成功</strong>，要么<strong>失败</strong></p>
</li>
<li><p>特性:</p>
<ul>
<li>一致性</li>
<li>原子性</li>
<li>持久性</li>
<li>隔离性</li>
</ul>
</li>
<li><p>对应AOP中通知类型</p>
<p><img src="/img/atcrowdfunding.assets/image-20220107121553869.png" alt="image-20220107121553869"></p>
</li>
</ul>
<h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>在框架下通过一系列配置使spring来管理事务操作</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>xml使用配置事务的流程:</p>
<p><img src="/img/atcrowdfunding.assets/image-20220107122909860.png" alt="image-20220107122909860"></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ul>
<li><p>在component中创建service包</p>
<p><img src="/img/atcrowdfunding.assets/image-20220107160420447.png" alt="image-20220107160420447"></p>
</li>
<li><p>创建spring-persist-tx.xml文件单独进行事务配置</p>
<p>（注：基于xml事务配置中，事务属性method必须配置，如果某个方法没有配置对应的txmethod，事务对方法可能不生效）</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:tx</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">                            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">                            http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">                            http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--扫描service包，事务方法在service层--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.fall.service&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--配置事务管理器--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;txManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--配置AOP--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--切入点表达式--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pointcut&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* *..*ServiceImpl.*(..))&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!--配置事务通知和切入点--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;txAdvice&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;pointcut&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">aop:advisor</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--配置事务通知--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;txAdvice&quot;</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;txManager&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--name指定对应的方法名，read-only=&quot;true&quot;设置为只读，可以加快查询性能--&gt;</span><br>            <span class="hljs-comment">&lt;!--查询：通常设置为只读，便于性能优化--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;get*&quot;</span> <span class="hljs-attr">read-only</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;query*&quot;</span> <span class="hljs-attr">read-only</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;find*&quot;</span> <span class="hljs-attr">read-only</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;count*&quot;</span> <span class="hljs-attr">read-only</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br>            <span class="hljs-comment">&lt;!--增删改：配置事务传播行为，回滚异常--&gt;</span><br>                <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">                默认行为：REQUIRED，表示当前方法必须运行在事务中，如果没有事务，则开启事务，在自己的事务中运行。</span><br><span class="hljs-comment">                    如果已经有了已开启的事务，则在当前事务中运行。有可能和其他方法共用同一个事务</span><br><span class="hljs-comment">                建议设置：REQUIRES_NEW，表示当前方法必须运行在事务中，如果没有事务，则开启事务，在自己的事务中运行。</span><br><span class="hljs-comment">                    和 REQUIRED 的区别是就算现在已经有了已开启的事务，也一定要开启自己的事务，避免和其他方法共用同一个事务。</span><br><span class="hljs-comment">                --&gt;</span><br>            <span class="hljs-comment">&lt;!--rollback-for：表示触发什么异常时，进行回滚；默认值：运行时异常，建议设置为运行时异常+编译期异常--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;save*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRES_NEW&quot;</span> <span class="hljs-attr">rollback-for</span>=<span class="hljs-string">&quot;java.lang.Exception&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tx:method</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;update*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRES_NEW&quot;</span> <span class="hljs-attr">rollback-for</span>=<span class="hljs-string">&quot;java.lang.Exception&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tx:method</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;remove*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRES_NEW&quot;</span> <span class="hljs-attr">rollback-for</span>=<span class="hljs-string">&quot;java.lang.Exception&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tx:method</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>测试:</p>
<p>测试时，抛出异常，回滚不插入数据，则配置事务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="hljs-meta">@ContextConfiguration(locations = &#123;&quot;classpath:spring-persist-mybatis.xml&quot;,&quot;classpath:spring-persist-tx.xml&quot;&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdTest</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DataSource dataSource;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AdminMapper adminMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AdminService adminService;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">txTest</span><span class="hljs-params">()</span></span>&#123;<br>        Admin admin = <span class="hljs-keyword">new</span> Admin(<span class="hljs-keyword">null</span>,<span class="hljs-string">&quot;lily&quot;</span>,<span class="hljs-string">&quot;321&quot;</span>,<span class="hljs-string">&quot;丽丽&quot;</span>,<span class="hljs-string">&quot;lily@qq.com&quot;</span>,<span class="hljs-keyword">null</span>);<br>        adminService.saveAdmin(admin);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Spring整合SpringMVC"><a href="#Spring整合SpringMVC" class="headerlink" title="Spring整合SpringMVC"></a>Spring整合SpringMVC</h2><h3 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h3><ol>
<li>handler中装配Service</li>
<li>页面能够访问handler</li>
</ol>
<h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p>表述层配置文件关系</p>
<p><img src="/img/atcrowdfunding.assets/image-20220107163121737.png" alt="image-20220107163121737"></p>
<h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><h4 id="web-xml具体配置"><a href="#web-xml具体配置" class="headerlink" title="web.xml具体配置"></a>web.xml具体配置</h4><ul>
<li><p>在web.xml中配置ContextLoaderListener</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--配置监听加载文件--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:spring-persist-*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br><span class="hljs-comment">&lt;!--ContextLoaderListener加入容器--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>在web.xml中配置filter</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 配置字符集过滤器,解决乱码 --&gt;</span><br><span class="hljs-comment">&lt;!--必须作为第一个filter进行配置，才能生效--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>characterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>encoding<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--强制请求进行编码--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>forceRequestEncoding<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--强制响应进行编码--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>forceResponseEncoding<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-comment">&lt;!--配置过滤器的过滤路径，/*全部路径--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>characterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>在web.xml中配置前端控制器DispatcherServlet</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-comment">&lt;!--配置前端控制器--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--SpringMVC的配置文件--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:spring-web-mvc.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--Servlet默认的生命周期中，会在第一次请求时创建对象</span><br><span class="hljs-comment">        而DispatcherServlet创建对象时，有大量的初始化工作，不适合在第一次请求时创建</span><br><span class="hljs-comment">        设置load-on-startup使其在web应用启动时进行创建--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--配置映射路径--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--  url-pattern配置方式一:/表示所有拦截  --&gt;</span><br><span class="hljs-comment">&lt;!--        &lt;url-pattern&gt;/&lt;/url-pattern&gt;--&gt;</span><br><br>    <span class="hljs-comment">&lt;!--  url-pattern配置方式二:配置请求扩展名  --&gt;</span><br>    <span class="hljs-comment">&lt;!--  优点:</span><br><span class="hljs-comment">                1.静态资源不通过SpringMVC，不需要特殊处理</span><br><span class="hljs-comment">                2.实现伪静态效果</span><br><span class="hljs-comment">                  (1)给黑客入侵增加难度</span><br><span class="hljs-comment">                   (2)有利于SEO优化</span><br><span class="hljs-comment">           缺点：不符合RESTFul风格--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>*.html<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--如果一个Ajax请求扩展名时是html，但实际返回json数据，与实际不匹配，会报406错误</span><br><span class="hljs-comment">        为了让Ajax顺利拿到json数据，配置json扩展名--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>*.json<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="SpringMVC配置文件具体配置"><a href="#SpringMVC配置文件具体配置" class="headerlink" title="SpringMVC配置文件具体配置"></a>SpringMVC配置文件具体配置</h4><ul>
<li><p>```xml</p>
<?xml version="1.0" encoding="UTF-8"?>
<p>&lt;beans xmlns=”<a target="_blank" rel="noopener" href="http://www.springframework.org/schema/beans&quot;">http://www.springframework.org/schema/beans&quot;</a></p>
<div class="code-wrapper"><pre><code class="hljs">               xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
               xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
               xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
               xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                                http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                                http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;
        &lt;!--自动扫描包，扫描handler--&gt;
        &lt;context:component-scan base-package=&quot;org.fall.mvc&quot;&gt;&lt;/context:component-scan&gt;
        &lt;!--配置SpringMVC驱动注解--&gt;
        &lt;mvc:annotation-driven/&gt;
        &lt;!--配置视图解析器--&gt;
        &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
            &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/&quot;&gt;&lt;/property&gt;
            &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;&gt;&lt;/property&gt;
        &lt;/bean&gt;
</code></pre></div>
</beans>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"></span><br><span class="xml">#### 测试</span><br><span class="xml"></span><br><span class="xml">- index.jsp</span><br><span class="xml"></span><br><span class="xml">  ```xml</span><br><span class="xml">  &lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>测试<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="xml">      &lt;%--</span><br><span class="xml">          base 标签必须写在 head 标签内部</span><br><span class="xml">          base 标签必须在所有“带具体路径”的标签的前面</span><br><span class="xml">          serverName 部分 EL 表达式和 serverPort 部分 EL 表达式之间必须写“:”</span><br><span class="xml">          serverPort 部分 EL 表达式和 contextPath 部分 EL 表达式之间绝对不能写“/”</span><br><span class="xml">          原因：contextPath 部分 EL 表达式本身就是“/”开头</span><br><span class="xml">          如果多写一个“/”会干扰 Cookie 的工作机制</span><br><span class="xml">          serverPort 部分 EL 表达式后面必须写“/”</span><br><span class="xml">      --%&gt;</span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">base</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://$</span></span></span><span class="hljs-template-variable">&#123;pageContext.request.serverName&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">:$</span></span></span><span class="hljs-template-variable">&#123;pageContext.request.serverPort&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">$</span></span></span><span class="hljs-template-variable">&#123;pageContext.request.contextPath&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">/&quot;</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Hello World!<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;test/ssm.html&quot;</span>&gt;</span>测试页面<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure></li>
<li><p>handler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestHandler</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    AdminService adminService;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/test/ssm.html&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">testSSM</span><span class="hljs-params">(Model model)</span></span>&#123;<br>        List&lt;Admin&gt; admins = adminService.getAll();<br>        model.addAttribute(<span class="hljs-string">&quot;admins&quot;</span>, admins);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;target&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="AJAX请求"><a href="#AJAX请求" class="headerlink" title="AJAX请求"></a>AJAX请求</h2><h3 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h3><p><img src="/img/atcrowdfunding.assets/image-20220107225628686.png" alt="image-20220107225628686"></p>
<p>@RequestBody和@RespondBody要生效需要jackson依赖，确定是否导入依赖，同时配置mvc:annotation-driven。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- Spring 进行 JSON 数据转换依赖 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="导入jquery"><a href="#导入jquery" class="headerlink" title="导入jquery"></a>导入jquery</h3><p><img src="/img/atcrowdfunding.assets/image-20220108160359994.png" alt="image-20220108160359994"></p>
<p>导入后记得刷新项目</p>
<h3 id="Ajax测试"><a href="#Ajax测试" class="headerlink" title="Ajax测试"></a>Ajax测试</h3><p>jsp页面</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs jsp">    &lt;script src=<span class="hljs-string">&quot;jquery/jquery-2.1.1.min.js&quot;</span> type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;&lt;/script&gt;<br>    &lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>        $(function () &#123;<br><br>            <span class="hljs-comment">//btn1</span><br>            <span class="hljs-comment">//此方式可以在浏览器看到发送的请求体是Form Data(表单数据)</span><br>            $(<span class="hljs-string">&quot;#btn1&quot;</span>).click(function () &#123;<br>                $.ajax(&#123;<br>                    url: <span class="hljs-string">&quot;send/array/one.html&quot;</span>,         <span class="hljs-comment">//请求目标资源地址</span><br>                    type: <span class="hljs-string">&quot;post&quot;</span>,                       <span class="hljs-comment">//请求方式</span><br>                    data: &#123;<br>                        array: [<span class="hljs-number">5</span>,<span class="hljs-number">8</span>,<span class="hljs-number">12</span>]<br>                    &#125;,                     <span class="hljs-comment">//发送的请求参数</span><br>                    dataType: <span class="hljs-string">&quot;text&quot;</span>,                   <span class="hljs-comment">//表示如何对待服务器返回的数据</span><br>                    success: function (response) &#123;<br>                        alert(response);<br>                    &#125;,<br>                    error: function (response) &#123;<br>                        alert(response);<br>                    &#125;<br>                &#125;);<br>            &#125;);<br><br>            <span class="hljs-comment">//btn2</span><br>            <span class="hljs-comment">//此方式可以在浏览器看到发送的请求体是Request Payload(请求负载)</span><br>            $(<span class="hljs-string">&quot;#btn2&quot;</span>).click(function () &#123;<br>                <span class="hljs-comment">//准备要发送的数据</span><br>                <span class="hljs-keyword">var</span> array=[<span class="hljs-number">5</span>,<span class="hljs-number">8</span>,<span class="hljs-number">12</span>];<br>                <span class="hljs-comment">//必须先将目标转换成JSON字符串</span><br>                <span class="hljs-keyword">var</span> arrayStr = JSON.stringify(array);<br>                $.ajax(&#123;<br>                    url: <span class="hljs-string">&quot;send/array/two.html&quot;</span>,<br>                    type: <span class="hljs-string">&quot;post&quot;</span>,<br>                    data: arrayStr,<br>                    dataType: <span class="hljs-string">&quot;text&quot;</span>,<br>                    contentType: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>,  <span class="hljs-comment">//告诉服务器端当前请求的请求体是JSON格式</span><br>                    success: function (response) &#123;<br>                        alert(response);<br>                    &#125;,<br>                    error: function (response) &#123;<br>                        alert(response);<br>                    &#125;<br>                &#125;);<br>            &#125;);<br><br>            <span class="hljs-comment">//btn3</span><br>            <span class="hljs-comment">//传输复杂对象</span><br>            $(<span class="hljs-string">&quot;#btn3&quot;</span>).click(function () &#123;<br>                <span class="hljs-keyword">var</span> student = &#123;<br>                    <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;Fall&quot;</span>,<br>                    <span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-number">21</span>,<br>                    <span class="hljs-string">&quot;address&quot;</span>:&#123;<br>                        <span class="hljs-string">&quot;province&quot;</span>:<span class="hljs-string">&quot;浙江&quot;</span>,<br>                        <span class="hljs-string">&quot;city&quot;</span>:<span class="hljs-string">&quot;宁波&quot;</span><br>                    &#125;,<br>                    <span class="hljs-string">&quot;subjects&quot;</span>:[<br>                        &#123;<br>                            <span class="hljs-string">&quot;subjectName&quot;</span>:<span class="hljs-string">&quot;Java&quot;</span>,<br>                            <span class="hljs-string">&quot;score&quot;</span>:<span class="hljs-number">96</span><br>                        &#125;,<br>                        &#123;<br>                            <span class="hljs-string">&quot;subjectName&quot;</span>:<span class="hljs-string">&quot;Data Struct&quot;</span>,<br>                            <span class="hljs-string">&quot;score&quot;</span>:<span class="hljs-number">93</span><br>                        &#125;<br>                    ],<br>                    <span class="hljs-string">&quot;map&quot;</span>:&#123;<br>                        <span class="hljs-string">&quot;key1&quot;</span>:<span class="hljs-string">&quot;value1&quot;</span>,<br>                        <span class="hljs-string">&quot;key2&quot;</span>:<span class="hljs-string">&quot;value2&quot;</span><br>                    &#125;<br>                &#125;;   <span class="hljs-comment">//student end</span><br>                <span class="hljs-keyword">var</span> studentStr = JSON.stringify(student);<br>                $.ajax(&#123;<br>                    url: <span class="hljs-string">&quot;send/compose/object.html&quot;</span>,<br>                    type: <span class="hljs-string">&quot;post&quot;</span>,<br>                    data: studentStr,<br>                    dataType: <span class="hljs-string">&quot;text&quot;</span>,<br>                    contentType: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>,<br>                    success: function (response) &#123;<br>                        alert(response);            <span class="hljs-comment">//在浏览器控制台打印返回的信息</span><br>                    &#125;,<br>                    error: function (response) &#123;<br>                        alert(response);<br>                    &#125;<br>                &#125;);<br><br>            &#125;);<br><br>            <span class="hljs-comment">//btn4</span><br>            <span class="hljs-comment">//使用ResultEntity，统一返回的格式</span><br>            $(<span class="hljs-string">&quot;#btn4&quot;</span>).click(function () &#123;<br>                <span class="hljs-keyword">var</span> student = &#123;<br>                    <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;Fall&quot;</span>,<br>                    <span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-number">21</span>,<br>                    <span class="hljs-string">&quot;address&quot;</span>:&#123;<br>                        <span class="hljs-string">&quot;province&quot;</span>:<span class="hljs-string">&quot;浙江&quot;</span>,<br>                        <span class="hljs-string">&quot;city&quot;</span>:<span class="hljs-string">&quot;宁波&quot;</span><br>                    &#125;,<br>                    <span class="hljs-string">&quot;subjects&quot;</span>:[<br>                        &#123;<br>                            <span class="hljs-string">&quot;subjectName&quot;</span>:<span class="hljs-string">&quot;Java&quot;</span>,<br>                            <span class="hljs-string">&quot;score&quot;</span>:<span class="hljs-number">96</span><br>                        &#125;,<br>                        &#123;<br>                            <span class="hljs-string">&quot;subjectName&quot;</span>:<span class="hljs-string">&quot;Data Struct&quot;</span>,<br>                            <span class="hljs-string">&quot;score&quot;</span>:<span class="hljs-number">93</span><br>                        &#125;<br>                    ],<br>                    <span class="hljs-string">&quot;map&quot;</span>:&#123;<br>                        <span class="hljs-string">&quot;key1&quot;</span>:<span class="hljs-string">&quot;value1&quot;</span>,<br>                        <span class="hljs-string">&quot;key2&quot;</span>:<span class="hljs-string">&quot;value2&quot;</span><br>                    &#125;<br>                &#125;;<br>                <span class="hljs-keyword">var</span> studentStr = JSON.stringify(student);<br>                $.ajax(&#123;<br>                    url: <span class="hljs-string">&quot;send/compose/object.json&quot;</span>,    <span class="hljs-comment">//此时是json，表示返回的数据是json格式的</span><br>                    type: <span class="hljs-string">&quot;post&quot;</span>,<br>                    data: studentStr,<br>                    dataType: <span class="hljs-string">&quot;json&quot;</span>,                   <span class="hljs-comment">//此时服务端返回的数据是json格式</span><br>                    contentType: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>,<br>                    success: function (response) &#123;<br>                        console.log(response);       <span class="hljs-comment">//在浏览器控制台打印返回的信息</span><br>                    &#125;,<br>                    error: function (response) &#123;<br>                        console.log(response);<br>                    &#125;<br>                &#125;);<br><br>            &#125;);<br>        &#125;);<br>    &lt;/script&gt;<br>&lt;/head&gt;<br>&lt;h2&gt;Hello World!&lt;/h2&gt;<br>&lt;a href=<span class="hljs-string">&quot;test/ssm.html&quot;</span>&gt;测试页面&lt;/a&gt;<br>&lt;br/&gt;&lt;br/&gt;<br>&lt;button id=<span class="hljs-string">&quot;btn1&quot;</span>&gt;Test Ajax One&lt;/button&gt;<br>&lt;br/&gt;&lt;br/&gt;<br>&lt;button id=<span class="hljs-string">&quot;btn2&quot;</span>&gt;Test Ajax Two&lt;/button&gt;<br>&lt;br/&gt;&lt;br/&gt;<br>&lt;button id=<span class="hljs-string">&quot;btn3&quot;</span>&gt;Test Compose Object&lt;/button&gt;<br>&lt;br/&gt;&lt;br/&gt;<br>&lt;button id=<span class="hljs-string">&quot;btn4&quot;</span>&gt;Test ResultEntity&lt;/button&gt;<br>&lt;/body&gt;<br></code></pre></td></tr></table></figure>

<p>控制器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/send/array/one.html&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">testAjaxOne</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;array[]&quot;)</span>List&lt;Integer&gt; array)</span></span>&#123;<br>    <span class="hljs-keyword">for</span> (Integer integer : array) &#123;<br>        System.out.println(integer);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">//@RequestBody来获取请求体中的json数据</span><br><span class="hljs-meta">@RequestMapping(&quot;/send/array/two.html&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">testAjaxTwo</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Integer[] array)</span></span>&#123;<br>    <span class="hljs-keyword">for</span> (Integer integer : array) &#123;<br>        System.out.println(integer);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">//@RequestBody来获取请求体中的复杂数据</span><br><span class="hljs-meta">@RequestMapping(&quot;send/compose/object.html&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">testAjaxObject</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Student student)</span></span>&#123;<br>    System.out.println(student.toString());<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">//测试ResultEntity</span><br><span class="hljs-meta">@RequestMapping(&quot;send/compose/object.json&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;Student&gt; <span class="hljs-title">testAjaxResultEntity</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Student student)</span></span>&#123;<br>    <span class="hljs-comment">//将查询到的数据通过ResultEntity返回</span><br>    <span class="hljs-keyword">return</span> ResultEntity.successWithData(student);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="统一返回ResultEntity实体类"><a href="#统一返回ResultEntity实体类" class="headerlink" title="统一返回ResultEntity实体类"></a>统一返回ResultEntity实体类</h3><p>在util工程下创建ResultEntity实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.fall;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Type;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResultEntity</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;<br>    <span class="hljs-comment">//设置两个常量</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String SUCCESS = <span class="hljs-string">&quot;SUCCESS&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String FAILED = <span class="hljs-string">&quot;FAILED&quot;</span>;<br><br>    <span class="hljs-comment">//请求错误时，返回的错误信息，对应SUCCESS与FAILED</span><br>    <span class="hljs-keyword">private</span> String message;<br><br>    <span class="hljs-comment">//要返回的数据</span><br>    <span class="hljs-keyword">private</span> T data;<br><br>    <span class="hljs-comment">//封装当前请求的处理结果是成功还是失败</span><br>    <span class="hljs-keyword">private</span> String result;<br><br>    <span class="hljs-comment">//请求处理成功并且不向前端返回数据时，使用的静态方法</span><br>    <span class="hljs-comment">//第一个&lt;Type&gt;表示声明一个泛型Type，第二个和return中的&lt;Type&gt;表示使用该泛型</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;Type&gt; <span class="hljs-function">ResultEntity&lt;Type&gt; <span class="hljs-title">successWithoutData</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultEntity&lt;Type&gt;(<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>,SUCCESS);<br>    &#125;<br><br>    <span class="hljs-comment">//请求处理成功并且向前端返回数据时，使用的静态方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;Type&gt; <span class="hljs-function">ResultEntity&lt;Type&gt; <span class="hljs-title">successWithData</span><span class="hljs-params">(Type data)</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultEntity&lt;Type&gt;(<span class="hljs-keyword">null</span>,data,SUCCESS);<br>    &#125;<br><br>    <span class="hljs-comment">//请求处理失败，需要返回错误信息时，使用的静态方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;Type&gt; <span class="hljs-function">ResultEntity&lt;Type&gt; <span class="hljs-title">failed</span><span class="hljs-params">(String message)</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultEntity&lt;&gt;(message,<span class="hljs-keyword">null</span>,FAILED);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ResultEntity</span><span class="hljs-params">(String message, T data, String result)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.message = message;<br>        <span class="hljs-keyword">this</span>.data = data;<br>        <span class="hljs-keyword">this</span>.result = result;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ResultEntity</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getSUCCESS</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> SUCCESS;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getFAILED</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> FAILED;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getMessage</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> message;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMessage</span><span class="hljs-params">(String message)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.message = message;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">getData</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> data;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setData</span><span class="hljs-params">(T data)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.data = data;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getResult</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setResult</span><span class="hljs-params">(String result)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.result = result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><h3 id="目标-2"><a href="#目标-2" class="headerlink" title="目标"></a>目标</h3><p>使用异常映射机制将整个项目的异常和错误进行统一管理</p>
<h3 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h3><ul>
<li>异常映射机制</li>
</ul>
<p><img src="/img/atcrowdfunding.assets/image-20220108161755218.png" alt="image-20220108161755218"></p>
<ul>
<li><p>SpringMVC提供了基于xml和基于注解的两种异常映射机制</p>
<p><img src="/img/atcrowdfunding.assets/image-20220108161917266.png" alt="image-20220108161917266"></p>
</li>
</ul>
<h3 id="基于xml的异常映射"><a href="#基于xml的异常映射" class="headerlink" title="基于xml的异常映射"></a>基于xml的异常映射</h3><p>在spring-web-mvc中配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--  基于xml的异常配置  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;simpleMappingExceptionResolver&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--   配置异常视图和具体页面的对应关系     --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;exceptionMappings&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--  key属性指定异常的全类名，标签中写具体对应的视图(这个值要拼前后缀得到的路径)    --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;java.lang.Exception&quot;</span>&gt;</span>system-error<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="判断请求类型的工具方法"><a href="#判断请求类型的工具方法" class="headerlink" title="判断请求类型的工具方法"></a>判断请求类型的工具方法</h3><p>在utils工程下创建CrowdUtils工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 用来判断请求类型的工具(true表示json请求，false表示普通请求)</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdUtils</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">judgeRequestType</span><span class="hljs-params">(HttpServletRequest httpServletRequest)</span></span>&#123;<br>        <span class="hljs-comment">//获取请求的信息头</span><br>        String acceptHeader=httpServletRequest.getHeader(<span class="hljs-string">&quot;Accept&quot;</span>);<br>        String xRequestHeader=httpServletRequest.getHeader(<span class="hljs-string">&quot;X-Requested-With&quot;</span>);<br>        <span class="hljs-comment">//判断是否为json请求</span><br>        <span class="hljs-keyword">if</span> ((acceptHeader!=<span class="hljs-keyword">null</span>&amp;&amp;acceptHeader.contains(<span class="hljs-string">&quot;application/json&quot;</span>)) ||<br>                (xRequestHeader!=<span class="hljs-keyword">null</span>&amp;&amp;acceptHeader.equals(<span class="hljs-string">&quot;XMLHttpRequest&quot;</span>)))<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="基于注解的异常映射"><a href="#基于注解的异常映射" class="headerlink" title="基于注解的异常映射"></a>基于注解的异常映射</h3><ul>
<li><p>创建处理异常的CrowUtils工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ControllerAdvice</span>   <span class="hljs-comment">//表示一个基于注解的异常类</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdExceptionResolver</span> </span>&#123;<br><br>    <span class="hljs-comment">//处理空指针异常</span><br>    <span class="hljs-meta">@ExceptionHandler(value = &#123;NullPointerException.class&#125;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">nullPointExceptionResolver</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            //实际捕获到的类型</span></span><br><span class="hljs-params"><span class="hljs-function">            NullPointerException nullPointerException,</span></span><br><span class="hljs-params"><span class="hljs-function">            //当前请求对象</span></span><br><span class="hljs-params"><span class="hljs-function">            HttpServletRequest request,</span></span><br><span class="hljs-params"><span class="hljs-function">            //当前响应对象</span></span><br><span class="hljs-params"><span class="hljs-function">            HttpServletResponse response</span></span><br><span class="hljs-params"><span class="hljs-function">            //指定普通页时去的错误页面</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        String viewName=<span class="hljs-string">&quot;system-error&quot;</span>;<br>        <span class="hljs-keyword">return</span> conmonResolver(nullPointerException,request,response,viewName);<br>    &#125;<br><br>    <span class="hljs-comment">//处理数学异常</span><br>    <span class="hljs-meta">@ExceptionHandler(value = &#123;ArithmeticException.class&#125;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">resolveArithmeticException</span><span class="hljs-params">(ArithmeticException arithmeticException,</span></span><br><span class="hljs-params"><span class="hljs-function">                                                   HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        String viewName=<span class="hljs-string">&quot;system-error&quot;</span>;<br>        <span class="hljs-keyword">return</span> conmonResolver(arithmeticException,request,response,viewName);<br>    &#125;<br><br>    <span class="hljs-comment">//抽取出公共部分代码</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> ModelAndView <span class="hljs-title">conmonResolver</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            //实际捕获到的类型,使用了泛型的特性</span></span><br><span class="hljs-params"><span class="hljs-function">            Exception exception,</span></span><br><span class="hljs-params"><span class="hljs-function">            //当前请求对象</span></span><br><span class="hljs-params"><span class="hljs-function">            HttpServletRequest request,</span></span><br><span class="hljs-params"><span class="hljs-function">            //当前响应对象</span></span><br><span class="hljs-params"><span class="hljs-function">            HttpServletResponse response,</span></span><br><span class="hljs-params"><span class="hljs-function">            //指定普通页时去的错误页面</span></span><br><span class="hljs-params"><span class="hljs-function">            String viewName</span></span><br><span class="hljs-params"><span class="hljs-function">        )</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>            <span class="hljs-comment">//判断当前的类型请求</span><br>        <span class="hljs-keyword">boolean</span> judgeRequestType = CrowdUtils.judgeRequestType(request);<br>        <span class="hljs-comment">//是json请求则执行</span><br>        <span class="hljs-keyword">if</span>(judgeRequestType)&#123;<br>            <span class="hljs-comment">//创建返回异常的实体类</span><br>            ResultEntity&lt;Object&gt; failed=ResultEntity.failed(exception.getMessage());<br>            <span class="hljs-comment">//创建gson对象进行json转换</span><br>            Gson gson = <span class="hljs-keyword">new</span> Gson();<br>            <span class="hljs-comment">//转换为json字符串</span><br>            String json=gson.toJson(failed);<br>            <span class="hljs-comment">//通过原生的servlet返回</span><br>            response.getWriter().write(json);<br>            <span class="hljs-comment">//由于ResultEntity已经由respond返回，不用返回ModelAndView</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>        <span class="hljs-comment">//是普通请求则执行</span><br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-comment">//创建ModelAndView对象</span><br>            ModelAndView modelAndView = <span class="hljs-keyword">new</span> ModelAndView();<br>            <span class="hljs-comment">//设置出发跳转的页面</span><br>            modelAndView.setViewName(viewName);<br>            <span class="hljs-comment">//将异常信息植入</span><br>            modelAndView.addObject(CrowdConstant.ATTR_NAME_EXCEPTION,exception);<br>            <span class="hljs-comment">//返回ModelAndView</span><br>            <span class="hljs-keyword">return</span> modelAndView;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>创建常量类CrowdConstant</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 常量类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdConstant</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ATTR_NAME_EXCEPTION = <span class="hljs-string">&quot;exception&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String MESSAGE_LOGIN_FAILED = <span class="hljs-string">&quot;抱歉！登录失败！请确认账号密码是否正确&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String MESSAGE_LOGIN_ACCT_ALREADY_IN_USE = <span class="hljs-string">&quot;抱歉！账号已经被人使用过了&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String MESSAGE_ACCESS_FORBIDEN = <span class="hljs-string">&quot;请登录后在访问&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="修饰异常页面"><a href="#修饰异常页面" class="headerlink" title="修饰异常页面"></a>修饰异常页面</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;keys&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;author&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">base</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://$&#123;pageContext.request.serverName&#125;:$&#123;pageContext.request.serverPort&#125;$&#123;pageContext.request.contextPath&#125;/&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;bootstrap/css/bootstrap.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css/font-awesome.min.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css/login.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;jquery/jquery-2.1.1.min.js&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span><br><span class="javascript">        $(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">            $(<span class="hljs-string">&quot;button&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">                <span class="hljs-built_in">window</span>.history.back();</span><br><span class="javascript">            &#125;);</span><br><span class="javascript">        &#125;);</span><br><span class="javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar navbar-inverse navbar-fixed-top&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;navigation&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar-header&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar-brand&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;index.html&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size:32px;&quot;</span>&gt;</span>尚筹网-创意产品众筹平台<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: center;&quot;</span>&gt;</span>请求出现了错误QAQ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: center;&quot;</span>&gt;</span>错误消息：$&#123;requestScope.exception.message&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:150px;margin: 0 auto;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-lg btn-success btn-block&quot;</span>&gt;</span>返回上一步<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;bootstrap/js/bootstrap.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="管理员登录页"><a href="#管理员登录页" class="headerlink" title="管理员登录页"></a>管理员登录页</h2><p>引入静态资源,放入webapp下</p>
<p><img src="/img/atcrowdfunding.assets/image-20220109004852629.png" alt="image-20220109004852629"></p>
<p>创建admin-login.jsp页面,修改表单，添加base标签(注意放在引入css，js<strong>前面</strong>)</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;form action=<span class="hljs-string">&quot;admin/do/login.html&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-signin&quot;</span> role=<span class="hljs-string">&quot;form&quot;</span>&gt;<br>    &lt;h2 <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-signin-heading&quot;</span>&gt;&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-log-in&quot;</span>&gt;&lt;/i&gt; 管理员登录&lt;/h2&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group has-success has-feedback&quot;</span>&gt;<br>        &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;loginAcct&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> id=<span class="hljs-string">&quot;inputSuccess4&quot;</span> placeholder=<span class="hljs-string">&quot;请输入登录账号&quot;</span> autofocus&gt;<br>        &lt;span <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-user form-control-feedback&quot;</span>&gt;&lt;/span&gt;<br>    &lt;/div&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group has-success has-feedback&quot;</span>&gt;<br>        &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;loginPswd&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> id=<span class="hljs-string">&quot;inputSuccess4&quot;</span> placeholder=<span class="hljs-string">&quot;请输入登录密码&quot;</span> style=<span class="hljs-string">&quot;margin-top:10px;&quot;</span>&gt;<br>        &lt;span <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-lock form-control-feedback&quot;</span>&gt;&lt;/span&gt;<br>    &lt;/div&gt;<br>    &lt;button type=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-lg btn-success btn-block&quot;</span> href=<span class="hljs-string">&quot;main.html&quot;</span>&gt;登录&lt;/button&gt;<br>&lt;/form&gt;<br></code></pre></td></tr></table></figure>

<p>配置视图控制器，进行页面跳转</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--  配置视图控制器，代替@RequestMapping  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mvc:view-controller</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/admin/to/login/page.html&quot;</span> <span class="hljs-attr">view-name</span>=<span class="hljs-string">&quot;admin-login&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:view-controller</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="使用Layer弹框组件"><a href="#使用Layer弹框组件" class="headerlink" title="使用Layer弹框组件"></a>使用Layer弹框组件</h2><p>引入Layer文件，并在页面引入js(注意在jquery后面引入)</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;script src=<span class="hljs-string">&quot;layer/layer.js&quot;</span> type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h1 id="管理员系统"><a href="#管理员系统" class="headerlink" title="管理员系统"></a>管理员系统</h1><h2 id="管理员登录"><a href="#管理员登录" class="headerlink" title="管理员登录"></a>管理员登录</h2><h3 id="目标-3"><a href="#目标-3" class="headerlink" title="目标"></a>目标</h3><p>识别登陆者身份，控制他行为，赋予他权限。</p>
<h3 id="思路-3"><a href="#思路-3" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220109143549363.png" alt="image-20220109143549363"></p>
<h3 id="创建MD5加密工具方法"><a href="#创建MD5加密工具方法" class="headerlink" title="创建MD5加密工具方法"></a>创建MD5加密工具方法</h3><p>在CrowdUtils类加入静态方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 对明文字符进行MD5加密</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> source 传入明文字符</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">md5</span><span class="hljs-params">(String source)</span> </span>&#123;<br>    <span class="hljs-comment">// 1.判断source是否有效</span><br>    <span class="hljs-keyword">if</span> (source == <span class="hljs-keyword">null</span> || source.length() == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// 2.如果不是有效字符抛出异常</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(CrowdConstant.MESSAGE_STRING_INVALIDATE);<br>    &#125;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// 3.获取MessageDigest对象</span><br>        String algorithm = <span class="hljs-string">&quot;md5&quot;</span>;<br>        MessageDigest messageDigest = MessageDigest.getInstance(algorithm);<br>        <span class="hljs-comment">// 4.获取字符串解析数组</span><br>        <span class="hljs-keyword">byte</span>[] input = source.getBytes();<br>        <span class="hljs-comment">// 5.执行加密</span><br>        <span class="hljs-keyword">byte</span>[] output = messageDigest.digest(input);<br>        <span class="hljs-comment">// 6.创建BigInteger对象</span><br>        <span class="hljs-keyword">int</span> signum = <span class="hljs-number">1</span>;<br>        BigInteger bigInteger = <span class="hljs-keyword">new</span> BigInteger(signum, output);<br>        <span class="hljs-comment">// 7.按照16进制将值转化为字符串</span><br>        <span class="hljs-keyword">int</span> radix = <span class="hljs-number">16</span>;<br>        String encoded = bigInteger.toString(radix).toUpperCase();<br>        <span class="hljs-comment">// 8.返回加密字符串</span><br>        <span class="hljs-keyword">return</span> encoded;<br>    &#125; <span class="hljs-keyword">catch</span> (NoSuchAlgorithmException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="自定义登录失败异常类"><a href="#自定义登录失败异常类" class="headerlink" title="自定义登录失败异常类"></a>自定义登录失败异常类</h3><ul>
<li><p>在exception包下创建LoginFailedException</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.fall.exception;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 登录失败的异常</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginFailedException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginFailedException</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginFailedException</span><span class="hljs-params">(String message)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(message);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginFailedException</span><span class="hljs-params">(String message, Throwable cause)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(message, cause);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginFailedException</span><span class="hljs-params">(Throwable cause)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(cause);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginFailedException</span><span class="hljs-params">(String message, Throwable cause, <span class="hljs-keyword">boolean</span> enableSuppression, <span class="hljs-keyword">boolean</span> writableStackTrace)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(message, cause, enableSuppression, writableStackTrace);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>修改异常处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//处理登录失败异常</span><br><span class="hljs-meta">@ExceptionHandler(value = &#123;LoginFailedException.class&#125;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">nullLoginFailedExceptionResolver</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        //实际捕获到的类型</span></span><br><span class="hljs-params"><span class="hljs-function">        NullPointerException nullPointerException,</span></span><br><span class="hljs-params"><span class="hljs-function">        //当前请求对象</span></span><br><span class="hljs-params"><span class="hljs-function">        HttpServletRequest request,</span></span><br><span class="hljs-params"><span class="hljs-function">        //当前响应对象</span></span><br><span class="hljs-params"><span class="hljs-function">        HttpServletResponse response</span></span><br><span class="hljs-params"><span class="hljs-function">        //指定普通页时去的错误页面</span></span><br><span class="hljs-params"><span class="hljs-function">)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    String viewName=<span class="hljs-string">&quot;system-error&quot;</span>;<br>    <span class="hljs-keyword">return</span> conmonResolver(nullPointerException,request,response,viewName);<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>将错误信息显示到admin-login.jsp页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-signin-heading&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-log-in&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 管理员登录<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>$&#123;requestScope.exception.message&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="创建控制管理员登录的Handler方法"><a href="#创建控制管理员登录的Handler方法" class="headerlink" title="创建控制管理员登录的Handler方法"></a>创建控制管理员登录的Handler方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminHandler</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    AdminService adminService;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/admin/do/login.html&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doLogin</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;loginAcct&quot;)</span> String loginAcct,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;loginPswd&quot;)</span> String loginPswd,</span></span><br><span class="hljs-params"><span class="hljs-function">            HttpSession session</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span> </span>&#123;<br>        <span class="hljs-comment">// 调用Service方法检查登录</span><br>        <span class="hljs-comment">// 这个方法如果返回Admin对象则登录成功，如果账号密码不正确则抛出异常</span><br>        Admin admin = adminService.getAdminByLoginAcct(loginAcct, loginPswd);<br>        <span class="hljs-comment">// 将登录成功返回的对象存入session域中</span><br>        session.setAttribute(CrowdConstant.ATTR_NAME_LOGIN_ADMIN, admin);<br>        <span class="hljs-comment">// 返回主页面</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;admin-main&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="Service层实现业务逻辑"><a href="#Service层实现业务逻辑" class="headerlink" title="Service层实现业务逻辑"></a>Service层实现业务逻辑</h3><p>获取管理员的登录信息方法体</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Admin <span class="hljs-title">getAdminByLoginAcct</span><span class="hljs-params">(String loginAcct, String loginPswd)</span> </span>&#123;<br>    <span class="hljs-comment">// 1.根据登录账号查询Admin对象</span><br>    <span class="hljs-comment">// 创建Example对象</span><br>    AdminExample adminExample = <span class="hljs-keyword">new</span> AdminExample();<br>    <span class="hljs-comment">// 创建Criteria对象</span><br>    AdminExample.Criteria criteria = adminExample.createCriteria();<br>    <span class="hljs-comment">// 封装查找的条件</span><br>    criteria.andLoginAcctEqualTo(loginAcct);<br>    <span class="hljs-comment">// 调用adminMapper进行查找</span><br>    List&lt;Admin&gt; admins = adminMapper.selectByExample(adminExample);<br>    <span class="hljs-comment">// 2.判断Admin是否为空</span><br>    <span class="hljs-keyword">if</span> (admins == <span class="hljs-keyword">null</span> &amp;&amp; admins.size() == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// 3.Admin对象为空则抛出异常</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> LoginFailedException(CrowdConstant.MESSAGE_LOGIN_FAILED);<br>    &#125;<br>    <span class="hljs-comment">// 是否出现多条数据</span><br>    <span class="hljs-keyword">if</span> (admins.size() &gt; <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> LoginFailedException(CrowdConstant.MESSAGE_SYSTEM_ERROR_LOGIN_NOT_UNIQUE);<br>    &#125;<br>    <span class="hljs-comment">// 4.Admin对象不为空则取出Admin对象</span><br>    Admin admin = admins.get(<span class="hljs-number">0</span>);<br>    <span class="hljs-comment">// 5.为空抛出异常，不为空取出密码</span><br>    <span class="hljs-keyword">if</span> (admin == <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> LoginFailedException(CrowdConstant.MESSAGE_LOGIN_FAILED);<br>    &#125;<br>    String userPswdDb = admin.getUserPswd();<br>    <span class="hljs-comment">// 5.将表单提交的数据进行明文加密</span><br>    String userPswdForm = CrowdUtils.md5(loginPswd);<br>    <span class="hljs-comment">// 6.对密码进行比较</span><br>    <span class="hljs-keyword">if</span> (!Objects.equals(userPswdDb, userPswdForm)) &#123;<br>        <span class="hljs-comment">// 7.不相等抛出异常</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> LoginFailedException(CrowdConstant.MESSAGE_LOGIN_FAILED);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// 8.相等则返回Admin对象</span><br>        <span class="hljs-keyword">return</span> admin;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="重定向主页面"><a href="#重定向主页面" class="headerlink" title="重定向主页面"></a>重定向主页面</h3><ul>
<li><p>将admin-main.html页面导入后，修改base标签，和用户名</p>
</li>
<li><p>doLogin重定向主页面，防止表单重复提交</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 返回主页面</span><br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/admin/to/main/page.html&quot;</span>;<br></code></pre></td></tr></table></figure></li>
<li><p>配置视图控制器，重新响应页面</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:view-controller</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/admin/to/main/page.html&quot;</span> <span class="hljs-attr">view-name</span>=<span class="hljs-string">&quot;admin-main&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:view-controller</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h3><ul>
<li><p>修改超链接地址</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;admin/do/logout.html&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-off&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 退出系统<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>Handler中doLogout方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/admin/do/logout.html&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doLogout</span><span class="hljs-params">(HttpSession session)</span></span>&#123;<br>    <span class="hljs-comment">// 强制session失败</span><br>    session.invalidate();<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/admin/to/login/page.html&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="抽取主页面的公共部分"><a href="#抽取主页面的公共部分" class="headerlink" title="抽取主页面的公共部分"></a>抽取主页面的公共部分</h3><ul>
<li><p>抽取为后，需要引入jsp文件</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%<span class="hljs-meta">@include</span> file=<span class="hljs-string">&quot;/WEB-INF/include-head.jsp&quot;</span> %&gt;<br>&lt;body&gt;<br>&lt;%<span class="hljs-meta">@include</span> file=<span class="hljs-string">&quot;/WEB-INF/include-nav.jsp&quot;</span> %&gt;<br>&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;container-fluid&quot;</span>&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;row&quot;</span>&gt;<br>        &lt;%<span class="hljs-meta">@include</span> file=<span class="hljs-string">&quot;/WEB-INF/include-sidebar.jsp&quot;</span>%&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>setting-&gt;Editor-&gt;File an Code Templates中创建模板方便下次使用</p>
</li>
</ul>
<h2 id="登录检查"><a href="#登录检查" class="headerlink" title="登录检查"></a>登录检查</h2><h3 id="目标-4"><a href="#目标-4" class="headerlink" title="目标"></a>目标</h3><p>将部分资源保护起来，让没有登录的用户不能访问</p>
<h3 id="思路-4"><a href="#思路-4" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220111164707521.png" alt="image-20220111164707521"></p>
<h3 id="创建拦截器类"><a href="#创建拦截器类" class="headerlink" title="创建拦截器类"></a>创建拦截器类</h3><p>拦截器只需重写preHandle使其继承HandlerInterceptorAdapter即可，在拦截器拦截后，抛出异常来处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HandlerInterceptorAdapter</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// 1.通过request对象获取session域</span><br>        HttpSession session = httpServletRequest.getSession();<br>        <span class="hljs-comment">// 2.获取session中的Admin对象</span><br>        Admin admin = (Admin) session.getAttribute(CrowdConstant.ATTR_NAME_LOGIN_ADMIN);<br>        <span class="hljs-comment">// 3.admin为空抛出异常</span><br>        <span class="hljs-keyword">if</span> (admin == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AccessForbiddenException(CrowdConstant.MESSAGE_ACCESS_FORBIDEN);<br>        &#125;<br>        <span class="hljs-comment">// 4.不为空则放行</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="自定义拒绝访问异常类"><a href="#自定义拒绝访问异常类" class="headerlink" title="自定义拒绝访问异常类"></a>自定义拒绝访问异常类</h3><p>处理拦截器抛出的异常，使其返回到登录页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccessForbiddenException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AccessForbiddenException</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AccessForbiddenException</span><span class="hljs-params">(String message)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(message);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AccessForbiddenException</span><span class="hljs-params">(String message, Throwable cause)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(message, cause);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AccessForbiddenException</span><span class="hljs-params">(Throwable cause)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(cause);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-title">AccessForbiddenException</span><span class="hljs-params">(String message, Throwable cause, <span class="hljs-keyword">boolean</span> enableSuppression, <span class="hljs-keyword">boolean</span> writableStackTrace)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(message, cause, enableSuppression, writableStackTrace);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="配置拦截器"><a href="#配置拦截器" class="headerlink" title="配置拦截器"></a>配置拦截器</h3><p>拦截器拦截登录页面，退出，登录请求以外的路径</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptors</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptor</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 配置将要拦截的资源路径:--&gt;</span><br>        <span class="hljs-comment">&lt;!-- /** 表示多层路径 /aaa/bbb--&gt;</span><br>        <span class="hljs-comment">&lt;!-- /* 表示一层路径 /aaa--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/**&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- 配置不拦截的请求--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:exclude-mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/admin/to/login/page.html&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:exclude-mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/admin/do/login.html&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:exclude-mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/admin/do/logout.html&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- 配置拦截器类--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.fall.mvc.interceptor.LoginInterceptor&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptor</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptors</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="配置异常类的映射路径"><a href="#配置异常类的映射路径" class="headerlink" title="配置异常类的映射路径"></a>配置异常类的映射路径</h3><p>触发异常则返回登陆页面</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;simpleMappingExceptionResolver&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--   配置异常视图和具体页面的对应关系     --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;exceptionMappings&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- key属性指定异常的全类名，标签中写具体对应的视图(这个值要拼前后缀得到的路径)    --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;java.lang.Exception&quot;</span>&gt;</span>system-error<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 通过xml配置拒绝访问异常映射，跳转登陆页面--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;AccessForbiddenException&quot;</span>&gt;</span>admin-login<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="管理员维护"><a href="#管理员维护" class="headerlink" title="管理员维护"></a>管理员维护</h2><h3 id="查询用户"><a href="#查询用户" class="headerlink" title="查询用户"></a>查询用户</h3><h4 id="目标-5"><a href="#目标-5" class="headerlink" title="目标"></a>目标</h4><p>将数据库的Admin数据在页面上已分页的形式显示，在后端将“带关键字”和“不带关键字”的分页合并为同一套代码。</p>
<h4 id="思路-5"><a href="#思路-5" class="headerlink" title="思路"></a>思路</h4><p><img src="/img/atcrowdfunding.assets/image-20220113192952927.png" alt="image-20220113192952927"></p>
<h4 id="导入pagehelper依赖"><a href="#导入pagehelper依赖" class="headerlink" title="导入pagehelper依赖"></a>导入pagehelper依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- MyBatis 分页插件 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="在mybatis配置文件中配置分页插件"><a href="#在mybatis配置文件中配置分页插件" class="headerlink" title="在mybatis配置文件中配置分页插件"></a>在mybatis配置文件中配置分页插件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sqlSessionFactory&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span><br>    ...<br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;plugins&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 配置pagehelper插件--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.github.pagehelper.PageHelper&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;properties&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span><br>                        <span class="hljs-comment">&lt;!-- 配置数据库方言（mysql）--&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;dialect&quot;</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>                        <span class="hljs-comment">&lt;!-- 配置页码的合理修正--&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;reasonable&quot;</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="AdminMapper添加根据关键字查询sql"><a href="#AdminMapper添加根据关键字查询sql" class="headerlink" title="AdminMapper添加根据关键字查询sql"></a>AdminMapper添加根据关键字查询sql</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectAdminByKeyword&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span><br>    select<br>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;Base_Column_List&quot;</span> /&gt;</span><br>    from t_admin<br>    where login_acct like concat(&quot;%&quot;,#&#123;keyword&#125;,&quot;%&quot;)<br>    or user_name like concat(&quot;%&quot;,#&#123;keyword&#125;,&quot;%&quot;)<br>    or email like concat(&quot;%&quot;,#&#123;keyword&#125;,&quot;%&quot;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="AdminServiceImpl中接口中的实现方法"><a href="#AdminServiceImpl中接口中的实现方法" class="headerlink" title="AdminServiceImpl中接口中的实现方法"></a>AdminServiceImpl中接口中的实现方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 按关键字查询数据，并返回分页对象</span><br><span class="hljs-function">PageInfo&lt;Admin&gt; <span class="hljs-title">getPageInfo</span><span class="hljs-params">(String keyword,Integer pageNum,Integer pageSize)</span></span>;<br></code></pre></td></tr></table></figure>

<p>使用pagehelper插件封装List对象为pageInfo对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> PageInfo&lt;Admin&gt; <span class="hljs-title">getPageInfo</span><span class="hljs-params">(String keyword, Integer pageNum, Integer pageSize)</span> </span>&#123;<br>    <span class="hljs-comment">// 1.开启pageHelper功能</span><br>    <span class="hljs-comment">// 体现了pageHelper的”非侵入设计“，原本要做的查询不必有任何修改</span><br>    PageHelper.startPage(pageNum, pageSize);<br>    <span class="hljs-comment">// 2.按照关键字进行查询</span><br>    List&lt;Admin&gt; admins = adminMapper.selectAdminByKeyword(keyword);<br>    <span class="hljs-comment">// 3.返回封装的pageInfo对象</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PageInfo(admins);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="分页hanlder处理请求"><a href="#分页hanlder处理请求" class="headerlink" title="分页hanlder处理请求"></a>分页hanlder处理请求</h4><p>当不点击页数是时，需要设置默认值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/admin/get/page.html&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPageInfo</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        // 当值为空时，需要指定默认值</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(value = &quot;keyword&quot;, defaultValue = &quot;&quot;)</span> String keyword,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="hljs-params"><span class="hljs-function">        ModelMap modelMap</span></span><br><span class="hljs-params"><span class="hljs-function">)</span> </span>&#123;<br>    PageInfo&lt;Admin&gt; pageInfo = adminService.getPageInfo(keyword, pageNum, pageSize);<br>    modelMap.addAttribute(CrowdConstant.ATTR_NAME_PAGE_INFO,pageInfo);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;admin-page&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="在分页页面显示信息"><a href="#在分页页面显示信息" class="headerlink" title="在分页页面显示信息"></a>在分页页面显示信息</h4><ul>
<li><p>先导入jstl标签库，进行调用信息显示</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%<span class="hljs-meta">@taglib</span> prefix=<span class="hljs-string">&quot;c&quot;</span> uri=<span class="hljs-string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>table标签显示数据</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;table <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;table  table-bordered&quot;</span>&gt;<br>    &lt;thead&gt;<br>    &lt;tr&gt;<br>        &lt;th width=<span class="hljs-string">&quot;30&quot;</span>&gt;#&lt;/th&gt;<br>        &lt;th width=<span class="hljs-string">&quot;30&quot;</span>&gt;&lt;input type=<span class="hljs-string">&quot;checkbox&quot;</span>&gt;&lt;/th&gt;<br>        &lt;th&gt;账号&lt;/th&gt;<br>        &lt;th&gt;名称&lt;/th&gt;<br>        &lt;th&gt;邮箱地址&lt;/th&gt;<br>        &lt;th width=<span class="hljs-string">&quot;100&quot;</span>&gt;操作&lt;/th&gt;<br>    &lt;/tr&gt;<br>    &lt;/thead&gt;<br>    &lt;tbody&gt;<br>    &lt;%-- jstl --%&gt;<br>    &lt;c:<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;$&#123;empty requestScope.pageInfo.list&#125;&quot;</span>&gt;<br>        &lt;tr&gt;<br>            &lt;td colspan=<span class="hljs-string">&quot;6&quot;</span>&gt;抱歉，查不到相关的数据！&lt;/td&gt;<br>        &lt;/tr&gt;<br>    &lt;/c:<span class="hljs-keyword">if</span>&gt;<br>    &lt;c:<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;$&#123;!empty requestScope.pageInfo.list&#125;&quot;</span>&gt;<br>        &lt;c:forEach items=<span class="hljs-string">&quot;$&#123;requestScope.pageInfo.list&#125;&quot;</span> <span class="hljs-keyword">var</span>=<span class="hljs-string">&quot;admin&quot;</span> varStatus=<span class="hljs-string">&quot;status&quot;</span>&gt;<br>            &lt;tr&gt;<br>                &lt;td&gt;$&#123;status.count&#125;&lt;/td&gt;<br>                &lt;td&gt;&lt;input type=<span class="hljs-string">&quot;checkbox&quot;</span>&gt;&lt;/td&gt;<br>                &lt;td&gt;$&#123;admin.loginAcct&#125;&lt;/td&gt;<br>                &lt;td&gt;$&#123;admin.userName&#125;&lt;/td&gt;<br>                &lt;td&gt;$&#123;admin.email&#125;&lt;/td&gt;<br>                &lt;td&gt;<br>                    &lt;a href=<span class="hljs-string">&quot;assign/to/page.html?adminId=$&#123;admin.id&#125;&amp;pageNum=$&#123;requestScope.pageInfo.pageNum&#125;&amp;keyword=$&#123;param.keyword&#125;&quot;</span><br>                       <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-success btn-xs&quot;</span>&gt;&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot; glyphicon glyphicon-check&quot;</span>&gt;&lt;/i&gt;&lt;/a&gt;<br>                    &lt;a href=<span class="hljs-string">&quot;admin/page/update/$&#123;admin.id&#125;/$&#123;requestScope.pageInfo.pageNum&#125;/$&#123;param.keyword&#125;.html&quot;</span><br>                       <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-primary btn-xs&quot;</span>&gt;&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot; glyphicon glyphicon-pencil&quot;</span>&gt;&lt;/i&gt;&lt;/a&gt;<br>                    &lt;a href=<span class="hljs-string">&quot;admin/page/remove/$&#123;admin.id&#125;/$&#123;requestScope.pageInfo.pageNum&#125;/$&#123;param.keyword&#125;.html&quot;</span><br>                       <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-danger btn-xs&quot;</span>&gt;<br>                        &lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot; glyphicon glyphicon-remove&quot;</span>&gt;&lt;/i&gt;<br>                    &lt;/a&gt;<br>                &lt;/td&gt;<br>            &lt;/tr&gt;<br>        &lt;/c:forEach&gt;<br>    &lt;/c:<span class="hljs-keyword">if</span>&gt;<br>    &lt;/tbody&gt;<br>&lt;/table&gt;<br></code></pre></td></tr></table></figure>

<h4 id="分页导航条"><a href="#分页导航条" class="headerlink" title="分页导航条"></a>分页导航条</h4><p>使用<strong>Pagination</strong>来选择页码</p>
<ul>
<li><p>导入pagination的css和jquery文件</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%--引入pagination的css--%&gt;<br>&lt;link href=<span class="hljs-string">&quot;css/pagination.css&quot;</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span> /&gt;<br>&lt;%--引入基于jquery的paginationjs--%&gt;<br>&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span> src=<span class="hljs-string">&quot;jquery/jquery.pagination.js&quot;</span>&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>分页导航条显示</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;/tbody&gt;<br>&lt;tfoot&gt;<br>&lt;tr&gt;<br>    &lt;td colspan=<span class="hljs-string">&quot;6&quot;</span> align=<span class="hljs-string">&quot;center&quot;</span>&gt;<br>        &lt;div id=<span class="hljs-string">&quot;Pagination&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;pagination&quot;</span>&gt;&lt;!-- 这里显示分页 --&gt;&lt;/div&gt;<br>    &lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;/tfoot&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>js代码</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>    $(function () &#123;<br>        initPagination();<br>    &#125;);<br><br>    <span class="hljs-function">function <span class="hljs-title">initPagination</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//获取分页数据中的总记录数</span><br>        <span class="hljs-keyword">var</span> totalRecord = $&#123;requestScope.pageInfo.total&#125;;<br><br>        <span class="hljs-comment">//声明Pagination设置属性的JSON对象</span><br>        <span class="hljs-keyword">var</span> properties = &#123;<br>            num_edge_entries: <span class="hljs-number">3</span>,                                <span class="hljs-comment">//边缘页数</span><br>            num_display_entries: <span class="hljs-number">5</span>,                             <span class="hljs-comment">//主体页数</span><br>            callback: pageSelectCallback,                       <span class="hljs-comment">//点击各种翻页反扭时触发的回调函数（执行翻页操作）</span><br>            current_page: $&#123;requestScope.pageInfo.pageNum-<span class="hljs-number">1</span>&#125;,   <span class="hljs-comment">//当前页码</span><br>            prev_text: <span class="hljs-string">&quot;上一页&quot;</span>,                                 <span class="hljs-comment">//在对应上一页操作的按钮上的文本</span><br>            next_text: <span class="hljs-string">&quot;下一页&quot;</span>,                                 <span class="hljs-comment">//在对应下一页操作的按钮上的文本</span><br>            items_per_page: $&#123;requestScope.pageInfo.pageSize&#125;   <span class="hljs-comment">//每页显示的数量</span><br>        &#125;;<br>        $(<span class="hljs-string">&quot;#Pagination&quot;</span>).pagination(totalRecord,properties);<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">pageSelectCallback</span><span class="hljs-params">(pageIndex, jQuery)</span></span>&#123;<br>        <span class="hljs-comment">// pageIndex是当前页码的索引，因此比pageNum小1</span><br>        <span class="hljs-keyword">var</span> pageNum = pageIndex+<span class="hljs-number">1</span>;<br>        <span class="hljs-comment">// 执行页面跳转</span><br>        window.location.href = <span class="hljs-string">&quot;admin/get/page.html?pageNum=&quot;</span>+pageNum;<br>        <span class="hljs-comment">// 取消当前超链接的默认行为</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>修复造成一直刷新的回调bug</p>
<p>在jquery.pagination.js中将其注释掉</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 回调函数</span><br><span class="hljs-comment">// opts.callback(current_page, this);</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="关键字查询"><a href="#关键字查询" class="headerlink" title="关键字查询"></a>关键字查询</h4><ul>
<li><p>修改form标签</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;form <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-inline&quot;</span> action=<span class="hljs-string">&quot;admin/get/page.html&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> role=<span class="hljs-string">&quot;form&quot;</span><br>      style=<span class="hljs-string">&quot;float:left;&quot;</span>&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group has-feedback&quot;</span>&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;input-group&quot;</span>&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;input-group-addon&quot;</span>&gt;查询条件&lt;/div&gt;<br>            &lt;input <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control has-success&quot;</span> name=<span class="hljs-string">&quot;keyword&quot;</span> type=<span class="hljs-string">&quot;text&quot;</span> placeholder=<span class="hljs-string">&quot;请输入查询条件&quot;</span><br>                   value=<span class="hljs-string">&quot;$&#123;param.keyword&#125;&quot;</span>/&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>    &lt;button type=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-warning&quot;</span>&gt;&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-search&quot;</span>&gt;&lt;/i&gt; 查询<br>    &lt;/button&gt;<br>&lt;/form&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>在页面切换后，关键字不在请求参数中，在转发请求路径中加入关键字</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jS"><span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">&quot;admin/get/page.html?pageNum=&quot;</span> + pageNum+<span class="hljs-string">&quot;&amp;keyword=&quot;</span>+$&#123;param.keyword&#125;;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><h4 id="目标-6"><a href="#目标-6" class="headerlink" title="目标"></a>目标</h4><p>点击删除将数据删除后，返回当前页面。</p>
<h4 id="思路-6"><a href="#思路-6" class="headerlink" title="思路"></a>思路</h4><p><img src="/img/atcrowdfunding.assets/image-20220114101538435.png" alt="image-20220114101538435"></p>
<h4 id="设置按钮跳转路径"><a href="#设置按钮跳转路径" class="headerlink" title="设置按钮跳转路径"></a>设置按钮跳转路径</h4><p>使用Restful风格，pageNum在重定向时需要在路径中传入需要显示的页面，keyword在查询条件后删除，在重定向时也需要传入显示关键字查询页面</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;a href=<span class="hljs-string">&quot;admin/remove/$&#123;admin.id&#125;/$&#123;requestScope.pageInfo.pageNum&#125;/$&#123;param.keyword&#125;.html&quot;</span><br>   <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-danger btn-xs&quot;</span>&gt;<br></code></pre></td></tr></table></figure>

<h4 id="Hander方法"><a href="#Hander方法" class="headerlink" title="Hander方法"></a>Hander方法</h4><p>返回时的问题：</p>
<ol>
<li>直接返回页面会因为没有发送分页请求而无法显示数据</li>
<li>使用转发发送分页请求可以实现页面的显示，但用户刷新后会造成后台重复删除</li>
<li>使用重定向可以防止重复删除</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/admin/remove/&#123;adminId&#125;/&#123;pageNum&#125;/&#123;keyword&#125;.html&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">remove</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@PathVariable(&quot;adminId&quot;)</span> Integer adminId,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@PathVariable(&quot;pageNum&quot;)</span> Integer pageNum,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@PathVariable(&quot;keyword&quot;)</span> String keyword</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>&#123;<br>    adminService.removeOne(adminId);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/admin/get/page.html?pageNum=&quot;</span>+pageNum+<span class="hljs-string">&quot;&amp;keyword=&quot;</span>+keyword;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="AdminService接口"><a href="#AdminService接口" class="headerlink" title="AdminService接口"></a>AdminService接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">removeOne</span><span class="hljs-params">(Integer adminId)</span></span>;<br></code></pre></td></tr></table></figure>

<h4 id="AdminServiceImpl"><a href="#AdminServiceImpl" class="headerlink" title="AdminServiceImpl"></a>AdminServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeOne</span><span class="hljs-params">(Integer adminId)</span> </span>&#123;<br>    adminMapper.deleteByPrimaryKey(adminId);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="新增用户"><a href="#新增用户" class="headerlink" title="新增用户"></a>新增用户</h3><h4 id="目标-7"><a href="#目标-7" class="headerlink" title="目标"></a>目标</h4><p>将表单提交的admin对象保存到数据库中</p>
<ul>
<li>loginAcct不能重复</li>
<li>密码加密</li>
</ul>
<h4 id="思路-7"><a href="#思路-7" class="headerlink" title="思路"></a>思路</h4><p><img src="/img/atcrowdfunding.assets/image-20220114112324628.png" alt="image-20220114112324628"></p>
<h4 id="添加唯一索引"><a href="#添加唯一索引" class="headerlink" title="添加唯一索引"></a>添加唯一索引</h4><p>给数据库中login_acct字段添加唯一索引，防止用户名重复（在添加时注意表中<strong>不能有重复的数据</strong>，会报错1062）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> t_admin <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> INDEX(login_acct);<br></code></pre></td></tr></table></figure>

<h4 id="修改admin-add-jsp页面"><a href="#修改admin-add-jsp页面" class="headerlink" title="修改admin-add.jsp页面"></a>修改admin-add.jsp页面</h4><p>修改字段中的name属性和Admin实体对应，修改提交请求路径</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs jsp">    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main&quot;</span>&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main&quot;</span>&gt;<br>            &lt;ol <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;breadcrumb&quot;</span>&gt;<br>                &lt;li&gt;&lt;a href=<span class="hljs-string">&quot;admin/main/page.html&quot;</span>&gt;首页&lt;/a&gt;&lt;/li&gt;<br>                &lt;li&gt;&lt;a href=<span class="hljs-string">&quot;admin/page/page.html&quot;</span>&gt;数据列表&lt;/a&gt;&lt;/li&gt;<br>                &lt;li <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;active&quot;</span>&gt;新增&lt;/li&gt;<br>            &lt;/ol&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel panel-default&quot;</span>&gt;<br>                &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel-heading&quot;</span>&gt;表单数据<br>                    &lt;div style=<span class="hljs-string">&quot;float:right;cursor:pointer;&quot;</span> data-toggle=<span class="hljs-string">&quot;modal&quot;</span> data-target=<span class="hljs-string">&quot;#myModal&quot;</span>&gt;&lt;i<br>                            <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-question-sign&quot;</span>&gt;&lt;/i&gt;&lt;/div&gt;<br>                &lt;/div&gt;<br>                &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel-body&quot;</span>&gt;<br>                    &lt;form action=<span class="hljs-string">&quot;admin/save.html&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> role=<span class="hljs-string">&quot;form&quot;</span>&gt;<br>                        &lt;p&gt;$&#123;requestScope.exception.message&#125;&lt;/p&gt;<br>                        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;<br>                            &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span>&gt;登录账号&lt;/label&gt;<br>                            &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;loginAcct&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> id=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span><br>                                   placeholder=<span class="hljs-string">&quot;请输入登录账号&quot;</span>&gt;<br>                        &lt;/div&gt;<br>                        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;<br>                            &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span>&gt;用户密码&lt;/label&gt;<br>                            &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;userPswd&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> id=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span><br>                                   placeholder=<span class="hljs-string">&quot;请输入用户密码&quot;</span>&gt;<br>                        &lt;/div&gt;<br>                        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;<br>                            &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span>&gt;用户昵称&lt;/label&gt;<br>                            &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;userName&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> id=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span><br>                                   placeholder=<span class="hljs-string">&quot;请输入用户昵称&quot;</span>&gt;<br>                        &lt;/div&gt;<br><br>                        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;<br>                            &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;exampleInputEmail1&quot;</span>&gt;邮箱地址&lt;/label&gt;<br>                            &lt;input type=<span class="hljs-string">&quot;email&quot;</span> name=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> id=<span class="hljs-string">&quot;exampleInputEmail1&quot;</span><br>                                   placeholder=<span class="hljs-string">&quot;请输入邮箱地址&quot;</span>&gt;<br>                            &lt;p <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;help-block label label-warning&quot;</span>&gt;请输入合法的邮箱地址, 格式为： xxxx<span class="hljs-meta">@xxxx</span>.com&lt;/p&gt;<br>                        &lt;/div&gt;<br>                        &lt;button type=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-success&quot;</span>&gt;&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;&lt;/i&gt; 新增<br>                        &lt;/button&gt;<br>                        &lt;button type=<span class="hljs-string">&quot;reset&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-danger&quot;</span>&gt;&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-refresh&quot;</span>&gt;&lt;/i&gt; 重置<br>                        &lt;/button&gt;<br>                    &lt;/form&gt;<br>                &lt;/div&gt;<br>            &lt;/div&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>

<h4 id="Handler方法"><a href="#Handler方法" class="headerlink" title="Handler方法"></a>Handler方法</h4><p>注意重定向到最后一页</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;admin/save.html&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">saveAdmin</span><span class="hljs-params">(Admin admin)</span></span>&#123;<br>    <span class="hljs-comment">// 1.调用service保存数据</span><br>    adminService.saveAdmin(admin);<br>    <span class="hljs-comment">// 2.返回页面，由于新增数据在最后一条，将数据定位到最后一页</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/admin/get/page.html?pageNum=&quot;</span>+Integer.MAX_VALUE;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="AdminServiceImpl中实现方法"><a href="#AdminServiceImpl中实现方法" class="headerlink" title="AdminServiceImpl中实现方法"></a>AdminServiceImpl中实现方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveAdmin</span><span class="hljs-params">(Admin admin)</span> </span>&#123;<br>    <span class="hljs-comment">// 1.取出密码进行md5加密</span><br>    String password=admin.getUserPswd();<br>    String passwordMd5 = CrowdUtils.md5(password);<br>    admin.setUserPswd(passwordMd5);<br>    <span class="hljs-comment">// 2.设置新增时间</span><br>    Date date = <span class="hljs-keyword">new</span> Date();<br>    SimpleDateFormat simpleDateFormat = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br>    String createTime = simpleDateFormat.format(date);<br>    admin.setCreateTime(createTime);<br>    <span class="hljs-comment">// 3.添加数据</span><br>    adminMapper.insert(admin);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="处理账户一致异常"><a href="#处理账户一致异常" class="headerlink" title="处理账户一致异常"></a>处理账户一致异常</h4><ul>
<li><p>由于在mysql中设置了唯一约束，在进行添加时spring会报DuplicateKeyException异常，自定义异常类进行处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginAcctAlreadyInUseException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginAcctAlreadyInUseException</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginAcctAlreadyInUseException</span><span class="hljs-params">(String message)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(message);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginAcctAlreadyInUseException</span><span class="hljs-params">(String message, Throwable cause)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(message, cause);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginAcctAlreadyInUseException</span><span class="hljs-params">(Throwable cause)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(cause);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginAcctAlreadyInUseException</span><span class="hljs-params">(String message, Throwable cause, <span class="hljs-keyword">boolean</span> enableSuppression, <span class="hljs-keyword">boolean</span> writableStackTrace)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(message, cause, enableSuppression, writableStackTrace);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>在CrowdExceptionResolver中添加异常处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 处理用户名重复的异常</span><br><span class="hljs-meta">@ExceptionHandler(value = &#123;LoginAcctAlreadyInUseException.class&#125;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">loginAcctAlreadyInUseExceptionResolver</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        // 实际捕获到的类型</span></span><br><span class="hljs-params"><span class="hljs-function">        LoginAcctAlreadyInUseException LoginAcctAlreadyInUseException,</span></span><br><span class="hljs-params"><span class="hljs-function">        // 当前请求对象</span></span><br><span class="hljs-params"><span class="hljs-function">        HttpServletRequest request,</span></span><br><span class="hljs-params"><span class="hljs-function">        // 当前响应对象</span></span><br><span class="hljs-params"><span class="hljs-function">        HttpServletResponse response</span></span><br><span class="hljs-params"><span class="hljs-function">        // 指定普通页时去的错误页面</span></span><br><span class="hljs-params"><span class="hljs-function">)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    String viewName = <span class="hljs-string">&quot;admin-add&quot;</span>;<br>    <span class="hljs-keyword">return</span> conmonResolver(LoginAcctAlreadyInUseException, request, response, viewName);<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>在增加记录时捕获异常，并抛出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 3.添加数据</span><br><span class="hljs-keyword">try</span> &#123;<br>    adminMapper.insert(admin);<br>&#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>    <span class="hljs-keyword">if</span>(exception <span class="hljs-keyword">instanceof</span> DuplicateKeyException)&#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> LoginAcctAlreadyInUseException(CrowdConstant.MESSAGE_LOGIN_ACCT_ALREADY_IN_USE);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="更新用户"><a href="#更新用户" class="headerlink" title="更新用户"></a>更新用户</h3><h4 id="目标-8"><a href="#目标-8" class="headerlink" title="目标"></a>目标</h4><p>修改现有的Admin，不修改密码和创建时间。</p>
<h4 id="思路-8"><a href="#思路-8" class="headerlink" title="思路"></a>思路</h4><p><img src="/img/atcrowdfunding.assets/image-20220114141705314.png" alt="image-20220114141705314"></p>
<h4 id="表单回显"><a href="#表单回显" class="headerlink" title="表单回显"></a>表单回显</h4><ul>
<li><p>Handler方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/admin/to/edit/page.html&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toEditPage</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(&quot;adminId&quot;)</span> Integer adminId,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(&quot;pageNum&quot;)</span> Integer pageNum,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(&quot;keyword&quot;)</span> String keyword,</span></span><br><span class="hljs-params"><span class="hljs-function">        ModelMap modelMap</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>&#123;<br>    <span class="hljs-comment">// 1.调用serivce查询数据</span><br>    Admin admin=adminService.getAdminById(adminId);<br>    <span class="hljs-comment">// 2.将admin数据保存到model中，用于表单回显数据，pageNum和keyword返回</span><br>    modelMap.addAttribute(<span class="hljs-string">&quot;admin&quot;</span>,admin);<br>    modelMap.addAttribute(<span class="hljs-string">&quot;pageNum&quot;</span>,pageNum);<br>    modelMap.addAttribute(<span class="hljs-string">&quot;keyword&quot;</span>,keyword);<br>    <span class="hljs-comment">// 3.返回到修改页面</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;admin-edit&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>修改页面和新增页面相似</p>
<p>注意将pageNum和keyword设置在隐藏域中，用于更新后返回分页</p>
<p>（报错400，注意createTime也需要传进去才能自动封装Admin）</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main&quot;</span>&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main&quot;</span>&gt;<br>        &lt;ol <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;breadcrumb&quot;</span>&gt;<br>            &lt;li&gt;&lt;a href=<span class="hljs-string">&quot;admin/main/page.html&quot;</span>&gt;首页&lt;/a&gt;&lt;/li&gt;<br>            &lt;li&gt;&lt;a href=<span class="hljs-string">&quot;admin/page/page.html&quot;</span>&gt;数据列表&lt;/a&gt;&lt;/li&gt;<br>            &lt;li <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;active&quot;</span>&gt;更新&lt;/li&gt;<br>        &lt;/ol&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel panel-default&quot;</span>&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel-heading&quot;</span>&gt;表单数据<br>                &lt;div style=<span class="hljs-string">&quot;float:right;cursor:pointer;&quot;</span> data-toggle=<span class="hljs-string">&quot;modal&quot;</span> data-target=<span class="hljs-string">&quot;#myModal&quot;</span>&gt;<br>                    &lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-question-sign&quot;</span>&gt;&lt;/i&gt;<br>                &lt;/div&gt;<br>            &lt;/div&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel-body&quot;</span>&gt;<br>                &lt;form action=<span class="hljs-string">&quot;admin/update.html&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> role=<span class="hljs-string">&quot;form&quot;</span>&gt;<br>                    &lt;%-- 显示错误信息 --%&gt;<br>                    &lt;p&gt;$&#123;requestScope.exception.message&#125;&lt;/p&gt;<br>                    &lt;%-- type=hidden，因为这些数据不需要（pageNum、keyword）或不应该被修改（id、createTime）只需要传递给后端即可 --%&gt;<br>                    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;id&quot;</span> value=<span class="hljs-string">&quot;$&#123;requestScope.admin.id&#125;&quot;</span>/&gt;<br>                    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;createTime&quot;</span> value=<span class="hljs-string">&quot;$&#123;requestScope.admin.createTime&#125;&quot;</span>/&gt;<br>                    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;pageNum&quot;</span> value=<span class="hljs-string">&quot;$&#123;requestScope.pageNum&#125;&quot;</span>/&gt;<br>                    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;keyword&quot;</span> value=<span class="hljs-string">&quot;$&#123;requestScope.keyword&#125;&quot;</span>/&gt;<br>                    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;<br>                        &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span>&gt;登录账号&lt;/label&gt;<br>                        &lt;%-- 通过value给各个文本框赋原始值 --%&gt;<br>                        &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;loginAcct&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> id=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span><br>                               value=<span class="hljs-string">&quot;$&#123;requestScope.admin.loginAcct&#125;&quot;</span> placeholder=<span class="hljs-string">&quot;请输入登录账号&quot;</span>&gt;<br>                    &lt;/div&gt;<br>                    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;<br>                        &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span>&gt;用户昵称&lt;/label&gt;<br>                        &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;userName&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> id=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span><br>                               value=<span class="hljs-string">&quot;$&#123;requestScope.admin.userName&#125;&quot;</span> placeholder=<span class="hljs-string">&quot;请输入用户昵称&quot;</span>&gt;<br>                    &lt;/div&gt;<br><br>                    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;<br>                        &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;exampleInputEmail1&quot;</span>&gt;邮箱地址&lt;/label&gt;<br>                        &lt;input type=<span class="hljs-string">&quot;email&quot;</span> name=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> id=<span class="hljs-string">&quot;exampleInputEmail1&quot;</span><br>                               value=<span class="hljs-string">&quot;$&#123;requestScope.admin.email&#125;&quot;</span> placeholder=<span class="hljs-string">&quot;请输入邮箱地址&quot;</span>&gt;<br>                        &lt;p <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;help-block label label-warning&quot;</span>&gt;请输入合法的邮箱地址, 格式为： xxxx<span class="hljs-meta">@xxxx</span>.com&lt;/p&gt;<br>                    &lt;/div&gt;<br>                    &lt;button type=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-success&quot;</span>&gt;<br>                        &lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;修改&lt;/i&gt;<br>                    &lt;/button&gt;<br>                    &lt;button type=<span class="hljs-string">&quot;reset&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-danger&quot;</span>&gt;<br>                        &lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-refresh&quot;</span>&gt;重置&lt;/i&gt;<br>                    &lt;/button&gt;<br>                &lt;/form&gt;<br>            &lt;/div&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h4><ul>
<li><p>Handler方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;admin/update.html&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">updateAdmin</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        Admin admin,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(&quot;pageNum&quot;)</span> Integer pageNum,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(&quot;keyword&quot;)</span> String keyword</span></span><br><span class="hljs-params"><span class="hljs-function">        )</span></span>&#123;<br>    <span class="hljs-comment">// 1.调用service更新信息</span><br>    adminService.updateAdmin(admin);<br>    <span class="hljs-comment">// 2.重定向到分页页面</span><br>    System.out.println(keyword);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/admin/get/page.html?pageNum=&quot;</span>+pageNum+<span class="hljs-string">&quot;&amp;keyword=&quot;</span>+keyword;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>接口中实现更新操作</p>
<p>当<strong>用户名相同</strong>时，抛出异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateAdmin</span><span class="hljs-params">(Admin admin)</span> </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// 有选择的更新</span><br>        adminMapper.updateByPrimaryKeySelective(admin);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>        <span class="hljs-comment">// 抛出更新时，用户名相同异常</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> LoginAcctAlreadyUpdateException(CrowdConstant.MESSAGE_LOGIN_ACCT_ALREADY_IN_USE);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>自定义异常类和登录一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  更新Admin如果有相同的账户，则抛出这个异常</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginAcctAlreadyUpdateException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span></span>&#123;<br>...<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>异常处理方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 处理新增用户名重复的异常</span><br><span class="hljs-meta">@ExceptionHandler(value = &#123;LoginAcctAlreadyInUseException.class&#125;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">loginAcctAlreadyInUseExceptionResolver</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        // 实际捕获到的类型</span></span><br><span class="hljs-params"><span class="hljs-function">        LoginAcctAlreadyInUseException LoginAcctAlreadyInUseException,</span></span><br><span class="hljs-params"><span class="hljs-function">        // 当前请求对象</span></span><br><span class="hljs-params"><span class="hljs-function">        HttpServletRequest request,</span></span><br><span class="hljs-params"><span class="hljs-function">        // 当前响应对象</span></span><br><span class="hljs-params"><span class="hljs-function">        HttpServletResponse response</span></span><br><span class="hljs-params"><span class="hljs-function">        // 指定普通页时去的错误页面</span></span><br><span class="hljs-params"><span class="hljs-function">)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    String viewName = <span class="hljs-string">&quot;admin-add&quot;</span>;<br>    <span class="hljs-keyword">return</span> conmonResolver(LoginAcctAlreadyInUseException, request, response, viewName);<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="角色系统"><a href="#角色系统" class="headerlink" title="角色系统"></a>角色系统</h1><h2 id="RBAC模型"><a href="#RBAC模型" class="headerlink" title="RBAC模型"></a>RBAC模型</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><h4 id="为什么要进行权限控制"><a href="#为什么要进行权限控制" class="headerlink" title="为什么要进行权限控制"></a>为什么要进行权限控制</h4><p>如果没有权限控制，系统的功能完全不设防，全部暴露在所有用户面前。用户登录 以后可以使用系统中的所有功能。这是实际运行中不能接受的。 </p>
<p>所以权限控制系统的<strong>目标</strong>就是管理用户行为，保护系统功能。 </p>
<h4 id="什么是权限控制"><a href="#什么是权限控制" class="headerlink" title="什么是权限控制"></a>什么是权限控制</h4><p>“权限”=“权力”+“限制” </p>
<h4 id="如何进行权限控制"><a href="#如何进行权限控制" class="headerlink" title="如何进行权限控制"></a>如何进行权限控制</h4><h3 id="定义资源"><a href="#定义资源" class="headerlink" title="定义资源"></a>定义资源</h3><p>资源就是系统中需要保护起来的功能。具体形式很多：URL 地址、handler 方 法、service 方法、页面元素等等都可以定义为资源使用权限控制系统保护起来。 </p>
<h3 id="创建权限"><a href="#创建权限" class="headerlink" title="创建权限"></a>创建权限</h3><p>一个功能复杂的项目会包含很多具体资源，成千上万都有可能。这么多资源逐 个进行操作太麻烦了。为了简化操作，可以将相关的几个资源封装到一起，打包成 一个“权限”同时分配给有需要的人。</p>
<p><strong>创建角色</strong> </p>
<p>对于一个庞大系统来说，一方面需要保护的资源非常多，另一方面操作系统的 人也非常多。把资源打包为权限是对操作的简化，同样把用户划分为不同角色也是 对操作的简化。否则直接针对一个个用户进行管理就会很繁琐 所以角色就是用户的分组、分类。先给角色分配权限，然后再把角色分配给用户，用户以这个角色的身份操作系统就享有角色对应的权限了。 </p>
<p><strong>管理用户</strong> </p>
<p>系统中的用户其实是人操作系统时用来登录系统的账号、密码。 </p>
<p><strong>建立关联关系</strong> </p>
<p><strong>权限→资源：单向多对多</strong> </p>
<p>Java 类之间单向：从权限实体类可以获取到资源对象的集合，但是通过资 源获取不到权限 。</p>
<p>数据库表之间多对多： 一个权限可以包含多个资源 ,一个资源可以被分配给多个不同权限 。</p>
<p><strong>角色→权限：单向多对多</strong> </p>
<p>Java 类之间单向：从角色实体类可以获取到权限对象的集合，但是通过权限获取不到角色 。</p>
<p>数据库表之间多对多： 一个角色可以包含多个权限 ，一个权限可以被分配给多个不同角色 。</p>
<p><strong>用户→角色：双向多对多</strong> </p>
<p>Java 类之间双向：可以通过用户获取它具备的角色，也可以看一个角色下,包含哪些用户 。</p>
<p>数据库表之间： 一个角色可以包含多个用户 ，一个用户可以身兼数职。</p>
<h2 id="角色维护"><a href="#角色维护" class="headerlink" title="角色维护"></a>角色维护</h2><h3 id="分页显示角色"><a href="#分页显示角色" class="headerlink" title="分页显示角色"></a>分页显示角色</h3><h4 id="目标-9"><a href="#目标-9" class="headerlink" title="目标"></a>目标</h4><p>将角色数据分页显示，使用异步AJAX完成</p>
<h4 id="思路-9"><a href="#思路-9" class="headerlink" title="思路"></a>思路</h4><p><img src="/img/atcrowdfunding.assets/image-20220114200548146.png" alt="image-20220114200548146"></p>
<h4 id="创建数据库表"><a href="#创建数据库表" class="headerlink" title="创建数据库表"></a>创建数据库表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_role(<br>id <span class="hljs-type">INT</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">PRIMARY</span> key auto_increment,<br>name <span class="hljs-type">char</span>(<span class="hljs-number">100</span>)<br>)	<br></code></pre></td></tr></table></figure>

<h4 id="逆向工程"><a href="#逆向工程" class="headerlink" title="逆向工程"></a>逆向工程</h4><p>在generatorConfig中修改</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 数据库表名与需要的实体类对应映射的指定 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_role&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;Role&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure>

<p>生成后归类到各自的包中,生成Role的构造方法</p>
<h4 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h4><h5 id="查询语句"><a href="#查询语句" class="headerlink" title="查询语句"></a>查询语句</h5><p>RoleMapper接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-function">List&lt;Role&gt; <span class="hljs-title">selectRoleByKeyword</span><span class="hljs-params">(String keyword)</span></span>;<br></code></pre></td></tr></table></figure>

<p>RoleMapper.xml中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs XML"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectRoleByKeyword&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span><br>  select<br>  <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;Base_Column_List&quot;</span> /&gt;</span><br>  from t_role<br>  where name like concat(&quot;%&quot;,#&#123;keyword&#125;,&quot;%&quot;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="接口实现查询操作"><a href="#接口实现查询操作" class="headerlink" title="接口实现查询操作"></a>接口实现查询操作</h5><p>RoleService接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">RoleService</span> </span>&#123;<br>    <span class="hljs-comment">// 根据关键字查询Role</span><br>    <span class="hljs-function">PageInfo&lt;Role&gt; <span class="hljs-title">getRoleByKeyword</span><span class="hljs-params">(String keyword,Integer pageNum,Integer pageSize)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>RoleServiceImpl实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoleServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RoleService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RoleMapper roleMapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PageInfo&lt;Role&gt; <span class="hljs-title">getRoleByKeyword</span><span class="hljs-params">(String keyword, Integer pageNum, Integer pageSize)</span> </span>&#123;<br>        <span class="hljs-comment">// 1.开启分页插件</span><br>        PageHelper.startPage(pageNum,pageSize);<br>        <span class="hljs-comment">// 2.进行查询返回List对象</span><br>        List&lt;Role&gt; roles = roleMapper.selectRoleByKeyword(keyword);<br>        <span class="hljs-comment">// 3.将roles封装在pageInfo中</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PageInfo&lt;&gt;(roles);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="Handler方法-1"><a href="#Handler方法-1" class="headerlink" title="Handler方法"></a>Handler方法</h5><p>处理json请求，斌返回封装到ResultEntity中的json数据（异常已通过异常机制抛出，这里不做处理）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/role/get/page/info.json&quot;)</span><br><span class="hljs-keyword">public</span> ResultEntity&lt;PageInfo&lt;Role&gt;&gt; getPageInfo(<br>        <span class="hljs-meta">@RequestParam(value = &quot;keyword&quot;,defaultValue = &quot;&quot;)</span> String keyword,<br>        <span class="hljs-meta">@RequestParam(value = &quot;pageNum&quot;,defaultValue = &quot;1&quot;)</span> Integer pageNum,<br>        <span class="hljs-meta">@RequestParam(value = &quot;pageSize&quot;,defaultValue = &quot;5&quot;)</span> Integer pageSize<br>)&#123;<br>    <span class="hljs-comment">// 1.调用service查询</span><br>    PageInfo&lt;Role&gt; roleByKeyword = roleService.getRoleByKeyword(keyword, pageNum, pageSize);<br>    <span class="hljs-comment">// 2.封装到ResultEntity中,上面抛出异常是交给异常映射机制处理</span><br>    <span class="hljs-keyword">return</span> ResultEntity.successWithData(roleByKeyword);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h4><p>设置a标签路径</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;li style=<span class="hljs-string">&quot;height:30px;&quot;</span>&gt;<br>    &lt;a href=<span class="hljs-string">&quot;role/to/page.html&quot;</span>&gt;&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-king&quot;</span>&gt;&lt;/i&gt; 角色维护&lt;/a&gt;<br>&lt;/li&gt;<br></code></pre></td></tr></table></figure>

<h5 id="配置视图控制器"><a href="#配置视图控制器" class="headerlink" title="配置视图控制器"></a>配置视图控制器</h5><p>跳转到role-page页面</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:view-controller</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/role/to/page.html&quot;</span> <span class="hljs-attr">view-name</span>=<span class="hljs-string">&quot;role-page&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:view-controller</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="role-page页面"><a href="#role-page页面" class="headerlink" title="role-page页面"></a>role-page页面</h5><ul>
<li>引入外部js</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%--引入pagination的css--%&gt;<br>&lt;link href=<span class="hljs-string">&quot;css/pagination.css&quot;</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span>/&gt;<br>&lt;%--引入基于jquery的paginationjs--%&gt;<br>&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span> src=<span class="hljs-string">&quot;jquery/jquery.pagination.js&quot;</span>&gt;&lt;/script&gt;<br>&lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;ztree/zTreeStyle.css&quot;</span>/&gt;<br>&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span> src=<span class="hljs-string">&quot;ztree/jquery.ztree.all-3.5.min.js&quot;</span>&gt;&lt;/script&gt;<br>&lt;%--引入自定义的js代码--%&gt;<br>&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span> src=<span class="hljs-string">&quot;crowd/my-role.js&quot;</span> charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;&lt;/script&gt;<br>&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>    $(function () &#123;<br>        <span class="hljs-comment">// 设置各个全局变量，方便外部js文件中使用</span><br>        window.pageNum = <span class="hljs-number">1</span>;<br>        window.pageSize = <span class="hljs-number">5</span>;<br>        window.keyword = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-comment">// 调用外部的生成分页的函数</span><br>        generatePage();<br>    &#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>主题表格部分</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main&quot;</span>&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel panel-default&quot;</span>&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel-heading&quot;</span>&gt;<br>            &lt;h3 <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel-title&quot;</span>&gt;&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-th&quot;</span>&gt;&lt;/i&gt; 数据列表&lt;/h3&gt;<br>        &lt;/div&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel-body&quot;</span>&gt;<br>            &lt;form <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-inline&quot;</span> role=<span class="hljs-string">&quot;form&quot;</span> style=<span class="hljs-string">&quot;float:left;&quot;</span>&gt;<br>                &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group has-feedback&quot;</span>&gt;<br>                    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;input-group&quot;</span>&gt;<br>                        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;input-group-addon&quot;</span>&gt;查询条件&lt;/div&gt;<br>                        &lt;input <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control has-success&quot;</span> id=<span class="hljs-string">&quot;inputKeyword&quot;</span> type=<span class="hljs-string">&quot;text&quot;</span><br>                               placeholder=<span class="hljs-string">&quot;请输入查询条件&quot;</span>&gt;<br>                    &lt;/div&gt;<br>                &lt;/div&gt;<br>                &lt;button id=<span class="hljs-string">&quot;searchBtn&quot;</span> type=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-warning&quot;</span>&gt;&lt;i<br>                        <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-search&quot;</span>&gt;&lt;/i&gt; 查询<br>                &lt;/button&gt;<br>            &lt;/form&gt;<br>            &lt;button type=<span class="hljs-string">&quot;button&quot;</span> id=<span class="hljs-string">&quot;batchRemoveBtn&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-danger&quot;</span><br>                    style=<span class="hljs-string">&quot;float:right;margin-left:10px;&quot;</span>&gt;&lt;i<br>                    <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot; glyphicon glyphicon-remove&quot;</span>&gt;&lt;/i&gt; 删除<br>            &lt;/button&gt;<br>            &lt;button type=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span><br>                    style=<span class="hljs-string">&quot;float:right;&quot;</span> id=<span class="hljs-string">&quot;showAddModalBtn&quot;</span>&gt;<br>                &lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;&lt;/i&gt; 新增<br>            &lt;/button&gt;<br>            &lt;br&gt;<br>            &lt;hr style=<span class="hljs-string">&quot;clear:both;&quot;</span>&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;table-responsive&quot;</span>&gt;<br>                &lt;table <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;table  table-bordered&quot;</span>&gt;<br>                    &lt;thead&gt;<br>                    &lt;tr&gt;<br>                        &lt;th width=<span class="hljs-string">&quot;30&quot;</span>&gt;#&lt;/th&gt;<br>                        &lt;th width=<span class="hljs-string">&quot;30&quot;</span>&gt;&lt;input id=<span class="hljs-string">&quot;summaryBox&quot;</span> type=<span class="hljs-string">&quot;checkbox&quot;</span>&gt;&lt;/th&gt;<br>                        &lt;th&gt;名称&lt;/th&gt;<br>                        &lt;th width=<span class="hljs-string">&quot;100&quot;</span>&gt;操作&lt;/th&gt;<br>                    &lt;/tr&gt;<br>                    &lt;/thead&gt;<br>                    &lt;%--  tbody的id=rolePageTBody,用于绑定on()函数 --%&gt;<br>                    &lt;tbody id=<span class="hljs-string">&quot;rolePageTBody&quot;</span>&gt;<br>                    &lt;/tbody&gt;<br>                    &lt;tfoot&gt;<br>                    &lt;tr&gt;<br>                        &lt;td colspan=<span class="hljs-string">&quot;6&quot;</span> align=<span class="hljs-string">&quot;center&quot;</span>&gt;<br>                            &lt;div id=<span class="hljs-string">&quot;Pagination&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;pagination&quot;</span>&gt;&lt;!-- 这里显示分页 --&gt;&lt;/div&gt;<br>                        &lt;/td&gt;<br>                    &lt;/tr&gt;<br>                    &lt;/tfoot&gt;<br>                &lt;/table&gt;<br>            &lt;/div&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>

<h5 id="填充表格"><a href="#填充表格" class="headerlink" title="填充表格"></a>填充表格</h5><p>使用jquery处理json数据，并填充在表格中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 执行分页，生成分页效果</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generatePage</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// 通过getPageInfoRemote()方法得到pageInfo</span><br>    <span class="hljs-keyword">var</span> pageInfo = getPageInfoRemote();<br><br>    <span class="hljs-comment">// 将pageInfo传入fillTableTBody()方法，在tbody中生成分页后的数据</span><br>    fillTableTBody(pageInfo);<br>&#125;<br><br><span class="hljs-comment">// 从远程服务器端获取PageInfo数据</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPageInfoRemote</span>(<span class="hljs-params"></span>) </span>&#123;<br><br>    <span class="hljs-comment">// 调用$.ajax()函数发送请求，并用ajaxResult接收函数返回值</span><br>    <span class="hljs-keyword">var</span> ajaxResult = $.ajax(&#123;<br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;role/get/page/info.json&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>        <span class="hljs-comment">// 页码、页大小、关键字均从全局变量中获取</span><br>        <span class="hljs-attr">data</span>: &#123;<br>            <span class="hljs-string">&quot;pageNum&quot;</span>: <span class="hljs-built_in">window</span>.pageNum,<br>            <span class="hljs-string">&quot;pageSize&quot;</span>: <span class="hljs-built_in">window</span>.pageSize,<br>            <span class="hljs-string">&quot;keyword&quot;</span>: <span class="hljs-built_in">window</span>.keyword<br>        &#125;,<br>        <span class="hljs-attr">async</span>: <span class="hljs-literal">false</span>,        <span class="hljs-comment">//关闭异步模式，使用同步，这是为了显示页面时保持现有的顺序</span><br>        <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span><br>    &#125;);<br><br>    <span class="hljs-comment">// 取得当前的响应状态码</span><br>    <span class="hljs-keyword">var</span> statusCode = ajaxResult.status;<br><br>    <span class="hljs-comment">// 判断当前状态码是不是200，不是200表示发生错误，通过layer提示错误消息</span><br>    <span class="hljs-keyword">if</span> (statusCode != <span class="hljs-number">200</span>) &#123;<br>        layer.msg(<span class="hljs-string">&quot;失败！状态码=&quot;</span> + statusCode + <span class="hljs-string">&quot;错误信息=&quot;</span> + ajaxResult.statusText);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 响应状态码为200，进入下面的代码</span><br>    <span class="hljs-comment">// 通过responseJSON取得handler中的返回值</span><br>    <span class="hljs-keyword">var</span> resultEntity = ajaxResult.responseJSON;<br><br>    <span class="hljs-comment">// 从resultEntity取得result属性</span><br>    <span class="hljs-keyword">var</span> result = resultEntity.result;<br><br>    <span class="hljs-comment">// 判断result是否是FAILED</span><br>    <span class="hljs-keyword">if</span> (result == <span class="hljs-string">&quot;FAILED&quot;</span>) &#123;<br>        <span class="hljs-comment">// 显示失败的信息</span><br>        layer.msg(resultEntity.message);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// result不是失败时，获取pageInfo</span><br>    <span class="hljs-keyword">var</span> pageInfo = resultEntity.data;<br><br>    <span class="hljs-comment">// 返回pageInfo</span><br>    <span class="hljs-keyword">return</span> pageInfo;<br>&#125;<br><br><span class="hljs-comment">// 根据PageInfo填充表格</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fillTableTBody</span>(<span class="hljs-params">pageInfo</span>) </span>&#123;<br><br>    <span class="hljs-comment">// 清除tbody中的旧内容</span><br>    $(<span class="hljs-string">&quot;#rolePageTBody&quot;</span>).empty();<br><br>    <span class="hljs-comment">// 使无查询结果时，不显示导航条</span><br>    $(<span class="hljs-string">&quot;#Pagination&quot;</span>).empty();<br><br>    <span class="hljs-comment">// 判断pageInfo对象是否有效，无效则表示未查到数据</span><br>    <span class="hljs-keyword">if</span> (pageInfo == <span class="hljs-literal">null</span> || pageInfo == <span class="hljs-literal">undefined</span> || pageInfo.list == <span class="hljs-literal">null</span> || pageInfo.list.length == <span class="hljs-number">0</span>) &#123;<br>        $(<span class="hljs-string">&quot;#rolePageTBody&quot;</span>).append(<span class="hljs-string">&quot;&lt;tr&gt;&lt;td colspan=&#x27;4&#x27; align=&#x27;center&#x27;&gt;抱歉！没有查询到想要的数据&lt;/td&gt;&lt;/tr&gt;&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// pageInfo有效，使用pageInfo的list填充tbody</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; pageInfo.list.length; i++) &#123;<br><br>        <span class="hljs-keyword">var</span> role = pageInfo.list[i];<br>        <span class="hljs-keyword">var</span> roleId = role.id;<br>        <span class="hljs-keyword">var</span> roleName = role.name;<br>        <span class="hljs-keyword">var</span> numberTd = <span class="hljs-string">&quot;&lt;td&gt;&quot;</span> + (i + <span class="hljs-number">1</span>) + <span class="hljs-string">&quot;&lt;/td&gt;&quot;</span>;<br>        <span class="hljs-keyword">var</span> checkboxTd = <span class="hljs-string">&quot;&lt;td&gt;&lt;input type=&#x27;checkbox&#x27;/&gt;&lt;/td&gt;&quot;</span>;<br>        <span class="hljs-keyword">var</span> roleNameTd = <span class="hljs-string">&quot;&lt;td&gt;&quot;</span> + roleName + <span class="hljs-string">&quot;&lt;/td&gt;&quot;</span>;<br><br>        <span class="hljs-keyword">var</span> checkBtn = <span class="hljs-string">&quot;&lt;button type=&#x27;button&#x27; class=&#x27;btn btn-success btn-xs&#x27;&gt;&lt;i class=&#x27; glyphicon glyphicon-check&#x27;&gt;&lt;/i&gt;&lt;/button&gt;&quot;</span><br><br>        <span class="hljs-keyword">var</span> pencilBtn = <span class="hljs-string">&quot;&lt;button type=&#x27;button&#x27; class=&#x27;btn btn-primary btn-xs&#x27;&gt;&lt;i class=&#x27; glyphicon glyphicon-pencil&#x27;&gt;&lt;/i&gt;&lt;/button&gt;&quot;</span><br><br>        <span class="hljs-keyword">var</span> removeBtn = <span class="hljs-string">&quot;&lt;button type=&#x27;button&#x27; class=&#x27;btn btn-danger btn-xs&#x27;&gt;&lt;i class=&#x27; glyphicon glyphicon-remove&#x27;&gt;&lt;/i&gt;&lt;/button&gt;&quot;</span><br><br>        <span class="hljs-comment">// 拼接三个小按钮成一个td</span><br>        <span class="hljs-keyword">var</span> buttonTd = <span class="hljs-string">&quot;&lt;td&gt;&quot;</span> + checkBtn + <span class="hljs-string">&quot; &quot;</span> + pencilBtn + <span class="hljs-string">&quot; &quot;</span> + removeBtn + <span class="hljs-string">&quot;&lt;/td&gt;&quot;</span>;<br><br>        <span class="hljs-comment">// 将所有的td拼接成tr</span><br>        <span class="hljs-keyword">var</span> tr = <span class="hljs-string">&quot;&lt;tr&gt;&quot;</span> + numberTd + checkboxTd + roleNameTd + buttonTd + <span class="hljs-string">&quot;&lt;/tr&gt;&quot;</span>;<br><br>        <span class="hljs-comment">// 将拼接后的结果，放入id=rolePageTBody</span><br>        $(<span class="hljs-string">&quot;#rolePageTBody&quot;</span>).append(tr);<br>    &#125;<br><br>    <span class="hljs-comment">// 调用generateNavigator()方法传入pageInfo，进行生成分页页码导航条</span><br>    generateNavigator(pageInfo);<br><br>&#125;<br><br><span class="hljs-comment">// 生成分页页码导航条</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateNavigator</span>(<span class="hljs-params">pageInfo</span>) </span>&#123;<br><br><br>    <span class="hljs-comment">//获取分页数据中的总记录数</span><br>    <span class="hljs-keyword">var</span> totalRecord = pageInfo.total;<br><br>    <span class="hljs-comment">//声明Pagination设置属性的JSON对象</span><br>    <span class="hljs-keyword">var</span> properties = &#123;<br>        <span class="hljs-attr">num_edge_entries</span>: <span class="hljs-number">3</span>,                                <span class="hljs-comment">//边缘页数</span><br>        <span class="hljs-attr">num_display_entries</span>: <span class="hljs-number">5</span>,                             <span class="hljs-comment">//主体页数</span><br>        <span class="hljs-attr">callback</span>: paginationCallback,                       <span class="hljs-comment">//点击各种翻页反扭时触发的回调函数（执行翻页操作）</span><br>        <span class="hljs-attr">current_page</span>: (pageInfo.pageNum - <span class="hljs-number">1</span>),                 <span class="hljs-comment">//当前页码</span><br>        <span class="hljs-attr">prev_text</span>: <span class="hljs-string">&quot;上一页&quot;</span>,                                 <span class="hljs-comment">//在对应上一页操作的按钮上的文本</span><br>        <span class="hljs-attr">next_text</span>: <span class="hljs-string">&quot;下一页&quot;</span>,                                 <span class="hljs-comment">//在对应下一页操作的按钮上的文本</span><br>        <span class="hljs-attr">items_per_page</span>: pageInfo.pageSize               <span class="hljs-comment">//每页显示的数量</span><br>    &#125;;<br><br>    <span class="hljs-comment">// 调用pagination()函数，生成导航条</span><br>    $(<span class="hljs-string">&quot;#Pagination&quot;</span>).pagination(totalRecord, properties);<br><br><br>&#125;<br><br><span class="hljs-comment">// 翻页时的回调函数</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">paginationCallback</span>(<span class="hljs-params">pageIndex, jQuery</span>) </span>&#123;<br><br>    <span class="hljs-comment">// pageIndex是当前页码的索引，因此比pageNum小1</span><br>    <span class="hljs-built_in">window</span>.pageNum = pageIndex + <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">// 重新执行分页代码</span><br>    generatePage();<br><br>    <span class="hljs-comment">// 取消当前超链接的默认行为</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="乱码问题"><a href="#乱码问题" class="headerlink" title="乱码问题"></a>乱码问题</h5><ul>
<li>方法一:可以修改tomcat启动参数</li>
</ul>
<p><img src="/img/atcrowdfunding.assets/image-20220115120719617.png" alt="image-20220115120719617"></p>
<ul>
<li>方法二:将js文件修改为带有BOM的utf-8格式</li>
<li>方法三:在引入js时规定字符编码charset=”UTF-8”</li>
</ul>
<h3 id="关键字查询-1"><a href="#关键字查询-1" class="headerlink" title="关键字查询"></a>关键字查询</h3><h4 id="目标-10"><a href="#目标-10" class="headerlink" title="目标"></a>目标</h4><p>把页面上的“查询”表单和已经封装好的执行分页的函数连起来即可</p>
<h4 id="思路-10"><a href="#思路-10" class="headerlink" title="思路"></a>思路</h4><p><img src="/img/atcrowdfunding.assets/image-20220115121106127.png" alt="image-20220115121106127"></p>
<h4 id="绑定单击事件"><a href="#绑定单击事件" class="headerlink" title="绑定单击事件"></a>绑定单击事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 给查询按钮绑定单击事件</span><br>$(<span class="hljs-string">&quot;#searchBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// 查询后的页面从第一页显示</span><br>    <span class="hljs-built_in">window</span>.pageNum = <span class="hljs-number">1</span>;<br>    <span class="hljs-comment">// 获取关键字数据给对应的全局变量</span><br>    <span class="hljs-built_in">window</span>.keyword  = $(<span class="hljs-string">&quot;#inputKeyword&quot;</span>).val();<br>    <span class="hljs-comment">// 调用分页函数刷新</span><br>    generatePage();<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="新增角色"><a href="#新增角色" class="headerlink" title="新增角色"></a>新增角色</h3><h4 id="目标-11"><a href="#目标-11" class="headerlink" title="目标"></a>目标</h4><p>通过在打开的模态框中输入角色名称，执行对新角色的保存</p>
<h4 id="思路-11"><a href="#思路-11" class="headerlink" title="思路"></a>思路</h4><p><img src="/img/atcrowdfunding.assets/image-20220115140947213.png" alt="image-20220115140947213"></p>
<h4 id="前端-1"><a href="#前端-1" class="headerlink" title="前端"></a>前端</h4><h5 id="新增模态框的引入"><a href="#新增模态框的引入" class="headerlink" title="新增模态框的引入"></a>新增模态框的引入</h5><ul>
<li><p>创建model-role-add.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;<br>&lt;div id=<span class="hljs-string">&quot;addRoleModal&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal fade&quot;</span> tabindex=<span class="hljs-string">&quot;-1&quot;</span> role=<span class="hljs-string">&quot;dialog&quot;</span>&gt;<br>    &lt;div  <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-dialog&quot;</span> role=<span class="hljs-string">&quot;document&quot;</span>&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-content&quot;</span>&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-header&quot;</span>&gt;<br>                &lt;button type=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;close&quot;</span> data-dismiss=<span class="hljs-string">&quot;modal&quot;</span> aria-label=<span class="hljs-string">&quot;Close&quot;</span>&gt;&lt;span aria-hidden=<span class="hljs-string">&quot;true&quot;</span>&gt;&amp;times;&lt;/span&gt;&lt;/button&gt;<br>                &lt;h4 <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-title&quot;</span>&gt;尚筹网-角色添加&lt;/h4&gt;<br>            &lt;/div&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-body&quot;</span>&gt;<br>                &lt;form <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-signin&quot;</span> role=<span class="hljs-string">&quot;form&quot;</span>&gt;<br>                    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group has-success has-feedback&quot;</span>&gt;<br>                        &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;roleName&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> id=<span class="hljs-string">&quot;inputSuccess4&quot;</span> placeholder=<span class="hljs-string">&quot;请输入角色名称&quot;</span> autofocus&gt;<br>                        &lt;span <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-user form-control-feedback&quot;</span>&gt;&lt;/span&gt;<br>                    &lt;/div&gt;<br>                &lt;/form&gt;<br>            &lt;/div&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-footer&quot;</span>&gt;<br>                &lt;button id=<span class="hljs-string">&quot;saveRoleBtn&quot;</span> type=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span>&gt;保存&lt;/button&gt;<br>            &lt;/div&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>将静态资源在页尾引入</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%<span class="hljs-meta">@include</span> file=<span class="hljs-string">&quot;/WEB-INF/model-role-add.jsp&quot;</span> %&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>绑定新增按钮，弹出静态框</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 点击新增按钮打开模态框</span><br>$(<span class="hljs-string">&quot;#showAddModalBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    $(<span class="hljs-string">&quot;#addRoleModal&quot;</span>).modal(<span class="hljs-string">&quot;show&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="绑定保存按钮"><a href="#绑定保存按钮" class="headerlink" title="绑定保存按钮"></a>绑定保存按钮</h5><p>点击保存按钮，返送Ajax异步请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 给新增模态框的保存按钮绑定单击事件</span><br>$(<span class="hljs-string">&quot;#saveRoleBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// 获取用户在文本框中输入角色的名称</span><br>    <span class="hljs-comment">// #addModal表示找到整个模态框</span><br>    <span class="hljs-comment">// 空格表示后代元素中继续查找</span><br>    <span class="hljs-comment">// [name=roleName] 表示匹配name属性roleName的元素</span><br>    <span class="hljs-keyword">var</span> roleName = $.trim($(<span class="hljs-string">&quot;#addRoleModal [name=roleName]&quot;</span>).val());<br><br>    <span class="hljs-comment">// 发送Ajax请求</span><br>    $.ajax(&#123;<br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;role/save.json&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>        <span class="hljs-attr">data</span>: &#123;<br>            <span class="hljs-attr">name</span>: roleName<br>        &#125;,<br>        <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            <span class="hljs-keyword">var</span> result = response.result;<br>            <span class="hljs-comment">// 成功则弹框输出</span><br>            <span class="hljs-keyword">if</span> (result == <span class="hljs-string">&quot;SUCCESS&quot;</span>) &#123;<br>                layer.msg(<span class="hljs-string">&quot;操作成功！&quot;</span>);<br><br>                <span class="hljs-comment">// 进入最后一页 方便显示添加的内容</span><br>                <span class="hljs-built_in">window</span>.pageNum = <span class="hljs-number">999</span>;<br>                <span class="hljs-comment">// 重新生成分页</span><br>                generatePage();<br>            &#125;<br><br>            <span class="hljs-comment">// 失败弹出原因</span><br>            <span class="hljs-keyword">if</span> (result == <span class="hljs-string">&quot;FAILED&quot;</span>) &#123;<br>                layer.msg(<span class="hljs-string">&quot;操作失败！&quot;</span> + response.message);<br>            &#125;<br>        &#125;,<br>        <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>            layer.msg(response.status + <span class="hljs-string">&quot; &quot;</span> + response.statusText);<br>        &#125;<br>    &#125;);<br><br>    <span class="hljs-comment">// 关闭模态框</span><br>    $(<span class="hljs-string">&quot;#addRoleModal&quot;</span>).modal(<span class="hljs-string">&quot;hide&quot;</span>);<br><br>    <span class="hljs-comment">// 清理模态框</span><br>    $(<span class="hljs-string">&quot;#addRoleModal [name=roleName]&quot;</span>).val(<span class="hljs-string">&quot;&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h4 id="后端-1"><a href="#后端-1" class="headerlink" title="后端"></a>后端</h4><h5 id="handler方法"><a href="#handler方法" class="headerlink" title="handler方法"></a>handler方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/role/save.json&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">saveRole</span><span class="hljs-params">(Role role)</span></span>&#123;<br>    roleService.saveRole(role);<br>    <span class="hljs-keyword">return</span> ResultEntity.successWithData();<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="RoleService的实现"><a href="#RoleService的实现" class="headerlink" title="RoleService的实现"></a>RoleService的实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveRole</span><span class="hljs-params">(Role role)</span> </span>&#123;<br>    roleMapper.insert(role);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="更新角色"><a href="#更新角色" class="headerlink" title="更新角色"></a>更新角色</h3><h4 id="目标-12"><a href="#目标-12" class="headerlink" title="目标"></a>目标</h4><p>修改角色信息</p>
<h4 id="思路-12"><a href="#思路-12" class="headerlink" title="思路"></a>思路</h4><p><img src="/img/atcrowdfunding.assets/image-20220115143004565.png" alt="image-20220115143004565"></p>
<h4 id="前端-2"><a href="#前端-2" class="headerlink" title="前端"></a>前端</h4><h5 id="修改模态框的引入"><a href="#修改模态框的引入" class="headerlink" title="修改模态框的引入"></a>修改模态框的引入</h5><ul>
<li>modal-role-update.jsp页面</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> pageEncoding=<span class="hljs-string">&quot;UTF-8&quot;</span> %&gt;<br>&lt;div id=<span class="hljs-string">&quot;editModal&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal fade&quot;</span> tabindex=<span class="hljs-string">&quot;-1&quot;</span> role=<span class="hljs-string">&quot;dialog&quot;</span>&gt;<br>    &lt;div  <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-dialog&quot;</span> role=<span class="hljs-string">&quot;document&quot;</span>&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-content&quot;</span>&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-header&quot;</span>&gt;<br>                &lt;button type=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;close&quot;</span> data-dismiss=<span class="hljs-string">&quot;modal&quot;</span> aria-label=<span class="hljs-string">&quot;Close&quot;</span>&gt;&lt;span aria-hidden=<span class="hljs-string">&quot;true&quot;</span>&gt;&amp;times;&lt;/span&gt;&lt;/button&gt;<br>                &lt;h4 <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-title&quot;</span>&gt;尚筹网-角色更新&lt;/h4&gt;<br>            &lt;/div&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-body&quot;</span>&gt;<br>                &lt;form <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-signin&quot;</span> role=<span class="hljs-string">&quot;form&quot;</span>&gt;<br>                    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group has-success has-feedback&quot;</span>&gt;<br>                        &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;roleName&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> id=<span class="hljs-string">&quot;inputSuccess4&quot;</span> placeholder=<span class="hljs-string">&quot;请输入角色名称&quot;</span> autofocus&gt;<br>                        &lt;span <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-user form-control-feedback&quot;</span>&gt;&lt;/span&gt;<br>                    &lt;/div&gt;<br>                &lt;/form&gt;<br>            &lt;/div&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-footer&quot;</span>&gt;<br>                &lt;button id=<span class="hljs-string">&quot;updateRoleBtn&quot;</span> type=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-success&quot;</span>&gt;更新&lt;/button&gt;<br>            &lt;/div&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>引入到role-page中</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%<span class="hljs-meta">@include</span> file=<span class="hljs-string">&quot;/WEB-INF/modal-role-update.jsp&quot;</span>%&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="回显数据"><a href="#回显数据" class="headerlink" title="回显数据"></a>回显数据</h5><ul>
<li><p>在动态生成的编辑按钮处添加选择器，以及添加id值，方便修改时获取id的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> pencilBtn = <span class="hljs-string">&quot;&lt;button id=&#x27;&quot;</span>+roleId+<span class="hljs-string">&quot;&#x27; type=&#x27;button&#x27; class=&#x27;btn btn-primary btn-xs pencilBtn&#x27;&gt;&lt;i class=&#x27; glyphicon glyphicon-pencil&#x27;&gt;&lt;/i&gt;&lt;/button&gt;&quot;</span><br></code></pre></td></tr></table></figure></li>
<li><p>给动态生成的编辑按钮绑定单击事件，弹出静态框，并回显信息在输入文本框中</p>
<p>普通单击事件无法绑定翻页后的编辑按钮，使用on函数利用静态元素取绑定动态生成的按钮</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 传统的事件绑定方式只有那个在第一个页面有效，在翻页后失效，使用jQuery对象on（）函数解决</span><br><span class="hljs-comment">//首先找到“动态生成”的元素附着的“静态”元素</span><br><span class="hljs-comment">// on：第一个参数：事件类型</span><br><span class="hljs-comment">// on：第二个参数：找到真正的绑定元素的选择器</span><br><span class="hljs-comment">// on：第一个参数：事件的响应函数</span><br>$(<span class="hljs-string">&quot;#rolePageTBody&quot;</span>).on(<span class="hljs-string">&quot;click&quot;</span>,<span class="hljs-string">&quot;.pencilBtn&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// 打开模态框</span><br>    $(<span class="hljs-string">&quot;#editModal&quot;</span>).modal(<span class="hljs-string">&quot;show&quot;</span>);<br><br>    <span class="hljs-comment">// 获取表格中当前行的角色名称</span><br>    <span class="hljs-keyword">var</span> roleName=$(<span class="hljs-built_in">this</span>).parent().prev().text();<br><br>    <span class="hljs-comment">// 获取当前角色的id,为了发送Ajax请求，将它设置为全局变量</span><br>    <span class="hljs-built_in">window</span>.roleId=<span class="hljs-built_in">this</span>.id;<br><br>    <span class="hljs-comment">// 使用roleName设置模态框中的文本框</span><br>    $(<span class="hljs-string">&quot;#editModal [name=roleName]&quot;</span>).val(roleName);<br><br>    <span class="hljs-comment">// 绑定更新，发送Ajax请求</span><br>    $(<span class="hljs-string">&quot;#updateRoleBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-comment">// 获取用户填写的更新用户名</span><br>        $(<span class="hljs-string">&quot;#editModal [name=roleName]&quot;</span>).val();<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="发送Ajax修改数据"><a href="#发送Ajax修改数据" class="headerlink" title="发送Ajax修改数据"></a>发送Ajax修改数据</h5><p>最后不执行清除模态框，(需要回显信息)，不返回最后一页</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 绑定更新，发送Ajax请求</span><br>          $(<span class="hljs-string">&quot;#updateRoleBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>              <span class="hljs-comment">// 从模态框的文本框中获得修改后的roleName</span><br>              <span class="hljs-keyword">var</span> roleName = $(<span class="hljs-string">&quot;#editModal [name=roleName]&quot;</span>).val();<br>              $.ajax(&#123;<br>                  <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;role/update.json&quot;</span>,<br>                  <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>                  <span class="hljs-attr">data</span>: &#123;<br>                      <span class="hljs-attr">id</span>:<span class="hljs-built_in">window</span>.roleId,	<span class="hljs-comment">// 从全局遍历取得当前角色的id</span><br>                      <span class="hljs-attr">name</span>:roleName<br>                  &#125;,<br>                  <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>                  <span class="hljs-attr">success</span>:<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>                      <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;SUCCESS&quot;</span>)&#123;<br>                          layer.msg(<span class="hljs-string">&quot;操作成功！&quot;</span>);<br>                          generatePage();<br>                      &#125;<br>                      <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;FAILED&quot;</span>)<br>                          layer.msg(<span class="hljs-string">&quot;操作失败&quot;</span>+response.message)<br>                  &#125;,<br>                  <span class="hljs-attr">error</span>:<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>                      layer.msg(<span class="hljs-string">&quot;statusCode=&quot;</span>+response.status + <span class="hljs-string">&quot; message=&quot;</span>+response.statusText);<br>                  &#125;<br>              &#125;);<br><br>              <span class="hljs-comment">// 关闭模态框</span><br>              $(<span class="hljs-string">&quot;#editModal&quot;</span>).modal(<span class="hljs-string">&quot;hide&quot;</span>);<br>          &#125;);<br>      &#125;);<br></code></pre></td></tr></table></figure>

<h4 id="后端-2"><a href="#后端-2" class="headerlink" title="后端"></a>后端</h4><p>Hander方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/role/update.json&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">updateRole</span><span class="hljs-params">(Role role)</span></span>&#123;<br>    roleService.updateRole(role);<br>    <span class="hljs-keyword">return</span> ResultEntity.successWithData();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>RoleService实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateRole</span><span class="hljs-params">(Role role)</span> </span>&#123;<br>    roleMapper.updateByPrimaryKey(role);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="删除角色"><a href="#删除角色" class="headerlink" title="删除角色"></a>删除角色</h3><h4 id="目标-13"><a href="#目标-13" class="headerlink" title="目标"></a>目标</h4><p>前端的“单条删除”和“批量删除”在后端合并为同一套操作，合并的依据是：单条删除时id也被放在数组中，后端完全根据id的数组进行删除</p>
<h4 id="思路-13"><a href="#思路-13" class="headerlink" title="思路"></a>思路</h4><p><img src="/img/atcrowdfunding.assets/image-20220115162624525.png" alt="image-20220115162624525"></p>
<h4 id="前端-3"><a href="#前端-3" class="headerlink" title="前端"></a>前端</h4><h5 id="删除模态框的引入"><a href="#删除模态框的引入" class="headerlink" title="删除模态框的引入"></a>删除模态框的引入</h5><ul>
<li><p>modal-role-confirm.jsp模态框</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;<br>&lt;div id=<span class="hljs-string">&quot;confirmRoleModal&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal fade&quot;</span> tabindex=<span class="hljs-string">&quot;-1&quot;</span> role=<span class="hljs-string">&quot;dialog&quot;</span>&gt;<br>    &lt;div  <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-dialog&quot;</span> role=<span class="hljs-string">&quot;document&quot;</span>&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-content&quot;</span>&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-header&quot;</span>&gt;<br>                &lt;button type=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;close&quot;</span> data-dismiss=<span class="hljs-string">&quot;modal&quot;</span> aria-label=<span class="hljs-string">&quot;Close&quot;</span>&gt;&lt;span aria-hidden=<span class="hljs-string">&quot;true&quot;</span>&gt;&amp;times;&lt;/span&gt;&lt;/button&gt;<br>                &lt;h4 <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-title&quot;</span>&gt;尚筹网-确认删除&lt;/h4&gt;<br>            &lt;/div&gt;<br><br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-body&quot;</span>&gt;<br>                &lt;h4&gt;请确认是否删除下列角色！&lt;/h4&gt;<br>                &lt;%-- 确认的列表 --%&gt;<br>                &lt;div id=<span class="hljs-string">&quot;confirmList&quot;</span> style=<span class="hljs-string">&quot;text-align: center&quot;</span>&gt;&lt;/div&gt;<br>            &lt;/div&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-footer&quot;</span>&gt;<br>                &lt;button id=<span class="hljs-string">&quot;confirmRoleBtn&quot;</span> type=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-success&quot;</span>&gt;确认删除&lt;/button&gt;<br>            &lt;/div&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>引入到role-page页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;%@include file=<span class="hljs-string">&quot;/WEB-INF/modal-role-confirm.jsp&quot;</span>%&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="确认删除框的函数"><a href="#确认删除框的函数" class="headerlink" title="确认删除框的函数"></a>确认删除框的函数</h5><p>显示已选择的角色的角色名，封装函数在my-role.js中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 打开确认删除的模态框</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showConfirmModal</span>(<span class="hljs-params">roleArray</span>) </span>&#123;<br>    <span class="hljs-comment">// 显示模态框</span><br>    $(<span class="hljs-string">&quot;#confirmRoleModal&quot;</span>).modal(<span class="hljs-string">&quot;show&quot;</span>);<br><br>    <span class="hljs-comment">// 清除旧的模态框中的数据</span><br>    $(<span class="hljs-string">&quot;#confirmList&quot;</span>).empty();<br><br>    <span class="hljs-comment">// 创建一个全局变量数组，用于存放要删除的roleId</span><br>    <span class="hljs-built_in">window</span>.roleIdArray = [];<br><br>    <span class="hljs-comment">// 填充数据</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; roleArray.length; i++) &#123;<br><br>        <span class="hljs-keyword">var</span> roleId = roleArray[i].id;<br><br>        <span class="hljs-comment">// 将当前遍历到的roleId放入全局变量</span><br>        <span class="hljs-built_in">window</span>.roleIdArray.push(roleId);<br><br>        <span class="hljs-keyword">var</span> roleName = roleArray[i].name;<br><br>        <span class="hljs-comment">// 显示出要删除的数据</span><br>        $(<span class="hljs-string">&quot;#confirmList&quot;</span>).append(roleName + <span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure>

<h5 id="点击删除弹出模态框（单个删除）"><a href="#点击删除弹出模态框（单个删除）" class="headerlink" title="点击删除弹出模态框（单个删除）"></a>点击删除弹出模态框（单个删除）</h5><ul>
<li><p>在每页的删除按钮添加id（方便后面用来删除操作）和class的属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> removeBtn = <span class="hljs-string">&quot;&lt;button id=&#x27;&quot;</span>+roleId+<span class="hljs-string">&quot;&#x27; type=&#x27;button&#x27; class=&#x27;btn btn-danger btn-xs removeBtn&#x27;&gt;&lt;i class=&#x27; glyphicon glyphicon-remove&#x27;&gt;&lt;/i&gt;&lt;/button&gt;&quot;</span><br></code></pre></td></tr></table></figure></li>
<li><p>给单击X删除绑定单击事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 给单击删除把昂顶单击响应函数</span><br>$(<span class="hljs-string">&quot;#rolePageTBody&quot;</span>).on(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-string">&quot;.removeBtn&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// 通过x按钮删除时，只有一个角色，因此只需要建一个特殊的数组，存放单个对象即可</span><br>    <span class="hljs-keyword">var</span> roleArray = [&#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-built_in">this</span>.id,<br>        <span class="hljs-attr">name</span>: $(<span class="hljs-built_in">this</span>).parent().prev().text()<br>    &#125;];<br>    <span class="hljs-comment">// 调用删除静态框函数，传入roleArray</span><br>    showConfirmModal(roleArray);<br>&#125;);<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="绑定确认删除单击事件"><a href="#绑定确认删除单击事件" class="headerlink" title="绑定确认删除单击事件"></a>绑定确认删除单击事件</h5><p>需要先转换为json字符串，后台才能使用请求体获取请求数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 给确认删除按钮绑定单击事件</span><br>$(<span class="hljs-string">&quot;#confirmRoleBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// 将id信息封装到请求体</span><br>    <span class="hljs-keyword">var</span> requestBody = <span class="hljs-built_in">JSON</span>.stringify(<span class="hljs-built_in">window</span>.roleIdArray);<br>    $.ajax(&#123;<br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;role/remove.json&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>        <span class="hljs-attr">data</span>: requestBody,                         <span class="hljs-comment">// 将转换后的数据传给后端</span><br>        <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>        <span class="hljs-attr">contentType</span>: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>, <span class="hljs-comment">// 表明发送json格式数据</span><br>        <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;SUCCESS&quot;</span>) &#123;<br>                layer.msg(<span class="hljs-string">&quot;操作成功！&quot;</span>);<br>                generatePage();<br>            &#125;<br>            <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;FAILED&quot;</span>)<br>                layer.msg(<span class="hljs-string">&quot;操作失败&quot;</span> + response.message)<br>        &#125;,<br>        <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            layer.msg(<span class="hljs-string">&quot;statusCode=&quot;</span> + response.status + <span class="hljs-string">&quot; message=&quot;</span> + response.statusText);<br>        &#125;<br>    &#125;);<br><br>    <span class="hljs-comment">// 关闭模态框</span><br>    $(<span class="hljs-string">&quot;#confirmRoleModal&quot;</span>).modal(<span class="hljs-string">&quot;hide&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h5 id="多选框删除角色（多个删除）"><a href="#多选框删除角色（多个删除）" class="headerlink" title="多选框删除角色（多个删除）"></a>多选框删除角色（多个删除）</h5><ul>
<li><p>在外部js生成表单td绑定id，方便多选框勾取时获取id值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> checkboxTd = <span class="hljs-string">&quot;&lt;td&gt;&lt;input type=&#x27;checkbox&#x27; id=&#x27;&quot;</span>+roleId+<span class="hljs-string">&quot;&#x27; class=&#x27;itemBox&#x27;/&gt;&lt;/td&gt;&quot;</span>;<br></code></pre></td></tr></table></figure></li>
<li><p>给全选框设置id（id=summaryBox）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;30&quot;</span>&gt;</span>#<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;30&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;summaryBox&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>名称<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100&quot;</span>&gt;</span>操作<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>多选框全选，全不选处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 全选，全不选的反向操作</span><br>$(<span class="hljs-string">&quot;#rolePageTBody&quot;</span>).on(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-string">&quot;.itemBox&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// 获取当前已选中的多选框的数量</span><br>    <span class="hljs-keyword">var</span> checkedBoxCount = $(<span class="hljs-string">&quot;.itemBox:checked&quot;</span>).length;<br>    <span class="hljs-comment">// 获取全部checkBox的数量</span><br>    <span class="hljs-keyword">var</span> checkBoxAll = $(<span class="hljs-string">&quot;.itemBox&quot;</span>).length;<br>    <span class="hljs-comment">// 两者比较设置总的多选框状态</span><br>    $(<span class="hljs-string">&quot;#summaryBox&quot;</span>).prop(<span class="hljs-string">&quot;checked&quot;</span>, checkedBoxCount == checkBoxAll);<br>&#125;);<br><br><span class="hljs-comment">// 给多选删除按钮绑定单击事件</span><br>$(<span class="hljs-string">&quot;#batchRemoveBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)</span>&#123;<br><br>    <span class="hljs-comment">// 创建一个数组对象，用来存放后面获得的角色对象</span><br>    <span class="hljs-keyword">var</span> roleArray = [];<br><br>    <span class="hljs-comment">// 遍历被勾选的内容</span><br>    $(<span class="hljs-string">&quot;.itemBox:checked&quot;</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-comment">// 通过this引用当前遍历得到的多选框的id</span><br>        <span class="hljs-keyword">var</span> roleId = <span class="hljs-built_in">this</span>.id;<br><br>        <span class="hljs-comment">// 通过DOM操作获取角色名称</span><br>        <span class="hljs-keyword">var</span> roleName = $(<span class="hljs-built_in">this</span>).parent().next().text();<br><br>        roleArray.push(&#123;<br>            <span class="hljs-string">&quot;id&quot;</span>:roleId,<br>            <span class="hljs-string">&quot;name&quot;</span>:roleName<br>        &#125;);<br>    &#125;);<br></code></pre></td></tr></table></figure></li>
<li><p>点击删除多选框内容</p>
<p>调用显示静态框函数，传入roleArray</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 给多选删除按钮绑定单击事件</span><br>       $(<span class="hljs-string">&quot;#batchRemoveBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>  <br>           <span class="hljs-comment">// 创建一个数组对象，用来存放后面获得的角色对象</span><br>           <span class="hljs-keyword">var</span> roleArray = [];<br>  <br>           <span class="hljs-comment">// 遍历被勾选的内容</span><br>           $(<span class="hljs-string">&quot;.itemBox:checked&quot;</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>               <span class="hljs-comment">// 通过this引用当前遍历得到的多选框的id</span><br>               <span class="hljs-keyword">var</span> roleId = <span class="hljs-built_in">this</span>.id;<br>  <br>               <span class="hljs-comment">// 通过DOM操作获取角色名称</span><br>               <span class="hljs-keyword">var</span> roleName = $(<span class="hljs-built_in">this</span>).parent().next().text();<br>  <br>               roleArray.push(&#123;<br>                   <span class="hljs-attr">id</span>: roleId,<br>                   <span class="hljs-attr">name</span>: roleName<br>               &#125;);<br>           &#125;);<br>  <br>           <span class="hljs-comment">// 判断roleArray的长度是否为0</span><br>           <span class="hljs-keyword">if</span> (roleArray.length == <span class="hljs-number">0</span>) &#123;<br>               layer.msg(<span class="hljs-string">&quot;请至少选择一个来删除&quot;</span>);<br>               <span class="hljs-keyword">return</span>;<br>           &#125;<br>  <br>           <span class="hljs-comment">// 显示确认框</span><br>           showConfirmModal(roleArray);<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="后台"><a href="#后台" class="headerlink" title="后台"></a>后台</h4><h5 id="Handler方法-2"><a href="#Handler方法-2" class="headerlink" title="Handler方法"></a>Handler方法</h5><p>传入的是json数据，使用请求体来获取json字符串</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/role/update.json&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">updateRole</span><span class="hljs-params">(Role role)</span> </span>&#123;<br>    roleService.updateRole(role);<br>    <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="RoleService的实现-1"><a href="#RoleService的实现-1" class="headerlink" title="RoleService的实现"></a>RoleService的实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteRole</span><span class="hljs-params">(List&lt;Integer&gt; roleIdList)</span> </span>&#123;<br>    RoleExample roleExample = <span class="hljs-keyword">new</span> RoleExample();<br>    RoleExample.Criteria criteria = roleExample.createCriteria();<br>    criteria.andIdIn(roleIdList);<br>    roleMapper.deleteByExample(roleExample);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="菜单维护"><a href="#菜单维护" class="headerlink" title="菜单维护"></a>菜单维护</h1><h2 id="树形结构基础知识"><a href="#树形结构基础知识" class="headerlink" title="树形结构基础知识"></a>树形结构基础知识</h2><p><img src="/img/atcrowdfunding.assets/image-20220115201632429.png" alt="image-20220115201632429"></p>
<p>整个树形结构最多只能有三级</p>
<h3 id="在数据库中表示树形结构"><a href="#在数据库中表示树形结构" class="headerlink" title="在数据库中表示树形结构"></a>在数据库中表示树形结构</h3><h4 id="创建菜单数据库表"><a href="#创建菜单数据库表" class="headerlink" title="创建菜单数据库表"></a>创建菜单数据库表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">#创建菜单的数据库表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_menu<br>(<br>	id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment, <br>	pid <span class="hljs-type">int</span>(<span class="hljs-number">11</span>), <br>	name <span class="hljs-type">varchar</span>(<span class="hljs-number">200</span>), <br>	url <span class="hljs-type">varchar</span>(<span class="hljs-number">200</span>),<br>	icon <span class="hljs-type">varchar</span>(<span class="hljs-number">200</span>), <br>	<span class="hljs-keyword">primary</span> key (id)<br>);<br></code></pre></td></tr></table></figure>

<h4 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>#插入数据<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27; 系统权限菜单&#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-th-list&#x27;</span>,<span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27; 控 制 面 板 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-dashboard&#x27;</span>,<span class="hljs-string">&#x27;main.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;权限管理&#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon glyphicon-tasks&#x27;</span>,<span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27; 用 户 维 护 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-user&#x27;</span>,<span class="hljs-string">&#x27;user/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27; 角 色 维 护 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-king&#x27;</span>,<span class="hljs-string">&#x27;role/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27; 菜 单 维 护 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-lock&#x27;</span>,<span class="hljs-string">&#x27;permission/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27; 业 务 审 核 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-ok&#x27;</span>,<span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;8&#x27;</span>,<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27; 实名认证审核&#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-check&#x27;</span>,<span class="hljs-string">&#x27;auth_cert/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;9&#x27;</span>,<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27; 广 告 审 核 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-check&#x27;</span>,<span class="hljs-string">&#x27;auth_adv/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;10&#x27;</span>,<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27; 项 目 审 核 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-check&#x27;</span>,<span class="hljs-string">&#x27;auth_project/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;11&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27; 业 务 管 理 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-th-large&#x27;</span>,<span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;12&#x27;</span>,<span class="hljs-string">&#x27;11&#x27;</span>,<span class="hljs-string">&#x27; 资 质 维 护 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-picture&#x27;</span>,<span class="hljs-string">&#x27;cert/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;13&#x27;</span>,<span class="hljs-string">&#x27;11&#x27;</span>,<span class="hljs-string">&#x27; 分 类 管 理 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-equalizer&#x27;</span>,<span class="hljs-string">&#x27;certtype/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;14&#x27;</span>,<span class="hljs-string">&#x27;11&#x27;</span>,<span class="hljs-string">&#x27; 流 程 管 理 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-random&#x27;</span>,<span class="hljs-string">&#x27;process/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;15&#x27;</span>,<span class="hljs-string">&#x27;11&#x27;</span>,<span class="hljs-string">&#x27; 广 告 管 理 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-hdd&#x27;</span>,<span class="hljs-string">&#x27;advert/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;16&#x27;</span>,<span class="hljs-string">&#x27;11&#x27;</span>,<span class="hljs-string">&#x27; 消 息 模 板 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-comment&#x27;</span>,<span class="hljs-string">&#x27;message/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;17&#x27;</span>,<span class="hljs-string">&#x27;11&#x27;</span>,<span class="hljs-string">&#x27; 项 目 分 类 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-list&#x27;</span>,<span class="hljs-string">&#x27;projectType/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;18&#x27;</span>,<span class="hljs-string">&#x27;11&#x27;</span>,<span class="hljs-string">&#x27; 项 目 标 签 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-tags&#x27;</span>,<span class="hljs-string">&#x27;tag/index.htm&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `t_menu` (`id`, `pid`, `name`, `icon`, `url`) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;19&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27; 参 数 管 理 &#x27;</span>,<span class="hljs-string">&#x27;glyphicon glyphicon-list-alt&#x27;</span>,<span class="hljs-string">&#x27;param/index.htm&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h4 id="关联方式"><a href="#关联方式" class="headerlink" title="关联方式"></a>关联方式</h4><p>子节点通过pid字段关联到父节点的id字段，建立父子关系。</p>
<p><img src="/img/atcrowdfunding.assets/image-20220115202554241.png" alt="image-20220115202554241"></p>
<p>根节点的pid为空</p>
<h4 id="在Java类中表示树形结构"><a href="#在Java类中表示树形结构" class="headerlink" title="在Java类中表示树形结构"></a>在Java类中表示树形结构</h4><h5 id="基本方式"><a href="#基本方式" class="headerlink" title="基本方式"></a>基本方式</h5><p>在 Menu 类中使用 List<Menu> <strong>children</strong> 属性存储当前节点的子节点。 </p>
<h5 id="为了配合zTree-所需要添加的属性"><a href="#为了配合zTree-所需要添加的属性" class="headerlink" title="为了配合zTree 所需要添加的属性"></a>为了配合zTree 所需要添加的属性</h5><ul>
<li><p>pid 属性：找到父节点 </p>
</li>
<li><p>name 属性：作为节点名称 </p>
</li>
<li><p>icon 属性：当前节点使用的图标 </p>
</li>
<li><p><strong>open</strong> 属性：控制节点是否默认打开 </p>
</li>
<li><p>url 属性：点击节点时跳转的位置 </p>
</li>
</ul>
<h2 id="页面显示树形结构"><a href="#页面显示树形结构" class="headerlink" title="页面显示树形结构"></a>页面显示树形结构</h2><h3 id="目标-14"><a href="#目标-14" class="headerlink" title="目标"></a>目标</h3><p>将数据库中查询得到的数据到页面上显示出来</p>
<h3 id="思路-14"><a href="#思路-14" class="headerlink" title="思路"></a>思路</h3><p>数据库查询全部→Java 对象组装→页面上使用 zTree 显示 </p>
<h3 id="逆向工程-1"><a href="#逆向工程-1" class="headerlink" title="逆向工程"></a>逆向工程</h3><ul>
<li><p>修改配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 数据库表名与需要的实体类对应映射的指定 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_menu&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;Menu&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>修改Menu实体类</p>
<p>此处省略get，set，有参，无参构造器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> crowd.entity;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Menu</span> </span>&#123;<br>    <span class="hljs-comment">// 主键</span><br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-comment">// 父节点id</span><br>    <span class="hljs-keyword">private</span> Integer pid;<br>    <span class="hljs-comment">// 结点名称</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-comment">// 结点附带的url地址，是将来点击菜单项时要跳转的路径</span><br>    <span class="hljs-keyword">private</span> String url;<br>    <span class="hljs-comment">// 结点图标样式</span><br>    <span class="hljs-keyword">private</span> String icon;<br>    <span class="hljs-comment">// 存储节点的集合，初始化是为了避免空指针异常</span><br>    <span class="hljs-keyword">private</span> List&lt;Menu&gt; children = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>    <span class="hljs-comment">// 控制节点是否默认打开，true为打开</span><br>    <span class="hljs-keyword">private</span> Boolean open = <span class="hljs-keyword">true</span>;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="后端-3"><a href="#后端-3" class="headerlink" title="后端"></a>后端</h3><h4 id="MenuHandler方法"><a href="#MenuHandler方法" class="headerlink" title="MenuHandler方法"></a>MenuHandler方法</h4><p>查询节点信息，将节点的id和信息封装为map返回，最终返回根节点信息，则得到整棵树</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/menu/get/whole/tree.json&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;Menu&gt; <span class="hljs-title">getWholeTreeNew</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// 1.查询全部的Menu对象</span><br>    List&lt;Menu&gt; menuList = menuService.getAll();<br>    <span class="hljs-comment">// 2.申明一个变量来存储找到的一个根节点</span><br>    Menu root = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-comment">// 3.创建 Map 对象用来存储 id 和 Menu 对象的对应关系便于查找父节点</span><br>    Map&lt;Integer, Menu&gt; menuMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>    <span class="hljs-comment">// 4.遍历 menuList 填充 menuMap</span><br>    <span class="hljs-keyword">for</span> (Menu menu : menuList) &#123;<br>        Integer id = menu.getId();<br>        menuMap.put(id, menu);<br>    &#125;<br>    <span class="hljs-comment">// 5.再次遍历 menuList 查找根节点、组装父子节点</span><br>    <span class="hljs-keyword">for</span> (Menu menu : menuList) &#123;<br>        <span class="hljs-comment">// 6.获取节点的父节点值</span><br>        Integer pid = menu.getPid();<br>        <span class="hljs-comment">// 7.判断父节点为空则为根节点</span><br>        <span class="hljs-keyword">if</span> (pid == <span class="hljs-keyword">null</span>) &#123;<br>            root = menu;<br>            <span class="hljs-comment">// 8.如果当前节点没有父节点，那肯定是根节点，不循环执行</span><br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>        <span class="hljs-comment">// 9.如果 pid 不为 null，说明当前节点有父节点，那么可以根据 pid 到 menuMap 中 查找对应的 Menu 对象</span><br>        Menu father = menuMap.get(pid);<br>        <span class="hljs-comment">// 10.将当前节点存入父节点的 children 集合</span><br>        father.getChildren().add(menu);<br>    &#125;<br>    <span class="hljs-comment">// 11.经过上面的运算，根节点包含了整个树形结构，返回根节点就是返回整个树</span><br>    <span class="hljs-keyword">return</span> ResultEntity.successWithData(root);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="Service实现"><a href="#Service实现" class="headerlink" title="Service实现"></a>Service实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getAll</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> menuMapper.selectByExample(<span class="hljs-keyword">new</span> MenuExample());<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="绑定单击事件-1"><a href="#绑定单击事件-1" class="headerlink" title="绑定单击事件"></a>绑定单击事件</h4><ul>
<li><p>绑定菜单维护单击事件</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;a href=<span class="hljs-string">&quot;menu/to/page.html&quot;</span>&gt;&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-lock&quot;</span>&gt;&lt;/i&gt; 菜单维护&lt;/a&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>配置视图</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:view-controller</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/menu/to/page.html&quot;</span> <span class="hljs-attr">view-name</span>=<span class="hljs-string">&quot;menu-page&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:view-controller</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="前端-4"><a href="#前端-4" class="headerlink" title="前端"></a>前端</h3><h4 id="引入ZTree和自定义的外部js文件"><a href="#引入ZTree和自定义的外部js文件" class="headerlink" title="引入ZTree和自定义的外部js文件"></a>引入ZTree和自定义的外部js文件</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;ztree/zTreeStyle.css&quot;</span>/&gt;<br>&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span> src=<span class="hljs-string">&quot;ztree/jquery.ztree.all-3.5.min.js&quot;</span>&gt;&lt;/script&gt;<br>&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span> src=<span class="hljs-string">&quot;crowd/my-menu.js&quot;</span>&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h4 id="menu主页面"><a href="#menu主页面" class="headerlink" title="menu主页面"></a>menu主页面</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main&quot;</span>&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel panel-default&quot;</span>&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel-heading&quot;</span>&gt;&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-th-list&quot;</span>&gt;&lt;/i&gt; 权限菜单列表<br>            &lt;div style=<span class="hljs-string">&quot;float:right;cursor:pointer;&quot;</span> data-toggle=<span class="hljs-string">&quot;modal&quot;</span> data-target=<span class="hljs-string">&quot;#myModal&quot;</span>&gt;<br>                &lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-question-sign&quot;</span>&gt;<br>                &lt;/i&gt;<br>            &lt;/div&gt;<br>        &lt;/div&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel-body&quot;</span>&gt;<br>            &lt;ul id=<span class="hljs-string">&quot;treeDemo&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;ztree&quot;</span>&gt;<br>                &lt;%-- 显示树形结构依附于上面的ul --%&gt;<br>            &lt;/ul&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>

<h4 id="显示图标和按钮"><a href="#显示图标和按钮" class="headerlink" title="显示图标和按钮"></a>显示图标和按钮</h4><p>将显示图标和按钮封装为函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 显示图标</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myAddDiyDom</span>(<span class="hljs-params">treeId, treeNode</span>) </span>&#123;<br>    <span class="hljs-comment">// treeId就是树形结构依附的ul的id</span><br>    <span class="hljs-comment">// treeNode就是当前节点全部数据（包括后端查询得到的）</span><br><br>    <span class="hljs-comment">// 根据zTree中每一个图标span的id的规则：</span><br>    <span class="hljs-comment">// 如treeDemo_7_ico</span><br>    <span class="hljs-comment">// id结构就是ul的id_当前节点序号_ico（tId就是id_当前节点序号）</span><br>    <span class="hljs-comment">// 可以拼出每一个span的id：</span><br>    <span class="hljs-keyword">var</span> spanId = treeNode.tId + <span class="hljs-string">&quot;_ico&quot;</span>;<br>    <span class="hljs-comment">// 删除旧的class，增加新得到的class</span><br>    $(<span class="hljs-string">&quot;#&quot;</span>+spanId).removeClass().addClass(treeNode.icon);<br>&#125;<br><br><span class="hljs-comment">// 鼠标覆盖时，显示按钮组</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myAddHoverDom</span>(<span class="hljs-params">treeId, treeNode</span>) </span>&#123;<br>    <span class="hljs-comment">// 定义增加、修改、删除节点的标签字符串</span><br>    <span class="hljs-keyword">var</span> addBtn = <span class="hljs-string">&quot;&lt;a id=&#x27;&quot;</span>+treeNode.id+<span class="hljs-string">&quot;&#x27; class=&#x27;addBtn btn btn-info dropdown-toggle btn-xs&#x27; style=&#x27;margin-left:10px;padding-top:0px;&#x27; href=&#x27;#&#x27; title=&#x27;增加节点&#x27;&gt;&amp;nbsp;&amp;nbsp;&lt;i class=&#x27;fa fa-fw fa-plus rbg &#x27;&gt;&lt;/i&gt;&lt;/a&gt;&quot;</span>;<br>    <span class="hljs-keyword">var</span> editBtn = <span class="hljs-string">&quot;&lt;a id=&#x27;&quot;</span>+treeNode.id+<span class="hljs-string">&quot;&#x27; class=&#x27;editBtn btn btn-info dropdown-toggle btn-xs&#x27; style=&#x27;margin-left:10px;padding-top:0px;&#x27; href=&#x27;#&#x27; title=&#x27;修改节点&#x27;&gt;&amp;nbsp;&amp;nbsp;&lt;i class=&#x27;fa fa-fw fa-edit rbg &#x27;&gt;&lt;/i&gt;&lt;/a&gt;&quot;</span>;<br>    <span class="hljs-keyword">var</span> removeBtn = <span class="hljs-string">&quot;&lt;a id=&#x27;&quot;</span>+treeNode.id+<span class="hljs-string">&quot;&#x27; class=&#x27;removeBtn btn btn-info dropdown-toggle btn-xs&#x27; style=&#x27;margin-left:10px;padding-top:0px;&#x27; href=&#x27;#&#x27; title=&#x27;删除节点&#x27;&gt;&amp;nbsp;&amp;nbsp;&lt;i class=&#x27;fa fa-fw fa-times rbg &#x27;&gt;&lt;/i&gt;&lt;/a&gt;&quot;</span>;<br><br>    <span class="hljs-comment">// btn用于存放不同的节点显示的不同的按钮</span><br>    <span class="hljs-keyword">var</span> btn = <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-comment">// 得到每个节点的level，根据level决定显示的按钮组的内容</span><br>    <span class="hljs-keyword">var</span> level = treeNode.level;<br><br>    <span class="hljs-comment">// 按照一定规则设置按钮组span的id</span><br>    <span class="hljs-keyword">var</span> btnGroupId = <span class="hljs-string">&quot;btnGroupTreeDemo_&quot;</span>+treeNode.id;<br><br>    <span class="hljs-comment">// 如果此时按钮组已经有内容了，则不再往下执行</span><br>    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">&quot;#&quot;</span>+btnGroupId).length &gt; <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-keyword">return</span> ;<br>    &#125;<br><br>    <span class="hljs-comment">// 根据level决定按钮组内部显示的内容</span><br>    <span class="hljs-keyword">if</span> (level === <span class="hljs-number">0</span>)&#123;<br>        btn = addBtn;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (level === <span class="hljs-number">1</span>)&#123;<br>        btn = addBtn + editBtn;<br>        <span class="hljs-comment">// 判断是否子节点，有子节点则不显示删除按钮，没有子节点则显示删除按钮</span><br>        <span class="hljs-keyword">if</span> (treeNode.children.length === <span class="hljs-number">0</span>)&#123;<br>            btn = btn + removeBtn;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// level==3则显示删除按钮与修改按钮</span><br>        btn = editBtn+removeBtn;<br>    &#125;<br><br>    <span class="hljs-comment">// 拼接a标签的id（treeDemo_x_a）</span><br>    <span class="hljs-keyword">var</span> aId = treeNode.tId + <span class="hljs-string">&quot;_a&quot;</span>;<br><br>    <span class="hljs-comment">// 根据id，在a标签后加按钮组</span><br>    $(<span class="hljs-string">&quot;#&quot;</span>+aId).after(<span class="hljs-string">&quot;&lt;span id=&#x27;&quot;</span>+btnGroupId+<span class="hljs-string">&quot;&#x27;&gt;&quot;</span>+btn+<span class="hljs-string">&quot;&lt;/span&gt;&quot;</span>);<br><br>&#125;<br><br><span class="hljs-comment">// 鼠标移开时，隐藏按钮组</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myRemoveHoverDom</span>(<span class="hljs-params">treeId, treeNode</span>) </span>&#123;<br>    <span class="hljs-comment">// 按钮组span的id</span><br>    <span class="hljs-keyword">var</span> btnGroupId = <span class="hljs-string">&quot;btnGroupTreeDemo_&quot;</span>+treeNode.id;<br>    <span class="hljs-comment">// 删除此id的标签</span><br>    $(<span class="hljs-string">&quot;#&quot;</span>+btnGroupId).remove();<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="生成树形结构"><a href="#生成树形结构" class="headerlink" title="生成树形结构"></a>生成树形结构</h4><ul>
<li><p>将树形结构生成封装为外部js的函数，方便调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 封装生成树形结构的代码</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateTree</span>(<span class="hljs-params"></span>)</span>&#123;<br>    $.ajax(&#123;<br>        <span class="hljs-attr">url</span>:<span class="hljs-string">&quot;menu/get/whole/tree.json&quot;</span>,<br>        <span class="hljs-attr">type</span>:<span class="hljs-string">&quot;post&quot;</span>,<br>        <span class="hljs-attr">dataType</span>:<span class="hljs-string">&quot;json&quot;</span>,<br>        <span class="hljs-attr">success</span>:<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;SUCCESS&quot;</span>)&#123;<br>                <span class="hljs-comment">// 成功 则设置下列属性\</span><br>                <span class="hljs-keyword">var</span> setting = &#123;<br>                    <span class="hljs-attr">view</span>:&#123;<br>                        <span class="hljs-comment">// 设置每一个标签的图标</span><br>                        <span class="hljs-string">&quot;addDiyDom&quot;</span>:myAddDiyDom,<br>                        <span class="hljs-comment">// 设置悬浮在标签上时的函数</span><br>                        <span class="hljs-string">&quot;addHoverDom&quot;</span>:myAddHoverDom,<br>                        <span class="hljs-comment">// 设置从标签上移除时的函数</span><br>                        <span class="hljs-string">&quot;removeHoverDom&quot;</span>:myRemoveHoverDom<br>                    &#125;,<br>                    <span class="hljs-attr">data</span>:&#123;<br>                        <span class="hljs-attr">key</span>:&#123;<br>                            <span class="hljs-comment">// 实现“点了不跑”，也就是设置了这里的url后，会根据该url去寻找页面，如果页面找不到，则不跳转</span><br>                            <span class="hljs-comment">/*</span><br><span class="hljs-comment">                                  zTree 节点数据保存节点链接的目标 URL 的属性名称。</span><br><span class="hljs-comment">                               特殊用途：当后台数据只能生成 url 属性，又不想实现点击节点跳转的功能时，可以直接修改此属性为其他不存在的属性名称</span><br><span class="hljs-comment">                                默认值：&quot;url&quot;</span><br><span class="hljs-comment">                            */</span><br>                            <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;None&quot;</span><br>                        &#125;<br>                    &#125;<br>                &#125;;<br>                <span class="hljs-comment">// 通过response得到data，就是后端传来的查询结构</span><br>                <span class="hljs-keyword">var</span> zNodes = response.data;<br>                <span class="hljs-comment">// 执行zTree的初始化函数，传参分别是依附的ul的id（通过jQuery选择器）、setting变量、查询到的树形结构</span><br>                $.fn.zTree.init($(<span class="hljs-string">&quot;#treeDemo&quot;</span>), setting, zNodes);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;FAILED&quot;</span>)<br>                layer.msg(<span class="hljs-string">&quot;操作失败&quot;</span>+response.message)<br>        &#125;,<br>        <span class="hljs-attr">error</span>:<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            layer.msg(<span class="hljs-string">&quot;statusCode=&quot;</span>+response.status + <span class="hljs-string">&quot; message=&quot;</span>+response.statusText);<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>menu页面调用生成函数</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>    $(function () &#123;<br>       generateTree();<br>    &#125;);<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="添加节点"><a href="#添加节点" class="headerlink" title="添加节点"></a>添加节点</h2><h3 id="目标-15"><a href="#目标-15" class="headerlink" title="目标"></a>目标</h3><p>给当前节点添加子节点，保存到数据库，并刷新页面的显示</p>
<h3 id="思路-15"><a href="#思路-15" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220117112316033.png" alt="image-20220117112316033"></p>
<h3 id="前端-5"><a href="#前端-5" class="headerlink" title="前端"></a>前端</h3><h4 id="引入模态框"><a href="#引入模态框" class="headerlink" title="引入模态框"></a>引入模态框</h4><p>记得刷新工程</p>
<p><img src="/img/atcrowdfunding.assets/image-20220117121954877.png" alt="image-20220117121954877"></p>
<h4 id="绑定class"><a href="#绑定class" class="headerlink" title="绑定class"></a>绑定class</h4><p>方便通过选择器找到节点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> addBtn = <span class="hljs-string">&quot;&lt;a id=&#x27;&quot;</span>+treeNode.id+<span class="hljs-string">&quot;&#x27; class=&#x27;addBtn btn btn-info dropdown-toggle btn-xs&#x27; style=&#x27;margin-left:10px;padding-top:0px;&#x27; href=&#x27;#&#x27; title=&#x27;增加节点&#x27;&gt;&amp;nbsp;&amp;nbsp;&lt;i class=&#x27;fa fa-fw fa-plus rbg &#x27;&gt;&lt;/i&gt;&lt;/a&gt;&quot;</span>;<br><span class="hljs-keyword">var</span> editBtn = <span class="hljs-string">&quot;&lt;a id=&#x27;&quot;</span>+treeNode.id+<span class="hljs-string">&quot;&#x27; class=&#x27;editBtn btn btn-info dropdown-toggle btn-xs&#x27; style=&#x27;margin-left:10px;padding-top:0px;&#x27; href=&#x27;#&#x27; title=&#x27;修改节点&#x27;&gt;&amp;nbsp;&amp;nbsp;&lt;i class=&#x27;fa fa-fw fa-edit rbg &#x27;&gt;&lt;/i&gt;&lt;/a&gt;&quot;</span>;<br><span class="hljs-keyword">var</span> removeBtn = <span class="hljs-string">&quot;&lt;a id=&#x27;&quot;</span>+treeNode.id+<span class="hljs-string">&quot;&#x27; class=&#x27;removeBtn btn btn-info dropdown-toggle btn-xs&#x27; style=&#x27;margin-left:10px;padding-top:0px;&#x27; href=&#x27;#&#x27; title=&#x27;删除节点&#x27;&gt;&amp;nbsp;&amp;nbsp;&lt;i class=&#x27;fa fa-fw fa-times rbg &#x27;&gt;&lt;/i&gt;&lt;/a&gt;&quot;</span>;<br></code></pre></td></tr></table></figure>

<h4 id="点击添加按钮"><a href="#点击添加按钮" class="headerlink" title="点击添加按钮"></a>点击添加按钮</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 给“+”按钮，添加单击响应函数，打开添加节点的模态框</span><br>$(<span class="hljs-string">&quot;#treeDemo&quot;</span>).on(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-string">&quot;.addBtn&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// 将当前按钮的id保存为全局变量pid，方便后面调用</span><br>    <span class="hljs-built_in">window</span>.pid = <span class="hljs-built_in">this</span>.id;<br>    <span class="hljs-comment">// 打开模态框</span><br>    $(<span class="hljs-string">&quot;#menuAddModal&quot;</span>).modal(<span class="hljs-string">&quot;show&quot;</span>);<br>    <span class="hljs-comment">// 关闭默认跳转行为</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;);<br></code></pre></td></tr></table></figure>

<h4 id="点击保存按钮"><a href="#点击保存按钮" class="headerlink" title="点击保存按钮"></a>点击保存按钮</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 添加节点模态框中保存按钮的单击事件</span><br>$(<span class="hljs-string">&quot;#menuSaveBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// 从输入框中获得name，并去掉前后空格</span><br>    <span class="hljs-keyword">var</span> name = $.trim($(<span class="hljs-string">&quot;#menuAddModal [name=name]&quot;</span>).val());<br>    <span class="hljs-comment">// 从输入框中获得url，并去掉前后空格</span><br>    <span class="hljs-keyword">var</span> url = $.trim($(<span class="hljs-string">&quot;#menuAddModal [name=url]&quot;</span>).val());<br>    <span class="hljs-comment">// 下面的选项中获得被选中的icon的值</span><br>    <span class="hljs-keyword">var</span> icon = $(<span class="hljs-string">&quot;#menuAddModal [name=icon]:checked&quot;</span>).val();<br><br>    $.ajax(&#123;<br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;menu/save.json&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>        <span class="hljs-string">&quot;data&quot;</span>: &#123;<br>            <span class="hljs-attr">name</span>: name,<br>            <span class="hljs-attr">url</span>: url,<br>            <span class="hljs-attr">icon</span>: icon,<br>            <span class="hljs-comment">// 从全局变量获得该节点的父节点id</span><br>            <span class="hljs-attr">pid</span>: <span class="hljs-built_in">window</span>.pid<br>        &#125;,<br>        <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>        <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;SUCCESS&quot;</span>) &#123;<br>                layer.msg(<span class="hljs-string">&quot;操作成功！&quot;</span>);<br><br>                <span class="hljs-comment">// 重新生成树形结构</span><br>                generateTree();<br>            &#125;<br>            <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;FAILED&quot;</span>) &#123;<br>                layer.msg(<span class="hljs-string">&quot;操作失败！&quot;</span>);<br>            &#125;<br>        &#125;,<br>        <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            layer.msg(response.status + <span class="hljs-string">&quot; &quot;</span> + response.statusText);<br>        &#125;<br>    &#125;);<br><br>    <span class="hljs-comment">// 关闭模态框</span><br>    $(<span class="hljs-string">&quot;#menuAddModal&quot;</span>).modal(<span class="hljs-string">&quot;hide&quot;</span>);<br><br>    <span class="hljs-comment">// 清空模态框内的数据(通过模拟用户单击“重置”按钮)</span><br>    $(<span class="hljs-string">&quot;#menuResetBtn&quot;</span>).click();<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="后端-4"><a href="#后端-4" class="headerlink" title="后端"></a>后端</h3><h4 id="Handler方法-3"><a href="#Handler方法-3" class="headerlink" title="Handler方法"></a>Handler方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/menu/save.json&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">saveMenu</span><span class="hljs-params">(Menu menu)</span> </span>&#123;<br>    menuService.saveMenu(menu);<br>    <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="Service实现-1"><a href="#Service实现-1" class="headerlink" title="Service实现"></a>Service实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveMenu</span><span class="hljs-params">(Menu menu)</span> </span>&#123;<br>    menuMapper.insert(menu);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="更新节点"><a href="#更新节点" class="headerlink" title="更新节点"></a>更新节点</h2><h3 id="目标-16"><a href="#目标-16" class="headerlink" title="目标"></a>目标</h3><p>修改当前节点的基本属性，不更换父节点 </p>
<h3 id="思路-16"><a href="#思路-16" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220117121844546.png" alt="image-20220117121844546"></p>
<h3 id="前端-6"><a href="#前端-6" class="headerlink" title="前端"></a>前端</h3><h4 id="修改模态框的引入-1"><a href="#修改模态框的引入-1" class="headerlink" title="修改模态框的引入"></a>修改模态框的引入</h4><p>使用ztree提供的根据id查找结点方式getNodeByParam</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 动态生成的修改按钮，单击打开修改的模态框</span><br>$(<span class="hljs-string">&quot;#treeDemo&quot;</span>).on(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-string">&quot;.editBtn&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br><br>    <span class="hljs-comment">// 保存此按钮的id</span><br>    <span class="hljs-built_in">window</span>.id = <span class="hljs-built_in">this</span>.id;<br><br>    $(<span class="hljs-string">&quot;#menuEditModal&quot;</span>).modal(<span class="hljs-string">&quot;show&quot;</span>);<br><br>    <span class="hljs-comment">// 要实现通过id拿到整个节点的信息，需要拿到zTreeObj</span><br>    <span class="hljs-keyword">var</span> zTreeObj = $.fn.zTree.getZTreeObj(<span class="hljs-string">&quot;treeDemo&quot;</span>);<br><br>    <span class="hljs-keyword">var</span> key = <span class="hljs-string">&quot;id&quot;</span>;<br>    <span class="hljs-keyword">var</span> value = <span class="hljs-built_in">window</span>.id;<br><br>    <span class="hljs-comment">// getNodeByParam，通过id得到当前的整个节点</span><br>    <span class="hljs-comment">// 注意：id为treeNode的id，返回的就是那个treeNode</span><br>    <span class="hljs-keyword">var</span> currentNode = zTreeObj.getNodeByParam(key, value);<br><br>    $(<span class="hljs-string">&quot;#menuEditModal [name=name]&quot;</span>).val(currentNode.name);<br><br>    $(<span class="hljs-string">&quot;#menuEditModal [name=url]&quot;</span>).val(currentNode.url);<br><br>    <span class="hljs-comment">// 这里currentNode.icon其实是数组形式，利用这个值，放在[]中，传回val，就可以使相匹配的值回显在模态框中</span><br>    $(<span class="hljs-string">&quot;#menuEditModal [name=icon]&quot;</span>).val([currentNode.icon]);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;);<br></code></pre></td></tr></table></figure>

<h4 id="绑定更新按钮的单击事件"><a href="#绑定更新按钮的单击事件" class="headerlink" title="绑定更新按钮的单击事件"></a>绑定更新按钮的单击事件</h4><p>ajax传入修改的节点的id，而不是pid，获取icon时应该选取checked中的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 更新节点模态框中保存按钮的单击事件</span><br>$(<span class="hljs-string">&quot;#menuEditBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br><br>    <span class="hljs-keyword">var</span> name = $(<span class="hljs-string">&quot;#menuEditModal [name=name]&quot;</span>).val();<br><br>    <span class="hljs-keyword">var</span> url = $(<span class="hljs-string">&quot;#menuEditModal [name=url]&quot;</span>).val();<br><br>    <span class="hljs-keyword">var</span> icon = $(<span class="hljs-string">&quot;#menuEditModal [name=icon]:checked&quot;</span>).val();<br>    $.ajax(&#123;<br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;menu/update.json&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>        <span class="hljs-string">&quot;data&quot;</span>: &#123;<br>            <span class="hljs-attr">name</span>: name,<br>            <span class="hljs-attr">url</span>: url,<br>            <span class="hljs-attr">icon</span>: icon,<br>            <span class="hljs-comment">// 从全局变量获得该节点的节点id</span><br>            <span class="hljs-attr">id</span>: <span class="hljs-built_in">window</span>.id<br>        &#125;,<br>        <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>        <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;SUCCESS&quot;</span>) &#123;<br>                layer.msg(<span class="hljs-string">&quot;操作成功！&quot;</span>);<br><br>                <span class="hljs-comment">// 重新生成树形结构</span><br>                generateTree();<br>            &#125;<br>            <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;FAILED&quot;</span>) &#123;<br>                layer.msg(<span class="hljs-string">&quot;操作失败！&quot;</span>);<br>            &#125;<br>        &#125;,<br>        <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            layer.msg(response.status + <span class="hljs-string">&quot; &quot;</span> + response.statusText);<br>        &#125;<br>    &#125;);<br>    <span class="hljs-comment">// 关闭模态框</span><br>    $(<span class="hljs-string">&quot;#menuEditModal&quot;</span>).modal(<span class="hljs-string">&quot;hide&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="后端-5"><a href="#后端-5" class="headerlink" title="后端"></a>后端</h3><h4 id="Handler方法-4"><a href="#Handler方法-4" class="headerlink" title="Handler方法"></a>Handler方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/menu/update.json&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">updateMenu</span><span class="hljs-params">(Menu menu)</span></span>&#123;<br>    menuService.updateMenu(menu);<br>    <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="Service的实现"><a href="#Service的实现" class="headerlink" title="Service的实现"></a>Service的实现</h4><p>有选择的进行更新</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateMenu</span><span class="hljs-params">(Menu menu)</span> </span>&#123;<br>    menuMapper.updateByPrimaryKeySelective(menu);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h2><h3 id="目标-17"><a href="#目标-17" class="headerlink" title="目标"></a>目标</h3><p>删除当前节点</p>
<h3 id="思路-17"><a href="#思路-17" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220117134313794.png" alt="image-20220117134313794"></p>
<h3 id="前端-7"><a href="#前端-7" class="headerlink" title="前端"></a>前端</h3><h4 id="删除静态框的引入"><a href="#删除静态框的引入" class="headerlink" title="删除静态框的引入"></a>删除静态框的引入</h4><p>主要通过获取当前节点来回显提示信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 动态生成的删除按钮，单击打开删除的模态框</span><br>$(<span class="hljs-string">&quot;#treeDemo&quot;</span>).on(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-string">&quot;.removeBtn&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br><br>    <span class="hljs-comment">// 保存此按钮的id</span><br>    <span class="hljs-built_in">window</span>.id = <span class="hljs-built_in">this</span>.id;<br><br>    $(<span class="hljs-string">&quot;#menuConfirmModal&quot;</span>).modal(<span class="hljs-string">&quot;show&quot;</span>);<br><br>    <span class="hljs-comment">// 要实现通过id拿到整个节点的信息，需要拿到zTreeObj</span><br>    <span class="hljs-keyword">var</span> zTreeObj = $.fn.zTree.getZTreeObj(<span class="hljs-string">&quot;treeDemo&quot;</span>);<br><br>    <span class="hljs-keyword">var</span> key = <span class="hljs-string">&quot;id&quot;</span>;<br>    <span class="hljs-keyword">var</span> value = <span class="hljs-built_in">window</span>.id;<br><br>    <span class="hljs-comment">// getNodeByParam，通过id得到当前的整个节点</span><br>    <span class="hljs-comment">// 注意：id为treeNode的id，返回的就是那个treeNode</span><br>    <span class="hljs-keyword">var</span> currentNode = zTreeObj.getNodeByParam(key, value);<br><br>    <span class="hljs-comment">// 获取当前节点的icon和name来作为提示信息</span><br>    <span class="hljs-keyword">var</span> icon = currentNode.icon;<br>    <span class="hljs-keyword">var</span> name = currentNode.name;<br><br>    <span class="hljs-comment">// 回显-向id=removeNodeSpan的span标签添加html语句（显示图标与节点名）</span><br>    $(<span class="hljs-string">&quot;#removeNodeSpan&quot;</span>).html(<span class="hljs-string">&quot;【&lt;i class=&#x27;&quot;</span>+icon+<span class="hljs-string">&quot;&#x27;&gt;&quot;</span>+name+<span class="hljs-string">&quot;】&lt;/i&gt;&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;);<br></code></pre></td></tr></table></figure>

<h4 id="绑定确定删除单击事件"><a href="#绑定确定删除单击事件" class="headerlink" title="绑定确定删除单击事件"></a>绑定确定删除单击事件</h4><p>只需传入当前节点的id，根据id进行删除</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 删除节点模态框中确定按钮的单击事件</span><br>$(<span class="hljs-string">&quot;#confirmBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br><br>    <span class="hljs-keyword">var</span> name = $(<span class="hljs-string">&quot;#menuEditModal [name=name]&quot;</span>).val();<br><br>    <span class="hljs-keyword">var</span> url = $(<span class="hljs-string">&quot;#menuEditModal [name=url]&quot;</span>).val();<br><br>    <span class="hljs-keyword">var</span> icon = $(<span class="hljs-string">&quot;#menuEditModal [name=icon]:checked&quot;</span>).val();<br>    $.ajax(&#123;<br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;menu/remove.json&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>        <span class="hljs-string">&quot;data&quot;</span>: &#123;<br>            <span class="hljs-comment">// 从全局变量获得该节点的节点id</span><br>            <span class="hljs-attr">id</span>: <span class="hljs-built_in">window</span>.id<br>        &#125;,<br>        <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>        <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;SUCCESS&quot;</span>) &#123;<br>                layer.msg(<span class="hljs-string">&quot;操作成功！&quot;</span>);<br><br>                <span class="hljs-comment">// 重新生成树形结构</span><br>                generateTree();<br>            &#125;<br>            <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;FAILED&quot;</span>) &#123;<br>                layer.msg(<span class="hljs-string">&quot;操作失败！&quot;</span>);<br>            &#125;<br>        &#125;,<br>        <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            layer.msg(response.status + <span class="hljs-string">&quot; &quot;</span> + response.statusText);<br>        &#125;<br>    &#125;);<br>    <span class="hljs-comment">// 关闭模态框</span><br>    $(<span class="hljs-string">&quot;#menuConfirmModal&quot;</span>).modal(<span class="hljs-string">&quot;hide&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="后端-6"><a href="#后端-6" class="headerlink" title="后端"></a>后端</h3><h4 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h4><p>将@RestController替换@ResponseBody和@Controller</p>
<h4 id="Handler方法-5"><a href="#Handler方法-5" class="headerlink" title="Handler方法"></a>Handler方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/menu/remove.json&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">removeMenu</span><span class="hljs-params">(Integer id)</span></span>&#123;<br>    menuService.remove(id);<br>    <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="Service实现-2"><a href="#Service实现-2" class="headerlink" title="Service实现"></a>Service实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(Integer id)</span> </span>&#123;<br>    menuMapper.deleteByPrimaryKey(id);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p><img src="/img/atcrowdfunding.assets/image-20220117143627760.png" alt="image-20220117143627760"></p>
<h2 id="Admin分配Role"><a href="#Admin分配Role" class="headerlink" title="Admin分配Role"></a>Admin分配Role</h2><h3 id="目标-18"><a href="#目标-18" class="headerlink" title="目标"></a>目标</h3><p>通过页面操作把Admin和Role之间的关联关系保存到数据库</p>
<h3 id="思路-18"><a href="#思路-18" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220117145438323.png" alt="image-20220117145438323"></p>
<h3 id="后端-7"><a href="#后端-7" class="headerlink" title="后端"></a>后端</h3><h4 id="替换button为a标签"><a href="#替换button为a标签" class="headerlink" title="替换button为a标签"></a>替换button为a标签</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;a href=<span class="hljs-string">&quot;assign/to/page.html?adminId=$&#123;admin.id&#125;&amp;pageNum=$&#123;requestScope.pageInfo.pageNum&#125;&amp;keyword=$&#123;param.keyword&#125;&quot;</span><br>   <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-success btn-xs&quot;</span>&gt;&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot; glyphicon glyphicon-check&quot;</span>&gt;&lt;/i&gt;&lt;/a&gt;<br></code></pre></td></tr></table></figure>

<h4 id="Handler方法-6"><a href="#Handler方法-6" class="headerlink" title="Handler方法"></a>Handler方法</h4><p>分别将已分配角色和未分配角色都传入model中，则不用前端判断</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/assign/to/page.html&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toAssignPage</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(&quot;adminId&quot;)</span> Integer adminId,</span></span><br><span class="hljs-params"><span class="hljs-function">        ModelMap modelMap</span></span><br><span class="hljs-params"><span class="hljs-function">)</span> </span>&#123;<br>    <span class="hljs-comment">// 查询已分配角色</span><br>    List&lt;Role&gt; assignRoleList = roleService.getAssignedRole(adminId);<br>    <span class="hljs-comment">// 查询未分配的角色</span><br>    List&lt;Role&gt; unAssignRoleList = roleService.getUnAssignedRole(adminId);<br>    <span class="hljs-comment">// 存入模型</span><br>    modelMap.addAttribute(<span class="hljs-string">&quot;assignRoleList&quot;</span>, assignRoleList);<br>    modelMap.addAttribute(<span class="hljs-string">&quot;unAssignRoleList&quot;</span>, unAssignRoleList);<br>    <span class="hljs-comment">// 转发到assign-role</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;assign-role&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="Service实现-3"><a href="#Service实现-3" class="headerlink" title="Service实现"></a>Service实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Role&gt; <span class="hljs-title">getAssignedRole</span><span class="hljs-params">(Integer adminId)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> roleMapper.selectAssignedRoleList(adminId);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Role&gt; <span class="hljs-title">getUnAssignedRole</span><span class="hljs-params">(Integer adminId)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> roleMapper.selectUnAssignedRoleList(adminId);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="sql语句"><a href="#sql语句" class="headerlink" title="sql语句"></a>sql语句</h4><p>使用子查询，在查询已分配和未分配较方便</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 查询已经分配的角色 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectAssignedRoleList&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span><br>  select id,name from t_role where id in (select role_id from inner_admin_role where admin_id=#&#123;adminId&#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 查询未分配的角色 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectUnAssignedRoleList&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span><br>  select id,name from t_role where id not in (select role_id from inner_admin_role where admin_id=#&#123;adminId&#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="前端-8"><a href="#前端-8" class="headerlink" title="前端"></a>前端</h3><h4 id="页面角色显示"><a href="#页面角色显示" class="headerlink" title="页面角色显示"></a>页面角色显示</h4><p>assign-role.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main&quot;</span>&gt;<br>    &lt;ol <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;breadcrumb&quot;</span>&gt;<br>        &lt;li&gt;&lt;a href=<span class="hljs-string">&quot;#&quot;</span>&gt;首页&lt;/a&gt;&lt;/li&gt;<br>        &lt;li&gt;&lt;a href=<span class="hljs-string">&quot;#&quot;</span>&gt;数据列表&lt;/a&gt;&lt;/li&gt;<br>        &lt;li <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;active&quot;</span>&gt;分配角色&lt;/li&gt;<br>    &lt;/ol&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel panel-default&quot;</span>&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;panel-body&quot;</span>&gt;<br>            &lt;form action=<span class="hljs-string">&quot;assign/do/assign.html&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> role=<span class="hljs-string">&quot;form&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-inline&quot;</span>&gt;<br>                &lt;!--隐藏域保存不会改变的adminId、pageNum、keyword，在提交时一起传给后端--&gt;<br>                &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> value=<span class="hljs-string">&quot;$&#123;param.adminId&#125;&quot;</span> name=<span class="hljs-string">&quot;adminId&quot;</span>/&gt;<br>                &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> value=<span class="hljs-string">&quot;$&#123;param.pageNum&#125;&quot;</span> name=<span class="hljs-string">&quot;pageNum&quot;</span>/&gt;<br>                &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> value=<span class="hljs-string">&quot;$&#123;param.keyword&#125;&quot;</span> name=<span class="hljs-string">&quot;keyword&quot;</span>/&gt;<br>                &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;<br>                    &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span>&gt;未分配角色列表&lt;/label&gt;&lt;br&gt;<br>                    &lt;select <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> multiple=<span class="hljs-string">&quot;&quot;</span> size=<span class="hljs-string">&quot;10&quot;</span> style=<span class="hljs-string">&quot;width:100px;overflow-y:auto;&quot;</span>&gt;<br>                        &lt;c:forEach items=<span class="hljs-string">&quot;$&#123;requestScope.unAssignRoleList&#125;&quot;</span> <span class="hljs-keyword">var</span>=<span class="hljs-string">&quot;role&quot;</span>&gt;<br>                            &lt;option value=<span class="hljs-string">&quot;$&#123;role.id&#125;&quot;</span>&gt;$&#123;role.name&#125;&lt;/option&gt;<br>                        &lt;/c:forEach&gt;<br>                    &lt;/select&gt;<br>                &lt;/div&gt;<br>                &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;<br>                    &lt;ul&gt;<br>                        &lt;li id=<span class="hljs-string">&quot;toRightBtn&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-default glyphicon glyphicon-chevron-right&quot;</span>&gt;&lt;/li&gt;<br>                        &lt;br&gt;<br>                        &lt;li id=<span class="hljs-string">&quot;toLeftBtn&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-default glyphicon glyphicon-chevron-left&quot;</span> style=<span class="hljs-string">&quot;margin-top:20px;&quot;</span>&gt;&lt;/li&gt;<br>                    &lt;/ul&gt;<br>                &lt;/div&gt;<br>                &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-group&quot;</span> style=<span class="hljs-string">&quot;margin-left:40px;&quot;</span>&gt;<br>                    &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span>&gt;已分配角色列表&lt;/label&gt;&lt;br&gt;<br>                    &lt;!-- 被选中要分配的部分，name设置为roleIdList --&gt;<br>                    &lt;select name=<span class="hljs-string">&quot;roleIdList&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> multiple=<span class="hljs-string">&quot;&quot;</span> size=<span class="hljs-string">&quot;10&quot;</span> style=<span class="hljs-string">&quot;width:100px;overflow-y:auto;&quot;</span>&gt;<br>                        &lt;c:forEach items=<span class="hljs-string">&quot;$&#123;requestScope.assignRoleList&#125;&quot;</span> <span class="hljs-keyword">var</span>=<span class="hljs-string">&quot;role&quot;</span>&gt;<br>                            &lt;option value=<span class="hljs-string">&quot;$&#123;role.id&#125;&quot;</span>&gt;$&#123;role.name&#125;&lt;/option&gt;<br>                        &lt;/c:forEach&gt;<br>                    &lt;/select&gt;<br>                &lt;/div&gt;<br>                &lt;button id=<span class="hljs-string">&quot;submitBtn&quot;</span> type=<span class="hljs-string">&quot;submit&quot;</span> style=<span class="hljs-string">&quot;width:100px;margin-top: 20px;margin-left: 230px;&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-sm btn-success btn-block&quot;</span>&gt;提交&lt;/button&gt;<br>            &lt;/form&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>

<h4 id="点击按钮分配角色"><a href="#点击按钮分配角色" class="headerlink" title="点击按钮分配角色"></a>点击按钮分配角色</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>    $(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-comment">// 点击右箭头，将左边角色追加在右边</span><br>        $(<span class="hljs-string">&quot;#toRightBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>            $(<span class="hljs-string">&quot;select:eq(0)&gt;option:selected&quot;</span>).appendTo(<span class="hljs-string">&quot;select:eq(1)&quot;</span>);<br>        &#125;);<br>        <span class="hljs-comment">// 点击左箭头，将右边角色追加在右边</span><br>        $(<span class="hljs-string">&quot;#toLeftBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>            $(<span class="hljs-string">&quot;select:eq(1)&gt;option:selected&quot;</span>).appendTo(<span class="hljs-string">&quot;select:eq(0)&quot;</span>);<br>        &#125;);<br>    &#125;);<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h2 id="Admin执行分配"><a href="#Admin执行分配" class="headerlink" title="Admin执行分配"></a>Admin执行分配</h2><h3 id="目标-19"><a href="#目标-19" class="headerlink" title="目标"></a>目标</h3><p>点击保存，将角色保存在数据库中</p>
<h3 id="思路-19"><a href="#思路-19" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220118100122954.png" alt="image-20220118100122954"></p>
<h3 id="前端-9"><a href="#前端-9" class="headerlink" title="前端"></a>前端</h3><h4 id="提交表单"><a href="#提交表单" class="headerlink" title="提交表单"></a>提交表单</h4><p>表单需要设置隐藏域，来定位pageNum和keyword以及获取正在执行的adminId</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;form action=<span class="hljs-string">&quot;assign/do/role/assign.html&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> role=<span class="hljs-string">&quot;form&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-inline&quot;</span>&gt;<br>                        &lt;!--隐藏域保存不会改变的adminId、pageNum、keyword，在提交时一起传给后端--&gt;<br>                        &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> value=<span class="hljs-string">&quot;$&#123;param.adminId&#125;&quot;</span> name=<span class="hljs-string">&quot;adminId&quot;</span>/&gt;<br>                        &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> value=<span class="hljs-string">&quot;$&#123;param.pageNum&#125;&quot;</span> name=<span class="hljs-string">&quot;pageNum&quot;</span>/&gt;<br>                        &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> value=<span class="hljs-string">&quot;$&#123;param.keyword&#125;&quot;</span> name=<span class="hljs-string">&quot;keyword&quot;</span>/&gt;<br></code></pre></td></tr></table></figure>

<h4 id="完善表单"><a href="#完善表单" class="headerlink" title="完善表单"></a>完善表单</h4><p>让右边没有选中的角色全部选中，提交表单时才不会遗漏</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 让右边框中元素全部为选中，提交表单则全部提交</span><br>$(<span class="hljs-string">&quot;#submitBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    $(<span class="hljs-string">&quot;select:eq(1)&gt;option&quot;</span>).prop(<span class="hljs-string">&quot;selected&quot;</span>,<span class="hljs-string">&quot;selected&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="后端-8"><a href="#后端-8" class="headerlink" title="后端"></a>后端</h3><h4 id="Handler方法-7"><a href="#Handler方法-7" class="headerlink" title="Handler方法"></a>Handler方法</h4><p>在获取roleIdList时，允许为空</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/assign/do/role/assign.html&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">saveAdminRoleRelationship</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(value = &quot;adminId&quot;)</span> Integer adminId,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(&quot;pageNum&quot;)</span> Integer pageNum,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(&quot;keyword&quot;)</span> String keyword,</span></span><br><span class="hljs-params"><span class="hljs-function">        // 管理员可以没有权限，所以可以设置roleId可以为空</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(value = &quot;roleIdList&quot;,required = false)</span> List&lt;Integer&gt; roleIdList,</span></span><br><span class="hljs-params"><span class="hljs-function">        ModelMap modelMap</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>&#123;<br><br>    <span class="hljs-comment">// 调用service层方法</span><br>    adminService.saveAdminRoleRelationship(adminId, roleIdList);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/admin/get/page.html?pageNum=&quot;</span>+pageNum+<span class="hljs-string">&quot;&amp;keyword=&quot;</span>+keyword;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="Service实现-4"><a href="#Service实现-4" class="headerlink" title="Service实现"></a>Service实现</h4><p>由于单个删除浪费时间，可以先将adminId的角色全部删除后再插入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveAdminRoleRelationship</span><span class="hljs-params">(Integer adminId, List&lt;Integer&gt; roleIdList)</span> </span>&#123;<br>    <span class="hljs-comment">// 为了简化操作：先将adminId的角色全部删除</span><br>    adminMapper.deleteOldRelationship(adminId);<br>    <span class="hljs-comment">// 根据roleIdList和adminId保存新的关系</span><br>    <span class="hljs-keyword">if</span>(roleIdList!=<span class="hljs-keyword">null</span>&amp;&amp;roleIdList.size()&gt;=<span class="hljs-number">0</span>)&#123;<br>        adminMapper.saveNewRelationship(adminId,roleIdList);<br>    &#125;<br></code></pre></td></tr></table></figure>

<h4 id="AdminMapper接口"><a href="#AdminMapper接口" class="headerlink" title="AdminMapper接口"></a>AdminMapper接口</h4><p>AminMapper接口定义方法，自定义sql进行删除和插入，使用@Param注解，在sql中会使用到参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteOldRelationship</span><span class="hljs-params">(Integer adminId)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">saveNewRelationship</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;adminId&quot;)</span> Integer adminId,<span class="hljs-meta">@Param(&quot;roleIdList&quot;)</span> List&lt;Integer&gt; roleIdList)</span></span>;<br></code></pre></td></tr></table></figure>

<h4 id="sql语句-1"><a href="#sql语句-1" class="headerlink" title="sql语句"></a>sql语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">delete</span> id<span class="hljs-operator">=</span>&quot;deleteOldRelationship&quot;<span class="hljs-operator">&gt;</span><br>    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> inner_admin_role <span class="hljs-keyword">where</span> admin_id<span class="hljs-operator">=</span>#&#123;adminId&#125;<br><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">delete</span><span class="hljs-operator">&gt;</span><br><span class="hljs-operator">&lt;</span><span class="hljs-keyword">insert</span> id<span class="hljs-operator">=</span>&quot;saveNewRelationship&quot;<span class="hljs-operator">&gt;</span><br>    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> inner_admin_role(admin_id,role_id) <span class="hljs-keyword">values</span><br>    <span class="hljs-operator">&lt;</span>foreach collection<span class="hljs-operator">=</span>&quot;roleIdList&quot; item<span class="hljs-operator">=</span>&quot;roleId&quot; separator<span class="hljs-operator">=</span>&quot;,&quot;<span class="hljs-operator">&gt;</span><br>         (#&#123;adminId&#125;,#&#123;roleId&#125;)<br>    <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>foreach<span class="hljs-operator">&gt;</span><br><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">insert</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="Role分配Auth"><a href="#Role分配Auth" class="headerlink" title="Role分配Auth"></a>Role分配Auth</h2><h3 id="目标-20"><a href="#目标-20" class="headerlink" title="目标"></a>目标</h3><p>把角色和权限的关联保存到数据库</p>
<h3 id="思路-20"><a href="#思路-20" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220118115150368.png" alt="image-20220118115150368"></p>
<h3 id="创建权限表"><a href="#创建权限表" class="headerlink" title="创建权限表"></a>创建权限表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 建t_auth表<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t_auth (<br>	id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>	name <span class="hljs-type">varchar</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>	title <span class="hljs-type">varchar</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>	category_id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br><br>	<span class="hljs-keyword">PRIMARY</span> KEY (id)<br>);<br><br># 给t_auth表插入数据<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_auth(id,`name`,title,category_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-string">&#x27;用户模块&#x27;</span>,<span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_auth(id,`name`,title,category_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;user:delete&#x27;</span>,<span class="hljs-string">&#x27;删除&#x27;</span>,<span class="hljs-number">1</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_auth(id,`name`,title,category_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;user:get&#x27;</span>,<span class="hljs-string">&#x27;查询&#x27;</span>,<span class="hljs-number">1</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_auth(id,`name`,title,category_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-string">&#x27;角色模块&#x27;</span>,<span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_auth(id,`name`,title,category_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">5</span>,<span class="hljs-string">&#x27;role:delete&#x27;</span>,<span class="hljs-string">&#x27;删除&#x27;</span>,<span class="hljs-number">4</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_auth(id,`name`,title,category_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">6</span>,<span class="hljs-string">&#x27;role:get&#x27;</span>,<span class="hljs-string">&#x27;查询&#x27;</span>,<span class="hljs-number">4</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_auth(id,`name`,title,category_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">7</span>,<span class="hljs-string">&#x27;role:add&#x27;</span>,<span class="hljs-string">&#x27;新增&#x27;</span>,<span class="hljs-number">4</span>);<br></code></pre></td></tr></table></figure>

<h3 id="逆向工程-2"><a href="#逆向工程-2" class="headerlink" title="逆向工程"></a>逆向工程</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_auth&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;Auth&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure>

<p>生成实体类后，添加有参和无参构造器，将各文件放在各自包中，最后创建AuthService接口和实现类</p>
<h3 id="前端-10"><a href="#前端-10" class="headerlink" title="前端"></a>前端</h3><h4 id="给按钮添加class和id值"><a href="#给按钮添加class和id值" class="headerlink" title="给按钮添加class和id值"></a>给按钮添加class和id值</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> checkBtn = <span class="hljs-string">&quot;&lt;button id=&#x27;&quot;</span> + roleId + <span class="hljs-string">&quot;&#x27; type=&#x27;button&#x27; class=&#x27;btn btn-success btn-xs checkBtn&#x27;&gt;&lt;i class=&#x27; glyphicon glyphicon-check&#x27;&gt;&lt;/i&gt;&lt;/button&gt;&quot;</span><br></code></pre></td></tr></table></figure>

<h4 id="模态框的引入"><a href="#模态框的引入" class="headerlink" title="模态框的引入"></a>模态框的引入</h4><ul>
<li><p>modal-role-assign-auth.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;<br>&lt;div id=<span class="hljs-string">&quot;assignModal&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal fade&quot;</span> tabindex=<span class="hljs-string">&quot;-1&quot;</span> role=<span class="hljs-string">&quot;dialog&quot;</span>&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-dialog&quot;</span> role=<span class="hljs-string">&quot;document&quot;</span>&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-content&quot;</span>&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-header&quot;</span>&gt;<br>                &lt;button type=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;close&quot;</span> data-dismiss=<span class="hljs-string">&quot;modal&quot;</span><br>                        aria-label=<span class="hljs-string">&quot;Close&quot;</span>&gt;<br>                    &lt;span aria-hidden=<span class="hljs-string">&quot;true&quot;</span>&gt;&amp;times;&lt;/span&gt;<br>                &lt;/button&gt;<br>                &lt;h4 <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-title&quot;</span>&gt;尚筹网-角色权限分配&lt;/h4&gt;<br>            &lt;/div&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-body&quot;</span>&gt;<br>                &lt;ul id=<span class="hljs-string">&quot;authTreeDemo&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;ztree&quot;</span>&gt;&lt;/ul&gt;<br>            &lt;/div&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;modal-footer&quot;</span>&gt;<br>                &lt;button id=<span class="hljs-string">&quot;assignBtn&quot;</span> type=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span>&gt;好的，我设置好了！执行分配！&lt;/button&gt;<br>            &lt;/div&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>静态资源引入</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%<span class="hljs-meta">@include</span> file=<span class="hljs-string">&quot;/WEB-INF/modal-role-assign-auth.jsp&quot;</span> %&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="弹出模态框"><a href="#弹出模态框" class="headerlink" title="弹出模态框"></a>弹出模态框</h4><p>将生成树形结构封装为函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 弹出权限分配静态框</span><br>$(<span class="hljs-string">&quot;#rolePageTBody&quot;</span>).on(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-string">&quot;.checkBtn&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// 打开模态框</span><br>    $(<span class="hljs-string">&quot;#assignModal&quot;</span>).modal(<span class="hljs-string">&quot;show&quot;</span>);<br>    <span class="hljs-comment">// 生成树形结构</span><br>    fullAuthTree();<br>&#125;);<br></code></pre></td></tr></table></figure>

<h4 id="生成树形结构的函数"><a href="#生成树形结构的函数" class="headerlink" title="生成树形结构的函数"></a>生成树形结构的函数</h4><p>处理树形结构不同于菜单维护，使用zTree的简单json数据来显示，而不是后台将数据封装好</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 生成权限分配树形结构</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fullAuthTree</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-comment">// 发送Ajax请求查询Auth数据</span><br>    <span class="hljs-keyword">var</span> ajaxReturn = $.ajax(&#123;<br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;assign/get/all/auth.json&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>        <span class="hljs-attr">async</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span><br>    &#125;);<br><br>    <span class="hljs-keyword">if</span> (ajaxReturn.status != <span class="hljs-number">200</span>)&#123;<br>        layer.msg(<span class="hljs-string">&quot;请求出错！错误码：&quot;</span>+ ajaxReturn.status + <span class="hljs-string">&quot;错误信息：&quot;</span> + ajaxReturn.statusText);<br>        <span class="hljs-keyword">return</span> ;<br>    &#125;<br><br>    <span class="hljs-keyword">var</span> resultEntity = ajaxReturn.responseJSON;<br><br>    <span class="hljs-keyword">if</span> (resultEntity.result == <span class="hljs-string">&quot;FAILED&quot;</span>)&#123;<br>        layer.msg(<span class="hljs-string">&quot;操作失败！&quot;</span>+resultEntity.message);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (resultEntity.result == <span class="hljs-string">&quot;SUCCESS&quot;</span>) &#123;<br>        <span class="hljs-keyword">var</span> authList = resultEntity.data;<br>        <span class="hljs-comment">// 将服务端查询到的list交给zTree自己组装</span><br>        <span class="hljs-keyword">var</span> setting = &#123;<br>            <span class="hljs-attr">data</span>: &#123;<br>                <span class="hljs-comment">// 开启简单JSON功能</span><br>                <span class="hljs-attr">simpleData</span>: &#123;<br>                    <span class="hljs-attr">enable</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-comment">// 通过pIdKey属性设置父节点的属性名，而不使用默认的pId</span><br>                    <span class="hljs-attr">pIdKey</span>: <span class="hljs-string">&quot;categoryId&quot;</span><br>                &#125;,<br>                <span class="hljs-attr">key</span>: &#123;<br>                    <span class="hljs-comment">// 设置在前端显示的节点名是查询到的title，而不是使用默认的name</span><br>                    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;title&quot;</span><br>                &#125;,<br>            &#125;,<br><br>            <span class="hljs-attr">check</span>: &#123;<br>                <span class="hljs-attr">enable</span>: <span class="hljs-literal">true</span><br>            &#125;<br>        &#125;;<br><br>        <span class="hljs-comment">// 生成树形结构信息</span><br>        $.fn.zTree.init($(<span class="hljs-string">&quot;#authTreeDemo&quot;</span>), setting, authList);<br><br>        <span class="hljs-comment">// 设置节点默认是展开的</span><br>        <span class="hljs-comment">// 1 得到zTreeObj</span><br>        <span class="hljs-keyword">var</span> zTreeObj = $.fn.zTree.getZTreeObj(<span class="hljs-string">&quot;authTreeDemo&quot;</span>);<br>        <span class="hljs-comment">// 2 设置默认展开</span><br>        zTreeObj.expandAll(<span class="hljs-literal">true</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="后端-9"><a href="#后端-9" class="headerlink" title="后端"></a>后端</h3><h4 id="Handler方法-8"><a href="#Handler方法-8" class="headerlink" title="Handler方法"></a>Handler方法</h4><p>获取所有Auth并封装在List，以json数据返回，方便调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/assign/get/all/auth.json&quot;)</span><br><span class="hljs-keyword">public</span> ResultEntity&lt;List&lt;Auth&gt;&gt; getAllAuth()&#123;<br>    List&lt;Auth&gt; authList = authService.getAllAuth();<br>    <span class="hljs-keyword">return</span> ResultEntity.successWithData(authList);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="AuthService实现"><a href="#AuthService实现" class="headerlink" title="AuthService实现"></a>AuthService实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Auth&gt; <span class="hljs-title">getAllAuth</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> authMapper.selectByExample(<span class="hljs-keyword">new</span> AuthExample());<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Role回显Auth"><a href="#Role回显Auth" class="headerlink" title="Role回显Auth"></a>Role回显Auth</h2><h3 id="目标-21"><a href="#目标-21" class="headerlink" title="目标"></a>目标</h3><p>生成模态框后，自动发送Ajax请求，并回显在复选框上</p>
<h3 id="思路-21"><a href="#思路-21" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220118155508792.png" alt="image-20220118155508792"></p>
<h3 id="前端-11"><a href="#前端-11" class="headerlink" title="前端"></a>前端</h3><h4 id="保存roleId"><a href="#保存roleId" class="headerlink" title="保存roleId"></a>保存roleId</h4><p>方便传入roleId查找Auth来回显</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 弹出权限分配静态框</span><br>$(<span class="hljs-string">&quot;#rolePageTBody&quot;</span>).on(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-string">&quot;.checkBtn&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-built_in">window</span>.roleId = <span class="hljs-built_in">this</span>.id;<br>    <span class="hljs-comment">// 打开模态框</span><br>    $(<span class="hljs-string">&quot;#assignModal&quot;</span>).modal(<span class="hljs-string">&quot;show&quot;</span>);<br>    <span class="hljs-comment">// 生成树形结构</span><br>    fullAuthTree();<br>&#125;);<br></code></pre></td></tr></table></figure>

<h4 id="回显Auth复选框"><a href="#回显Auth复选框" class="headerlink" title="回显Auth复选框"></a>回显Auth复选框</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 回显权限信息</span><br>ajaxReturn = $.ajax(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;assign/get/assigned/auth/id/by/role/id.json&quot;</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>    <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>    <span class="hljs-attr">data</span>: &#123;<br>        <span class="hljs-attr">roleId</span>: <span class="hljs-built_in">window</span>.roleId<br>    &#125;,<br>    <span class="hljs-attr">async</span>: <span class="hljs-literal">false</span><br>&#125;);<br><br><span class="hljs-keyword">if</span> (ajaxReturn.status != <span class="hljs-number">200</span>) &#123;<br>    layer.msg(<span class="hljs-string">&quot;请求出错！错误码：&quot;</span> + ajaxReturn.status + <span class="hljs-string">&quot;错误信息：&quot;</span> + ajaxReturn.statusText);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">// 获取返回的json信息</span><br>resultEntity = ajaxReturn.responseJSON;<br><br><span class="hljs-keyword">if</span> (resultEntity.result == <span class="hljs-string">&quot;FAILED&quot;</span>) &#123;<br>    layer.msg(<span class="hljs-string">&quot;操作失败！&quot;</span> + resultEntity.message);<br>&#125;<br><br><span class="hljs-keyword">if</span> (resultEntity.result == <span class="hljs-string">&quot;SUCCESS&quot;</span>) &#123;<br>    <span class="hljs-keyword">var</span> authIdArray = resultEntity.data;<br><br>    <span class="hljs-comment">// 遍历得到的autoId的数组</span><br>    <span class="hljs-comment">// 根据authIdArray勾选对应的节点</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; authIdArray.length; i++) &#123;<br>        <span class="hljs-keyword">var</span> authId = authIdArray[i];<br><br>        <span class="hljs-comment">// 通过id得到treeNode</span><br>        <span class="hljs-keyword">var</span> treeNode = zTreeObj.getNodeByParam(<span class="hljs-string">&quot;id&quot;</span>, authId);<br><br>        <span class="hljs-comment">// checked设置为true，表示勾选节点</span><br>        <span class="hljs-keyword">var</span> checked = <span class="hljs-literal">true</span>;<br><br>        <span class="hljs-comment">// checkTypeFlag设置为false，表示不联动勾选，</span><br>        <span class="hljs-comment">// 即父节点的子节点未完全勾选时不改变父节点的勾选状态</span><br>        <span class="hljs-comment">// 否则会出现bug：前端只要选了一个子节点，传到后端后，下次再调用时，发现前端那个子节点的所有兄弟节点也被勾选了，</span><br>        <span class="hljs-comment">// 因为在子节点勾选时，父节点也被勾选了，之后前端显示时，联动勾选，导致全部子节点被勾选</span><br>        <span class="hljs-keyword">var</span> checkTypeFlag = <span class="hljs-literal">false</span>;<br><br>        <span class="hljs-comment">// zTreeObj的checkNode方法 执行勾选操作</span><br>        zTreeObj.checkNode(treeNode, checked, checkTypeFlag);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="后端-10"><a href="#后端-10" class="headerlink" title="后端"></a>后端</h3><h4 id="创建inner-role-auth数据表"><a href="#创建inner-role-auth数据表" class="headerlink" title="创建inner-role-auth数据表"></a>创建inner-role-auth数据表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> inner_role_auth(<br> id <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br> role_id <span class="hljs-type">INT</span>,<br> auth_id <span class="hljs-type">INT</span>,<br> <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br> );<br></code></pre></td></tr></table></figure>

<h4 id="Hanlder方法"><a href="#Hanlder方法" class="headerlink" title="Hanlder方法"></a>Hanlder方法</h4><p>返回authId的List集合，在前端可以遍历authId来回显</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/assign/get/assigned/auth/id/by/role/id.json&quot;)</span><br><span class="hljs-keyword">public</span> ResultEntity&lt;List&lt;Integer&gt;&gt; getAssignedAuthIdByRoleId(<span class="hljs-meta">@RequestParam(&quot;roleID&quot;)</span> Integer roleId)&#123;<br>    List&lt;Integer&gt; authList = authService.getAssignedAuthIdByRoleId(roleId);<br>    <span class="hljs-keyword">return</span> ResultEntity.successWithData(authList);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="AuthService实现-1"><a href="#AuthService实现-1" class="headerlink" title="AuthService实现"></a>AuthService实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title">getAssignedAuthIdByRoleId</span><span class="hljs-params">(Integer roleId)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> authMapper.selectAuthIdByRoleId(roleId);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="sql语句-2"><a href="#sql语句-2" class="headerlink" title="sql语句"></a>sql语句</h4><p>通过roleId查询authId</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">select</span> id<span class="hljs-operator">=</span>&quot;selectAuthIdByRoleId&quot; resultType<span class="hljs-operator">=</span>&quot;int&quot;<span class="hljs-operator">&gt;</span><br>  <span class="hljs-keyword">select</span> auth_id <span class="hljs-keyword">from</span> inner_role_auth <span class="hljs-keyword">where</span> role_id<span class="hljs-operator">=</span>#&#123;roleId&#125;<br><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">select</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="Role执行分配"><a href="#Role执行分配" class="headerlink" title="Role执行分配"></a>Role执行分配</h2><h3 id="目标-22"><a href="#目标-22" class="headerlink" title="目标"></a>目标</h3><p>点击执行，在数据库中保存，并显示模态框</p>
<h3 id="思路-22"><a href="#思路-22" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220118151754107-16424902801321.png" alt="image-20220118151754107"></p>
<h3 id="前端-12"><a href="#前端-12" class="headerlink" title="前端"></a>前端</h3><h4 id="绑定提交单击事件"><a href="#绑定提交单击事件" class="headerlink" title="绑定提交单击事件"></a>绑定提交单击事件</h4><p>提交后发送Ajax请求，注意在传入后端的参数中，需要将roleId也看作为数组，以请求体的方式传入，使用@RequestBody接受</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 给提交权限修改绑定单击事件</span><br>$(<span class="hljs-string">&quot;#assignBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// 声明一个数组，用来存放被勾选的auth的id</span><br>    <span class="hljs-keyword">var</span> authIdArray = [];<br><br>    <span class="hljs-comment">// 拿到zTreeObj</span><br>    <span class="hljs-keyword">var</span> zTreeObj = $.fn.zTree.getZTreeObj(<span class="hljs-string">&quot;authTreeDemo&quot;</span>);<br><br>    <span class="hljs-comment">// 通过getCheckedNodes方法拿到被选中的option信息</span><br>    <span class="hljs-keyword">var</span> authArray = zTreeObj.getCheckedNodes();<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; authArray.length; i++) &#123;<br>        <span class="hljs-comment">// 从被选中的auth中遍历得到每一个auth的id</span><br>        <span class="hljs-keyword">var</span> authId = authArray[i].id;<br>        <span class="hljs-comment">// 通过push方法将得到的id存入authIdArray</span><br>        authIdArray.push(authId);<br>    &#125;<br>    <span class="hljs-keyword">var</span> requestBody = &#123;<br>        <span class="hljs-comment">// 为了后端取值方便，两个数据都用数组格式存放，后端统一用List&lt;Integer&gt;获取</span><br>        <span class="hljs-attr">roleId</span>: [<span class="hljs-built_in">window</span>.roleId],<br>        <span class="hljs-attr">authIdList</span>: authIdArray<br>    &#125;<br>    requestBody = <span class="hljs-built_in">JSON</span>.stringify(requestBody);<br><br>    <span class="hljs-comment">// 发送Ajax请求保存</span><br>    $.ajax(&#123;<br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;assign/do/role/assign/auth.json&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>        <span class="hljs-attr">data</span>: requestBody,<br>        <span class="hljs-attr">contentType</span>: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>,<br>        <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>        <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;SUCCESS&quot;</span>)&#123;<br>                layer.msg(<span class="hljs-string">&quot;操作成功！&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (response.result == <span class="hljs-string">&quot;FAILED&quot;</span>)&#123;<br>                layer.msg(<span class="hljs-string">&quot;操作失败！提示信息：&quot;</span>+ response.message);<br>            &#125;<br>        &#125;,<br>        <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>            layer.msg(response.status + <span class="hljs-string">&quot;  &quot;</span> + response.statusText);<br>        &#125;<br>    &#125;);<br><br>    <span class="hljs-comment">// 关闭模态框</span><br>    $(<span class="hljs-string">&quot;#assignModal&quot;</span>).modal(<span class="hljs-string">&quot;hide&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="后端-11"><a href="#后端-11" class="headerlink" title="后端"></a>后端</h3><h4 id="Handler方法-9"><a href="#Handler方法-9" class="headerlink" title="Handler方法"></a>Handler方法</h4><p>使用Map接受参数，方便取出各数组，和admin执行分配方法一致，先将所有记录删除后再插入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/assign/do/role/assign/auth.json&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">saveRoleAuthRelathinship</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Map&lt;String, List&lt;Integer&gt;&gt; map)</span> </span>&#123;<br>    <span class="hljs-comment">// 取出roleId进行删除</span><br>    List&lt;Integer&gt; roleIdList = map.get(<span class="hljs-string">&quot;roleId&quot;</span>);<br>    Integer roleId = roleIdList.get(<span class="hljs-number">0</span>);<br>    <span class="hljs-comment">// 根据roleId进行删除</span><br>    authService.deleteOldRelationship(roleId);<br>    <span class="hljs-comment">// 取出新增的权限的authId</span><br>    List&lt;Integer&gt; authIdList = map.get(<span class="hljs-string">&quot;authIdList&quot;</span>);<br>    <span class="hljs-comment">// 判断是否为空，再进行插入</span><br>    <span class="hljs-keyword">if</span> (authIdList != <span class="hljs-keyword">null</span> &amp;&amp; authIdList.size() &gt; <span class="hljs-number">0</span>) &#123;<br>        authService.saveNewRelationship(roleId, authIdList);<br>    &#125;<br>    <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="AuthServuce实现"><a href="#AuthServuce实现" class="headerlink" title="AuthServuce实现"></a>AuthServuce实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteOldRelationship</span><span class="hljs-params">(Integer roleId)</span> </span>&#123;<br>    authMapper.deleteOldRelationship(roleId);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveNewRelationship</span><span class="hljs-params">(Integer roleId, List&lt;Integer&gt; authIdList)</span> </span>&#123;<br>    authMapper.insertNewRelationship(roleId,authIdList);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="AuthMapper接口定义方法"><a href="#AuthMapper接口定义方法" class="headerlink" title="AuthMapper接口定义方法"></a>AuthMapper接口定义方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteOldRelationship</span><span class="hljs-params">(Integer roleId)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insertNewRelationship</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;roleId&quot;)</span> Integer roleId,<span class="hljs-meta">@Param(&quot;authIdList&quot;)</span> List&lt;Integer&gt; authIdList)</span></span>;<br></code></pre></td></tr></table></figure>

<h4 id="sql语句-3"><a href="#sql语句-3" class="headerlink" title="sql语句"></a>sql语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">delete</span> id<span class="hljs-operator">=</span>&quot;deleteOldRelationship&quot;<span class="hljs-operator">&gt;</span><br>   <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> inner_role_auth <span class="hljs-keyword">where</span> role_id<span class="hljs-operator">=</span>#&#123;roleId&#125;<br><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">delete</span><span class="hljs-operator">&gt;</span><br><br><span class="hljs-operator">&lt;</span><span class="hljs-keyword">insert</span> id<span class="hljs-operator">=</span>&quot;insertNewRelationship&quot;<span class="hljs-operator">&gt;</span><br>  <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> inner_role_auth (role_id, auth_id) <span class="hljs-keyword">values</span><br>  <span class="hljs-operator">&lt;</span>foreach collection<span class="hljs-operator">=</span>&quot;authIdList&quot; item<span class="hljs-operator">=</span>&quot;authId&quot; separator<span class="hljs-operator">=</span>&quot;,&quot;<span class="hljs-operator">&gt;</span><br>    (#&#123;roleId&#125;,#&#123;authId&#125;)<br>  <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>foreach<span class="hljs-operator">&gt;</span><br><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">insert</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="SpringSecurity的引入"><a href="#SpringSecurity的引入" class="headerlink" title="SpringSecurity的引入"></a>SpringSecurity的引入</h2><p>在springSecurity注入IOC容器中时，应该注入SpringMVC的IOC，对浏览器请求进行控制</p>
<p><img src="/img/atcrowdfunding.assets/image-20220119145321761.png" alt="image-20220119145321761"></p>
<h3 id="添加依赖-1"><a href="#添加依赖-1" class="headerlink" title="添加依赖"></a>添加依赖</h3><p>父工程下添加，控制版本</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- SpringSecurity 对 Web 应用进行权限管理 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;fall.spring.security.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- SpringSecurity 配置 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;fall.spring.security.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- SpringSecurity 标签库 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-taglibs<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;fall.spring.security.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>在component下添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- SpringSecurity 对 Web 应用进行权限管理 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- SpringSecurity 配置 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- SpringSecurity 标签库 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-taglibs<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="加入SpringSecurity的filter"><a href="#加入SpringSecurity的filter" class="headerlink" title="加入SpringSecurity的filter"></a>加入SpringSecurity的filter</h3><p>web.xml下配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--加入 SpringSecurity 控制权限的 Filter--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="创建配置类"><a href="#创建配置类" class="headerlink" title="创建配置类"></a>创建配置类</h3><p>在mvc.config中创建springSecurity的配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>      <span class="hljs-comment">// 配置类</span><br><span class="hljs-meta">@EnableWebSecurity</span>  <span class="hljs-comment">// 开启web环境下的权限控制功能</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebAppSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="找不到springSecurityFilterChain"><a href="#找不到springSecurityFilterChain" class="headerlink" title="找不到springSecurityFilterChain"></a>找不到springSecurityFilterChain</h3><p>此时启动项目，在Tomcat Localhost Log下会报错</p>
<p><img src="/img/atcrowdfunding.assets/image-20220119141025713.png" alt="image-20220119141025713"></p>
<h4 id="报错原因"><a href="#报错原因" class="headerlink" title="报错原因"></a>报错原因</h4><p>Web 组件加载顺序：Listener→Filter→Servlet </p>
<ul>
<li><p>Spring IOC 容器：ContextLoaderListener 创建 </p>
</li>
<li><p>SpringMVC IOC 容器：DispatcherServlet 创建 </p>
</li>
<li><p>springSecurityFilterChain：从 IOC 容器中找到对应的 bean</p>
</li>
</ul>
<p><img src="/img/atcrowdfunding.assets/image-20220119143542626.png" alt="image-20220119143542626"></p>
<p>在ContextLoaderListener 初始化后，springSecurityFilterChain会在spring的IOC容器中找bean，但spring的IOC并未扫描springSecurity的配置类，就没有创建bean</p>
<h4 id="解决方案一：合并IOC容器"><a href="#解决方案一：合并IOC容器" class="headerlink" title="解决方案一：合并IOC容器"></a>解决方案一：合并IOC容器</h4><p>将Spring和SpringMVC的IOC容器合二为一</p>
<p>将spring的IOC容器注释掉，初始化时就不会在spring的IOC中找bean，而是放弃，在第一次请求时找SpringMVC中的bean</p>
<ul>
<li><p>web.xml中注释掉</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-comment">&lt;!--  将spring的IOC容器和SringMVC的IOC容器合二为一  --&gt;</span><br>    <span class="hljs-comment">&lt;!--配置监听加载文件--&gt;</span><br><span class="hljs-comment">&lt;!--    &lt;context-param&gt;--&gt;</span><br><span class="hljs-comment">&lt;!--        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;--&gt;</span><br><span class="hljs-comment">&lt;!--        &lt;param-value&gt;classpath:spring-persist-*.xml&lt;/param-value&gt;--&gt;</span><br><span class="hljs-comment">&lt;!--    &lt;/context-param&gt;--&gt;</span><br><span class="hljs-comment">&lt;!--    &amp;lt;!&amp;ndash;ContextLoaderListener加入容器&amp;ndash;&amp;gt;--&gt;</span><br><span class="hljs-comment">&lt;!--    &lt;listener&gt;--&gt;</span><br><span class="hljs-comment">&lt;!--        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;--&gt;</span><br><span class="hljs-comment">&lt;!--    &lt;/listener&gt;--&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>在SpringMVC配置加载文件时，将spring的IOC扫描的bean加载进去</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--SpringMVC的配置文件--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:spring-*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="解决方案二：修改源码"><a href="#解决方案二：修改源码" class="headerlink" title="解决方案二：修改源码"></a>解决方案二：修改源码</h4><p>先扫描SpringMVC的IOC容器，而不是spring的IOC容器，此处并未采用</p>
<h3 id="放行资源"><a href="#放行资源" class="headerlink" title="放行资源"></a>放行资源</h3><p>对登录页和静态资源放行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity security)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    security<br>            .authorizeRequests()<br>            .antMatchers(<span class="hljs-string">&quot;/admin/to/login/page.html&quot;</span>)   <span class="hljs-comment">// 对登录页放行</span><br>            .permitAll()                                            <span class="hljs-comment">//无条件访问</span><br>            .antMatchers(                                           <span class="hljs-comment">// 对静态资源放行</span><br>                    <span class="hljs-string">&quot;/bootstrap/**&quot;</span><br>                    , <span class="hljs-string">&quot;/crowd/**&quot;</span><br>                    , <span class="hljs-string">&quot;/css/**&quot;</span><br>                    , <span class="hljs-string">&quot;/fonts/**&quot;</span><br>                    , <span class="hljs-string">&quot;/img/**&quot;</span><br>                    , <span class="hljs-string">&quot;/jquery/**&quot;</span><br>                    , <span class="hljs-string">&quot;/layer/**&quot;</span><br>                    , <span class="hljs-string">&quot;/script/**&quot;</span><br>                    , <span class="hljs-string">&quot;/ztree/**&quot;</span>)<br>            .permitAll()<br>            .anyRequest()                                           <span class="hljs-comment">// 其他未设置的全部请求</span><br>            .authenticated();                                       <span class="hljs-comment">// 需要认证</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="登录配置"><a href="#登录配置" class="headerlink" title="登录配置"></a>登录配置</h3><ul>
<li><p>修改登录页的表单提交路径</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;form action=<span class="hljs-string">&quot;admin/security/login.html&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-signin&quot;</span> role=<span class="hljs-string">&quot;form&quot;</span>&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>在security下在配置表单登录功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">.and()<br>.formLogin()                                            <span class="hljs-comment">// 开启表单登录</span><br>.loginPage(<span class="hljs-string">&quot;/admin/to/login/page.html&quot;</span>)                 <span class="hljs-comment">// 登录页</span><br>.loginProcessingUrl(<span class="hljs-string">&quot;/admin/security/login.html&quot;</span>)       <span class="hljs-comment">// 登录请求的地址</span><br>.defaultSuccessUrl(<span class="hljs-string">&quot;/admin/to/main/page.html&quot;</span>)          <span class="hljs-comment">// 登录成功后前往的地址</span><br>.usernameParameter(<span class="hljs-string">&quot;loginAcct&quot;</span>)                         <span class="hljs-comment">// 账号请求参数的名称</span><br>.passwordParameter(<span class="hljs-string">&quot;loginPswd&quot;</span>)                         <span class="hljs-comment">// 密码请求参数的名称</span><br>.and()<br>.csrf()                                                 <span class="hljs-comment">// 为了方便，本项目禁用跨站请求伪造功能</span><br>.disable();<br></code></pre></td></tr></table></figure>

<p>注意禁用 CSRF 功能，实际开发时还是不要禁用</p>
</li>
<li><p>创建用户配置模拟登录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder builder)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    builder<br>            .inMemoryAuthentication()<br>            .withUser(<span class="hljs-string">&quot;tom&quot;</span>)<br>            .password(<span class="hljs-string">&quot;123&quot;</span>)<br>            .roles(<span class="hljs-string">&quot;ADMIN&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>注意在spring-web-mvc.xml中<strong>将拦截器注释掉</strong>，不然在访问main页面时会被拦截器拦截重新登录</p>
</li>
</ul>
<h3 id="退出登录配置"><a href="#退出登录配置" class="headerlink" title="退出登录配置"></a>退出登录配置</h3><ul>
<li><p>在退出按钮设置请求地址</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;li&gt;&lt;a href=<span class="hljs-string">&quot;admin/security/logout.html&quot;</span>&gt;&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-off&quot;</span>&gt;&lt;/i&gt; 退出系统&lt;/a&gt;&lt;/li&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>开启退出登录功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">.and()<br>.logout()                                               <span class="hljs-comment">// 开启登录退出功能</span><br>.logoutUrl(<span class="hljs-string">&quot;/admin/security/logout.html&quot;</span>)                <span class="hljs-comment">// 退出登录请求的地址</span><br>.logoutSuccessUrl(<span class="hljs-string">&quot;/admin/to/login/page.html&quot;</span>)          <span class="hljs-comment">// 退出成功后跳转的页面</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="使用数据库登录"><a href="#使用数据库登录" class="headerlink" title="使用数据库登录"></a>使用数据库登录</h3><h4 id="目标-23"><a href="#目标-23" class="headerlink" title="目标"></a>目标</h4><p>使用SpringSecurity通过查找数据库，对用户的账号密码校验，和赋予用户的权限</p>
<h4 id="思路-23"><a href="#思路-23" class="headerlink" title="思路"></a>思路</h4><p><img src="/img/atcrowdfunding.assets/image-20220119161956847.png" alt="image-20220119161956847"></p>
<h4 id="完善查询语句"><a href="#完善查询语句" class="headerlink" title="完善查询语句"></a>完善查询语句</h4><ul>
<li><p>通过adminId查找权限操作</p>
<ul>
<li><p>authService接口实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">getAssignAuthByAdminId</span><span class="hljs-params">(Integer adminId)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> authMapper.selectAssignAuthByAdminId(adminId);<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">select</span> id<span class="hljs-operator">=</span>&quot;selectAssignAuthByAdminId&quot; resultType<span class="hljs-operator">=</span>&quot;String&quot;<span class="hljs-operator">&gt;</span><br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> t_auth.name<br>    <span class="hljs-keyword">from</span> t_auth<br>             <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> inner_role_auth <span class="hljs-keyword">on</span> inner_role_auth.auth_id <span class="hljs-operator">=</span> t_auth.id<br>             <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> inner_admin_role <span class="hljs-keyword">on</span> inner_admin_role.role_id <span class="hljs-operator">=</span> inner_role_auth.role_id<br>    <span class="hljs-keyword">where</span> admin_id <span class="hljs-operator">=</span> #&#123;adminId&#125;<br>      <span class="hljs-keyword">AND</span> t_auth.`name` <span class="hljs-operator">!=</span> &quot;&quot; <span class="hljs-keyword">AND</span> t_auth.`name` <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">select</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>通过username查找admin</p>
<ul>
<li><p>使用QBC查询，AdminService接口实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Admin <span class="hljs-title">getAdminByLoginAcct</span><span class="hljs-params">(String username)</span> </span>&#123;<br>    AdminExample adminExample = <span class="hljs-keyword">new</span> AdminExample();<br>    AdminExample.Criteria criteria = adminExample.createCriteria();<br>    criteria.andLoginAcctLike(username);<br>    List&lt;Admin&gt; admins = adminMapper.selectByExample(adminExample);<br>    Admin admin = admins.get(<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">return</span> admin;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="创建SecurityAdmin"><a href="#创建SecurityAdmin" class="headerlink" title="创建SecurityAdmin"></a>创建SecurityAdmin</h4><p>SecurityAdmin封装了admin的信息和所拥有的权限，此时继承SpringSecurity提供的User类，并调用User的有参构造函数进行构造</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 为了能方便地获取到原始地Admin对象，因此创建一个SecurityAdmin类，继承User。</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityAdmin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">User</span> </span>&#123;<br><br>    <span class="hljs-comment">// 原始的Admin对象，包含Admin的所有属性</span><br>    <span class="hljs-keyword">private</span> Admin originalAdmin;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SecurityAdmin</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            // 传入原始的admin</span></span><br><span class="hljs-params"><span class="hljs-function">            Admin originalAdmin,</span></span><br><span class="hljs-params"><span class="hljs-function">            // 创建角色，权限的集合</span></span><br><span class="hljs-params"><span class="hljs-function">            List&lt;GrantedAuthority&gt; authorities)</span> </span>&#123;<br>        <span class="hljs-comment">// 调用父类的构造器</span><br>        <span class="hljs-keyword">super</span>(originalAdmin.getLoginAcct(), originalAdmin.getUserPswd(), authorities);<br>        <span class="hljs-keyword">this</span>.originalAdmin = originalAdmin;<br>    &#125;<br><br>    <span class="hljs-comment">// 对外提供获取原始的Admin对象的get方法</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Admin <span class="hljs-title">getOriginalAdmin</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> originalAdmin;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="实现UserDetailsService接口"><a href="#实现UserDetailsService接口" class="headerlink" title="实现UserDetailsService接口"></a>实现UserDetailsService接口</h4><p>使用CrowdUserDetailsServiceImpl来实现UserDetailsService接口，将用户和权限封装进SecurityAdmin中</p>
<p>此时CrowdUserDetailsServiceImpl放在impl包下，CrowdUserDetails放在api包下，（并没有放在config包下），需要再实现CrowdUserDetails</p>
<p><strong>注意</strong>：在进行角色存入时，需要添加ROLE_前缀表示存入的是角色，而不是权限</p>
<p>CrowdUserDetails接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CrowdUserDetailsService</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>CrowdUserDetailsServiceImpl实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdUserDetailsServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CrowdUserDetailsService</span>, <span class="hljs-title">UserDetailsService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AdminService adminService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RoleService roleService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AuthService authService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>&#123;<br>        <span class="hljs-comment">// 通过用户名得到Admin对象</span><br>        Admin admin = adminService.getAdminByLoginAcct(username);<br><br>        <span class="hljs-comment">// 通过AdminId得到角色List</span><br>        List&lt;Role&gt; roleList = roleService.getAssignedRole(admin.getId());<br><br>        <span class="hljs-comment">// 通过AdminId得到权限name地List</span><br>        List&lt;String&gt; authNameList = authService.getAssignAuthByAdminId(admin.getId());<br><br>        <span class="hljs-comment">// 创建List用来存放GrantedAuthority（权限信息）</span><br>        ArrayList&lt;GrantedAuthority&gt; authorities = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br><br>        <span class="hljs-comment">// 向List存放角色信息，注意角色必须要手动加上 “ROLE_” 前缀</span><br>        <span class="hljs-keyword">for</span> (Role role : roleList) &#123;<br>            String roleName = <span class="hljs-string">&quot;ROLE_&quot;</span> + rolerole.getName();<br>            SimpleGrantedAuthority simpleGrantedAuthority = <span class="hljs-keyword">new</span> SimpleGrantedAuthority(roleName);<br>            authorities.add(simpleGrantedAuthority);<br>        &#125;<br><br>        <span class="hljs-comment">// 向List存放权限信息</span><br>        <span class="hljs-keyword">for</span> (String authority : authNameList) &#123;<br>            SimpleGrantedAuthority simpleGrantedAuthority = <span class="hljs-keyword">new</span> SimpleGrantedAuthority(authority);<br>            authorities.add(simpleGrantedAuthority);<br>        &#125;<br><br>        <span class="hljs-comment">// 将Admin对象和权限信息存入SecurityAdmin中</span><br>        SecurityAdmin securityAdmin = <span class="hljs-keyword">new</span> SecurityAdmin(admin, authorities);<br><br>        <span class="hljs-comment">// 返回封装好的SecurityAdmin对象</span><br>        <span class="hljs-keyword">return</span> securityAdmin;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="再配置类中使用数据库登录"><a href="#再配置类中使用数据库登录" class="headerlink" title="再配置类中使用数据库登录"></a>再配置类中使用数据库登录</h4><p>先装配UserDetailsService，修改配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserDetailsService userDetailsService;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder builder)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    builder<br>            .userDetailsService(userDetailsService);		<span class="hljs-comment">//使用数据库登录</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="使用盐值加密"><a href="#使用盐值加密" class="headerlink" title="使用盐值加密"></a>使用盐值加密</h3><ul>
<li><p>将BCryptPasswordEncoder注入到容器，可以再配置文件中配置，也可以使用@Bean注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> BCryptPasswordEncoder <span class="hljs-title">BCryptPasswordEncoder</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>配置使用盐值加密</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder builder)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    builder<br>            .userDetailsService(userDetailsService)    <span class="hljs-comment">// 使用数据库登录</span><br>            .passwordEncoder(BCryptPasswordEncoder()); <span class="hljs-comment">// 使用盐值加密</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>修改保存管理员的方法（saveAdmin），不使用MD5加密，而是用盐值加密</p>
<p>先注入自动装配（此时我们已将容器合并，在spring容器中不需要再配置）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> BCryptPasswordEncoder bCryptPasswordEncoder;<br></code></pre></td></tr></table></figure>

<p>再使用BCryptPasswordEncoder</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 1.取出密码进行md5加密</span><br>String password=admin.getUserPswd();<br><span class="hljs-comment">// 使用盐值加密代替md5加密</span><br>String encode = bCryptPasswordEncoder.encode(password);<br>admin.setUserPswd(encode);<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="页面显示用户名"><a href="#页面显示用户名" class="headerlink" title="页面显示用户名"></a>页面显示用户名</h3><ul>
<li><p>导入springSecurity标签</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%<span class="hljs-meta">@taglib</span> prefix=<span class="hljs-string">&quot;security&quot;</span> uri=<span class="hljs-string">&quot;http://www.springframework.org/security/tags&quot;</span> %&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>通过封装的princinal显示信息</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;i <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;glyphicon glyphicon-user&quot;</span>&gt;<br>    &lt;!-- ，springSeurity将在登录成功后，将登录成功的User以principal存入，就是前面返回的originalAdmin，从originalAdmin属性可以获取Admin的所有信息  --&gt;<br>    &lt;security:authentication property=<span class="hljs-string">&quot;principal.originalAdmin.userName&quot;</span>&gt;&lt;/security:authentication&gt;<br>&lt;/i&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="密码擦除"><a href="#密码擦除" class="headerlink" title="密码擦除"></a>密码擦除</h3><ul>
<li><p>由于SecurityAdmin的父类，User已经在登陆后封装进principal时，将password设置为空，在页面无法显示Credentials信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">eraseCredentials</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.password = <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>但在SecurityAdmin的originalAdmin中还存在password的信息，因此将originalAdmin中的password设置为空（此处设置不会影响登录，登录时的密码验证时通过父类User来匹配的）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 擦除originalAdmin中的密码，即将originalAdmin设置为空</span><br>originalAdmin.setUserPswd(<span class="hljs-keyword">null</span>);<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="角色访问控制"><a href="#角色访问控制" class="headerlink" title="角色访问控制"></a>角色访问控制</h3><ul>
<li><p>方法一：可以在配置类中设置访问时要求的角色</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">security<br>		.antMatchers(<span class="hljs-string">&quot;/admin/get/page.html&quot;</span>)      			  <span class="hljs-comment">// 针对分页显示Admin数据设定访问控制</span><br>		.hasRole(<span class="hljs-string">&quot;经理&quot;</span>)                                        <span class="hljs-comment">// 要求具备经理角色</span><br></code></pre></td></tr></table></figure>

<p>此时在没有权限的时候，会报403异常，此时在SpringSecurity配置类中配置异常处理机制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">security<br>		.exceptionHandling()<br>		.accessDeniedHandler(<span class="hljs-keyword">new</span> AccessDeniedHandler() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, AccessDeniedException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br>        request.setAttribute(<span class="hljs-string">&quot;exception&quot;</span>,<span class="hljs-keyword">new</span> Exception(CrowdConstant.MESSAGE_ACCESS_DENIED));<br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/system-error.jsp&quot;</span>).forward(request,response);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>SpringSecurity异常不会被SpringMVC捕捉</strong>（因此403需要自己在SpringSecurity配置），层次对应关系如下</p>
<p><img src="/img/atcrowdfunding.assets/image-20220120145713618.png" alt="image-20220120145713618"></p>
</li>
<li><p>方法二：通过注解在Handler方法上设置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 拥有部长的角色才可以访问</span><br><span class="hljs-meta">@PreAuthorize(&quot;hasAnyRole(&#x27;部长&#x27;)&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/role/get/page/info.json&quot;)</span><br><span class="hljs-keyword">public</span> ResultEntity&lt;PageInfo&lt;Role&gt;&gt; getPageInfo()&#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>

<p>此时需要在配置类中加入注解，以上注解才生效</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>                                     <span class="hljs-comment">// 配置类</span><br><span class="hljs-meta">@EnableWebSecurity</span>                                 <span class="hljs-comment">// 开启web环境下的权限控制功能</span><br><span class="hljs-meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span> <span class="hljs-comment">// 开启此功能才可以使用注解来设置权限信息</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebAppSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在访问没有权限的资源时，SpringMVC会抛出异常，但没有对应的异常处理机制，因此配置异常处理机制，捕获一个大的Exception</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 处理springSecurity抛出的异常</span><br><span class="hljs-meta">@ExceptionHandler(value = &#123;Exception.class&#125;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">resolveException</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        Exception exception,</span></span><br><span class="hljs-params"><span class="hljs-function">        HttpServletRequest request,</span></span><br><span class="hljs-params"><span class="hljs-function">        HttpServletResponse response</span></span><br><span class="hljs-params"><span class="hljs-function">)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    String viewName = <span class="hljs-string">&quot;system-error&quot;</span>;<br>    <span class="hljs-keyword">return</span> conmonResolver(exception, request, response, viewName);<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="权限访问控制"><a href="#权限访问控制" class="headerlink" title="权限访问控制"></a>权限访问控制</h3><ul>
<li><p>在方法上加入权限，即拥有此权限才可以访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PreAuthorize(&quot;hasAuthority(&#x27;user:save&#x27;)&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;admin/save.html&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">saveAdmin</span><span class="hljs-params">(Admin admin)</span></span>&#123;<br>   ...<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>在配置类中设置，则/admin/get/page.html需要经理角色或者user:get才可以访问（如果OR 为 ADN 则需要角色和权限同时满足）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">security<br>		.antMatchers(<span class="hljs-string">&quot;/admin/get/page.html&quot;</span>)        <span class="hljs-comment">// 针对分页显示Admin数据设定访问控制</span><br>		.access(<span class="hljs-string">&quot;hasAnyRole(&#x27;经理&#x27;) OR hasAuthority(&#x27;user:get&#x27;) &quot;</span>) <span class="hljs-comment">// 要求具备经理角色和user:get权限</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="页面元素的权限控制"><a href="#页面元素的权限控制" class="headerlink" title="页面元素的权限控制"></a>页面元素的权限控制</h3><ul>
<li><p>需要在jsp中引入SpringSecurity标签库</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%<span class="hljs-meta">@taglib</span> prefix=<span class="hljs-string">&quot;security&quot;</span> uri=<span class="hljs-string">&quot;http://www.springframework.org/security/tags&quot;</span> %&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>此时security标签中对应的权限或者角色才可以显示给用户</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;security:authorize access=<span class="hljs-string">&quot;hasRole(&#x27;经理&#x27;)&quot;</span>&gt;<br>          ...<br>&lt;security:authorize access=<span class="hljs-string">&quot;hasAuthority(&#x27;role:delete&#x27;)&quot;</span>&gt;<br>          ...<br>&lt;/security:authorize&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="会员环境搭建"><a href="#会员环境搭建" class="headerlink" title="会员环境搭建"></a>会员环境搭建</h1><h2 id="总目标"><a href="#总目标" class="headerlink" title="总目标"></a>总目标</h2><p>会员登录注册 、发起众筹项目 、展示众筹项目 、支持众筹项目 、订单、支付功能</p>
<h2 id="分布式架构思路图"><a href="#分布式架构思路图" class="headerlink" title="分布式架构思路图"></a>分布式架构思路图</h2><p><img src="/img/atcrowdfunding.assets/image-20220122162213047.png" alt="image-20220122162213047"></p>
<h2 id="创建工程模块"><a href="#创建工程模块" class="headerlink" title="创建工程模块"></a>创建工程模块</h2><p>IDEA在Project Structure中就可以导入以前的模块</p>
<p><img src="/img/atcrowdfunding.assets/image-20220125215945354.png" alt="image-20220125215945354"></p>
<p>导入后效果</p>
<p><img src="/img/atcrowdfunding.assets/image-20220122184737974.png" alt="image-20220122184737974"></p>
<p>父工程打包方式为<strong>pom</strong>，其他工程打包为<strong>jar</strong></p>
<ul>
<li><p>端口号约定</p>
<p>atcrowdfunding08-member-eureka  1000 </p>
<p>atcrowdfunding10-member-mysql-provider 2000 </p>
<p>atcrowdfunding11-member-redis-provider 3000 </p>
<p>atcrowdfunding12-member-authentication-consumer 4000 </p>
<p>atcrowdfunding13-member-project-consumer 5000 </p>
<p>atcrowdfunding14-member-order-consumer 7000 </p>
<p>atcrowdfunding15-member-pay-consumer 8000 </p>
<p>atcrowdfunding16-member-zuul 80</p>
</li>
<li><p>父工程导入依赖，进行版本控制</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 在parent工程进行依赖管理 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 导入SpringCloud需要的依赖信息 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>Hoxton.SR8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- SpringBoot依赖信息 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.3.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--SpringBoot整合MyBatis的依赖--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--druid依赖信息--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Eureka模块"><a href="#Eureka模块" class="headerlink" title="Eureka模块"></a>Eureka模块</h3><ul>
<li><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableEurekaServer</span> <span class="hljs-comment">// 开启eureka功能</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdMainClass</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(CrowdMainClass.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">1000</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">atguigu-crowd-eureka</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">false</span>         <span class="hljs-comment"># 自己就是注册中心，所以不需要“从注册中心取回信息”</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">false</span>   <span class="hljs-comment"># 自己就是注册中心，所以自己不注册自己</span><br>    <span class="hljs-attr">service-url:</span>                  <span class="hljs-comment"># 客户端访问 Eureka 时使用的地址</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="实体类模块"><a href="#实体类模块" class="headerlink" title="实体类模块"></a>实体类模块</h3><h4 id="实体类的划分"><a href="#实体类的划分" class="headerlink" title="实体类的划分"></a>实体类的划分</h4><ul>
<li><p>VO（View Object） 视图对象 </p>
<p>用途 1：接收<strong>浏览器</strong>发送过来的数据 </p>
<p>用途 2：把数据发送给<strong>浏览器</strong>去显示</p>
</li>
<li><p>PO （Persistent Object） 持久化对象 </p>
<p>用途 1：将数据封装到 PO 对象存入数据库 </p>
<p>用途 2：将数据库数据查询出来存入 PO 对象 </p>
<p>所以 PO 对象是和数据库表对应，一个数据库表对应一个 PO 对象</p>
</li>
<li><p>DO（Data Object） 数据对象 </p>
<p>用途 1：从 Redis 查询得到数据封装为 DO 对象 </p>
<p>用途 2：从 ElasticSearch 查询得到数据封装为 DO 对象 </p>
<p>用途 3：从 Solr 查询得到数据封装为 DO 对象 </p>
<p>……</p>
<p>从中间件或其他第三方接口查询到的数据封装为 DO 对象</p>
</li>
<li><p>DTO（Data Transfer Object ）数据传输对象</p>
<p>用途 1：从 Consumer 发送数据到 Provider </p>
<p>用途 2：Provider 返回数据给 Consumer</p>
</li>
<li><p>示例</p>
<p><img src="/img/atcrowdfunding.assets/image-20220122181840968.png" alt="image-20220122181840968"></p>
<p>使用 org.springframework.beans.BeanUtils.copyProperties(Object, Object)在不同实体类之间复制属性。</p>
</li>
</ul>
<h4 id="创建包"><a href="#创建包" class="headerlink" title="创建包"></a>创建包</h4><p>本项目只用到VO,PO</p>
<p>创建com.atguigu.crowd.entity.po ，com.atguigu.crowd.entity.vo包</p>
<h4 id="使用lombok插件"><a href="#使用lombok插件" class="headerlink" title="使用lombok插件"></a>使用lombok插件</h4><p>lombok在.class文件时才会自动创建，IDEA中导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.16.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="Mysql工程"><a href="#Mysql工程" class="headerlink" title="Mysql工程"></a>Mysql工程</h3><h4 id="逆向工程-3"><a href="#逆向工程-3" class="headerlink" title="逆向工程"></a>逆向工程</h4><ul>
<li><p>创建数据库表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_member ( <br>id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment,<br>loginacct <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>, <br>userpswd <span class="hljs-type">char</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>, <br>username <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>), <br>email <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>), <br>authstatus <span class="hljs-type">int</span>(<span class="hljs-number">4</span>) comment <span class="hljs-string">&#x27;实名认证状态 0 - 未实名认证， 1 - 实名认证申 请中， 2 - 已实名认证&#x27;</span>,<br> usertype <span class="hljs-type">int</span>(<span class="hljs-number">4</span>) comment <span class="hljs-string">&#x27; 0 - 个人， 1 - 企业&#x27;</span>, <br>realname <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>), <br>cardnum <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),<br> accttype <span class="hljs-type">int</span>(<span class="hljs-number">4</span>) comment <span class="hljs-string">&#x27;0 - 企业， 1 - 个体， 2 - 个人， 3 - 政府&#x27;</span>, <br><span class="hljs-keyword">primary</span> key (id) );<br></code></pre></td></tr></table></figure></li>
<li><p>逆向工程</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 数据库表名与需要的实体类对应映射的指定 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_member&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;MemberPO&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>生成的实体类中使用lombok</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MemberPO</span> </span>&#123;<br></code></pre></td></tr></table></figure></li>
<li><p>将各自文件归入各自的包</p>
</li>
</ul>
<h4 id="整合mybatis"><a href="#整合mybatis" class="headerlink" title="整合mybatis"></a>整合mybatis</h4><ul>
<li><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>       <span class="hljs-comment">&lt;!-- druid连接池 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <br>       <span class="hljs-comment">&lt;!-- MyBatis依赖 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <br>       <span class="hljs-comment">&lt;!-- mysql驱动 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <br>       <span class="hljs-comment">&lt;!-- eureka客户端依赖 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <br>       <span class="hljs-comment">&lt;!-- web环境（为了能对外暴露接口） --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <br>       <span class="hljs-comment">&lt;!-- 测试 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>               <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>           <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <br>       <span class="hljs-comment">&lt;!-- 实体类依赖 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.crowd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atcrowdfunding09-member-entity<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <br>       <span class="hljs-comment">&lt;!--依赖entity--&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.crowd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atcrowdfunding04-admin-entity<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.crowd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atcrowdfunding05-common-util<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>启动类</p>
<p>注意<strong>扫描mapper接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@MapperScan(basePackages = &quot;com.atguigu.crowd.mapper&quot;)</span>  <span class="hljs-comment">// 扫描mapper接口所在的包</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdMainClass</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(CrowdMainClass.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>yml配置文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">2000</span><br><span class="hljs-attr">eureka:</span>                       <span class="hljs-comment"># 注册eureka</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:1000/eureka/</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span>                 <span class="hljs-comment"># 配置数据源</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">mydb</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">...</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/project_crowd?serverTimezone=UTC</span> <span class="hljs-comment"># 注意配置时区</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">atguigu-crowd-mysql</span> <span class="hljs-comment"># 客户端名</span><br><span class="hljs-attr">mybatis:</span>                      <span class="hljs-comment"># mybatis配置</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:/mybatis/mapper/*.xml</span><br><span class="hljs-attr">logging:</span>                      <span class="hljs-comment"># 打印sql日志</span><br>  <span class="hljs-attr">level:</span><br>    <span class="hljs-attr">com.atguigu.crowd.mapper:</span> <span class="hljs-string">debug</span><br>    <span class="hljs-attr">com.atguigu.crowd.test:</span> <span class="hljs-string">debug</span><br></code></pre></td></tr></table></figure></li>
<li><p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-meta">@SpringBootTest(classes = CrowdMainClass.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringTest</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DataSource dataSource;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MemberPOMapper memberPOMapper;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">connectTest</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        Connection connection = dataSource.getConnection();<br>        System.out.println(connection.toString());<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mybatisTest</span><span class="hljs-params">()</span> </span>&#123;<br>        BCryptPasswordEncoder passwordEncoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder();<br>        String source = <span class="hljs-string">&quot;123123&quot;</span>;<br>        String encode = passwordEncoder.encode(source);<br>        MemberPO memberPO = <span class="hljs-keyword">new</span> MemberPO(<span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;jack&quot;</span>, encode, <span class="hljs-string">&quot; 杰 克 &quot;</span>, <span class="hljs-string">&quot;jack@qq.com&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;杰克&quot;</span>, <span class="hljs-string">&quot;123123&quot;</span>, <span class="hljs-number">2</span>);<br>        memberPOMapper.insert(memberPO);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Redis工程"><a href="#Redis工程" class="headerlink" title="Redis工程"></a>Redis工程</h3><ul>
<li><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- redis依赖 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- eureka客户端依赖 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- web环境（为了能对外暴露接口） --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 测试 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 实体类依赖 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.crowd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atcrowdfunding09-member-entity<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 工具类依赖 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.crowd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atcrowdfunding05-common-util<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>主启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdMainClass</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(CrowdMainClass.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">3000</span><br><span class="hljs-attr">eureka:</span>                       <span class="hljs-comment"># redis也是eureka的客户端</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:1000/eureka/</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">atguigu-crowd-redis</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.241</span><span class="hljs-number">.130</span><br></code></pre></td></tr></table></figure></li>
<li><p>测试连接redis</p>
<p>先启动redis服务，测试类如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-meta">@SpringBootTest(classes = CrowdMainClass.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisTest</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">redisConnectTest</span><span class="hljs-params">()</span></span>&#123;<br>        ValueOperations&lt;String, String&gt; stringStringValueOperations = redisTemplate.opsForValue();<br>        stringStringValueOperations.set(<span class="hljs-string">&quot;k2&quot;</span>,<span class="hljs-string">&quot;v2&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>暴露接口</p>
<p>在api工程创建接口，通过fegin连接</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(&quot;atguigu-crowd-redis&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">RedisRemoteService</span> </span>&#123;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/set/redis/key/value/remote&quot;)</span><br>    <span class="hljs-function">ResultEntity&lt;String&gt; <span class="hljs-title">setRedisKeyValueRemote</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;key&quot;)</span> String key,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;value&quot;)</span> String value</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/set/redis/key/value/with/timeout/remote&quot;)</span><br>    <span class="hljs-function">ResultEntity&lt;String&gt; <span class="hljs-title">setRedisKeyValueWithTimeoutRemote</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;key&quot;)</span> String key,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;value&quot;)</span> String value,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;time&quot;)</span> <span class="hljs-keyword">long</span> time,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;timeUnit&quot;)</span> TimeUnit timeunit</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/get/redis/value/by/key/remote&quot;)</span><br>    <span class="hljs-function">ResultEntity&lt;String&gt; <span class="hljs-title">getRedisValueByKeyRemote</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;key&quot;)</span> String key</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/remove/redis/key/by/key/remote&quot;)</span><br>    <span class="hljs-function">ResultEntity&lt;String&gt; <span class="hljs-title">RemoveRedisKeyByKeyRemote</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;key&quot;)</span> String key</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>provider的handler，提供设置值，超时时间，获取值，删除key的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisProviderHandler</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    StringRedisTemplate redisTemplate;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/set/redis/key/value/remote&quot;)</span><br>    <span class="hljs-function">ResultEntity&lt;String&gt; <span class="hljs-title">setRedisKeyValueRemote</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;key&quot;)</span> String key,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;value&quot;)</span> String value</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ValueOperations&lt;String, String&gt; opsForValue = redisTemplate.opsForValue();<br>            opsForValue.set(key, value);<br>            <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>            exception.printStackTrace();<br>            <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/set/redis/key/value/with/timeout/remote&quot;)</span><br>    <span class="hljs-function">ResultEntity&lt;String&gt; <span class="hljs-title">setRedisKeyValueWithTimeoutRemote</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;key&quot;)</span> String key,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;value&quot;)</span> String value,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;time&quot;)</span> <span class="hljs-keyword">long</span> time,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;timeUnit&quot;)</span> TimeUnit timeunit</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ValueOperations&lt;String, String&gt; opsForValue = redisTemplate.opsForValue();<br>            opsForValue.set(key, value,time,timeunit);<br>            <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>            exception.printStackTrace();<br>            <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/get/redis/value/by/key/remote&quot;)</span><br>    <span class="hljs-function">ResultEntity&lt;String&gt; <span class="hljs-title">getRedisValueByKeyRemote</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;key&quot;)</span> String key</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ValueOperations&lt;String, String&gt; opsForValue = redisTemplate.opsForValue();<br>            String keyValue = opsForValue.get(key);<br>            <span class="hljs-keyword">return</span> ResultEntity.successWithData(keyValue);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>            exception.printStackTrace();<br>            <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/remove/redis/key/by/key/remote&quot;)</span><br>    <span class="hljs-function">ResultEntity&lt;String&gt; <span class="hljs-title">RemoveRedisKeyByKeyRemote</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;key&quot;)</span> String key</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.delete(key);<br>            <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>            exception.printStackTrace();<br>            <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Auth工程"><a href="#Auth工程" class="headerlink" title="Auth工程"></a>Auth工程</h3><ul>
<li><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- thymeleaf视图解析器 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 依赖api包，api依赖了entity和until，不用再次依赖 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.crowd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atcrowdfunding17-member-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>主启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdMainClass</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(CrowdMainClass.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">4000</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:1000/eureka/</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">thymeleaf:</span>	<span class="hljs-comment"># 配置视图解析器</span><br>    <span class="hljs-attr">prefix:</span> <span class="hljs-string">classpath:/templates/</span><br>    <span class="hljs-attr">suffix:</span> <span class="hljs-string">.html</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">atguigu-crowd-auth</span><br></code></pre></td></tr></table></figure></li>
<li><p>编写一个controller返回主页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PortalHandler</span> </span>&#123;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">PortalPage</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;portal&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>引入主界面 portal.html</p>
<p>修改为<strong>UTF-8编码</strong>，不然会出现乱码，<strong>引入thymeleaf名称空间</strong>，设置<strong>base标签</strong>，获取相对路径</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;zh-CN&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;author&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--  设置base标签，相对路径来获取静态资源  --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">base</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/&#125;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;bootstrap/css/bootstrap.min.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css/font-awesome.min.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css/carousel.css&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>引入静态资源</p>
<p>注意包名一定要为<strong>static</strong>，springboot默认<strong>static</strong>为静态资源</p>
<p><img src="/img/atcrowdfunding.assets/image-20220125194456081.png" alt="image-20220125194456081"></p>
</li>
</ul>
<h3 id="Zuul工程"><a href="#Zuul工程" class="headerlink" title="Zuul工程"></a>Zuul工程</h3><ul>
<li><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-zuul<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>主启动类（<strong>注意开启zuul</strong>）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 开启zuul</span><br><span class="hljs-meta">@EnableZuulProxy</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdMainClass</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(CrowdMainClass.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">atguigu-crowd-zuul</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:1000/eureka/</span><br><span class="hljs-attr">zuul:</span><br>  <span class="hljs-attr">ignored-services:</span> <span class="hljs-string">&quot;*&quot;</span>              <span class="hljs-comment"># 忽略原本微服务名称</span><br>  <span class="hljs-attr">sensitive-headers:</span> <span class="hljs-string">&quot;*&quot;</span>             <span class="hljs-comment"># 在zuul向其他微服务重定向时保持原本的请求体和响应头信息</span><br>  <span class="hljs-attr">routes:</span>                            <span class="hljs-comment"># 自定义路由规则</span><br>    <span class="hljs-attr">crowd-portal:</span>                    <span class="hljs-comment"># 自定义路由规则名称</span><br>      <span class="hljs-attr">service-id:</span> <span class="hljs-string">atguigu-crowd-auth</span> <span class="hljs-comment"># 微服务名称</span><br>      <span class="hljs-attr">path:</span> <span class="hljs-string">/**</span>                      <span class="hljs-comment"># /**表示多层路径，/*表示单层路径（此时就无法访问静态资源）</span><br></code></pre></td></tr></table></figure></li>
<li><p>测试时注意将<strong>eureka和对应的auth服务启动</strong>，不然会报错500</p>
</li>
</ul>
<h1 id="会员登录和注册"><a href="#会员登录和注册" class="headerlink" title="会员登录和注册"></a>会员登录和注册</h1><h2 id="会员注册"><a href="#会员注册" class="headerlink" title="会员注册"></a>会员注册</h2><h3 id="短信发送"><a href="#短信发送" class="headerlink" title="短信发送"></a>短信发送</h3><h4 id="目标-24"><a href="#目标-24" class="headerlink" title="目标"></a>目标</h4><ul>
<li>将验证码发送到用户手机上</li>
<li>将验证码存入redis中</li>
</ul>
<h4 id="思路-24"><a href="#思路-24" class="headerlink" title="思路"></a>思路</h4><p><img src="/img/atcrowdfunding.assets/image-20220126094955775.png" alt="image-20220126094955775"></p>
<h4 id="前端-13"><a href="#前端-13" class="headerlink" title="前端"></a>前端</h4><ul>
<li><p>配置viewcontroller，跳转注册页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdWebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;<br>  	    <span class="hljs-comment">// 转发请求的url路径和视图名</span><br>        String registerUrl = <span class="hljs-string">&quot;/auth/to/member/reg/page&quot;</span>;<br>        String registerViewName = <span class="hljs-string">&quot;member-reg&quot;</span>;<br>   <br>        <span class="hljs-comment">// 前往注册页面</span><br>        registry.addViewController(registerUrl).setViewName(registerViewName);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>主页面修改超链接</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;auth/to/member/reg/page.html&quot;</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>修改注册页</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;zh-CN&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;keys&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;author&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">base</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/&#125;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;bootstrap/css/bootstrap.min.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css/font-awesome.min.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css/login.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;jquery/jquery-2.1.1.min.js&quot;</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;bootstrap/js/bootstrap.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;layer/layer.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>为获取验证码绑定单击事件</p>
<p>此时需要添加给input添加name属性，button添加id属性和type类型</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group has-success has-feedback&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;code&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;inputSuccess4&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入验证码&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-top:10px;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon glyphicon-comment form-control-feedback&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sendBtn&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-lg btn-success btn-block&quot;</span>&gt;</span> 获取验证码<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>单击发送ajax请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>    $(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>        $(<span class="hljs-string">&quot;#sendBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">var</span> phoneNum = $.trim($(<span class="hljs-string">&quot;[name=phoneNum]&quot;</span>).val());<br>            $.ajax(&#123;<br>                <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/auth/member/send/short/message.json&quot;</span>,<br>                <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>                <span class="hljs-attr">data</span>: &#123;<br>                    <span class="hljs-string">&quot;phoneNum&quot;</span>:phoneNum<br>                &#125;,<br>                <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>                <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>                    <span class="hljs-keyword">var</span> result = response.result;<br>                    <span class="hljs-keyword">if</span> (result == <span class="hljs-string">&quot;SUCCESS&quot;</span>)&#123;<br>                        layer.msg(<span class="hljs-string">&quot;发送成功！&quot;</span>);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        layer.msg(<span class="hljs-string">&quot;发送失败 请重试！&quot;</span>);<br>                    &#125;<br>                &#125;,<br>                <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;<br>                    layer.msg(response.status + <span class="hljs-string">&quot; &quot;</span> + response.statusText);<br>                &#125;<br>            &#125;);<br>        &#125;);<br>    &#125;);<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="后端-12"><a href="#后端-12" class="headerlink" title="后端"></a>后端</h4><ul>
<li><p>封装发送短信的工具方法</p>
<p>需要在阿里云上购买短信API，此处我使用的是不需要导入依赖的短信API，使用JDK8即可使用</p>
<p><img src="/img/atcrowdfunding.assets/image-20220126134323200.png" alt="image-20220126134323200"></p>
<p>封装方法时返回ResultEntity，并设置返回信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> host    请求地址 支持http 和 https 及 WEBSOCKET</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> path    后缀</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> appcode 用来吊第三方API的appcode（购买后可以查看）</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> phone   短信接收的手机号码</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> sign    签名ID</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> skin    模板ID</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResultEntity&lt;String&gt; <span class="hljs-title">sendShortMessage</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        String host,</span></span><br><span class="hljs-params"><span class="hljs-function">        String path,</span></span><br><span class="hljs-params"><span class="hljs-function">        String appcode,</span></span><br><span class="hljs-params"><span class="hljs-function">        String phone,</span></span><br><span class="hljs-params"><span class="hljs-function">        String sign,</span></span><br><span class="hljs-params"><span class="hljs-function">        String skin)</span> </span>&#123;<br>    <span class="hljs-comment">// 生成验证码</span><br>    StringBuilder stringBuilder = <span class="hljs-keyword">new</span> StringBuilder();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>        <span class="hljs-keyword">int</span> random = (<span class="hljs-keyword">int</span>) (Math.random() * <span class="hljs-number">10</span>);<br>        stringBuilder.append(random);<br>    &#125;<br>    String param = stringBuilder.toString();<br>    String urlSend = host + path + <span class="hljs-string">&quot;?param=&quot;</span> + param + <span class="hljs-string">&quot;&amp;phone=&quot;</span> + phone + <span class="hljs-string">&quot;&amp;sign=&quot;</span> + sign + <span class="hljs-string">&quot;&amp;skin=&quot;</span> + skin;   <br>    <span class="hljs-keyword">try</span> &#123;<br>        URL url = <span class="hljs-keyword">new</span> URL(urlSend);<br>        HttpURLConnection httpURLCon = (HttpURLConnection) url.openConnection();<br>        httpURLCon.setRequestProperty(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">&quot;APPCODE &quot;</span> + appcode);<span class="hljs-comment">// 格式Authorization:APPCODE (中间是英文空格)</span><br>        <span class="hljs-keyword">int</span> httpCode = httpURLCon.getResponseCode();<br>        <span class="hljs-keyword">if</span> (httpCode == <span class="hljs-number">200</span>) &#123;<br>            String json = read(httpURLCon.getInputStream());<br>            System.out.println(<span class="hljs-string">&quot;正常请求计费(其他均不计费)&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;获取返回的json:&quot;</span>);<br>            System.out.print(json);<br>            <span class="hljs-keyword">return</span> ResultEntity.successWithData(param);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            Map&lt;String, List&lt;String&gt;&gt; map = httpURLCon.getHeaderFields();<br>            String error = map.get(<span class="hljs-string">&quot;X-Ca-Error-Message&quot;</span>).get(<span class="hljs-number">0</span>);<br>            <span class="hljs-keyword">if</span> (httpCode == <span class="hljs-number">400</span> &amp;&amp; error.equals(<span class="hljs-string">&quot;Invalid AppCode `not exists`&quot;</span>)) &#123;<br>                <span class="hljs-keyword">return</span> ResultEntity.failed(<span class="hljs-string">&quot;AppCode错误 &quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (httpCode == <span class="hljs-number">400</span> &amp;&amp; error.equals(<span class="hljs-string">&quot;Invalid Url&quot;</span>)) &#123;<br>                <span class="hljs-keyword">return</span> ResultEntity.failed(<span class="hljs-string">&quot;请求的 Method、Path 或者环境错误&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (httpCode == <span class="hljs-number">400</span> &amp;&amp; error.equals(<span class="hljs-string">&quot;Invalid Param Location&quot;</span>)) &#123;<br>                <span class="hljs-keyword">return</span> ResultEntity.failed(<span class="hljs-string">&quot;参数错误&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (httpCode == <span class="hljs-number">403</span> &amp;&amp; error.equals(<span class="hljs-string">&quot;Unauthorized&quot;</span>)) &#123;<br>                <span class="hljs-keyword">return</span> ResultEntity.failed(<span class="hljs-string">&quot;服务未被授权（或URL和Path不正确）&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (httpCode == <span class="hljs-number">403</span> &amp;&amp; error.equals(<span class="hljs-string">&quot;Quota Exhausted&quot;</span>)) &#123;<br>                <span class="hljs-keyword">return</span> ResultEntity.failed(<span class="hljs-string">&quot;套餐包次数用完 &quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> ResultEntity.failed(<span class="hljs-string">&quot;参数名错误 或 其他错误&quot;</span> + error);<br>            &#125;<br>        &#125;<br><br>    &#125; <span class="hljs-keyword">catch</span> (MalformedURLException e) &#123;<br>        <span class="hljs-keyword">return</span> ResultEntity.failed(<span class="hljs-string">&quot;URL格式错误&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (UnknownHostException e) &#123;<br>        <span class="hljs-keyword">return</span> ResultEntity.failed(<span class="hljs-string">&quot;URL地址错误&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        <span class="hljs-comment">// 打开注释查看详细报错异常信息</span><br>        e.printStackTrace();<br>        <span class="hljs-keyword">return</span> ResultEntity.failed(<span class="hljs-string">&quot;套餐包次数用完&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 读取返回结果</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">read</span><span class="hljs-params">(InputStream is)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    StringBuffer sb = <span class="hljs-keyword">new</span> StringBuffer();<br>    BufferedReader br = <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> InputStreamReader(is));<br>    String line = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">while</span> ((line = br.readLine()) != <span class="hljs-keyword">null</span>) &#123;<br>        line = <span class="hljs-keyword">new</span> String(line.getBytes(), <span class="hljs-string">&quot;utf-8&quot;</span>);<br>        sb.append(line);<br>    &#125;<br>    br.close();<br>    <span class="hljs-keyword">return</span> sb.toString();<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>使用yml配置文件设置发送短信需要用到的固定参数</p>
<p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 使用@ConfigurationProperties需要的依赖 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>配置实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Component</span>                                          <span class="hljs-comment">// 需要注入IOC容器</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;short.message&quot;)</span> <span class="hljs-comment">// 在yml配置文件中对应的前缀</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShortMessageProperties</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String host;<br>    <span class="hljs-keyword">private</span> String path;<br>    <span class="hljs-keyword">private</span> String appcode;<br>    <span class="hljs-keyword">private</span> String sign;<br>    <span class="hljs-keyword">private</span> String skin;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>yml配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">short</span>:<br>  message:<br>    host: https:<span class="hljs-comment">//fsmsn.market.alicloudapi.com</span><br>    path: /fsms132<br>    appcode: 1d96cd2b0d044fde8fc7c5c828dd370d<br>    sign: <span class="hljs-number">175622</span><br>    skin: <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>此时可以使用IOC中的ShortMessageProperties对象</p>
</li>
<li><p>handler方法调用工具方法，并存入redis</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MemberHandler</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ShortMessageProperties shortMessageProperties;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisRemoteService redisRemoteService;<br><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/auth/member/send/short/message.json&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">sendMessage</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;phoneNum&quot;)</span> String phoneNum)</span> </span>&#123;<br>        <span class="hljs-comment">// 发送验证码到phoneNum手机</span><br>        ResultEntity&lt;String&gt; sendShortMessage = CrowdUtils.sendShortMessage(<br>                shortMessageProperties.getHost(),<br>                shortMessageProperties.getPath(),<br>                shortMessageProperties.getAppcode(),<br>                phoneNum,<br>                shortMessageProperties.getSign(),<br>                shortMessageProperties.getSkin());<br>        <span class="hljs-comment">// 判断短信是否发送成功</span><br>        <span class="hljs-keyword">if</span> (ResultEntity.SUCCESS.equals(sendShortMessage.getResult())) &#123;<br>            <span class="hljs-comment">// 如果发送成功，将验证码存入redis</span><br>            String code = sendShortMessage.getData();<br>            <span class="hljs-comment">// 拼接存入redis的key值</span><br>            String key = CrowdConstant.REDIS_CODE_PREFIX + phoneNum;<br>            ResultEntity&lt;String&gt; saveCodeResultEntity = redisRemoteService.setRedisKeyValueWithTimeoutRemote(key, code, <span class="hljs-number">10</span>, TimeUnit.MINUTES);<br>            <span class="hljs-comment">// 判断redis中是否保存成功</span><br>            <span class="hljs-keyword">if</span> (ResultEntity.SUCCESS.equals(saveCodeResultEntity.getResult())) &#123;<br>                <span class="hljs-comment">// 保存成功则发送消息即可</span><br>                <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// 失败直接返回保存的对象</span><br>                <span class="hljs-keyword">return</span> saveCodeResultEntity;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> sendShortMessage;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>主启动类，注意需要启动fegin功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 启用fegin客户端功能</span><br><span class="hljs-meta">@EnableFeignClients</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdMainClass</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(CrowdMainClass.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>运行时需要同时启动redis和eureka服务</p>
</li>
</ul>
<h3 id="执行注册"><a href="#执行注册" class="headerlink" title="执行注册"></a>执行注册</h3><h4 id="目标-25"><a href="#目标-25" class="headerlink" title="目标"></a>目标</h4><p>如果验证码和各项信息能够通过。就将Member存入数据库。</p>
<h4 id="思路-25"><a href="#思路-25" class="headerlink" title="思路"></a>思路</h4><p><img src="/img/atcrowdfunding.assets/image-20220126144351250.png" alt="image-20220126144351250"></p>
<h4 id="前端-14"><a href="#前端-14" class="headerlink" title="前端"></a>前端</h4><ul>
<li><p>在页面添加name属性（注意和MemberVO对象属性保持一致），修改表单提交地址和请求方式，此处实例部分</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/auth/do/member/register.html&quot;</span>  <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-signin&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;form&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;message&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group has-success has-feedback&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;loginacct&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;inputSuccess4&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入登录账号&quot;</span> <span class="hljs-attr">autofocus</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-user form-control-feedback&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>	...<br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sendBtn&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-lg btn-success btn-block&quot;</span>&gt;</span> 获取验证码<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-lg btn-success btn-block&quot;</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="后端-13"><a href="#后端-13" class="headerlink" title="后端"></a>后端</h4><h5 id="mysql-provider工程实现保存操作"><a href="#mysql-provider工程实现保存操作" class="headerlink" title="mysql-provider工程实现保存操作"></a>mysql-provider工程实现保存操作</h5><ul>
<li><p>先将loginacct字段设置为unique</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> t_member <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> INDEX(loginacct);<br></code></pre></td></tr></table></figure></li>
<li><p>handler方法</p>
<p><strong>注意一定要用@RequestBody</strong>，在分布式架构中，Ribbon以json形式传输数据，在这里不会像SpringMVC一样自动寻找set方法配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/save/member/remote&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">saveMember</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> MemberPO memberPO)</span></span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        memberService.saveMember(memberPO);<br>        <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> DuplicateKeyException)&#123;<br>            <span class="hljs-keyword">return</span> ResultEntity.failed(CrowdConstant.MESSAGE_LOGIN_ACCT_ALREADY_IN_USE);<br>        &#125;<br>        <span class="hljs-comment">// 3.如果捕获到异常则返回失败的结果</span><br>        <span class="hljs-keyword">return</span> ResultEntity.failed(e.getMessage());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>saveMember接口实现</p>
<p>此时将事务只读设置为<strong>false</strong>，只有查询是只读</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Transactional(</span><br><span class="hljs-meta">        propagation = Propagation.REQUIRES_NEW,</span><br><span class="hljs-meta">        rollbackFor = Exception.class,</span><br><span class="hljs-meta">        readOnly = false</span><br><span class="hljs-meta">)</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveMember</span><span class="hljs-params">(MemberPO memberPO)</span> </span>&#123;<br>    memberPOMapper.insertSelective(memberPO);<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="api工程"><a href="#api工程" class="headerlink" title="api工程"></a>api工程</h5><ul>
<li><p>使用fegin调用，注意方法必须和provider中调用的一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(&quot;atguigu-crowd-mysql&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MysqlRemoteService</span> </span>&#123;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/get/memberpo/by/login/acct/remote&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;MemberPO&gt; <span class="hljs-title">getMemberPOByLoginAcctRemote</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;loginacct&quot;)</span> String loginacct)</span></span>;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/save/member/remote&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">saveMember</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> MemberPO memberPO)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="authentication-consumer工程"><a href="#authentication-consumer工程" class="headerlink" title="authentication-consumer工程"></a>authentication-consumer工程</h5><ul>
<li><p>创建与视图交互的MemberVO对象，注意和表单的name属性值相等，才可自动注入到MemberVO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MemberVO</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> String loginacct;<br><br>    <span class="hljs-keyword">private</span> String userpswd;<br><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-keyword">private</span> String email;<br><br>    <span class="hljs-keyword">private</span> String phoneNum;<br><br>    <span class="hljs-keyword">private</span> String code;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>handler方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> ShortMessageProperties shortMessageProperties;<br><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> RedisRemoteService redisRemoteService;<br><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> MysqlRemoteService mysqlRemoteService;<br><br><span class="hljs-meta">@RequestMapping(&quot;/auth/do/member/register.html&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">register</span><span class="hljs-params">(MemberVO memberVO, ModelMap modelMap)</span> </span>&#123;<br>    <span class="hljs-comment">// 1.获取用户手机号</span><br>    String phoneNum = memberVO.getPhoneNum();<br><br>    <span class="hljs-comment">// 2.拼redis中存储</span><br>    String redisCodeKey = CrowdConstant.REDIS_CODE_PREFIX + phoneNum;<br><br>    <span class="hljs-comment">// 3.从redis读取key对应的value</span><br>    ResultEntity&lt;String&gt; redisValueByKeyRemote = redisRemoteService.getRedisValueByKeyRemote(redisCodeKey);<br><br>    <span class="hljs-comment">// 4.检查查询操作是否有效</span><br>    <span class="hljs-comment">// 未找到验证码</span><br>    <span class="hljs-keyword">if</span> (ResultEntity.FAILED.equals(redisValueByKeyRemote.getResult())) &#123;<br>        modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, redisValueByKeyRemote.getMessage());<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;member-reg&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 获取redis中的验证码</span><br>    String redisCode = redisValueByKeyRemote.getData();<br><br>    <span class="hljs-comment">// redis中验证码为空</span><br>    <span class="hljs-keyword">if</span> (redisCode == <span class="hljs-keyword">null</span>) &#123;<br>        modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_CODE_NOT_EXISTS);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;member-reg&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// redis中验证码不为空</span><br>    <span class="hljs-keyword">if</span> (ResultEntity.SUCCESS.equals(redisValueByKeyRemote.getResult())) &#123;<br>        <span class="hljs-comment">// 5.如果从redis能够查询到value则比较表单验证码和redis验证码</span><br>        String formCode = memberVO.getCode();<br><br>        <span class="hljs-comment">// 验证码不一致</span><br>        <span class="hljs-keyword">if</span> (!Objects.equals(formCode, redisCode)) &#123;<br>            modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_CODE_INVALID);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;member-reg&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 验证码一致</span><br>        <span class="hljs-keyword">if</span> (Objects.equals(formCode, redisCode)) &#123;<br>            <span class="hljs-comment">// 6.如果验证码一致，则从redis中删除</span><br>            redisRemoteService.RemoveRedisKeyByKeyRemote(redisCode);<br><br>            <span class="hljs-comment">// 7.执行密码加密</span><br>            String userpswd = memberVO.getUserpswd();<br>            BCryptPasswordEncoder bCryptPasswordEncoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder();<br>            String passWord = bCryptPasswordEncoder.encode(userpswd);<br>            memberVO.setUserpswd(passWord);<br><br>            <span class="hljs-comment">// 8.执行保存，使用BeanUtil工具类进行属性拷贝</span><br>            MemberPO memberPO = <span class="hljs-keyword">new</span> MemberPO();<br>            BeanUtils.copyProperties(memberVO, memberPO);<br>            ResultEntity&lt;String&gt; saveMemberResultEntity = mysqlRemoteService.saveMember(memberPO);<br><br>            <span class="hljs-comment">// 保存失败</span><br>            <span class="hljs-keyword">if</span> (ResultEntity.FAILED.equals(saveMemberResultEntity.getResult())) &#123;<br>                modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, saveMemberResultEntity.getMessage());<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;member-reg&quot;</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// 使用重定向避免重复提交表单</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/auth/to/member/login/page&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>view-controller跳转登录页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdWebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;<br>        <span class="hljs-comment">// 转发请求的url路径和视图名</span><br>        String registerUrl = <span class="hljs-string">&quot;/auth/to/member/reg/page&quot;</span>;<br>        String registerViewName = <span class="hljs-string">&quot;member-reg&quot;</span>;<br>        <span class="hljs-comment">// 登录请求的url路径和视图名</span><br>        String loginUrl = <span class="hljs-string">&quot;/auth/to/member/login/page&quot;</span>;<br>        String loginViewName = <span class="hljs-string">&quot;member-login&quot;</span>;<br><br>        <span class="hljs-comment">// 前往注册页面</span><br>        registry.addViewController(registerUrl).setViewName(registerViewName);<br>        <span class="hljs-comment">// 前往登录页面</span><br>        registry.addViewController(loginUrl).setViewName(loginViewName);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>由于第一次请求redis需要建立缓存和连接，如果按照默认ribbon的工作时间来操作，第一次请求可能会导致超时，所以在yml配置文件中配置ribbon工作时间，可以避免 </p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">ribbon:</span><br>  <span class="hljs-attr">ReadTimeout:</span> <span class="hljs-number">10000</span><br>  <span class="hljs-attr">ConnectTimeout:</span> <span class="hljs-number">10000</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="会员登录"><a href="#会员登录" class="headerlink" title="会员登录"></a>会员登录</h2><h3 id="目标-26"><a href="#目标-26" class="headerlink" title="目标"></a>目标</h3><p>在用户输入账号密码后，在数据库中进行查询信息，有就跳转页面，没有需要回显错误消息。</p>
<h3 id="思路-26"><a href="#思路-26" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220126172226037.png" alt="image-20220126172226037"></p>
<h3 id="前端-15"><a href="#前端-15" class="headerlink" title="前端"></a>前端</h3><ul>
<li><p>登录页完善表单</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/auth/member/do/login.html&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-signin&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;form&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-signin-heading&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-log-in&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 用户登录<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;message&#125;&quot;</span>&gt;</span>登陆失败时显示的提示<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;session.message&#125;&quot;</span>&gt;</span>未登录时访问受限的提示<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group has-success has-feedback&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;loginacct&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;inputSuccess4&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入登录账号&quot;</span> <span class="hljs-attr">autofocus</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-user form-control-feedback&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group has-success has-feedback&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;loginpswd&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;inputSuccess4&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入登录密码&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-top:10px;&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-lock form-control-feedback&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align:right;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;reg.html&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/auth/to/member/reg/page.html&#125;&quot;</span>&gt;</span>我要注册<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-lg btn-success btn-block&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;member.html&quot;</span> &gt;</span> 登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>主页面回显用户名</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-user&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> [[$&#123;session.loginMember.username&#125;]]<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;caret&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="后端-14"><a href="#后端-14" class="headerlink" title="后端"></a>后端</h3><h4 id="authentication-consumer工程-1"><a href="#authentication-consumer工程-1" class="headerlink" title="authentication-consumer工程"></a>authentication-consumer工程</h4><ul>
<li><p>创建登录后，回显的MemberLoginVO实体</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MemberLoginVO</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Integer Id;<br><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-keyword">private</span> String email;<br><br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>handler方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/auth/member/do/login.html&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doLogin</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(&quot;loginacct&quot;)</span> String loginacct,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@RequestParam(&quot;loginpswd&quot;)</span> String userpswdForm,</span></span><br><span class="hljs-params"><span class="hljs-function">        ModelMap modelMap,</span></span><br><span class="hljs-params"><span class="hljs-function">        HttpSession session)</span> </span>&#123;<br>    <span class="hljs-comment">// 根据loginacct查找对象</span><br>    ResultEntity&lt;MemberPO&gt; memberPOResultEntity = mysqlRemoteService.getMemberPOByLoginAcctRemote(loginacct);<br><br>    <span class="hljs-comment">// 如果没有对象</span><br>    <span class="hljs-keyword">if</span> (CrowdConstant.MESSAGE_LOGIN_FAILED.equals(memberPOResultEntity.getResult())) &#123;<br>        modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, memberPOResultEntity.getMessage());<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;member-login&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// 有对象则取出对象</span><br>        MemberPO memberPO = memberPOResultEntity.getData();<br><br>        <span class="hljs-comment">// 如果取出对象为空</span><br>        <span class="hljs-keyword">if</span> (memberPO == <span class="hljs-keyword">null</span>) &#123;<br>            modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_LOGIN_FAILED);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;member-login&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 取出对象不为空，将密码进行比较</span><br>        <span class="hljs-comment">// 注意此时是密码保存是使用的盐值加密，每次加密后的值都不相同，所以不能直接使用==判断，而是用matches方法</span><br>        String userpswdDb = memberPO.getUserpswd();<br>        BCryptPasswordEncoder bCryptPasswordEncoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder();<br>        <span class="hljs-keyword">boolean</span> matches = bCryptPasswordEncoder.matches(userpswdForm, userpswdDb);<br>        <span class="hljs-keyword">if</span> (matches) &#123;<br>            <span class="hljs-comment">// 密码正确时，将数据存入封装到MemberLoginVO，并保存到session中</span><br>            MemberLoginVO memberLoginVO = <span class="hljs-keyword">new</span> MemberLoginVO(memberPO.getId(), memberPO.getUsername(), memberPO.getEmail());<br>            session.setAttribute(CrowdConstant.ATTR_NAME_LOGIN_MEMBER, memberLoginVO);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/auth/to/member/center/page&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_LOGIN_FAILED);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;member-login&quot;</span>;<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>配置view-controller，完成重定向</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 主页面请求的url路径和视图名</span><br>String centerUrl = <span class="hljs-string">&quot;/auth/to/member/center/page&quot;</span>;<br>String centerViewName = <span class="hljs-string">&quot;member-center&quot;</span>;<br><br> <span class="hljs-comment">// 前往主页面</span><br>registry.addViewController(centerUrl).setViewName(centerViewName);<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="mysql-provider工程"><a href="#mysql-provider工程" class="headerlink" title="mysql-provider工程"></a>mysql-provider工程</h4><ul>
<li><p>Mysql工程中handler的实现，提供接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/get/memberpo/by/login/acct/remote&quot;)</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;MemberPO&gt; <span class="hljs-title">getMemberPOByLoginAcctRemote</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;loginacct&quot;)</span> String loginacct)</span> </span>&#123;<br>       <span class="hljs-keyword">try</span> &#123;<br>           <span class="hljs-comment">// 1.调用本地 Service 完成查询</span><br>           MemberPO memberPO = memberService.getMemberPOByLoginAcct(loginacct);<br>           <span class="hljs-comment">// 2.如果没有抛异常，那么就返回成功的结果</span><br>           <span class="hljs-keyword">return</span> ResultEntity.successWithData(memberPO);<br>       &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>           e.printStackTrace();<br>           <span class="hljs-comment">// 3.如果捕获到异常则返回失败的结果</span><br>           <span class="hljs-keyword">return</span> ResultEntity.failed(e.getMessage());<br>       &#125;<br></code></pre></td></tr></table></figure></li>
<li><p>Mysql工程中service方法的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> MemberPO <span class="hljs-title">getMemberPOByLoginAcct</span><span class="hljs-params">(String loginacct)</span> </span>&#123;<br>    MemberPOExample memberPOExample = <span class="hljs-keyword">new</span> MemberPOExample();<br>    MemberPOExample.Criteria criteria = memberPOExample.createCriteria();<br>    criteria.andLoginacctEqualTo(loginacct);<br>    List&lt;MemberPO&gt; memberPOList = memberPOMapper.selectByExample(memberPOExample);<br>    <span class="hljs-keyword">if</span>(memberPOList == <span class="hljs-keyword">null</span> || memberPOList.size() == <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> memberPOList.get(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="api工程-1"><a href="#api工程-1" class="headerlink" title="api工程"></a>api工程</h4><ul>
<li><p>API工程中使用fegin调用Mysql工程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(&quot;atguigu-crowd-mysql&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MysqlRemoteService</span> </span>&#123;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/get/memberpo/by/login/acct/remote&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;MemberPO&gt; <span class="hljs-title">getMemberPOByLoginAcctRemote</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;loginacct&quot;)</span> String loginacct)</span></span>;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="退出登录-1"><a href="#退出登录-1" class="headerlink" title="退出登录"></a>退出登录</h2><h3 id="目标-27"><a href="#目标-27" class="headerlink" title="目标"></a>目标</h3><p>点击退出登录，返回到登录页面</p>
<h3 id="思路-27"><a href="#思路-27" class="headerlink" title="思路"></a>思路</h3><p>点击登录后，清除session</p>
<h3 id="前端-16"><a href="#前端-16" class="headerlink" title="前端"></a>前端</h3><p>修改超链接</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;index.html&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/auth/member/logout.html&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-off&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 退出系统<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="后端-15"><a href="#后端-15" class="headerlink" title="后端"></a>后端</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/auth/member/logout.html&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doLoginOut</span><span class="hljs-params">(HttpSession session)</span></span>&#123;<br>    session.invalidate();<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:http://localhost/&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="登录检查-1"><a href="#登录检查-1" class="headerlink" title="登录检查"></a>登录检查</h2><h3 id="目标-28"><a href="#目标-28" class="headerlink" title="目标"></a>目标</h3><p>把项目中必须登录才能访问的功能保护起来，如果没有登录就访问则跳转到登录页面。</p>
<h3 id="思路-28"><a href="#思路-28" class="headerlink" title="思路"></a>思路</h3><h4 id="总思路"><a href="#总思路" class="headerlink" title="总思路"></a>总思路</h4><p>使用<strong>网关的filter</strong>功能实现</p>
<p><img src="/img/atcrowdfunding.assets/image-20220127123516561.png" alt="image-20220127123516561"></p>
<h4 id="session问题"><a href="#session问题" class="headerlink" title="session问题"></a>session问题</h4><p>在分布式架构中，不同工程在不同的tomcat上，在登录时存入的session和在其他工程之间是<strong>不互通的</strong>。</p>
<p><img src="/img/atcrowdfunding.assets/image-20220127094643289.png" alt="image-20220127094643289"></p>
<p>需要使用<strong>SpringSession</strong>，会将session存入redis中，工作原理如下</p>
<p><img src="/img/atcrowdfunding.assets/image-20220127113122282.png" alt="image-20220127113122282"></p>
<h3 id="后端-16"><a href="#后端-16" class="headerlink" title="后端"></a>后端</h3><h4 id="解决session共享"><a href="#解决session共享" class="headerlink" title="解决session共享"></a>解决session共享</h4><ul>
<li><p>在<strong>zuul</strong>和<strong>authentication</strong>工程导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 引入 springboot&amp;redis 整合场景 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br><span class="hljs-comment">&lt;!-- 引入 springboot&amp;springsession 整合场景 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.session<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-session-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>在<strong>zuul</strong>和<strong>authentication</strong>工程的yml配置文件中配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">redis:</span>    <span class="hljs-comment"># 配置redis的地址</span><br>  <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.241</span><span class="hljs-number">.130</span><br><span class="hljs-attr">session:</span>  <span class="hljs-comment"># session存储的类型</span><br>  <span class="hljs-attr">store-type:</span> <span class="hljs-string">redis</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="放行静态资源"><a href="#放行静态资源" class="headerlink" title="放行静态资源"></a>放行静态资源</h4><p>创建工具类，放行静态资源和登录页以及登录请求，定义判断是否为静态资源的方法（使用截取的方法）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccessPassResources</span> </span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Set&lt;String&gt; PASS_RES_SET = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();       <span class="hljs-comment">// 放行的路径</span><br><br>    <span class="hljs-keyword">static</span> &#123;<br>        PASS_RES_SET.add(<span class="hljs-string">&quot;/&quot;</span>);<br>        PASS_RES_SET.add(<span class="hljs-string">&quot;/auth/to/member/reg/page&quot;</span>);<br>        PASS_RES_SET.add(<span class="hljs-string">&quot;/auth/to/member/login/page&quot;</span>);<br>        PASS_RES_SET.add(<span class="hljs-string">&quot;/auth/member/logout&quot;</span>);<br>        PASS_RES_SET.add(<span class="hljs-string">&quot;/auth/member/do/login&quot;</span>);<br>        PASS_RES_SET.add(<span class="hljs-string">&quot;/auth/do/member/register&quot;</span>);<br>        PASS_RES_SET.add(<span class="hljs-string">&quot;/auth/member/send/short/message.json&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Set&lt;String&gt; STATIC_RES_SET = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();    <span class="hljs-comment">// 放行的静态资源</span><br><br>    <span class="hljs-keyword">static</span> &#123;<br>        STATIC_RES_SET.add(<span class="hljs-string">&quot;bootstrap&quot;</span>);<br>        STATIC_RES_SET.add(<span class="hljs-string">&quot;css&quot;</span>);<br>        STATIC_RES_SET.add(<span class="hljs-string">&quot;fonts&quot;</span>);<br>        STATIC_RES_SET.add(<span class="hljs-string">&quot;img&quot;</span>);<br>        STATIC_RES_SET.add(<span class="hljs-string">&quot;jquery&quot;</span>);<br>        STATIC_RES_SET.add(<span class="hljs-string">&quot;layer&quot;</span>);<br>        STATIC_RES_SET.add(<span class="hljs-string">&quot;script&quot;</span>);<br>        STATIC_RES_SET.add(<span class="hljs-string">&quot;ztree&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">judgeCurrentServletPathWhetherStaticResource</span><span class="hljs-params">(String servletPath)</span></span>&#123;<br><br>        <span class="hljs-comment">// 字符串无效的情况</span><br>        <span class="hljs-keyword">if</span> (servletPath == <span class="hljs-keyword">null</span> || servletPath.length() == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(CrowdConstant.MESSAGE_STRING_INVALIDATE);<br>        &#125;<br><br>        <span class="hljs-comment">// 以”/“截取字符串</span><br>        String[] split = servletPath.split(<span class="hljs-string">&quot;/&quot;</span>);<br>        <span class="hljs-comment">// 获取的字符数组中第一个/的左边为空字符串，考虑到他的索引为0，所以我们需要一级路径判断，取索引为1的字符串</span><br>        String splitFirst = split[<span class="hljs-number">1</span>];<br>        <span class="hljs-comment">// 判断是否在静态资源中</span><br>        <span class="hljs-keyword">return</span> STATIC_RES_SET.contains(splitFirst);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="zuul工程"><a href="#zuul工程" class="headerlink" title="zuul工程"></a>zuul工程</h4><ul>
<li><p>引入工具类依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 依赖工具类 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.crowd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atcrowdfunding05-common-util<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>创建zuulFilter过滤器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdAccessFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ZuulFilter</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">filterType</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// pre表示在微服务前拦截</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;pre&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">filterOrder</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// 只有一个filter不设置次序</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">shouldFilter</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// 使用ThreadLocal线程本地化技术获取request</span><br>        RequestContext currentContext = RequestContext.getCurrentContext();<br>        HttpServletRequest request = currentContext.getRequest();<br><br>        <span class="hljs-comment">// 根据request获取请求路径</span><br>        String servletPath = request.getServletPath();<br><br>        <span class="hljs-comment">// 判断路径是否需要放行</span><br>        <span class="hljs-keyword">boolean</span> containPath = AccessPassResources.PASS_RES_SET.contains(servletPath);<br><br>        <span class="hljs-comment">// 如果路径在放行的set集合中，返回false放行</span><br>        <span class="hljs-keyword">if</span> (containPath)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 判断路径是否为静态资源</span><br>        <span class="hljs-keyword">boolean</span> currentServletPathWhetherStaticResource = AccessPassResources.judgeCurrentServletPathWhetherStaticResource(servletPath);<br><br>        <span class="hljs-comment">// 为静态资源则，返回false放行，反之则返回true执行run方法</span><br>        <span class="hljs-keyword">return</span> !currentServletPathWhetherStaticResource;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ZuulException </span>&#123;<br>        <span class="hljs-comment">// 使用ThreadLocal线程本地化技术获取request</span><br>        RequestContext currentContext = RequestContext.getCurrentContext();<br>        HttpServletRequest request = currentContext.getRequest();<br><br>        <span class="hljs-comment">// 从request中获取session对象</span><br>        HttpSession session = request.getSession();<br><br>       <span class="hljs-comment">// 从session中取出保存的登录对象</span><br>        Object loginMember =  session.getAttribute(CrowdConstant.ATTR_NAME_LOGIN_MEMBER);<br><br>        <span class="hljs-comment">// 如果没有登录对象</span><br>        <span class="hljs-keyword">if</span> (loginMember == <span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-comment">// 从 currentContext 对象中获取 Response 对象</span><br>            HttpServletResponse response = currentContext.getResponse();<br><br>            <span class="hljs-comment">// 将提示消息存入session域</span><br>            session.setAttribute(CrowdConstant.ATTR_NAME_LOGIN_MEMBER,CrowdConstant.MESSAGE_ACCESS_FORBIDEN);<br><br>            <span class="hljs-comment">// 重定向到登录页面</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// 直接重定向登录页面，而不是登录请求</span><br>                response.sendRedirect(<span class="hljs-string">&quot;/auth/to/member/login/page&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>注意yml配置文件设置，设置<strong>sensitive-headers: “*”</strong> 防止在重定向后无法保存原来的请求体和请求体（session信息）</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">zuul:</span><br>  <span class="hljs-attr">ignored-services:</span> <span class="hljs-string">&quot;*&quot;</span>              <span class="hljs-comment"># 忽略原本微服务名称</span><br>  <span class="hljs-attr">sensitive-headers:</span> <span class="hljs-string">&quot;*&quot;</span>             <span class="hljs-comment"># 在zuul向其他微服务重定向时保持原本的请求体和响应头信息</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="找不到MemberLoginVO"><a href="#找不到MemberLoginVO" class="headerlink" title="找不到MemberLoginVO"></a>找不到MemberLoginVO</h4><p>zuul工程<strong>注意依赖entity</strong>，不然会报错找不到MemberLoginVO</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 依赖entity类解决序列化bug --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.crowd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atcrowdfunding09-member-entity<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="重定向问题"><a href="#重定向问题" class="headerlink" title="重定向问题"></a>重定向问题</h4><p>分布式架构工程的端口不一致，相当于2个不同网站，在访问时会有session域不同步的问题，所以<strong>重定向统一修改问通过网关的80端口访问</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:http://localhost/...&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>此时需要修改MemberHandler中的重定向的地址，以后请求通过网关访问时，会拦截且统一保存session</p>
<h3 id="前端-17"><a href="#前端-17" class="headerlink" title="前端"></a>前端</h3><p>注意在登录页面回显zuul存入session的信息，此时的错误是在session中取得</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;session.message&#125;&quot;</span>&gt;</span>zuulfilter过滤后显示的登录提示<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h1 id="发起项目"><a href="#发起项目" class="headerlink" title="发起项目"></a>发起项目</h1><h2 id="OSS存储"><a href="#OSS存储" class="headerlink" title="OSS存储"></a>OSS存储</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul>
<li><p>创建bucket，注意<strong>一定要设置为公共读</strong></p>
<p><img src="/img/atcrowdfunding.assets/image-20220128135845767.png" alt="image-20220128135845767"></p>
</li>
<li><p>创建目录</p>
</li>
</ul>
<p><img src="/img/atcrowdfunding.assets/image-20220128135554258.png" alt="image-20220128135554258"></p>
<ul>
<li><p>上传文件</p>
<p><img src="/img/atcrowdfunding.assets/image-20220128135734986.png" alt="image-20220128135734986"></p>
</li>
</ul>
<h3 id="Java-程序调用OSS服务接口"><a href="#Java-程序调用OSS服务接口" class="headerlink" title="Java 程序调用OSS服务接口"></a>Java 程序调用OSS服务接口</h3><p><img src="/img/atcrowdfunding.assets/image-20220128140158931.png" alt="image-20220128140158931"></p>
<h4 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h4><p>访问密钥 AccessKey（AK）相当于登录密码，只是使用场景不同。AccessKey 用于程序方式调 用云服务 API，而登录密码用于登录控制台。如果您不需要调用 API，那么就不需要创建 AccessKey。 您可以使用 AccessKey 构造一个 API 请求（或者使用云服务 SDK）来操作资源。AccessKey 包 括 AccessKeyId 和 AccessKeySecret。 </p>
<p>AccessKeyId 用于标识用户，相当于账号。 </p>
<p>AccessKeySecret 是用来验证用户的密钥。AccessKeySecret 必须保密。</p>
<p><strong>禁止使用主账号AK</strong>，因为主账号AK泄露会威胁您所有资源的安全。请使用子账号（RAM 用户）AK 进行操作，可有效降低 AK 泄露的风险。</p>
<h4 id="创建子账号-AK"><a href="#创建子账号-AK" class="headerlink" title="创建子账号 AK"></a>创建子账号 AK</h4><ol>
<li><p>点击头像 -&gt; 点击AccessKey管理</p>
</li>
<li><p><img src="/img/atcrowdfunding.assets/image-20220128140433997.png" alt="image-20220128140433997"></p>
</li>
<li><p>创建用户</p>
<p><img src="/img/atcrowdfunding.assets/image-20220128140812596-16433501395251.png" alt="image-20220128140812596"></p>
<p>创建后注意记住<strong>AccessKey secret</strong>或者<strong>下载CSV文件</strong>，后边需要连接，填写验证码，即可</p>
</li>
<li><p>添加权限</p>
<p><img src="/img/atcrowdfunding.assets/image-20220128141218285.png" alt="image-20220128141218285"></p>
</li>
<li><p>授权权限</p>
<p><img src="/img/atcrowdfunding.assets/image-20220128141332996.png" alt="image-20220128141332996"></p>
<p>确定之后，就创建好了子账号</p>
</li>
<li><p>点击授权可以查看</p>
<p><img src="/img/atcrowdfunding.assets/image-20220128142652701.png" alt="image-20220128142652701"></p>
</li>
</ol>
<h4 id="将OSS引入项目"><a href="#将OSS引入项目" class="headerlink" title="将OSS引入项目"></a>将OSS引入项目</h4><ul>
<li><p>加入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.crowd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atcrowdfunding09-member-entity<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.session<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-session-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.aliyun.oss<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 测试 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>创建OSSproperties类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;aliyun.oss&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OSSProperties</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String endPoint;<br><br>    <span class="hljs-keyword">private</span> String bucketName;<br><br>    <span class="hljs-keyword">private</span> String accessKeyId;<br><br>    <span class="hljs-keyword">private</span> String accessKeySecret;<br><br>    <span class="hljs-keyword">private</span> String bucketDomain;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>yml配置文件</p>
<p>注意配置OSSproperties需要的属性<strong>aliyun.oss</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">5000</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">atguigu-crowd-project</span><br>  <span class="hljs-attr">thymeleaf:</span><br>    <span class="hljs-attr">prefix:</span> <span class="hljs-string">classpath:/templates/</span><br>    <span class="hljs-attr">suffix:</span> <span class="hljs-string">.html</span><br>  <span class="hljs-attr">redis:</span> <span class="hljs-comment"># 配置redis的地址</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.241</span><span class="hljs-number">.130</span><br>  <span class="hljs-attr">session:</span> <span class="hljs-comment"># session存储的类型</span><br>    <span class="hljs-attr">store-type:</span> <span class="hljs-string">redis</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:1000/eureka/</span><br><span class="hljs-attr">aliyun:</span><br>  <span class="hljs-attr">oss:</span><br>    <span class="hljs-attr">access-key-id:</span> <span class="hljs-string">LTAI5t7WYH9BFoPQLqciWx2D</span>   <span class="hljs-comment"># 你创建子账户的AccessKey ID</span><br>    <span class="hljs-attr">access-key-secret:</span> <span class="hljs-string">2gkfhCOoXcIQOdTxdDkXbXxjzXZOTk</span> <span class="hljs-comment"># 你创建子账户的AccessKey secret</span><br>    <span class="hljs-attr">bucket-domain:</span> <span class="hljs-string">project-atcrowdfunding.oss-cn-chengdu.aliyuncs.com</span> <span class="hljs-comment"># bucket中查找外网访问域名</span><br>    <span class="hljs-attr">bucket-name:</span> <span class="hljs-string">project-atcrowdfunding</span><br>    <span class="hljs-attr">end-point:</span> <span class="hljs-string">oss-cn-chengdu.aliyuncs.com</span><br></code></pre></td></tr></table></figure></li>
<li><p>在<strong>CrowdUtil</strong>类中添加上传工具静态方法</p>
<p>先引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.aliyun.oss<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>uploadFileToOSS方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResultEntity&lt;String&gt; <span class="hljs-title">uploadFileToOSS</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        String endPoint,</span></span><br><span class="hljs-params"><span class="hljs-function">        String accessKeyId,</span></span><br><span class="hljs-params"><span class="hljs-function">        String accessKeySecret,</span></span><br><span class="hljs-params"><span class="hljs-function">        InputStream inputStream,</span></span><br><span class="hljs-params"><span class="hljs-function">        String bucketName,</span></span><br><span class="hljs-params"><span class="hljs-function">        String bucketDomain,</span></span><br><span class="hljs-params"><span class="hljs-function">        String originalName )</span></span>&#123;<br>  <br>    <span class="hljs-comment">// 创建OSSClient实例</span><br>    OSS ossClient = <span class="hljs-keyword">new</span> OSSClientBuilder().build(endPoint,accessKeyId,accessKeySecret);<br>  <br>    <span class="hljs-comment">// 生成上传文件的目录，按照日期来划分目录</span><br>    String folderName = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyyMMdd&quot;</span>).format(<span class="hljs-keyword">new</span> Date());<br>  <br>    <span class="hljs-comment">// 生成上传文件在OSS服务器上保存的文件名,通过uuid生成随机uuid，将其中的“-”删去（替换成空字符串）</span><br>    String fileMainName = UUID.randomUUID().toString().replace(<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>  <br>    <span class="hljs-comment">// 从原始文件名中获取文件扩展名</span><br>    String extensionName = originalName.substring(originalName.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br>  <br>    <span class="hljs-comment">// 使用目录、文件主体名称、文件扩展名拼接得到对象名称</span><br>    String objectName = folderName + <span class="hljs-string">&quot;/&quot;</span> + fileMainName + extensionName;<br>  <br>  <br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// 调用OSS客户端对象的方法上传文件并获取响应结果数据</span><br>        PutObjectResult putObjectResult = ossClient.putObject(bucketName,objectName,inputStream);<br>  <br>        <span class="hljs-comment">// 从响应结果中获取具体的响应消息</span><br>        ResponseMessage responseMessage = putObjectResult.getResponse();<br>  <br>        <span class="hljs-comment">// 根据响应状态判断是否成功</span><br>        <span class="hljs-keyword">if</span> (responseMessage == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">// 拼接访问刚刚上传的文件的路径</span><br>            String ossFileAccessPath = bucketDomain + <span class="hljs-string">&quot;/&quot;</span> + objectName;<br>  <br>            <span class="hljs-comment">// 返回成功，并带上访问路径</span><br>            <span class="hljs-keyword">return</span> ResultEntity.successWithData(ossFileAccessPath);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// 获取响应状态码</span><br>            <span class="hljs-keyword">int</span> statusCode = responseMessage.getStatusCode();<br>            <span class="hljs-comment">// 没有成功 获取错误消息</span><br>            String errorMessage = responseMessage.getErrorResponseAsString();<br>  <br>            <span class="hljs-keyword">return</span> ResultEntity.failed(<span class="hljs-string">&quot;当前响应状态码=&quot;</span> + statusCode + <span class="hljs-string">&quot; 错误消息=&quot;</span> + errorMessage);<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        e.printStackTrace();<br>        <span class="hljs-keyword">return</span> ResultEntity.failed(e.getMessage());<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-comment">// 关闭OSSClient</span><br>        ossClient.shutdown();<br>    &#125;<br>  <br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="目标-29"><a href="#目标-29" class="headerlink" title="目标"></a>目标</h2><p>将各个表单页面提交的数据汇总到一起保存到数据库。</p>
<h2 id="思路-29"><a href="#思路-29" class="headerlink" title="思路"></a>思路</h2><p><img src="/img/atcrowdfunding.assets/image-20220128160654661.png" alt="image-20220128160654661"></p>
<h2 id="后端-17"><a href="#后端-17" class="headerlink" title="后端"></a>后端</h2><h3 id="逆向工程-4"><a href="#逆向工程-4" class="headerlink" title="逆向工程"></a>逆向工程</h3><ul>
<li><p>创建发起项目需要的数据库表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 分类表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_type ( <br>id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment, <br>name <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) comment <span class="hljs-string">&#x27;分类名称&#x27;</span>, <br>remark <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) comment <span class="hljs-string">&#x27;分类介绍&#x27;</span>,<br> <span class="hljs-keyword">primary</span> key (id) );<br> <br># 项目分类中间表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_project_type ( <br>id <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment, <br>projectid <span class="hljs-type">int</span>(<span class="hljs-number">11</span>), <br>typeid <span class="hljs-type">int</span>(<span class="hljs-number">11</span>), <br><span class="hljs-keyword">primary</span> key (id) );<br><br># 标签表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_tag ( <br>id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment, <br>pid <span class="hljs-type">int</span>(<span class="hljs-number">11</span>),<br> name <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),<br> <span class="hljs-keyword">primary</span> key (id) );<br> <br># 项目标签中间表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_project_tag(<br> id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment, <br>projectid <span class="hljs-type">int</span>(<span class="hljs-number">11</span>), <br>tagid <span class="hljs-type">int</span>(<span class="hljs-number">11</span>), <br><span class="hljs-keyword">primary</span> key (id) );<br><br>#项目表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_project ( <br>id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment, <br>project_name <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) comment <span class="hljs-string">&#x27;项目名称&#x27;</span>,<br>project_description <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) comment <span class="hljs-string">&#x27;项目描述&#x27;</span>,<br>money <span class="hljs-type">bigint</span> (<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;筹集金额&#x27;</span>, <br><span class="hljs-keyword">day</span> <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;筹集天数&#x27;</span>,<br>status <span class="hljs-type">int</span>(<span class="hljs-number">4</span>) comment <span class="hljs-string">&#x27;0-即将开始，1-众筹中，2-众筹成功，3-众筹失败 &#x27;</span>,<br>deploydate <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) comment <span class="hljs-string">&#x27;项目发起时间&#x27;</span>,<br>supportmoney <span class="hljs-type">bigint</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;已筹集到的金额&#x27;</span>, <br>supporter <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;支持人数&#x27;</span>, <br>completion <span class="hljs-type">int</span>(<span class="hljs-number">3</span>) comment <span class="hljs-string">&#x27;百分比完成度&#x27;</span>, <br>memberid <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;发起人的会员 id&#x27;</span>, <br>createdate <span class="hljs-type">varchar</span>(<span class="hljs-number">19</span>) comment <span class="hljs-string">&#x27;项目创建时间&#x27;</span>, <br>follower <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;关注人数&#x27;</span>, <br>header_picture_path <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) comment <span class="hljs-string">&#x27;头图路径&#x27;</span>,<br><span class="hljs-keyword">primary</span> key (id) );<br><br># 项目表项目详情图片表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_project_item_pic ( <br>id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment, <br>projectid <span class="hljs-type">int</span>(<span class="hljs-number">11</span>), <br>item_pic_path <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>), <br><span class="hljs-keyword">primary</span> key (id) );<br><br># 项目发起人信息表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_member_launch_info( <br>id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment, <br>memberid <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;会员 id&#x27;</span>, <br>description_simple <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) comment <span class="hljs-string">&#x27;简单介绍&#x27;</span>, <br>description_detail <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) comment <span class="hljs-string">&#x27;详细介绍&#x27;</span>, <br>phone_num <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) comment <span class="hljs-string">&#x27;联系电话&#x27;</span>, <br>service_num <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) comment <span class="hljs-string">&#x27;客服电话&#x27;</span>, <br><span class="hljs-keyword">primary</span> key (id) );<br><br># 回报信息表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_return ( <br>id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment, <br>projectid <span class="hljs-type">int</span>(<span class="hljs-number">11</span>), <br>type <span class="hljs-type">int</span>(<span class="hljs-number">4</span>) comment <span class="hljs-string">&#x27;0 - 实物回报， 1 虚拟物品回报&#x27;</span>, <br>supportmoney <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;支持金额&#x27;</span>, <br>content <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) comment <span class="hljs-string">&#x27;回报内容&#x27;</span>, <br>count <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;回报产品限额，“0”为不限回报数量&#x27;</span>, <br>signalpurchase <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;是否设置单笔限购&#x27;</span>, <br>purchase <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;具体限购数量&#x27;</span>, <br>freight <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;运费，“0”为包邮&#x27;</span>, <br>invoice <span class="hljs-type">int</span>(<span class="hljs-number">4</span>) comment <span class="hljs-string">&#x27;0 - 不开发票， 1 - 开发票&#x27;</span>, <br>returndate <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;项目结束后多少天向支持者发送回报&#x27;</span>, <br>describ_pic_path <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) comment <span class="hljs-string">&#x27;说明图片路径&#x27;</span>, <br><span class="hljs-keyword">primary</span> key (id) );<br><br># 发起人确认信息表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_member_confirm_info ( <br>id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment, memberid <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;会员 id&#x27;</span>, <br>paynum <span class="hljs-type">varchar</span>(<span class="hljs-number">200</span>) comment <span class="hljs-string">&#x27;易付宝企业账号&#x27;</span>, <br>cardnum <span class="hljs-type">varchar</span>(<span class="hljs-number">200</span>) comment <span class="hljs-string">&#x27;法人身份证号&#x27;</span>, <br><span class="hljs-keyword">primary</span> key (id) );<br></code></pre></td></tr></table></figure></li>
<li><p>逆向工程</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 数据库表名与需要的实体类对应映射的指定 --&gt;</span><br><span class="hljs-comment">&lt;!-- 数据库表名字和我们的 entity 类对应的映射指定 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_type&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;TypePO&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_tag&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;TagPO&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_project&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;ProjectPO&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_project_item_pic&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;ProjectItemPicPO&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_member_launch_info&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;MemberLaunchInfoPO&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_return&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;ReturnPO&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_member_confirm_info&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;MemberConfirmInfoPO&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>将实体类放在entity包中，接口和xml文件放在mysql-provider工程对应的包中</p>
</li>
</ul>
<h3 id="创建VO对象"><a href="#创建VO对象" class="headerlink" title="创建VO对象"></a>创建VO对象</h3><p>可通过尚筹网资料获取VO对象</p>
<p><img src="/img/atcrowdfunding.assets/image-20220128124209699.png" alt="image-20220128124209699"></p>
<h3 id="跳转页面"><a href="#跳转页面" class="headerlink" title="跳转页面"></a>跳转页面</h3><h4 id="我的众筹页面跳转"><a href="#我的众筹页面跳转" class="headerlink" title="我的众筹页面跳转"></a>我的众筹页面跳转</h4><ul>
<li><p>在auth工程的wen配置类添加,跳转到众筹页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 众筹页面请求的url路径和视图名</span><br>String crowdUrl = <span class="hljs-string">&quot;/member/my/crowd&quot;</span>;<br>String crowdViewName = <span class="hljs-string">&quot;member-crowd&quot;</span>;<br><span class="hljs-comment">// 前往众筹页面</span><br>registry.addViewController(crowdUrl).setViewName(crowdViewName);<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="发起众筹页面跳转"><a href="#发起众筹页面跳转" class="headerlink" title="发起众筹页面跳转"></a>发起众筹页面跳转</h4><ul>
<li><p>在zuul的yml配置文件中配置访问project工程的path</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">crowd-project:</span>                              <span class="hljs-comment"># 自定义路由规则名称</span><br>  <span class="hljs-attr">service-id:</span> <span class="hljs-string">atguigu-crowd-project</span>         <span class="hljs-comment"># 微服务名称</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">/project/**</span>                         <span class="hljs-comment"># auth已经通过/**访问，此时需要加个/project</span><br></code></pre></td></tr></table></figure></li>
<li><p>前端通过 Zuul 访问具体功能才能够保持 Cookie，进而保持 Session 一致，此时在project中创建web配置，设置view-controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;<br>  <span class="hljs-comment">// 重定向跳转页面</span><br>        registry.addViewController(<span class="hljs-string">&quot;/agree/portal/page&quot;</span>).setViewName(<span class="hljs-string">&quot;project-agree&quot;</span>);<br>        registry.addViewController(<span class="hljs-string">&quot;/launch/project/page&quot;</span>).setViewName(<span class="hljs-string">&quot;project-launch&quot;</span>);<br>        registry.addViewController(<span class="hljs-string">&quot;/return/project/page&quot;</span>).setViewName(<span class="hljs-string">&quot;project-return&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="接收发起项目表单数据"><a href="#接收发起项目表单数据" class="headerlink" title="接收发起项目表单数据"></a>接收发起项目表单数据</h3><ul>
<li><p>表单提交地址</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;projectForm&quot;</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/project/create/project/information&#125;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-horizontal&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>handler方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProjectConsumerHandler</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OSSProperties ossProperties;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/create/project/information&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">saveProjectBasicInfo</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            // 接收表单的部分信息</span></span><br><span class="hljs-params"><span class="hljs-function">            ProjectVO projectVO,</span></span><br><span class="hljs-params"><span class="hljs-function">            // 接收上传的头图</span></span><br><span class="hljs-params"><span class="hljs-function">            MultipartFile headerPicture,</span></span><br><span class="hljs-params"><span class="hljs-function">            // 接收项目详情图片</span></span><br><span class="hljs-params"><span class="hljs-function">            List&lt;MultipartFile&gt; detailPictureList,</span></span><br><span class="hljs-params"><span class="hljs-function">            // 将收集的一部分数据的ProjectVO保存到session</span></span><br><span class="hljs-params"><span class="hljs-function">            HttpSession session,</span></span><br><span class="hljs-params"><span class="hljs-function">            // 将错误信息保存到ModelMap中</span></span><br><span class="hljs-params"><span class="hljs-function">            ModelMap modelMap</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br><br>        <span class="hljs-comment">// 如果头图为空，返回错误信息</span><br>        <span class="hljs-keyword">if</span> (headerPicture.isEmpty()) &#123;<br>            <span class="hljs-comment">// 返回错误消息</span><br>            modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_HEADER_PIC_EMPTY);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;project-launch&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 将头图上传到OSS上</span><br><br>        ResultEntity&lt;String&gt; resultEntity = CrowdUtils.uploadFileToOSS(<br>                ossProperties.getEndPoint(),<br>                ossProperties.getAccessKeyId(),<br>                ossProperties.getAccessKeySecret(),<br>                headerPicture.getInputStream(),<br>                ossProperties.getBucketName(),<br>                ossProperties.getBucketDomain(),<br>                headerPicture.getOriginalFilename()<br>        );<br><br>        <span class="hljs-keyword">if</span> (ResultEntity.FAILED.equals(resultEntity.getResult())) &#123;<br>            <span class="hljs-comment">// 上传失败则显示错误信息</span><br>            modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_HEADER_PIC_UPLOAD_FAILED);<br>            <span class="hljs-comment">// 返回上一页面</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;project-launch&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 上传成功将信息保存到projectVO中</span><br>        String data = resultEntity.getData();<br>        projectVO.setHeaderPicturePath(data);<br><br><br>        <span class="hljs-comment">// 将详情图片上传到OSS</span><br>        <span class="hljs-comment">// 创建存放图片地址的list集合</span><br>        List&lt;String&gt; detailPicturePathList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br><br>        <span class="hljs-comment">// 判断详情图片是否为空</span><br>        <span class="hljs-keyword">if</span> (detailPictureList == <span class="hljs-keyword">null</span> || detailPictureList.isEmpty()) &#123;<br>            <span class="hljs-comment">// 上传失败则显示错误信息</span><br>            modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_DETAIL_PIC_EMPTY);<br>            <span class="hljs-comment">// 返回上一页面</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;project-launch&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 图片不为空，遍历详情图片</span><br>        <span class="hljs-keyword">for</span> (MultipartFile detailPicture : detailPictureList) &#123;<br>            <span class="hljs-comment">// 判断当前图片是否有效</span><br>            <span class="hljs-keyword">if</span> (detailPicture == <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-comment">// 上传失败则显示错误信息</span><br>                modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_DETAIL_PIC_EMPTY);<br>                <span class="hljs-comment">// 返回上一页面</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;project-launch&quot;</span>;<br>            &#125;<br><br>            ResultEntity&lt;String&gt; detailPictureResultEntity = CrowdUtils.uploadFileToOSS(<br>                    ossProperties.getEndPoint(),<br>                    ossProperties.getAccessKeyId(),<br>                    ossProperties.getAccessKeySecret(),<br>                    detailPicture.getInputStream(),<br>                    ossProperties.getBucketName(),<br>                    ossProperties.getBucketDomain(),<br>                    detailPicture.getOriginalFilename()<br>            );<br><br>            <span class="hljs-keyword">if</span> (ResultEntity.FAILED.equals(detailPictureResultEntity.getResult())) &#123;<br>                <span class="hljs-comment">// 上传失败则显示错误信息</span><br>                modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_DETAIL_PIC_UPLOAD_FAILED);<br>                <span class="hljs-comment">// 返回上一页面</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;project-launch&quot;</span>;<br>            &#125;<br><br>            <span class="hljs-comment">// 保存成功将路径存入list</span><br>            String pictureResultEntityData = detailPictureResultEntity.getData();<br>            detailPicturePathList.add(pictureResultEntityData);<br>        &#125;<br><br>        <span class="hljs-comment">// 将图片路径list集合保存在projectVO中</span><br>        projectVO.setDetailPicturePathList(detailPicturePathList);<br><br>        <span class="hljs-comment">// 将projectVO对象存入session域</span><br>        session.setAttribute(CrowdConstant.ATTR_NAME_TEMPLE_PROJECT, projectVO);<br><br>        <span class="hljs-comment">// 以网关的路径来重定向到return页面，才能保持session信息</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:http://localhost/project/return/project/page&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="收集回报信息"><a href="#收集回报信息" class="headerlink" title="收集回报信息"></a>收集回报信息</h3><ul>
<li><p>前端流程</p>
<p><img src="/img/atcrowdfunding.assets/image-20220129210206479.png" alt="image-20220129210206479"></p>
</li>
<li><p>ajax请求保存照片</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/create/upload/return/picture.json&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">uploadReturnPicture</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;returnPicture&quot;)</span> MultipartFile returnPicture)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    <span class="hljs-comment">// 判断是否是有效上传</span><br>    <span class="hljs-keyword">boolean</span> pictureIsEmpty = returnPicture.isEmpty();<br>    <span class="hljs-keyword">if</span> (pictureIsEmpty)&#123;<br>        <span class="hljs-comment">// 如果上传文件为空</span><br>        ResultEntity.failed(CrowdConstant.MESSAGE_RETURN_PIC_EMPTY);<br>    &#125;<br><br>    <span class="hljs-comment">// 执行文件上传</span><br>    ResultEntity&lt;String&gt; returnPictureEntity = CrowdUtils.uploadFileToOSS(<br>            ossProperties.getEndPoint(),<br>            ossProperties.getAccessKeyId(),<br>            ossProperties.getAccessKeySecret(),<br>            returnPicture.getInputStream(),<br>            ossProperties.getBucketName(),<br>            ossProperties.getBucketDomain(),<br>            returnPicture.getOriginalFilename()<br>    );<br></code></pre></td></tr></table></figure></li>
<li><p>保存回报表单信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@RequestMapping(&quot;/create/save/return.json&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">saveReturn</span><span class="hljs-params">(ReturnVO returnVO, HttpSession session)</span> </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// 从session中取出刚才保存的projectVO，需要进行强转</span><br>        ProjectVO projectVO = (ProjectVO) session.getAttribute(CrowdConstant.ATTR_NAME_TEMPLE_PROJECT);<br><br>        <span class="hljs-comment">// 判断return数据是否为空</span><br>        <span class="hljs-keyword">if</span> (returnVO == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> ResultEntity.failed(CrowdConstant.MESSAGE_TEMPLE_PROJECT_MISSING);<br>        &#125;<br><br>        <span class="hljs-comment">// 获取projectVO中的renturnVO</span><br>        List&lt;ReturnVO&gt; returnVOList = projectVO.getReturnVOList();<br><br>        <span class="hljs-comment">// 如果returnVOList为空</span><br>        <span class="hljs-keyword">if</span> (returnVOList == <span class="hljs-keyword">null</span> || returnVOList.size() == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// 初始化List</span><br>            returnVOList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>            projectVO.setReturnVOList(returnVOList);<br>        &#125;<br><br>        <span class="hljs-comment">// returnVOList不为空,将值追加进去</span><br>        returnVOList.add(returnVO);<br><br>        <span class="hljs-comment">// 重新把projectVO存入session中</span><br>        session.setAttribute(CrowdConstant.ATTR_NAME_TEMPLE_PROJECT, projectVO);<br><br>        <span class="hljs-comment">// 返回结果集</span><br>        <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br><br>    &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>        exception.printStackTrace();<br>        <span class="hljs-comment">// 返回失败的结果集</span><br>        <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="点击下一步跳转"><a href="#点击下一步跳转" class="headerlink" title="点击下一步跳转"></a>点击下一步跳转</h3><ul>
<li><p>修改超链接标签</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/project/create/confirm/page&#125;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-warning btn-lg&quot;</span>&gt;</span>下一步<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>配置view-controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">registry.addViewController(<span class="hljs-string">&quot;/create/confirm/page&quot;</span>).setViewName(<span class="hljs-string">&quot;project-confirm&quot;</span>);<br></code></pre></td></tr></table></figure></li>
<li><p>修改project-confirm页面</p>
</li>
</ul>
<h3 id="点击提交按钮确认表单"><a href="#点击提交按钮确认表单" class="headerlink" title="点击提交按钮确认表单"></a>点击提交按钮确认表单</h3><ul>
<li><p>在project-confirm页面修改表单提交信息，绑定提交单击事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;confirmForm&quot;</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/project/create/confirm&#125;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;form&quot;</span>&gt;</span><br>    <br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span><br><span class="javascript">  $(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;</span><br><span class="javascript">     $(<span class="hljs-string">&quot;#submitBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;</span><br><span class="javascript">     $(<span class="hljs-string">&quot;#confirmForm&quot;</span>).submit();</span><br><span class="javascript">     &#125;);</span><br><span class="javascript">   &#125;);</span><br><span class="javascript">  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;submitBtn&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-warning btn-lg&quot;</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>收集表单数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/create/confirm&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">saveConfirm</span><span class="hljs-params">(MemberConfirmInfoVO memberConfirmInfoVO, HttpSession session, ModelMap modelMap)</span> </span>&#123;<br><br>    <span class="hljs-comment">// 从session域读取之前的projectVO</span><br>    ProjectVO projectVO = (ProjectVO) session.getAttribute(CrowdConstant.ATTR_NAME_TEMPLE_PROJECT);<br><br>    <span class="hljs-comment">// 判断是否为空</span><br>    <span class="hljs-keyword">if</span> (projectVO == <span class="hljs-keyword">null</span>) &#123;<br>     <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(CrowdConstant.MESSAGE_TEMPLE_PROJECT_MISSING);<br>    &#125;<br><br>    <span class="hljs-comment">// 将确认的信息保存在projectVO中</span><br>    projectVO.setMemberConfirmInfoVO(memberConfirmInfoVO);<br><br>    <span class="hljs-comment">// 从session域读取当前访问的用户</span><br>    MemberLoginVO memberLoginVO = (MemberLoginVO) session.getAttribute(CrowdConstant.ATTR_NAME_LOGIN_MEMBER);<br><br>    <span class="hljs-comment">// 从中取出保存进去的id值，进而保存在数据库中</span><br>    Integer memberLoginVOId = memberLoginVO.getId();<br><br>    <span class="hljs-comment">// 调用mysql的方法将projectVO保存到数据库中</span><br>    ResultEntity resultEntity = mysqlRemoteService.saveProjectVORemote(projectVO , memberLoginVOId);<br><br>    <span class="hljs-comment">// 保存失败，将错误信息保存到modelMap中</span><br>    <span class="hljs-keyword">if</span> (ResultEntity.SUCCESS.equals(resultEntity.getResult())) &#123;<br>        modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE,resultEntity.getMessage());<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;project-confirm&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 保存好后将session域清空</span><br>    session.removeAttribute(CrowdConstant.MESSAGE_TEMPLE_PROJECT_MISSING);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:http://localhost/projetc/create/success/page&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>声明mysql的fegin接口，注意<strong>实体类一定要使用@RequestBody</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/save/projectvo/remote&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity <span class="hljs-title">saveProjectVORemote</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ProjectVO projectVO,<span class="hljs-meta">@RequestParam(&quot;memberLoginVOId&quot;)</span> Integer memberLoginVOId)</span></span>;<br></code></pre></td></tr></table></figure></li>
<li><p>在ProjectConsumerHandler的主启动类开启fegin代理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableFeignClients</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdMainClass</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(CrowdMainClass.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="把项目信息保存到数据库"><a href="#把项目信息保存到数据库" class="headerlink" title="把项目信息保存到数据库"></a>把项目信息保存到数据库</h3><ul>
<li><p>mysql-provider工程ProjectProviderHandler方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/save/projectvo/remote&quot;)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">saveProjectVORemote</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ProjectVO projectVO, <span class="hljs-meta">@RequestParam(&quot;memberLoginVOId&quot;)</span> Integer memberLoginVOId)</span> </span>&#123;<br>  <br>      <span class="hljs-keyword">try</span> &#123;<br>          <span class="hljs-comment">// 调用service方法进行保存</span><br>          projectService.saveProject(projectVO, memberLoginVOId);<br>  <br>          <span class="hljs-comment">// 返回结果</span><br>          <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>      &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>          exception.printStackTrace();<br>          <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>      &#125;<br>  &#125;<br></code></pre></td></tr></table></figure></li>
<li><p>保存信息ProjectService接口的实现</p>
<p>注意需要修改projectPOMapper.xml文件的insertSelective方法添加 <strong>useGeneratedKeys=”true” keyProperty=”id”</strong>,来获取projectId</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Transactional(readOnly = true)</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProjectServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ProjectService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ReturnPOMapper returnPOMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MemberConfirmInfoPOMapper memberConfirmInfoPOMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MemberLaunchInfoPOMapper memberLaunchInfoPOMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ProjectPOMapper projectPOMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ProjectItemPicPOMapper projectItemPicPOMapper;<br><br>    <span class="hljs-meta">@Transactional(readOnly = false, rollbackFor = Exception.class, propagation = Propagation.REQUIRES_NEW)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveProject</span><span class="hljs-params">(ProjectVO projectVO, Integer memberLoginVOId)</span> </span>&#123;<br><br>        <span class="hljs-comment">// 一：保存projectPO信息</span><br>        <span class="hljs-comment">// 1.创建projectPO对象</span><br>        ProjectPO projectPO = <span class="hljs-keyword">new</span> ProjectPO();<br>        <span class="hljs-comment">// 2.将projectVO的值赋值给projectPO</span><br>        BeanUtils.copyProperties(projectVO, projectPO);<br>        <span class="hljs-comment">// 3.把memberID设置到projectPO中</span><br>        projectPO.setMemberid(memberLoginVOId);<br>        <span class="hljs-comment">// 4.生成创建的时间</span><br>        String createdate = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>).format(<span class="hljs-keyword">new</span> Date());<br>        projectPO.setCreatedate(createdate);<br>        <span class="hljs-comment">// 5.status设置为0，表示即将开始</span><br>        projectPO.setStatus(<span class="hljs-number">0</span>);<br>        <span class="hljs-comment">// 6.保存projectPO对象,为了获取projectPO的id属性，需要修改xml配置文件添加 useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot;</span><br>        projectPOMapper.insertSelective(projectPO);<br>        <span class="hljs-comment">// 7.获取id属性</span><br>        Integer projectId = projectPO.getId();<br><br>        <span class="hljs-comment">// 二： 保存项目分类的关联的相关信息</span><br>        <span class="hljs-comment">// 1.从projectVO中获取typeIdList</span><br>        List&lt;Integer&gt; typeIdList = projectVO.getTypeIdList();<br>        <span class="hljs-comment">// 2.保存typeIdList</span><br>        projectPOMapper.insertTypeRelationship(typeIdList, projectId);<br><br>        <span class="hljs-comment">// 三：保存项目标签的关联的相关信息</span><br>        <span class="hljs-comment">// 1.从projectVO中获取typeIdList</span><br>        List&lt;Integer&gt; tagIdList = projectVO.getTagIdList();<br>        <span class="hljs-comment">// 2.保存tagIdList</span><br>        projectPOMapper.insertTagRelationship(tagIdList, projectId);<br><br>        <span class="hljs-comment">// 四：保存详情图片路径</span><br>        <span class="hljs-comment">// 1.从projectVO中获取detailPicturePathList</span><br>        List&lt;String&gt; detailPicturePathList = projectVO.getDetailPicturePathList();<br>        <span class="hljs-comment">// 2.保存detailPicturePathList</span><br>        projectItemPicPOMapper.insertPathList(projectId, detailPicturePathList);<br><br>        <span class="hljs-comment">// 五：保存项目发起人信息</span><br>        MemberLauchInfoVO memberLauchInfoVO = projectVO.getMemberLauchInfoVO();<br>        MemberLaunchInfoPO memberLaunchInfoPO = <span class="hljs-keyword">new</span> MemberLaunchInfoPO();<br>        BeanUtils.copyProperties(memberLauchInfoVO, memberLaunchInfoPO);<br>        memberLaunchInfoPO.setMemberid(projectId);<br>        memberLaunchInfoPOMapper.insert(memberLaunchInfoPO);<br><br>        <span class="hljs-comment">// 六：保存项目回报信息</span><br>        List&lt;ReturnVO&gt; returnVOList = projectVO.getReturnVOList();<br>        ArrayList&lt;ReturnPO&gt; returnPOList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (ReturnVO returnVO : returnVOList) &#123;<br>            ReturnPO returnPO = <span class="hljs-keyword">new</span> ReturnPO();<br>            BeanUtils.copyProperties(returnVO , returnPO);<br>            returnPOList.add(returnPO);<br>        &#125;<br>        returnPOMapper.insertReturnPOBatch(returnPOList , projectId);<br><br>        <span class="hljs-comment">// 七：保存项目确认信息</span><br>        MemberConfirmInfoVO memberConfirmInfoVO = projectVO.getMemberConfirmInfoVO();<br>        MemberConfirmInfoPO memberConfirmInfoPO = <span class="hljs-keyword">new</span> MemberConfirmInfoPO();<br>        BeanUtils.copyProperties(memberConfirmInfoVO, memberConfirmInfoPO);<br>        memberConfirmInfoPO.setMemberid(projectId);<br>        memberConfirmInfoPOMapper.insert(memberConfirmInfoPO);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>对应需要添加的sql语句</p>
<ul>
<li><p>ProjectPOMapper接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insertTypeRelationship</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;typeIdList&quot;)</span> List&lt;Integer&gt; typeIdList, <span class="hljs-meta">@Param(&quot;projectId&quot;)</span> Integer projectId)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insertTagRelationship</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;tagIdList&quot;)</span> List&lt;Integer&gt; tagIdList, <span class="hljs-meta">@Param(&quot;projectId&quot;)</span> Integer projectId)</span></span>;<br></code></pre></td></tr></table></figure>

<p>ProjectPOMapper.xml文件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">insert</span> id<span class="hljs-operator">=</span>&quot;insertTypeRelationship&quot;<span class="hljs-operator">&gt;</span><br>    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_project_type(`projectid`,`typeid`) <span class="hljs-keyword">values</span><br>    <span class="hljs-operator">&lt;</span>foreach collection<span class="hljs-operator">=</span>&quot;typeIdList&quot; item<span class="hljs-operator">=</span>&quot;typeId&quot; separator<span class="hljs-operator">=</span>&quot;,&quot;<span class="hljs-operator">&gt;</span><br>        (#&#123;projectId&#125; , #&#123;typeId&#125;)<br>    <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>foreach<span class="hljs-operator">&gt;</span><br><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">insert</span><span class="hljs-operator">&gt;</span><br><br><span class="hljs-operator">&lt;</span><span class="hljs-keyword">insert</span> id<span class="hljs-operator">=</span>&quot;insertTagRelationship&quot;<span class="hljs-operator">&gt;</span><br>    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_project_tag(`projectid`,`tagid`) <span class="hljs-keyword">values</span><br>    <span class="hljs-operator">&lt;</span>foreach collection<span class="hljs-operator">=</span>&quot;tagIdList&quot; item<span class="hljs-operator">=</span>&quot;tagId&quot; separator<span class="hljs-operator">=</span>&quot;,&quot;<span class="hljs-operator">&gt;</span><br>        (#&#123;projectId&#125; , #&#123;tagId&#125;)<br>    <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>foreach<span class="hljs-operator">&gt;</span><br><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">insert</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>ProjectItemPicPOMapper接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insertPathList</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;projectId&quot;)</span> Integer projectId,<span class="hljs-meta">@Param(&quot;detailPicturePathList&quot;)</span> List&lt;String&gt; detailPicturePathList)</span></span>;<br></code></pre></td></tr></table></figure>

<p>ProjectItemPicPOMapper.xml文件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">insert</span> id<span class="hljs-operator">=</span>&quot;insertPathList&quot;<span class="hljs-operator">&gt;</span><br>    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_project_item_pic(projectid, item_pic_path) <span class="hljs-keyword">values</span><br>    <span class="hljs-operator">&lt;</span>foreach collection<span class="hljs-operator">=</span>&quot;detailPicturePathList&quot; item<span class="hljs-operator">=</span>&quot;detailPath&quot; separator<span class="hljs-operator">=</span>&quot;,&quot;<span class="hljs-operator">&gt;</span><br>        (#&#123;projectId&#125; , #&#123;detailPath&#125;)<br>    <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>foreach<span class="hljs-operator">&gt;</span><br><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">insert</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>ReturnPOMapper接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insertReturnPOBatch</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;returnPOList&quot;)</span> ArrayList&lt;ReturnPO&gt; returnPOList,<span class="hljs-meta">@Param(&quot;projectId&quot;)</span> Integer projectId)</span></span>;<br></code></pre></td></tr></table></figure>

<p>ReturnPOMapper.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertReturnPOBatch&quot;</span>&gt;</span><br>    insert into t_return (<br>          projectid,<br>          type,<br>          supportmoney,<br>          content,<br>          count,<br>          signalpurchase,<br>          purchase,<br>          freight,<br>          invoice,<br>          returndate,<br>          describ_pic_path)<br>          values<br><span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;returnPOList&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;returnPO&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span><br>  (<br>   #&#123;projectId&#125;,<br>   #&#123;returnPO.type&#125;,<br>   #&#123;returnPO.supportmoney&#125;,<br>   #&#123;returnPO.content&#125;,<br>   #&#123;returnPO.count&#125;,<br>   #&#123;returnPO.signalpurchase&#125;,<br>   #&#123;returnPO.purchase&#125;,<br>   #&#123;returnPO.freight&#125;,<br>   #&#123;returnPO.invoice&#125;,<br>   #&#123;returnPO.returndate&#125;,<br>   #&#123;returnPO.describPicPath&#125;<br>  )<br><span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="前端-18"><a href="#前端-18" class="headerlink" title="前端"></a>前端</h2><ul>
<li><p>member-center页面添加超链接</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;list-group-item &quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;cursor:pointer;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/member/my/crowd&#125;&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration: none&quot;</span>&gt;</span>我的众筹<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;badge&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-chevron-right&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>member-crowd页面添加跳转地址，前面要写上域名（如果没有配置域名写 localhost 一样），确保通过Zuul 访问具体功能。 </p>
<p>因为必须通过 Zuul 访问具体功能才能够保持 Cookie，进而保持 Session 一致</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-warning&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;window.location.href=&#x27;http://localhost/project/agree/portal/page&#x27;&quot;</span>&gt;</span><br>    发起众筹<br><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>project-agree页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;panel-footer&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align:center;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-warning btn-lg&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;project/launch/project/page&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;http://localhost/project/launch/project/page&#125;&quot;</span>&gt;</span>阅读并同意协议<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="展示项目"><a href="#展示项目" class="headerlink" title="展示项目"></a>展示项目</h1><h2 id="目标-30"><a href="#目标-30" class="headerlink" title="目标"></a>目标</h2><p>在主页面上加载保存在数据库中真实的数据，按分类显示。</p>
<h2 id="思路-30"><a href="#思路-30" class="headerlink" title="思路"></a>思路</h2><p><img src="/img/atcrowdfunding.assets/image-20220130132931473.png" alt="image-20220130132931473"></p>
<h2 id="后端-18"><a href="#后端-18" class="headerlink" title="后端"></a>后端</h2><h3 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h3><ul>
<li><p>PortalTypeVO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PortalTypeVO</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String remark;<br><br>    <span class="hljs-keyword">private</span> List&lt;PortalProjectVO&gt; portalProjectVOList;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>PortalProjectVO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PortalProjectVO</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Integer projectId;<br>    <span class="hljs-keyword">private</span> String projectName;<br>    <span class="hljs-keyword">private</span> String headerPicturePath;<br>    <span class="hljs-keyword">private</span> Integer money;<br>    <span class="hljs-keyword">private</span> String deployDate;<br>    <span class="hljs-keyword">private</span> Integer percentage;<br>    <span class="hljs-keyword">private</span> Integer supporter;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="sql语句查询显示信息"><a href="#sql语句查询显示信息" class="headerlink" title="sql语句查询显示信息"></a>sql语句查询显示信息</h3><ul>
<li><p>ProjectPOMapper接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function">List&lt;PortalTypeVO&gt; <span class="hljs-title">selectPortalTypeVOList</span><span class="hljs-params">()</span></span>;<br></code></pre></td></tr></table></figure></li>
<li><p>ProjectPOMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;loadPortalProjectListResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.atguigu.crowd.entity.vo.PortalTypeVO&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 查询type中的属性值 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;remark&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;remark&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 通过id查询project的信息 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;portalProjectVOList&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;selectPortalProjectVOList&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectPortalTypeVOList&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;loadPortalProjectListResultMap&quot;</span>&gt;</span><br>    select id, name, remark<br>    from t_type<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectPortalProjectVOList&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.atguigu.crowd.entity.vo.PortalProjectVO&quot;</span>&gt;</span><br>        select t_project.id                                  projectId,<br>               t_project.project_name                        projectName,<br>               t_project.header_picture_path                 headerPicturePath,<br>               t_project.money                               money,<br>               t_project.deploydate                          deployDate,<br>               (t_project.supporter / t_project.money) * 100 percentage,<br>               t_project.supporter                           supporter<br>        from t_project<br>                 LEFT JOIN t_project_type on t_project.id = t_project_type.projectid<br>        where t_project_type.typeid = #&#123;id&#125;<br>        ORDER BY t_project.id DESC LIMIT 0,4;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Service接口和实现"><a href="#Service接口和实现" class="headerlink" title="Service接口和实现"></a>Service接口和实现</h3><ul>
<li><p>ProjectService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function">List&lt;PortalTypeVO&gt; <span class="hljs-title">selectPortalTypeVOList</span><span class="hljs-params">()</span></span>;<br></code></pre></td></tr></table></figure></li>
<li><p>ProjectServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;PortalTypeVO&gt; <span class="hljs-title">selectPortalTypeVOList</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> projectPOMapper.selectPortalTypeVOList();<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Mysql工程handler方法"><a href="#Mysql工程handler方法" class="headerlink" title="Mysql工程handler方法"></a>Mysql工程handler方法</h3><ul>
<li><p>调用service方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/get/portal/type/project/data/remote&quot;)</span><br><span class="hljs-keyword">public</span> ResultEntity&lt;List&lt;PortalTypeVO&gt;&gt; getPortalTypeVOList() &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        List&lt;PortalTypeVO&gt; portalTypeVOList = projectService.selectPortalTypeVOList();<br>        <span class="hljs-keyword">return</span> ResultEntity.successWithData(portalTypeVOList);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>        exception.printStackTrace();<br>        <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="api工程-2"><a href="#api工程-2" class="headerlink" title="api工程"></a>api工程</h3><ul>
<li><p>暴露接口，注意和mysql工程中一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/get/portal/type/project/data/remote&quot;)</span><br><span class="hljs-keyword">public</span> ResultEntity&lt;List&lt;PortalTypeVO&gt;&gt; getPortalTypeVOList();<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="处理页面请求handler"><a href="#处理页面请求handler" class="headerlink" title="处理页面请求handler"></a>处理页面请求handler</h3><ul>
<li><p>将数据存入model中，显示到页面上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">PortalPage</span><span class="hljs-params">(Model model)</span> </span>&#123;<br><br>    <span class="hljs-comment">// 调用远程mysql工程方法</span><br>    ResultEntity&lt;List&lt;PortalTypeVO&gt;&gt; portalTypeVOListEntity = mysqlRemoteService.getPortalTypeVOList();<br><br>    <span class="hljs-comment">// 判断是否查询成功</span><br>    <span class="hljs-keyword">if</span> (ResultEntity.SUCCESS.equals(portalTypeVOListEntity.getResult())) &#123;<br>        <span class="hljs-comment">// 将数据存入model用于前端显示</span><br>        List&lt;PortalTypeVO&gt; portalTypeVOList = portalTypeVOListEntity.getData();<br>        model.addAttribute(CrowdConstant.ATTR_NAME_PORTAL_TYPE_LIST, portalTypeVOList);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;portal&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="前端-19"><a href="#前端-19" class="headerlink" title="前端"></a>前端</h2><ul>
<li><p>根据modal中的数据，显示页面信息</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;#strings.isEmpty(portal_data)&#125;&quot;</span>&gt;</span>未能找到分类信息<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;not #strings.isEmpty(portal_data)&#125;&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;type : $&#123;portal_data&#125;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row clearfix&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-md-12 column&quot;</span>&gt;</span><br>                  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;box ui-draggable&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;mainBox&quot;</span>&gt;</span><br>                      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mHd&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>                          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;path&quot;</span>&gt;</span><br>                              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;projects.html&quot;</span>&gt;</span>更多...<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><br>                              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;type.name&#125;&quot;</span>&gt;</span>科技<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;type.remark&#125;&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color:#FFF;&quot;</span>&gt;</span>开启智慧未来<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>                          <span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>                      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mBd&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top:10px;&quot;</span>&gt;</span><br>                          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span><br>                              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;#strings.isEmpty(type.portalProjectVOList)&#125;&quot;</span>&gt;</span>未能找到当前分类的项目信息<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;not #strings.isEmpty(type.portalProjectVOList)&#125;&quot;</span>&gt;</span><br>                                  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;project : $&#123;type.portalProjectVOList&#125;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-md-3&quot;</span>&gt;</span><br>                                      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;thumbnail&quot;</span>&gt;</span><br>                                          <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;300x200&quot;</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;$&#123;project.headerPicturePath&#125;&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;img/product-1.jpg&quot;</span> /&gt;</span><br>                                          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;caption&quot;</span>&gt;</span><br>                                              <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;break&quot;</span>&gt;</span><br>                                                  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;project.html&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;&#x27;http://localhost/project/get/project/detail/&#x27; + $&#123;project.projectId&#125;&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;project.projectName&#125;&quot;</span>&gt;</span>活性富氢净水直饮机<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                                              <span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>                                              <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>                                              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;float:left;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-screenshot&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;目标金额&quot;</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> $<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;project.money&#125;&quot;</span>&gt;</span>20,000<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;float:right;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;截至日期&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-calendar&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;project.deployDate&#125;&quot;</span>&gt;</span>2017-20-20 <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                              <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                              <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                                              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;progress&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-bottom: 4px;&quot;</span>&gt;</span><br>                                                  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;progress-bar progress-bar-success&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;progressbar&quot;</span> <span class="hljs-attr">aria-valuenow</span>=<span class="hljs-string">&quot;40&quot;</span> <span class="hljs-attr">th:aria-valuenow</span>=<span class="hljs-string">&quot;$&#123;project.percentage&#125;&quot;</span> <span class="hljs-attr">aria-valuemin</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">aria-valuemax</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">th:style</span>=<span class="hljs-string">&quot;&#x27;width:&#x27;+$&#123;project.percentage&#125; + &#x27;%&#x27;&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 40%&quot;</span>&gt;</span><br>                                                      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;project.percentage&#125; + &#x27;%&#x27;&quot;</span> &gt;</span>40% <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                                  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                              <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;float:right;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-star-empty&quot;</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                                  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-user&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;支持人数&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br>                                              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;project.supporter&#125;&quot;</span> &gt;</span>12345<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <br>              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="显示项目详情"><a href="#显示项目详情" class="headerlink" title="显示项目详情"></a>显示项目详情</h1><h2 id="目标-31"><a href="#目标-31" class="headerlink" title="目标"></a>目标</h2><p>点击项目，显示项目详情</p>
<h2 id="思路-31"><a href="#思路-31" class="headerlink" title="思路"></a>思路</h2><p><img src="/img/atcrowdfunding.assets/image-20220130223635495.png" alt="image-20220130223635495"></p>
<h2 id="后端-19"><a href="#后端-19" class="headerlink" title="后端"></a>后端</h2><h3 id="创建实体类-1"><a href="#创建实体类-1" class="headerlink" title="创建实体类"></a>创建实体类</h3><ul>
<li><p>DetailProjectVO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DetailProjectVO</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> Integer projectId;<br>    <span class="hljs-keyword">private</span> String projectName;<br>    <span class="hljs-keyword">private</span> String projectDesc;<br>    <span class="hljs-keyword">private</span> Integer followerCount;<br>    <span class="hljs-keyword">private</span> Integer day;<br>    <span class="hljs-keyword">private</span> Integer status;<br>    <span class="hljs-keyword">private</span> String statusText;<br>    <span class="hljs-keyword">private</span> Integer money;<br>    <span class="hljs-keyword">private</span> Integer supportMoney;<br>    <span class="hljs-keyword">private</span> Integer percentage;<br>    <span class="hljs-keyword">private</span> String deployDate;<br>    <span class="hljs-keyword">private</span> Integer lastDay;<br>    <span class="hljs-keyword">private</span> Integer supporterCount;<br>    <span class="hljs-keyword">private</span> String headerPicturePath;<br>    <span class="hljs-keyword">private</span> List&lt;String&gt; detailPicturePathList;<br>    <span class="hljs-keyword">private</span> List&lt;DetailReturnVO&gt; detailReturnVOList;<br><br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>DetailReturnVO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  每一个项目的回报信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DetailReturnVO</span> </span>&#123;<br><br>    <span class="hljs-comment">// 回报主键信息</span><br>    <span class="hljs-keyword">private</span> Integer returnId;<br><br>    <span class="hljs-comment">// 当前栏位需要支持的金额</span><br>    <span class="hljs-keyword">private</span> Integer supportMoney;<br><br>    <span class="hljs-comment">// 是否限购，0时无限额，1时有限额</span><br>    <span class="hljs-keyword">private</span> Integer signalPurchase;<br><br>    <span class="hljs-comment">// 具体的限额数量</span><br>    <span class="hljs-keyword">private</span> Integer purchase;<br><br>    <span class="hljs-comment">// 当前栏位的支持者数量</span><br>    <span class="hljs-keyword">private</span> Integer supporterCount;<br><br>    <span class="hljs-comment">// 运费 0时表示包邮</span><br>    <span class="hljs-keyword">private</span> Integer freight;<br><br>    <span class="hljs-comment">// 众筹成功多少天后发货</span><br>    <span class="hljs-keyword">private</span> Integer returnDate;<br><br>    <span class="hljs-comment">// 回报的详细内容</span><br>    <span class="hljs-keyword">private</span> String content;<br><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="sql语句查找详情信息"><a href="#sql语句查找详情信息" class="headerlink" title="sql语句查找详情信息"></a>sql语句查找详情信息</h3><ul>
<li><p>ProjectPOMapper接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function">DetailProjectVO <span class="hljs-title">selectDetailProjectVO</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;id&quot;)</span> Integer projectId)</span></span>;<br></code></pre></td></tr></table></figure></li>
<li><p>ProjectPOMapper.xml，多张表进行查询使用collection</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;loadProjectDetailResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.atguigu.crowd.entity.vo.DetailProjectVO&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;projectId&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;projectName&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;project_name&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;projectDesc&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;project_description&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;money&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;money&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;day&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;day&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;status&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;status&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;percentage&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;percentage&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;followerCount&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;follower&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;headerPicturePath&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;header_picture_path&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;supporterCount&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;supporter&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;supportMoney&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;supportmoney&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;deployDate&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;deploydate&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;detailPicturePathList&quot;</span>  <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;selectDetailPicturePathList&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;detailReturnVOList&quot;</span>  <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;selectDetailReturnVOList&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectDetailReturnVOList&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.atguigu.crowd.entity.vo.DetailReturnVO&quot;</span>&gt;</span><br>    select<br>        id returnId,<br>        supportmoney supportMoney,<br>        content,<br>        signalpurchase signalPurchase,<br>        purchase,<br>        freight,<br>        returndate returnDate<br>    from t_return where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectDetailPicturePathList&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;String&quot;</span>&gt;</span><br>    select item_pic_path from t_project_item_pic where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectDetailProjectVO&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;loadProjectDetailResultMap&quot;</span>&gt;</span><br>    select id,<br>           project_name,<br>           project_description,<br>           money,<br>           day,<br>           status ,<br>           deploydate,<br>           supportmoney,<br>           supporter,<br>          (supportmoney/money)*100 percentage,<br>           follower,<br>           header_picture_path<br>    from t_project where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Service接口和实现-1"><a href="#Service接口和实现-1" class="headerlink" title="Service接口和实现"></a>Service接口和实现</h3><ul>
<li><p>ProjectService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function">DetailProjectVO <span class="hljs-title">selectDetailProjectVO</span><span class="hljs-params">(Integer projectId)</span></span>;<br></code></pre></td></tr></table></figure></li>
<li><p>ProjectServiceImpl，注意<strong>计算剩余天数和设置状态内容</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> DetailProjectVO <span class="hljs-title">selectDetailProjectVO</span><span class="hljs-params">(Integer projectId)</span> </span>&#123;<br>    DetailProjectVO detailProjectVO = projectPOMapper.selectDetailProjectVO(projectId);<br><br>    <span class="hljs-comment">// 根据status设置当前筹集的状态</span><br>    Integer status = detailProjectVO.getStatus();<br>    <span class="hljs-keyword">switch</span> (status) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>            detailProjectVO.setStatusText(<span class="hljs-string">&quot;即将开始&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            detailProjectVO.setStatusText(<span class="hljs-string">&quot;众筹中&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>            detailProjectVO.setStatusText(<span class="hljs-string">&quot;众筹成功&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>            detailProjectVO.setStatusText(<span class="hljs-string">&quot;众筹失败&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 使用LocalDate计算众筹还剩余多少时间</span><br>    <span class="hljs-comment">// 获取当前是当年的第多少天</span><br>    LocalDate todayDate = LocalDate.now();<br>    Integer todayDateDayOfYear = todayDate.getDayOfYear();<br><br>    <span class="hljs-comment">// 获取众筹开始的时间</span><br>    String deployDate = detailProjectVO.getDeployDate();<br><br>    <span class="hljs-comment">// 转化为LocalDate类型,取出的deployDate不能为空，不然会空指针</span><br>    DateTimeFormatter formatter = DateTimeFormatter.ofPattern(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>    LocalDate date = LocalDate.parse(deployDate, formatter);<br>    <span class="hljs-comment">// 获取在当年的第多少天</span><br>    Integer deployDateOfYear= date.getDayOfYear();<br><br>    <span class="hljs-comment">// 获取筹集持续时间</span><br>    Integer day = detailProjectVO.getDay();<br><br>    <span class="hljs-comment">// 计算众筹的剩余时间</span><br>    Integer lastDay = day - (todayDateDayOfYear - deployDateOfYear);<br><br>    <span class="hljs-comment">// 设置lastDay剩余时间</span><br>    detailProjectVO.setLastDay(lastDay);<br>    <span class="hljs-keyword">return</span> detailProjectVO;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Mysql工程handler方法-1"><a href="#Mysql工程handler方法-1" class="headerlink" title="Mysql工程handler方法"></a>Mysql工程handler方法</h3><ul>
<li><p>调用接口返回信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/get/detail/project/remote/&#123;projectId&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;DetailProjectVO&gt; <span class="hljs-title">getDetailProjectVORemote</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;projectId&quot;)</span> Integer projectId)</span> </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        DetailProjectVO detailProjectVO = projectService.selectDetailProjectVO(projectId);<br>        <span class="hljs-keyword">return</span> ResultEntity.successWithData(detailProjectVO);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>        exception.printStackTrace();<br>        <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="api工程-3"><a href="#api工程-3" class="headerlink" title="api工程"></a>api工程</h3><ul>
<li><p>暴露接口，注意和mysql-provider中一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/get/detail/project/remote/&#123;projectId&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;DetailProjectVO&gt; <span class="hljs-title">getDetailProjectVORemote</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;projectId&quot;)</span> Integer projectId)</span></span>;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="处理页面请求handler-1"><a href="#处理页面请求handler-1" class="headerlink" title="处理页面请求handler"></a>处理页面请求handler</h3><ul>
<li><p>路径上获取参数注意使用@PathVariable</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/get/detail/project/remote/&#123;projectId&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;DetailProjectVO&gt; <span class="hljs-title">getDetailProjectVORemote</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;projectId&quot;)</span> Integer projectId)</span> </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        DetailProjectVO detailProjectVO = projectService.selectDetailProjectVO(projectId);<br>        <span class="hljs-keyword">return</span> ResultEntity.successWithData(detailProjectVO);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>        exception.printStackTrace();<br>        <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="前端-20"><a href="#前端-20" class="headerlink" title="前端"></a>前端</h2><ul>
<li><p>修改portal页面的a标签</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;project.html&quot;</span></span><br><span class="hljs-tag">   <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;http://localhost/project/get/project/detail/&#125; + $&#123;project.projectId&#125;&quot;</span></span><br><span class="hljs-tag">   <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;project.projectName&#125;&quot;</span>&gt;</span>活性富氢净水直饮机<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>遍历detailProviderVO对象，显示在页面上，注意修改登录和退出登录的超链接地址</p>
</li>
</ul>
<h1 id="订单功能"><a href="#订单功能" class="headerlink" title="订单功能"></a>订单功能</h1><h2 id="搭建订单环境"><a href="#搭建订单环境" class="headerlink" title="搭建订单环境"></a>搭建订单环境</h2><ul>
<li><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- thymeleaf视图解析器 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 依赖api包，api依赖了entity和until，不用再次依赖 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.crowd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atcrowdfunding17-member-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 使用@ConfigurationProperties需要的依赖 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 引入 springboot&amp;redis 整合场景 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 引入 springboot&amp;springsession 整合场景 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.session<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-session-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 测试 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>application配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">7000</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">atguigu-crowd-order</span><br>  <span class="hljs-attr">thymeleaf:</span><br>    <span class="hljs-attr">prefix:</span> <span class="hljs-string">classpath:/templates/</span><br>    <span class="hljs-attr">suffix:</span> <span class="hljs-string">.html</span><br>  <span class="hljs-attr">redis:</span> <span class="hljs-comment"># 配置redis的地址</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.241</span><span class="hljs-number">.130</span><br>  <span class="hljs-attr">session:</span> <span class="hljs-comment"># session存储的类型</span><br>    <span class="hljs-attr">store-type:</span> <span class="hljs-string">redis</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:1000/eureka/</span><br><span class="hljs-attr">ribbon:</span><br>  <span class="hljs-attr">ReadTimeout:</span> <span class="hljs-number">10000</span><br>  <span class="hljs-attr">ConnectTimeout:</span> <span class="hljs-number">10000</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="逆向工程-5"><a href="#逆向工程-5" class="headerlink" title="逆向工程"></a>逆向工程</h2><ul>
<li><p>创建数据表</p>
<p><img src="/img/atcrowdfunding.assets/image-20220201142508777.png" alt="image-20220201142508777"></p>
<p>订单表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `project_crowd`.`t_order` ( <br>`id` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;主键&#x27;</span>,<br> `order_num` <span class="hljs-type">CHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">&#x27;订单号&#x27;</span>, <br>`pay_order_num` <span class="hljs-type">CHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">&#x27;支付宝流水号&#x27;</span>, <br>`order_amount` <span class="hljs-keyword">DOUBLE</span>(<span class="hljs-number">10</span>,<span class="hljs-number">5</span>) COMMENT <span class="hljs-string">&#x27;订单金额&#x27;</span>, <br>`invoice` <span class="hljs-type">INT</span> COMMENT <span class="hljs-string">&#x27;是否开发票（0 不开，1 开）&#x27;</span>, <br>`invoice_title` <span class="hljs-type">CHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">&#x27;发票抬头&#x27;</span>, <br>`order_remark` <span class="hljs-type">CHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">&#x27;订单备注&#x27;</span>, <br>`address_id` <span class="hljs-type">CHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">&#x27;收货地址 id&#x27;</span>,<br> <span class="hljs-keyword">PRIMARY</span> KEY (`id`) <br>);<br></code></pre></td></tr></table></figure>

<p>收货地址表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `project_crowd`.`t_address` ( <br>`id` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;主键&#x27;</span>,<br>`receive_name` <span class="hljs-type">CHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">&#x27;收件人&#x27;</span>, <br>`phone_num` <span class="hljs-type">CHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">&#x27;手机号&#x27;</span>,<br> `address` <span class="hljs-type">CHAR</span>(<span class="hljs-number">200</span>) COMMENT <span class="hljs-string">&#x27;收货地址&#x27;</span>, <br>`member_id` <span class="hljs-type">INT</span> COMMENT <span class="hljs-string">&#x27;用户 id&#x27;</span>, <br><span class="hljs-keyword">PRIMARY</span> KEY (`id`) <br>);<br></code></pre></td></tr></table></figure>

<p>项目信息表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `project_crowd`.`t_order_project` ( <br>`id` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;主键&#x27;</span>,<br> `project_name` <span class="hljs-type">CHAR</span>(<span class="hljs-number">200</span>) COMMENT <span class="hljs-string">&#x27;项目名称&#x27;</span>, <br>`launch_name` <span class="hljs-type">CHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">&#x27;发起人&#x27;</span>,<br> `return_content` <span class="hljs-type">CHAR</span>(<span class="hljs-number">200</span>) COMMENT <span class="hljs-string">&#x27;回报内容&#x27;</span>, <br>`return_count` <span class="hljs-type">INT</span> COMMENT <span class="hljs-string">&#x27;回报数量&#x27;</span>,<br> `support_price` <span class="hljs-type">INT</span> COMMENT <span class="hljs-string">&#x27;支持单价&#x27;</span>, <br>`freight` <span class="hljs-type">INT</span> COMMENT <span class="hljs-string">&#x27;配送费用&#x27;</span>,<br> `order_id` <span class="hljs-type">INT</span> COMMENT <span class="hljs-string">&#x27;订单表的主键&#x27;</span>, <br><span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br> );<br></code></pre></td></tr></table></figure></li>
<li><p>逆向工程生成也对应的实体类</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 数据库表名与需要的实体类对应映射的指定 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_order&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;OrderPO&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_address&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;AddressPO&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;t_order_project&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;OrderProjectPO&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>将各自文件移动到各自包中</p>
</li>
</ul>
<h2 id="确认回报内容"><a href="#确认回报内容" class="headerlink" title="确认回报内容"></a>确认回报内容</h2><h3 id="目标-32"><a href="#目标-32" class="headerlink" title="目标"></a>目标</h3><p>确认回报信息，填写回报数量，并结算，保存在VO对象中</p>
<h3 id="思路-32"><a href="#思路-32" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220201150803980.png" alt="image-20220201150803980"></p>
<h3 id="后端-20"><a href="#后端-20" class="headerlink" title="后端"></a>后端</h3><h4 id="创建实体类-2"><a href="#创建实体类-2" class="headerlink" title="创建实体类"></a>创建实体类</h4><p>创建VO对象与页面相对应</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderProjectVO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> Integer id;<br><br>    <span class="hljs-keyword">private</span> String orderNum;<br><br>    <span class="hljs-keyword">private</span> String payOrderNum;<br><br>    <span class="hljs-keyword">private</span> Double orderAmount;<br> <br>    <span class="hljs-keyword">private</span> Integer invoice;<br><br>    <span class="hljs-keyword">private</span> String invoiceTitle;<br><br>    <span class="hljs-keyword">private</span> String orderRemark;<br><br>    <span class="hljs-keyword">private</span> String addressId;<br><br>    <span class="hljs-keyword">private</span> Integer signalPurchase;<br><br>    <span class="hljs-keyword">private</span> Integer purchase;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="sql语句查找VO对象相关字段"><a href="#sql语句查找VO对象相关字段" class="headerlink" title="sql语句查找VO对象相关字段"></a>sql语句查找VO对象相关字段</h4><ul>
<li><p>OrderPOMapper接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function">OrderProjectVO <span class="hljs-title">selectOrderProjectVO</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;returnId&quot;)</span> Integer returnId)</span></span>;<br></code></pre></td></tr></table></figure></li>
<li><p>OrderPOMapper.xml中查询语句</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectOrderProjectVO&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.atguigu.crowd.entity.vo.OrderProjectVO&quot;</span>&gt;</span><br>    select project_name          projectName,<br>           content               returnContent,<br>           description_simple    launchName,<br>           t_return.supportmoney supportPrice,<br>           freight               freight,<br>           count                 returnCount,<br>           signalpurchase        signalPurchase,<br>           purchase              purchase<br>    from t_project<br>             left join t_member_launch_info on t_project.memberid = t_member_launch_info.memberid<br>             left join t_return on t_project.id = t_return.projectid<br>    where t_return.id = #&#123;returnId&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="Service接口的实现"><a href="#Service接口的实现" class="headerlink" title="Service接口的实现"></a>Service接口的实现</h4><ul>
<li><p>OrderService接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">OrderService</span> </span>&#123;<br><br>    <span class="hljs-function">OrderProjectVO <span class="hljs-title">selectOrderProjectVO</span><span class="hljs-params">(Integer returnId)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>OrderServiceImpl实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Transactional(readOnly = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OrderService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderPOMapper orderPOMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderProjectPOMapper orderProjectPOMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AddressPOMapper addressPOMapper;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> OrderProjectVO <span class="hljs-title">selectOrderProjectVO</span><span class="hljs-params">(Integer returnId)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> orderPOMapper.selectOrderProjectVO(returnId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="Mysql工程handler方法-2"><a href="#Mysql工程handler方法-2" class="headerlink" title="Mysql工程handler方法"></a>Mysql工程handler方法</h4><ul>
<li><p>注意和api中的方法名一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestControllerpublic</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderProviderHandler</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderService orderService;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/get/order/projectvo/remote&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;OrderProjectVO&gt; <span class="hljs-title">getOrderProjectVORemote</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@RequestParam(&quot;returnId&quot;)</span> Integer returnId,</span></span><br><span class="hljs-params"><span class="hljs-function">            HttpSession session)</span> </span>&#123;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            OrderProjectVO orderProjectVO = orderService.selectOrderProjectVO(returnId);<br>            <span class="hljs-keyword">return</span> ResultEntity.successWithData(orderProjectVO);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>            exception.printStackTrace();<br>            <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="api工程-4"><a href="#api工程-4" class="headerlink" title="api工程"></a>api工程</h4><ul>
<li><p>暴露接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/get/order/projectvo/remote&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;OrderProjectVO&gt; <span class="hljs-title">getOrderProjectVORemote</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;returnId&quot;)</span> Integer returnId)</span></span>;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="order工程"><a href="#order工程" class="headerlink" title="order工程"></a>order工程</h4><h5 id="处理页面请求的handler"><a href="#处理页面请求的handler" class="headerlink" title="处理页面请求的handler"></a>处理页面请求的handler</h5><ul>
<li><p>使用**@PathVariable<strong>接收参数，注意将数据存入</strong>session**中方便使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderHandler</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MysqlRemoteService mysqlRemoteService;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/confirm/return/info/&#123;returnId&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">showReturnConfirmInfo</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@PathVariable(&quot;returnId&quot;)</span> Integer returnId,</span></span><br><span class="hljs-params"><span class="hljs-function">            HttpSession session</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span> </span>&#123;<br>        ResultEntity&lt;OrderProjectVO&gt; orderProjectVOResultEntity = mysqlRemoteService.getOrderProjectVORemote(returnId);<br><br>        <span class="hljs-keyword">if</span> (ResultEntity.SUCCESS.equals(orderProjectVOResultEntity.getResult())) &#123;<br>            session.setAttribute(CrowdConstant.ATTR_NAME_ORDER_PROJECT, orderProjectVOResultEntity.getData());<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;confirm_return&quot;</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="主启动类"><a href="#主启动类" class="headerlink" title="主启动类"></a>主启动类</h5><ul>
<li><p>开启fegin代理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableFeignClients</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdMainClass</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(CrowdMainClass.class , args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="前端-21"><a href="#前端-21" class="headerlink" title="前端"></a>前端</h3><ul>
<li><p>修改详情页的“支持”超链接</p>
<p>带上<strong>returnId</strong>方便查询，注意通过<strong>网关配置的路由路径访问</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-warning btn-lg&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;&#x27;http://localhost/order/confirm/return/info/&#x27;+ $&#123;return.returnId&#125;&quot;</span>&gt;</span><br>    支持<br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>回显数据在confirm_return.html页面，注意页面上显示用户名和退出登录的路径</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;session.orderProjectVO.projectName&#125;&quot;</span>&gt;</span>活性富氢净水直饮机<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;session.orderProjectVO.launchName&#125;&quot;</span>&gt;</span>深圳市博实永道电子商务有限公司<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;session.orderProjectVO.returnContent&#125;&quot;</span>&gt;</span><br>        每满1750人抽取一台活性富氢净水直饮机，至少抽取一台。抽取名额（小数点后一位四舍五入）=参与人数÷1750人，由苏宁官方抽取。<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;returnCountInput&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span></span><br><span class="hljs-tag">               <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:60px;&quot;</span></span><br><span class="hljs-tag">               <span class="hljs-attr">th:value</span>=<span class="hljs-string">&quot;$&#123;session.orderProjectVO.returnCount&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color:#F60&quot;</span>&gt;</span>￥[[$&#123;session.orderProjectVO.supportPrice&#125;]]<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;session.orderProjectVO.freight&#125; == 0&quot;</span>&gt;</span>免运费<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;session.orderProjectVO.freight&#125; &gt; 0&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;session.orderProjectVO.freight&#125;&quot;</span>&gt;</span>运费<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>输入订单数时判断是否大于限购数和计算总金额的js代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<br><br>    <span class="hljs-keyword">var</span> signalPurchase = [[$&#123;session.orderProjectVO.signalPurchase&#125;]];<br><br>    <span class="hljs-keyword">var</span> purchase = [[$&#123;session.orderProjectVO.purchase&#125;]];<br><br>    <span class="hljs-keyword">var</span> freight = [[$&#123;session.orderProjectVO.freight&#125;]]<br><br>    <span class="hljs-keyword">var</span> supportPrice = [[$&#123;session.orderProjectVO.supportPrice&#125;]]<br><br>    $(<span class="hljs-string">&#x27;#myTab a&#x27;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>&#123;<br>        e.preventDefault()<br>        $(<span class="hljs-built_in">this</span>).tab(<span class="hljs-string">&#x27;show&#x27;</span>)<br>    &#125;);<br><br>    <span class="hljs-comment">// 自动修正总价的功能</span><br>    <span class="hljs-comment">// 当id=returnCountInput的标签发送改动时触发</span><br>    $(<span class="hljs-string">&quot;#returnCountInput&quot;</span>).change(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">var</span> returnCount = $.trim($(<span class="hljs-built_in">this</span>).val());<br><br>        <span class="hljs-keyword">if</span> (returnCount == <span class="hljs-literal">null</span> || returnCount == <span class="hljs-string">&quot;&quot;</span>) &#123;<br>            alert(<span class="hljs-string">&quot;请输入有效数据!&quot;</span>)<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 限购时不能超过限购数量</span><br>        <span class="hljs-keyword">if</span> (signalPurchase == <span class="hljs-number">1</span> &amp;&amp; returnCount &gt;= purchase) &#123;<br>            alert(<span class="hljs-string">&quot;不能超过限购数量!&quot;</span>);<br>            $(<span class="hljs-built_in">this</span>).val(<span class="hljs-built_in">this</span>.defaultValue);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 满足以上条件后，计算总价</span><br>        $(<span class="hljs-string">&quot;#totalAmount&quot;</span>).text(freight +(supportPrice * returnCount));<br>    &#125;);<br><br>    $(<span class="hljs-string">&quot;#submitBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">var</span> returnCount = $(<span class="hljs-string">&quot;#returnCountInput&quot;</span>).val();<br>        <span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">&quot;/order/confirm/order/&quot;</span> + returnCount;<br>    &#125;);<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="确认订单"><a href="#确认订单" class="headerlink" title="确认订单"></a>确认订单</h2><h3 id="目标-33"><a href="#目标-33" class="headerlink" title="目标"></a>目标</h3><p>点击结算，显示用户地址信息，没有即新增，显示订单的信息和总金额。</p>
<h3 id="思路-33"><a href="#思路-33" class="headerlink" title="思路"></a>思路</h3><p><img src="/img/atcrowdfunding.assets/image-20220202105918540.png" alt="image-20220202105918540"></p>
<h3 id="后端-21"><a href="#后端-21" class="headerlink" title="后端"></a>后端</h3><h4 id="创建实体类-3"><a href="#创建实体类-3" class="headerlink" title="创建实体类"></a>创建实体类</h4><ul>
<li><p>创建Address实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddressVO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> Integer id;<br><br>    <span class="hljs-keyword">private</span> String receiveName;<br><br>    <span class="hljs-keyword">private</span> String phoneNum;<br><br>    <span class="hljs-keyword">private</span> String address;<br><br>    <span class="hljs-keyword">private</span> Integer memberId;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="Service接口实现"><a href="#Service接口实现" class="headerlink" title="Service接口实现"></a>Service接口实现</h4><ul>
<li><p>OrderService接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function">List&lt;AddressVO&gt; <span class="hljs-title">selectAddressVO</span><span class="hljs-params">(Integer memberLoginVOId)</span></span>;<br></code></pre></td></tr></table></figure></li>
<li><p>OrderServiceImpl实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;AddressVO&gt; <span class="hljs-title">selectAddressVO</span><span class="hljs-params">(Integer memberLoginVOId)</span> </span>&#123;<br>       AddressPOExample addressPOExample = <span class="hljs-keyword">new</span> AddressPOExample();<br>       AddressPOExample.Criteria criteria = addressPOExample.createCriteria();<br>       criteria.andMemberIdEqualTo(memberLoginVOId);<br>       ArrayList&lt;AddressVO&gt; addressVOList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>       List&lt;AddressPO&gt; addressPOList = addressPOMapper.selectByExample(addressPOExample);<br>       <span class="hljs-keyword">for</span> (AddressPO addressPO : addressPOList) &#123;<br>           AddressVO addressVO = <span class="hljs-keyword">new</span> AddressVO();<br>           BeanUtils.copyProperties(addressPO, addressVO);<br>           addressVOList.add(addressVO);<br>       &#125;<br>       <span class="hljs-keyword">return</span> addressVOList;<br>   &#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="mysql工程handler方法"><a href="#mysql工程handler方法" class="headerlink" title="mysql工程handler方法"></a>mysql工程handler方法</h4><ul>
<li><p>使用@RequestParam接收</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/get/order/addressvo/remote&quot;)</span><br><span class="hljs-keyword">public</span> ResultEntity&lt;List&lt;AddressVO&gt;&gt; getAddressVORemote(<span class="hljs-meta">@RequestParam(&quot;memberLoginVOId&quot;)</span> Integer memberLoginVOId) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        List&lt;AddressVO&gt; addressPOList = orderService.selectAddressVO(memberLoginVOId);<br>        <span class="hljs-keyword">return</span> ResultEntity.successWithData(addressPOList);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>        exception.printStackTrace();<br>        <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="api工程-5"><a href="#api工程-5" class="headerlink" title="api工程"></a>api工程</h4><ul>
<li><p>暴露接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/get/order/addressvo/remote&quot;)</span><br><span class="hljs-keyword">public</span> ResultEntity&lt;List&lt;AddressVO&gt;&gt; getAddressVORemote(<span class="hljs-meta">@RequestParam(&quot;memberLoginVOId&quot;)</span> Integer memberLoginVOId);<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="order工程-1"><a href="#order工程-1" class="headerlink" title="order工程"></a>order工程</h4><ul>
<li><p>handler方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/confirm/order/&#123;returnCount&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">showConfirmOrderInfo</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@PathVariable(&quot;returnCount&quot;)</span> Integer returnCount,</span></span><br><span class="hljs-params"><span class="hljs-function">        HttpSession session</span></span><br><span class="hljs-params"><span class="hljs-function">)</span> </span>&#123;<br>    <span class="hljs-comment">// 从session中取出对象</span><br>    OrderProjectVO orderProjectVO = (OrderProjectVO) session.getAttribute(CrowdConstant.ATTR_NAME_ORDER_PROJECT);<br><br>    <span class="hljs-comment">// 将接收的returnCount赋值进去，保存到session域</span><br>    orderProjectVO.setReturnCount(returnCount);<br>    session.setAttribute(CrowdConstant.ATTR_NAME_ORDER_PROJECT, orderProjectVO);<br><br>    <span class="hljs-comment">// 从session域中获取发起人的id值</span><br>    MemberLoginVO memberLoginVO = (MemberLoginVO) session.getAttribute(CrowdConstant.ATTR_NAME_LOGIN_MEMBER);<br>        Integer memberLoginVOId = memberLoginVO.getId();<br><br>        <span class="hljs-comment">// 根据memberLoginVOId查找地址信息</span><br>        ResultEntity&lt;List&lt;AddressVO&gt;&gt; addressVOListEntity = mysqlRemoteService.getAddressVORemote(memberLoginVOId);<br><br>        <span class="hljs-keyword">if</span> (ResultEntity.SUCCESS.equals(addressVOListEntity.getResult())) &#123;<br>            <span class="hljs-comment">// 将地址信息保存到session中</span><br>            session.setAttribute(CrowdConstant.ATTR_NAME_ORDER_ADDRESS, addressVOListEntity.getData());<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;confirm_order&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="前端-22"><a href="#前端-22" class="headerlink" title="前端"></a>前端</h3><ul>
<li><p>confirm-return点击结算发送请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">$(<span class="hljs-string">&quot;#submitBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> returnCount = $(<span class="hljs-string">&quot;#returnCountInput&quot;</span>).val();<br>    <span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">&quot;/order/confirm/order/&quot;</span> + returnCount;<br>&#125;);<br></code></pre></td></tr></table></figure></li>
<li><p>将session域中的数据显示在页面上</p>
</li>
</ul>
<h2 id="新增地址"><a href="#新增地址" class="headerlink" title="新增地址"></a>新增地址</h2><h3 id="目标-34"><a href="#目标-34" class="headerlink" title="目标"></a>目标</h3><p>提交表单，将新增地址保存在数据库，显示在页面上。</p>
<h3 id="思路-34"><a href="#思路-34" class="headerlink" title="思路"></a>思路</h3><p>使用重定向，并没有使用ajax</p>
<p><img src="/img/atcrowdfunding.assets/image-20220202160450970.png" alt="image-20220202160450970"></p>
<h3 id="后端-22"><a href="#后端-22" class="headerlink" title="后端"></a>后端</h3><h4 id="order工程-2"><a href="#order工程-2" class="headerlink" title="order工程"></a>order工程</h4><ul>
<li><p>使用实体类接收提交的表单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/save/address&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">saveAddressVO</span><span class="hljs-params">(AddressVO addressVO, HttpSession session)</span> </span>&#123;<br>    <span class="hljs-comment">// 调用远程接口保存address</span><br>    ResultEntity&lt;String&gt; resultEntity = mysqlRemoteService.saveAddressVORemote(addressVO);<br><br>    <span class="hljs-comment">// 从session域中获取returnCount重定向页面</span><br>    OrderProjectVO orderProjectVO = (OrderProjectVO) session.getAttribute(CrowdConstant.ATTR_NAME_ORDER_PROJECT);<br>    Integer returnCount = orderProjectVO.getReturnCount();<br><br>    <span class="hljs-comment">// 重定向页面</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:http://localhost/order/confirm/order/&quot;</span> + returnCount;<br><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="api工程-6"><a href="#api工程-6" class="headerlink" title="api工程"></a>api工程</h4><ul>
<li><p>暴露接口，注意<strong>实体类使用@RequestBody</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/save/order/addressvo/remote&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">saveAddressVORemote</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> AddressVO addressVO)</span></span>;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="远程mysql工程handler"><a href="#远程mysql工程handler" class="headerlink" title="远程mysql工程handler"></a>远程mysql工程handler</h4><ul>
<li><p>和api中接口一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/save/order/addressvo/remote&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResultEntity&lt;String&gt; <span class="hljs-title">saveAddressVORemote</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> AddressVO addressVO)</span> </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        orderService.insertAddressVO(addressVO);<br>        <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>        exception.printStackTrace();<br>        <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="Service实现-5"><a href="#Service实现-5" class="headerlink" title="Service实现"></a>Service实现</h4><ul>
<li><p>OrderServiceji接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insertAddressVO</span><span class="hljs-params">(AddressVO addressVO)</span></span>;<br></code></pre></td></tr></table></figure></li>
<li><p>OrderServiceImpl实现类，注意<strong>事务</strong>设置为只读，开启异常回滚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Transactional(readOnly = false, rollbackFor = Exception.class, propagation = Propagation.REQUIRES_NEW)</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertAddressVO</span><span class="hljs-params">(AddressVO addressVO)</span> </span>&#123;<br>    AddressPO addressPO = <span class="hljs-keyword">new</span> AddressPO();<br>    BeanUtils.copyProperties(addressVO, addressPO);<br>    addressPOMapper.insert(addressPO);<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="前端-23"><a href="#前端-23" class="headerlink" title="前端"></a>前端</h3><ul>
<li><p>提交地址表单，注意设置memberId在<strong>隐藏域</strong>中，方便插入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/order/save/address&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-horizontal&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;memberId&quot;</span> <span class="hljs-attr">th:value</span>=<span class="hljs-string">&quot;$&#123;session.loginMember.id&#125;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-2 control-label&quot;</span>&gt;</span>收货人（*）<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-10&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;receiveName&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:200px;&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请填写收货人姓名&quot;</span> &gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-2 control-label&quot;</span>&gt;</span>手机（*）<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-10&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;phoneNum&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:200px;&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请填写11位手机号码&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-2 control-label&quot;</span>&gt;</span>地址（*）<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-10&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;address&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:400px;&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请填写收货地址&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;inputEmail3&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-2 control-label&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-10&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span>&gt;</span>确认配送信息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>点击已了解，设置立即付款的disable为空，跳转支付</p>
<p><img src="/img/atcrowdfunding.assets/image-20220202161302826.png" alt="image-20220202161302826"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;knowRiskAndRuleCheckbox&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span>&gt;</span> 我已了解风险和规则<br><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">$(<span class="hljs-string">&quot;#knowRiskAndRuleCheckbox&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>      <span class="hljs-keyword">var</span> currentStatus = <span class="hljs-built_in">this</span>.checked;<br>      <span class="hljs-keyword">if</span> (currentStatus) &#123;<br>          $(<span class="hljs-string">&quot;#payBtn&quot;</span>).prop(<span class="hljs-string">&quot;disabled&quot;</span>,<span class="hljs-string">&quot;&quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>          $(<span class="hljs-string">&quot;#payBtn&quot;</span>).prop(<span class="hljs-string">&quot;disabled&quot;</span>,<span class="hljs-string">&quot;disabled&quot;</span>);<br>      &#125;<br>  &#125;);<br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="支付功能"><a href="#支付功能" class="headerlink" title="支付功能"></a>支付功能</h1><h2 id="使用支付宝接口"><a href="#使用支付宝接口" class="headerlink" title="使用支付宝接口"></a>使用支付宝接口</h2><h3 id="电脑网站支付"><a href="#电脑网站支付" class="headerlink" title="电脑网站支付"></a>电脑网站支付</h3><ul>
<li><p>进入<a target="_blank" rel="noopener" href="https://opendocs.alipay.com/home">文档首页</a></p>
</li>
<li><p>应用过程</p>
<p><img src="/img/atcrowdfunding.assets/image-20220201102440433.png" alt="image-20220201102440433"></p>
<p>开发工程中使用开放平台提供的沙箱环境进行调试，沙箱环境中的应用已经创建好了，不需要执行创建流程。功能开发完成，项目上线时再创建应用。</p>
</li>
</ul>
<h3 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h3><ul>
<li><p>对称加密</p>
<p>明文→加密→密文 </p>
<p>密文→解密→明文 </p>
<p>对称加密只需要公钥即可。</p>
</li>
<li><p>非对称加密</p>
<p><img src="/img/atcrowdfunding.assets/image-20220201102627368.png" alt="image-20220201102627368"></p>
<p>私钥加密的密文必须使用公钥解密。 </p>
<p>公钥加密的密文必须使用私钥解密。</p>
<p>私钥和公钥<strong>成对</strong>出现。</p>
</li>
<li><p>调用支付宝所使用的密钥</p>
<p>在支付宝开放平台的应用中设置商户公钥 ，在支付宝开放平台的应用中获取支付宝的公钥。</p>
<p><img src="/img/atcrowdfunding.assets/image-20220201102850329.png" alt="image-20220201102850329"></p>
<p>此时我们需要生成商户的私钥和支付宝公钥。</p>
</li>
<li><p>使用在线生成工具</p>
<p><img src="/img/atcrowdfunding.assets/image-20220201103212236.png" alt="image-20220201103212236"></p>
<p>生成密钥</p>
<p><img src="/img/atcrowdfunding.assets/image-20220201103351721.png" alt="image-20220201103351721"></p>
</li>
</ul>
<h3 id="支付流程"><a href="#支付流程" class="headerlink" title="支付流程"></a>支付流程</h3><ul>
<li><p>网站支付流程</p>
<p><img src="/img/atcrowdfunding.assets/image-20220201103658790.png" alt="image-20220201103658790"></p>
</li>
</ul>
<h3 id="内网穿透"><a href="#内网穿透" class="headerlink" title="内网穿透"></a>内网穿透</h3><h4 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h4><ul>
<li><p>项目发布方式</p>
<p><img src="/img/atcrowdfunding.assets/image-20220201103935122.png" alt="image-20220201103935122"></p>
</li>
<li><p>常规的上网方式：内网可以访问外网，而外网无法访问内网。此时内网穿透可以使外网访问内网。</p>
<p><img src="/img/atcrowdfunding.assets/image-20220201103949663.png" alt="image-20220201103949663"></p>
</li>
<li><p>此时我们是在<strong>内开</strong>发的，如果不使用内网穿透，支付宝就无法调用我们的项目，也无法发送请求给我们。</p>
</li>
</ul>
<h4 id="使用natapp"><a href="#使用natapp" class="headerlink" title="使用natapp"></a>使用natapp</h4><p>将内网外网通过natapp隧道打通,让内网的数据让外网可以获取。</p>
<ul>
<li><p>登录<a target="_blank" rel="noopener" href="https://natapp.cn/">natapp官网</a>-&gt;注册-&gt;登录-&gt;实名认证</p>
</li>
<li><p>下载客户端</p>
</li>
<li><p><strong>购买免费隧道</strong></p>
<p><img src="/img/atcrowdfunding.assets/image-20220201104429958.png" alt="image-20220201104429958"></p>
<p><img src="/img/atcrowdfunding.assets/image-20220201104625717.png" alt="image-20220201104625717"></p>
</li>
<li><p>配置config.ini</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment">#将本文件放置于 natapp 同级目录 程序将读取 [default] 段 </span><br><span class="hljs-comment">#在命令行参数模式如 natapp -authtoken=xxx 等相同参数将会覆盖掉此配置 </span><br><span class="hljs-comment">#命令行参数 -config= 可以指定任意 config.ini 文件 </span><br><span class="hljs-section">[default]</span> <br>authtoken= <span class="hljs-comment">#对应一条隧道的 authtoken </span><br>clienttoken= <span class="hljs-comment">#对应客户端的clienttoken,将会忽略 authtoken,若无请留 空, </span><br><span class="hljs-attr">log</span>=stdout <span class="hljs-comment">#log 日志文件,可指定本地文件, none=不做记录,stdout= 直接屏幕输出 ,默认为 none </span><br><span class="hljs-attr">loglevel</span>=DEBUG <span class="hljs-comment">#日志等级 DEBUG, INFO, WARNING, ERROR 默认为 DEBUG </span><br>http_proxy= <span class="hljs-comment">#代理设置 如 http://10.123.10.10:3128 非代理上网用 户请务必留空</span><br></code></pre></td></tr></table></figure></li>
<li><p>启动natapp</p>
<p><img src="/img/atcrowdfunding.assets/image-20220201111639472.png" alt="image-20220201111639472"></p>
<p>注意<strong>域名会变化</strong></p>
</li>
</ul>
<h3 id="使用沙箱环境"><a href="#使用沙箱环境" class="headerlink" title="使用沙箱环境"></a>使用沙箱环境</h3><p>由于在测试中使用，所以此时使用支付宝提供的沙箱测试。</p>
<p>进入支付宝开发者后，登录认证即可使用</p>
<p><img src="/img/atcrowdfunding.assets/image-20220203114809656.png" alt="image-20220203114809656"></p>
<ul>
<li><p>公钥和私钥</p>
<p>可以自定义自己生成的私钥和公钥，也可以使用默认提供的</p>
<p><img src="/img/atcrowdfunding.assets/image-20220203122257079.png" alt="image-20220203122257079"></p>
</li>
</ul>
<p><img src="/img/atcrowdfunding.assets/image-20220203122139762.png" alt="image-20220203122139762"></p>
<p>应用私钥和支付宝公钥后续调用支付宝时需要使用</p>
<h2 id="搭建order工程环境"><a href="#搭建order工程环境" class="headerlink" title="搭建order工程环境"></a>搭建order工程环境</h2><ul>
<li><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- thymeleaf视图解析器 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 依赖api包，api依赖了entity和until，不用再次依赖 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.crowd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atcrowdfunding17-member-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 使用@ConfigurationProperties需要的依赖 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 引入 springboot&amp;redis 整合场景 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 引入 springboot&amp;springsession 整合场景 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.session<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-session-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 测试 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--    调用支付宝sdk    --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alipay.sdk<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>alipay-sdk-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.49.ALL<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>主启动类，注意<strong>开启Fegin</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableFeignClients</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrowdMainClass</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(CrowdMainClass.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>application.yml配置文件,使用8000端口</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8000</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">atguigu-crowd-pay</span><br>  <span class="hljs-attr">thymeleaf:</span><br>    <span class="hljs-attr">prefix:</span> <span class="hljs-string">classpath:/templates/</span><br>    <span class="hljs-attr">suffix:</span> <span class="hljs-string">.html</span><br>  <span class="hljs-attr">redis:</span> <span class="hljs-comment"># 配置redis的地址</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.241</span><span class="hljs-number">.130</span><br>  <span class="hljs-attr">session:</span> <span class="hljs-comment"># session存储的类型</span><br>    <span class="hljs-attr">store-type:</span> <span class="hljs-string">redis</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:1000/eureka/</span><br><span class="hljs-attr">ribbon:</span><br>  <span class="hljs-attr">ReadTimeout:</span> <span class="hljs-number">10000</span><br>  <span class="hljs-attr">ConnectTimeout:</span> <span class="hljs-number">10000</span><br></code></pre></td></tr></table></figure></li>
<li><p>在zuul注册路由访问</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">zuul:</span><br>  <span class="hljs-attr">ignored-services:</span> <span class="hljs-string">&quot;*&quot;</span>                         <span class="hljs-comment"># 忽略原本微服务名称</span><br>  <span class="hljs-attr">sensitive-headers:</span> <span class="hljs-string">&quot;*&quot;</span>                        <span class="hljs-comment"># 在zuul向其他微服务重定向时保持原本的请求体和响应头信息</span><br>    <span class="hljs-attr">crowd-pay:</span>                                  <span class="hljs-comment"># 自定义路由规则名称</span><br>      <span class="hljs-attr">service-id:</span> <span class="hljs-string">atguigu-crowd-pay</span>             <span class="hljs-comment"># 微服务名称</span><br>      <span class="hljs-attr">path:</span> <span class="hljs-string">/pay/**</span>                             <span class="hljs-comment"># auth已经通过/**访问，此时需要加个/pay</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="目标-35"><a href="#目标-35" class="headerlink" title="目标"></a>目标</h2><p>点击支持后，跳转到支付页面，支付后保存支付的信息到数据库。</p>
<h2 id="思路-35"><a href="#思路-35" class="headerlink" title="思路"></a>思路</h2><p><img src="/img/atcrowdfunding.assets/image-20220203124942748.png" alt="image-20220203124942748"></p>
<h2 id="前端-24"><a href="#前端-24" class="headerlink" title="前端"></a>前端</h2><ul>
<li><p>点击支持，提交表单</p>
<p>此时由于数据在多张表单，此时我们使用一个空表单，将数据全部收集在一个表单中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--建立空表单用于提交支付信息--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;summaryForm&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/pay/generate/order&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>绑定支持单击事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 支付按钮的单击响应事件</span><br>$(<span class="hljs-string">&quot;#payBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// 收集要提交给表单的数据</span><br>    <span class="hljs-keyword">var</span> addressId = $(<span class="hljs-string">&quot;[name=addressId]:checked&quot;</span>).val();<br>    <span class="hljs-keyword">var</span> invoice = $(<span class="hljs-string">&quot;[name=invoiceRadio]:checked&quot;</span>).val();<br>    <span class="hljs-keyword">var</span> invoiceTitle = $.trim($(<span class="hljs-string">&quot;[name=invoiceTitle]&quot;</span>).val());<br>    <span class="hljs-keyword">var</span> remark = $.trim($(<span class="hljs-string">&quot;[name=remark]&quot;</span>).val());<br>    <span class="hljs-comment">// 提交表单</span><br>    $(<span class="hljs-string">&quot;#summaryForm&quot;</span>)<br>        .append(<span class="hljs-string">&quot;&lt;input type=&#x27;hidden&#x27; name=&#x27;addressId&#x27; value=&#x27;&quot;</span>+ addressId +<span class="hljs-string">&quot;&#x27; /&gt;&quot;</span>)<br>        .append(<span class="hljs-string">&quot;&lt;input type=&#x27;hidden&#x27; name=&#x27;invoice&#x27; value=&#x27;&quot;</span>+ invoice +<span class="hljs-string">&quot;&#x27; /&gt;&quot;</span>)<br>        .append(<span class="hljs-string">&quot;&lt;input type=&#x27;hidden&#x27; name=&#x27;invoiceTitle&#x27; value=&#x27;&quot;</span>+ invoiceTitle +<span class="hljs-string">&quot;&#x27; /&gt;&quot;</span>)<br>        .append(<span class="hljs-string">&quot;&lt;input type=&#x27;hidden&#x27; name=&#x27;orderRemark&#x27; value=&#x27;&quot;</span>+ remark +<span class="hljs-string">&quot;&#x27; /&gt;&quot;</span>)<br>        .submit();<br>&#125;);<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="后端-23"><a href="#后端-23" class="headerlink" title="后端"></a>后端</h2><h3 id="创建实体类-4"><a href="#创建实体类-4" class="headerlink" title="创建实体类"></a>创建实体类</h3><p>订单中VO对象的关系（<strong>级联</strong>关系）<img src="/img/atcrowdfunding.assets/image-20220203130239841.png" alt="image-20220203130239841"></p>
<ul>
<li><p>创建orderVO接收表单所有数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderVO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-comment">// 主键</span><br>    <span class="hljs-keyword">private</span> Integer id;<br><br>    <span class="hljs-comment">// 订单号</span><br>    <span class="hljs-keyword">private</span> String orderNum;<br><br>    <span class="hljs-comment">// 支付宝流水单号</span><br>    <span class="hljs-keyword">private</span> String payOrderNum;<br><br>    <span class="hljs-comment">// 订单金额</span><br>    <span class="hljs-keyword">private</span> Double orderAmount;<br><br>    <span class="hljs-comment">// 是否开发票</span><br>    <span class="hljs-keyword">private</span> Integer invoice;<br><br>    <span class="hljs-comment">// 发票抬头</span><br>    <span class="hljs-keyword">private</span> String invoiceTitle;<br><br>    <span class="hljs-comment">// 备注</span><br>    <span class="hljs-keyword">private</span> String orderRemark;<br><br>    <span class="hljs-keyword">private</span> String addressId;<br><br>    <span class="hljs-keyword">private</span> OrderProjectVO orderProjectVO;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="创建配置类-1"><a href="#创建配置类-1" class="headerlink" title="创建配置类"></a>创建配置类</h3><ul>
<li><p>配置调用支付宝时需要使用的参数，注意绑定配置文件中的前缀为ali.pay</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;ali.pay&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PayProperties</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String appId;<br>    <span class="hljs-keyword">private</span> String merchantPrivateKey;<br>    <span class="hljs-keyword">private</span> String alipayPublicKey;<br>    <span class="hljs-keyword">private</span> String notifyUrl;<br>    <span class="hljs-keyword">private</span> String returnUrl;<br>    <span class="hljs-keyword">private</span> String signType;<br>    <span class="hljs-keyword">private</span> String charset;<br>    <span class="hljs-keyword">private</span> String gatewayUrl;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>yml配置文件配置参数值</p>
<p><strong>merchantPrivateKey</strong>填写沙箱中的<strong>应用私钥</strong></p>
<p><strong>alipayPublicKey</strong>填写沙箱中的<strong>支付宝公钥</strong></p>
<p><strong>returnUrl</strong>是浏览器访问，所以通过网关调用我们的handler处理</p>
<p><strong>notifyUrl</strong>是支付宝调用我们返回值，此时需要<strong>内网穿透</strong>才可以访问我们，所以需要<strong>启动natapp</strong>填写<strong>内网穿透url</strong></p>
<p><strong>gatewayUrl</strong>沙箱提供的支付宝网关</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">ali:</span><br>  <span class="hljs-attr">pay:</span><br>    <span class="hljs-attr">appId:</span> <span class="hljs-number">2021000119607739</span>								<span class="hljs-comment"># 沙箱提供的appId</span><br>    <span class="hljs-attr">merchantPrivateKey:</span> <span class="hljs-string">...</span><br>    <span class="hljs-attr">alipayPublicKey:</span> <span class="hljs-string">...</span><br>    <span class="hljs-attr">notifyUrl:</span> <span class="hljs-string">http://56x6a9.natappfree.cc/pay/notify</span>     <span class="hljs-comment"># 支付宝需要访问我们，所以内网穿透启动后填写</span><br>    <span class="hljs-attr">returnUrl:</span> <span class="hljs-string">http://localhost/pay/return</span>                <span class="hljs-comment"># return时浏览器访问，所以可以通过zuul访问</span><br>    <span class="hljs-attr">signType:</span> <span class="hljs-string">RSA2</span><br>    <span class="hljs-attr">charset:</span> <span class="hljs-string">utf-8</span>                                        <span class="hljs-comment"># 字符集编码</span><br>    <span class="hljs-attr">gatewayUrl:</span> <span class="hljs-string">https://openapi.alipaydev.com/gateway.do</span>  <span class="hljs-comment"># 支付宝网关</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="handler方法处理支付请求"><a href="#handler方法处理支付请求" class="headerlink" title="handler方法处理支付请求"></a>handler方法处理支付请求</h3><ul>
<li><p>点击支持后处理请求，获取表单数据封装对象，并保存到<strong>session</strong>中，方便支付宝返回信息后再次封装对象，最后调用封装的方法给支付宝发送请求（注意存入和取出session保存在redis中的对象时，该对象需要<strong>序列化</strong>）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PayHandler</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> PayProperties payProperties;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MysqlRemoteService mysqlRemoteService;<br><br>    Logger logger = LoggerFactory.getLogger(PayHandler.class);<br><br>    <span class="hljs-comment">// 必须加上@ResponseBody，让当前方法的返回值成为响应体，当前方法在页面上显示支付宝支付界面</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/generate/order&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">generateOrder</span><span class="hljs-params">(OrderVO orderVO, HttpSession session)</span> <span class="hljs-keyword">throws</span> AlipayApiException, UnsupportedEncodingException </span>&#123;<br>        <span class="hljs-comment">// 从seesion域中获取OrderProjectVO对象</span><br>        OrderProjectVO orderProjectVO = (OrderProjectVO) session.getAttribute(CrowdConstant.ATTR_NAME_ORDER_PROJECT);<br>        <span class="hljs-comment">// 将OrderProjectVO和OrderVO组合</span><br>        orderVO.setOrderProjectVO(orderProjectVO);<br><br>        <span class="hljs-comment">// 设置订单号</span><br>        <span class="hljs-comment">// 当前的时间</span><br>        String nowTime = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyyMMddHHmmss&quot;</span>).format(<span class="hljs-keyword">new</span> Date());<br>        <span class="hljs-comment">// UUID生成用户名</span><br>        String user = UUID.randomUUID().toString().replace(<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).toUpperCase();<br>        <span class="hljs-comment">// 拼接订单号</span><br>        String orderNum = nowTime + user;<br>        <span class="hljs-comment">// 将订单号设置到OrderVO中</span><br>        orderVO.setOrderNum(orderNum);<br><br>        <span class="hljs-comment">// 计算总金额</span><br>        Double orderAmount = (<span class="hljs-keyword">double</span>) (orderProjectVO.getFreight() + orderProjectVO.getReturnCount() * orderProjectVO.getSupportPrice());<br>        orderVO.setOrderAmount(orderAmount);<br><br>        <span class="hljs-comment">// 先将orderVO保存到session域</span><br>        session.setAttribute(CrowdConstant.ATTR_NAME_ORDER, orderVO);<br><br>        <span class="hljs-comment">// 调用专门封装好的方法给支付宝接口发送请求</span><br>        <span class="hljs-keyword">return</span> sendRequestToAliPay(orderNum, orderAmount, orderProjectVO.getProjectName(), orderProjectVO.getReturnContent());<br>    &#125;<br>    &#125;<br></code></pre></td></tr></table></figure></li>
<li><p>封装的发送请求方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 发送请求给支付宝</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> orderNum    订单号</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> orderAmount 总金额</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> subject     商品的描述，可以使用项目名称</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> body        商品的描述，这里可以使用回报描述</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> 返回到页面上显示支付宝页面</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> AlipayApiException</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> UnsupportedEncodingException</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">sendRequestToAliPay</span><span class="hljs-params">(String orderNum, Double orderAmount, String subject, String body)</span> <span class="hljs-keyword">throws</span> AlipayApiException, UnsupportedEncodingException </span>&#123;<br><br>    <span class="hljs-comment">//获得初始化的AlipayClient</span><br>    AlipayClient alipayClient = <span class="hljs-keyword">new</span> DefaultAlipayClient(<br>            payProperties.getGatewayUrl(),<br>            payProperties.getAppId(),<br>            payProperties.getMerchantPrivateKey(),<br>            <span class="hljs-string">&quot;json&quot;</span>,<br>            payProperties.getCharset(),<br>            payProperties.getAlipayPublicKey(),<br>            payProperties.getSignType());<br><br>    <span class="hljs-comment">//设置请求参数</span><br>    AlipayTradePagePayRequest alipayRequest = <span class="hljs-keyword">new</span> AlipayTradePagePayRequest();<br>    alipayRequest.setReturnUrl(payProperties.getReturnUrl());<br>    alipayRequest.setNotifyUrl(payProperties.getNotifyUrl());<br><br><br>    alipayRequest.setBizContent(<span class="hljs-string">&quot;&#123;\&quot;out_trade_no\&quot;:\&quot;&quot;</span> + orderNum + <span class="hljs-string">&quot;\&quot;,&quot;</span><br>            + <span class="hljs-string">&quot;\&quot;total_amount\&quot;:\&quot;&quot;</span> + orderAmount + <span class="hljs-string">&quot;\&quot;,&quot;</span><br>            + <span class="hljs-string">&quot;\&quot;subject\&quot;:\&quot;&quot;</span> + subject + <span class="hljs-string">&quot;\&quot;,&quot;</span><br>            + <span class="hljs-string">&quot;\&quot;body\&quot;:\&quot;&quot;</span> + body + <span class="hljs-string">&quot;\&quot;,&quot;</span><br>            + <span class="hljs-string">&quot;\&quot;product_code\&quot;:\&quot;FAST_INSTANT_TRADE_PAY\&quot;&#125;&quot;</span>);<br><br>    <span class="hljs-comment">//若想给BizContent增加其他可选请求参数，以增加自定义超时时间参数timeout_express来举例说明</span><br>    <span class="hljs-comment">//alipayRequest.setBizContent(&quot;&#123;\&quot;out_trade_no\&quot;:\&quot;&quot;+ out_trade_no +&quot;\&quot;,&quot;</span><br>    <span class="hljs-comment">//    + &quot;\&quot;total_amount\&quot;:\&quot;&quot;+ total_amount +&quot;\&quot;,&quot;</span><br>    <span class="hljs-comment">//    + &quot;\&quot;subject\&quot;:\&quot;&quot;+ subject +&quot;\&quot;,&quot;</span><br>    <span class="hljs-comment">//    + &quot;\&quot;body\&quot;:\&quot;&quot;+ body +&quot;\&quot;,&quot;</span><br>    <span class="hljs-comment">//    + &quot;\&quot;timeout_express\&quot;:\&quot;10m\&quot;,&quot;</span><br>    <span class="hljs-comment">//    + &quot;\&quot;product_code\&quot;:\&quot;FAST_INSTANT_TRADE_PAY\&quot;&#125;&quot;);</span><br>    <span class="hljs-comment">//请求参数可查阅【电脑网站支付的API文档-alipay.trade.page.pay-请求参数】章节</span><br><br>    <span class="hljs-comment">// 返回</span><br>    <span class="hljs-keyword">return</span> alipayClient.pageExecute(alipayRequest).getBody();<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>支付宝返回调用方法，/return请求后，获取支付宝返回信息，封装进对象后，将数据保存到数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-meta">@ResponseBody</span><br>   <span class="hljs-meta">@RequestMapping(&quot;/return&quot;)</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">returnUrlMethod</span><span class="hljs-params">(HttpServletRequest request, HttpSession session)</span> <span class="hljs-keyword">throws</span> UnsupportedEncodingException, AlipayApiException </span>&#123;<br>       <span class="hljs-comment">//获取支付宝GET过来反馈信息</span><br>       Map&lt;String, String&gt; params = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>       Map&lt;String, String[]&gt; requestParams = request.getParameterMap();<br>       <span class="hljs-keyword">for</span> (Iterator&lt;String&gt; iter = requestParams.keySet().iterator(); iter.hasNext(); ) &#123;<br>           String name = iter.next();<br>           String[] values = requestParams.get(name);<br>           String valueStr = <span class="hljs-string">&quot;&quot;</span>;<br>           <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; values.length; i++) &#123;<br>               valueStr = (i == values.length - <span class="hljs-number">1</span>) ? valueStr + values[i]<br>                       : valueStr + values[i] + <span class="hljs-string">&quot;,&quot;</span>;<br>           &#125;<br>           <span class="hljs-comment">//乱码解决，这段代码在出现乱码时使用</span><br>           <span class="hljs-comment">//valueStr = new String(valueStr.getBytes(&quot;ISO-8859-1&quot;), &quot;utf-8&quot;);</span><br>           params.put(name, valueStr);<br>       &#125;<br><br>       <span class="hljs-keyword">boolean</span> signVerified = AlipaySignature.rsaCheckV1(<br>               params,<br>               payProperties.getAlipayPublicKey(),<br>               payProperties.getCharset(),<br>               payProperties.getSignType()); <span class="hljs-comment">//调用SDK验证签名</span><br><br>       <span class="hljs-comment">//——请在这里编写您的程序（以下代码仅作参考）——</span><br>       <span class="hljs-keyword">if</span> (signVerified) &#123;<br>           <span class="hljs-comment">//商户订单号</span><br>           String orderNum = <span class="hljs-keyword">new</span> String(request.getParameter(<span class="hljs-string">&quot;out_trade_no&quot;</span>).getBytes(<span class="hljs-string">&quot;ISO-8859-1&quot;</span>), <span class="hljs-string">&quot;UTF-8&quot;</span>);<br><br>           <span class="hljs-comment">//支付宝交易号</span><br>           String payOrderNum = <span class="hljs-keyword">new</span> String(request.getParameter(<span class="hljs-string">&quot;trade_no&quot;</span>).getBytes(<span class="hljs-string">&quot;ISO-8859-1&quot;</span>), <span class="hljs-string">&quot;UTF-8&quot;</span>);<br><br>           <span class="hljs-comment">//付款金额</span><br>           String orderAmount = <span class="hljs-keyword">new</span> String(request.getParameter(<span class="hljs-string">&quot;total_amount&quot;</span>).getBytes(<span class="hljs-string">&quot;ISO-8859-1&quot;</span>), <span class="hljs-string">&quot;UTF-8&quot;</span>);<br><br>           <span class="hljs-comment">// 将数据保存到数据库</span><br>           OrderVO orderVO = (OrderVO) session.getAttribute(CrowdConstant.ATTR_NAME_ORDER);<br><br>           <span class="hljs-comment">// 设置订单号和支付宝交易号</span><br>           orderVO.setOrderNum(orderNum);<br>           orderVO.setPayOrderNum(payOrderNum);<br><br>           <span class="hljs-comment">// 调用接口执行保存</span><br>           ResultEntity&lt;String&gt; resultEntity = mysqlRemoteService.saveOrderVO(orderVO);<br><br>           logger.info(<span class="hljs-string">&quot;保存结果&quot;</span> + resultEntity.getResult());<br><br>           <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;trade_no:&quot;</span> + orderNum + <span class="hljs-string">&quot;&lt;br/&gt;out_trade_no:&quot;</span> + payOrderNum + <span class="hljs-string">&quot;&lt;br/&gt;total_amount:&quot;</span> + orderAmount;<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>           <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;验签失败&quot;</span>;<br>       &#125;<br>   &#125;<br><br>   <span class="hljs-meta">@RequestMapping(&quot;/notify&quot;)</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyUrlMethod</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> AlipayApiException, UnsupportedEncodingException </span>&#123;<br>       <span class="hljs-comment">//获取支付宝POST过来反馈信息</span><br>       Map&lt;String, String&gt; params = <span class="hljs-keyword">new</span> HashMap&lt;String, String&gt;();<br>       Map&lt;String, String[]&gt; requestParams = request.getParameterMap();<br>       <span class="hljs-keyword">for</span> (Iterator&lt;String&gt; iter = requestParams.keySet().iterator(); iter.hasNext(); ) &#123;<br>           String name = (String) iter.next();<br>           String[] values = (String[]) requestParams.get(name);<br>           String valueStr = <span class="hljs-string">&quot;&quot;</span>;<br>           <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; values.length; i++) &#123;<br>               valueStr = (i == values.length - <span class="hljs-number">1</span>) ? valueStr + values[i]<br>                       : valueStr + values[i] + <span class="hljs-string">&quot;,&quot;</span>;<br>           &#125;<br>           <span class="hljs-comment">//乱码解决，这段代码在出现乱码时使用</span><br>           valueStr = <span class="hljs-keyword">new</span> String(valueStr.getBytes(<span class="hljs-string">&quot;ISO-8859-1&quot;</span>), <span class="hljs-string">&quot;utf-8&quot;</span>);<br>           params.put(name, valueStr);<br>       &#125;<br><br>       <span class="hljs-keyword">boolean</span> signVerified = AlipaySignature.rsaCheckV1(<br>               params,<br>               payProperties.getAlipayPublicKey(),<br>               payProperties.getCharset(),<br>               payProperties.getSignType()); <span class="hljs-comment">//调用SDK验证签名</span><br>       <span class="hljs-comment">//调用SDK验证签名</span><br><br>       <span class="hljs-comment">//——请在这里编写您的程序（以下代码仅作参考）——</span><br><br><span class="hljs-comment">/* 实际验证过程建议商户务必添加以下校验：</span><br><span class="hljs-comment">1、需要验证该通知数据中的out_trade_no是否为商户系统中创建的订单号，</span><br><span class="hljs-comment">2、判断total_amount是否确实为该订单的实际金额（即商户订单创建时的金额），</span><br><span class="hljs-comment">3、校验通知中的seller_id（或者seller_email) 是否为out_trade_no这笔单据的对应的操作方（有的时候，一个商户可能有多个seller_id/seller_email）</span><br><span class="hljs-comment">4、验证app_id是否为该商户本身。</span><br><span class="hljs-comment">*/</span><br>       <span class="hljs-keyword">if</span> (signVerified) &#123;<span class="hljs-comment">//验证成功</span><br>           <span class="hljs-comment">//商户订单号</span><br>           String out_trade_no = <span class="hljs-keyword">new</span> String(request.getParameter(<span class="hljs-string">&quot;out_trade_no&quot;</span>).getBytes(<span class="hljs-string">&quot;ISO-8859-1&quot;</span>), <span class="hljs-string">&quot;UTF-8&quot;</span>);<br><br>           <span class="hljs-comment">//支付宝交易号</span><br>           String trade_no = <span class="hljs-keyword">new</span> String(request.getParameter(<span class="hljs-string">&quot;trade_no&quot;</span>).getBytes(<span class="hljs-string">&quot;ISO-8859-1&quot;</span>), <span class="hljs-string">&quot;UTF-8&quot;</span>);<br><br>           <span class="hljs-comment">//交易状态</span><br>           String trade_status = <span class="hljs-keyword">new</span> String(request.getParameter(<span class="hljs-string">&quot;trade_status&quot;</span>).getBytes(<span class="hljs-string">&quot;ISO-8859-1&quot;</span>), <span class="hljs-string">&quot;UTF-8&quot;</span>);<br><br>           logger.info(<span class="hljs-string">&quot;验证成功!&quot;</span>);<br>           logger.info(<span class="hljs-string">&quot;out_trade_no&quot;</span> + out_trade_no);<br>           logger.info(<span class="hljs-string">&quot;trade_no&quot;</span> + trade_no);<br>           logger.info(<span class="hljs-string">&quot;trade_status&quot;</span> + trade_status);<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>           <span class="hljs-comment">//验证失败</span><br>           logger.info(<span class="hljs-string">&quot;验证失败!&quot;</span>);<br>           <span class="hljs-comment">//调试用，写文本函数记录程序运行情况是否正常</span><br>           <span class="hljs-comment">// String sWord = AlipaySignature.getSignCheckContentV1(params);</span><br>           <span class="hljs-comment">// AlipayConfig.logResult(sWord);</span><br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<p>此时浏览器显示返回的信息，需要将数据保存到数据库。</p>
<h3 id="保存信息"><a href="#保存信息" class="headerlink" title="保存信息"></a>保存信息</h3><p><img src="/img/atcrowdfunding.assets/image-20220203125343258.png" alt="image-20220203125343258"></p>
<h4 id="api工程-7"><a href="#api工程-7" class="headerlink" title="api工程"></a>api工程</h4><ul>
<li><p>暴露接口，实体类注意使用@RequestBody</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/save/ordervo/remote&quot;)</span><br><span class="hljs-function">ResultEntity&lt;String&gt; <span class="hljs-title">saveOrderVO</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrderVO orderVO)</span></span>;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="mysql工程"><a href="#mysql工程" class="headerlink" title="mysql工程"></a>mysql工程</h4><ul>
<li><p>handler方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/save/ordervo/remote&quot;)</span><br><span class="hljs-function">ResultEntity&lt;String&gt; <span class="hljs-title">saveOrderVO</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrderVO orderVO)</span> </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        orderService.insertOrderVO(orderVO);<br>        <span class="hljs-keyword">return</span> ResultEntity.successWithoutData();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception exception) &#123;<br>        exception.printStackTrace();<br>        <span class="hljs-keyword">return</span> ResultEntity.failed(exception.getMessage());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>OrderService接口和实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insertOrderVO</span><span class="hljs-params">(OrderVO orderVO)</span></span>;<br></code></pre></td></tr></table></figure>

<p>注意需要<strong>先保存orderPO再取出id</strong>保存到orderProjectPO对象的orderId字段中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Transactional(readOnly = false , propagation = Propagation.REQUIRES_NEW , rollbackFor = Exception.class)</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertOrderVO</span><span class="hljs-params">(OrderVO orderVO)</span> </span>&#123;<br>    OrderPO orderPO = <span class="hljs-keyword">new</span> OrderPO();<br>    BeanUtils.copyProperties(orderVO , orderPO);<br>    OrderProjectPO orderProjectPO = <span class="hljs-keyword">new</span> OrderProjectPO();<br>    BeanUtils.copyProperties(orderVO.getOrderProjectVO() , orderProjectPO);<br>    orderPOMapper.insert(orderPO);<br>    Integer orderId = orderPO.getId();<br>    orderProjectPO.setOrderId(orderId);<br>    orderProjectPOMapper.insert(orderProjectPO);<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>保存orderPO再取出id需要在xml的insert方法中设置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.atguigu.crowd.entity.po.OrderPO&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span> &gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/SSM/">SSM</a>
                    
                      <a class="hover-with-bg" href="/tags/SpringBoot/">SpringBoot</a>
                    
                      <a class="hover-with-bg" href="/tags/SpringCloud/">SpringCloud</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/01/05/linux/">
                        <span class="hidden-mobile">Linux</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>





  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
